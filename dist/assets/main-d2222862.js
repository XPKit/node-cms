import{V as me,a as p,i as Ie,_ as i,E as ae,b as C,c as $,d as xe,e as O,r as ke,f as pe,g as v,h as f,j as fe,k as W,l as H,m as k,n as De,o as K,p as Oe,q as ge,s as _e,t as Me,u as ve,v as Fe,w as Ae,x as oe,y as te,z as ye,A as Ne,B as be,C as Ve,D as Ue,F as Pe,G as ce,H as B,I as Ce,J as Be,K as qe,L as je,M as N,N as G,O as u,P as He,Q as ze,R as Q,S as Ke,T as Ge,U as Ye,W as We,X as Qe,Y as Xe,Z as Ze,$ as Je,a0 as et,a1 as tt,a2 as st,a3 as it,a4 as at,a5 as rt,a6 as nt,a7 as lt,a8 as P,a9 as ot,aa as ct,ab as dt,ac as X,ad as ut,ae as ht,af as mt,ag as pt,ah as ft,ai as gt,aj as _t,ak as we,al as vt,am as yt,an as bt,ao as Ct}from"./vendor-b4394ecc.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const $e=new me({theme:{themes:{light:{primary:"#00095B","node-cms-black":"#00142E","node-cms-blue":"#00095B","node-cms-grabber":"#1700F4","node-cms-twilight":"#00142E","node-cms-grey":"#AFAFAF","node-cms-light-grey":"#DBDBDB","node-cms-light-white-grey":"#EDEDED","node-cms-off-white":"#F6F6F6","node-cms-red":"#C90000"},dark:{primary:"#00142E","node-cms-black":"#00142E","node-cms-blue":"00142E","node-cms-grabber":"00142E","node-cms-twilight":"00142E","node-cms-grey":"00142E","node-cms-light-grey":"00142E","node-cms-light-white-grey":"00142E","node-cms-off-white":"00142E","node-cms-red":"00142E"}}},icons:{iconfont:"mdi"}});p.use(me);p.use(Ie,{vuetify:$e,iconsGroup:"mdi"});class wt{constructor(){this.isShow=!1,this.list=[]}start(e){this.isShow=!0,this.list=i.union(this.list,[e])}stop(e){this.list=i.difference(this.list,[e]),i.isEmpty(this.list)&&(this.isShow=!1)}}const re=new wt;class $t{constructor(){this.events=new ae}send(e,s="success"){this.events.emit("notification",{message:e,type:s})}}const se=new $t;class St{constructor(){this.user=null,this.logoutCallbackList=[]}init(){console.info("LoginService - init"),setInterval(async()=>{this.checkStatus()},1e3*15)}async getStatus(){try{const{data:e}=await C.get(`${window.location.pathname}login`);return this.user=e,e}catch{return null}}async checkStatus(){let e;const s=i.cloneDeep(this.user);try{e=await this.getStatus()}catch{}i.isEmpty(e)&&!i.isEmpty(s)&&(console.info("will logout"),await this.logout())}async changeTheme(e){try{const s=i.get(this.user,"theme","dark")==="dark"?"light":"dark";console.warn("changeTheme ",this.user,s),await C.get(`${window.location.pathname}changeTheme/${s}`),console.warn("Successfully changed the theme for user")}catch(s){console.error("Failed to change theme: ",s)}}async logout(){this.user=null;try{await C.get(`${window.location.pathname}logout`),window.location.reload()}catch(e){console.error("Failed to logout: ",e)}i.each(this.logoutCallbackList,e=>{e()})}onLogout(e){this.logoutCallbackList.push(e)}checkPermission(e){return i.includes(this.user.group.modules,e)}}const F=new St;class Lt{constructor(){this.config={}}async init(){try{const{data:e}=await $.get(`${window.location.pathname}config`);this.config=e}catch(e){console.error("Error during init of ConfigService:",e)}}}const V=new Lt;let Tt=class{constructor(){this.dict={},this.locale="enUS"}async init(){const{data:e}=await $.get(`${window.location.pathname}i18n/config.json`);this.config=i.get(e,"config.language",{defaultLocale:"enUS",locales:["enUS"]}),this.locale=i.get(this.config,"defaultLocale","enUS");for(const s of this.config.locales)try{const{data:a}=await $.get(`${window.location.pathname}i18n/${s}.json`);this.dict[s]=a}catch(a){console.warn(`TranslateService wasn't able to pull ${s}: `,a)}}setLocale(e){this.locale=e}get(e,s,a){if(i.isString(e)){const r=this.dict[s||this.locale]&&this.dict[s||this.locale][e];return r?i.template(r)(a):e}return i.isEmpty(e)?"":e[s||this.locale]||""}};const h=new Tt;class Rt{constructor(){this.cacheMap={}}async cache(e){const{data:s}=await $.get(`${window.location.pathname}../api/${e}`);return i.get(s,"userLoggedOut",!1)?(console.info("Received userLoggedOut from server, will redirect to login page"),window.location.reload(),[]):(this.cacheMap[e]=s,this.get(e))}get(e){const s=this.cacheMap[e];return i.isUndefined(s)&&console.info(`resource (${e}) is not cached`),s}setSchemas(e){this.schemas=e}getSchema(e){return i.find(this.schemas,{title:e})}}const E=new Rt;function m(t,e,s,a,r,n,l,o){var c=typeof t=="function"?t.options:t;e&&(c.render=e,c.staticRenderFns=s,c._compiled=!0),a&&(c.functional=!0),n&&(c._scopeId="data-v-"+n);var d;if(l?(d=function(g){g=g||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!g&&typeof __VUE_SSR_CONTEXT__<"u"&&(g=__VUE_SSR_CONTEXT__),r&&r.call(this,g),g&&g._registeredComponents&&g._registeredComponents.add(l)},c._ssrRegister=d):r&&(d=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),d)if(c.functional){c._injectStyles=d;var _=c.render;c.render=function(L,I){return d.call(I),_(L,I)}}else{var b=c.beforeCreate;c.beforeCreate=b?[].concat(b,d):[d]}return{exports:t,options:c}}const Et={data(){return{}},mounted(){},methods:{notify(t,e="success"){i.get(console,e,console.info)(t),se.send(t,e)}}},It=null,xt=null;var kt=m(Et,It,xt,!1,null,null,null,null);const M=kt.exports,Dt={};var Ot=function(){var e=this,s=e._self._c;return s("div",{staticClass:"showbox active"},[s("div",{staticClass:"loader"},[s("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[s("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"}})])])])},Mt=[],Ft=m(Dt,Ot,Mt,!1,null,null,null,null);const Se=Ft.exports,At={props:{localeList:{type:Array,default:()=>[]}},data(){return{TranslateService:h}},methods:{select(t){h.setLocale(t)}}};var Nt=function(){var e=this,s=e._self._c;return e.localeList&&e.localeList.length>1?s("div",{staticClass:"locale-list"},e._l(e.localeList,function(a,r){return s("div",{key:r,staticClass:"locale",class:{active:e.TranslateService.locale==a},on:{click:function(n){return e.select(a)}}},[e._v(" "+e._s(e._f("translate")("TL_"+a.toUpperCase()))+" ")])}),0):e._e()},Vt=[],Ut=m(At,Nt,Vt,!1,null,null,null,null);const Pt=Ut.exports;class Bt{constructor(){xe(this),this.events=new ae,this.connection=null,this.clientID=0,this.isConnecting=!1,this.isConnected=!1,this.connecting=!1,this.serverUrl=!1}async init(e){this.serverUrl=`ws://${window.location.hostname}:${i.get(e,"webserver.port",9090)}`,this.connect()}connect(){clearTimeout(this.connecting),!this.isConnecting&&(this.isConnecting=!0,this.isConnected=!1,this.events.emit("connected",!1),setTimeout(()=>{this.client=new WebSocket(this.serverUrl,"json"),console.info(`Created websocket client for ${this.serverUrl}`),this.client.onopen=this.onOpen,this.client.onclose=this.onClose,this.client.onmessage=this.onMessage},150))}onClose(e){console.info("Websocket - onClose",e),this.isConnecting=!1,this.isConnected=!1,this.events.emit("connected",!1),clearTimeout(this.heatbeat),clearTimeout(this.connecting),this.connecting=setTimeout(async()=>{await this.connect()},500)}onOpen(e){this.onHeartbeat(),this.isConnecting=!1,this.isConnected=!0,this.events.emit("connected",!0)}onMessage(e){const s=JSON.parse(e.data),a=i.get(s,"action","??");if(a==="ping")return this.pong();this.events.emit(a,i.get(s,"data",{}))}pong(){this.send({action:"pong",bearer:"9-0123456789"}),this.onHeartbeat()}send(e){try{this.client&&this.client.send(JSON.stringify(e))}catch(s){console.error("WebSocket::send: Error:",s)}}onHeartbeat(){clearTimeout(this.heatbeat),this.heatbeat=setTimeout(()=>{this.client.close()},3e4+5e3)}}const A=new Bt;O.extend(ke);const qt={props:{config:{type:[Object,Boolean],default:!1}},data(){return{TranslateService:h,destroyed:!1,type:null,timer:null,system:{cpu:{count:0,usage:0,model:"Unknown"},memory:{totalMemMb:0,usedMemMb:0,freeMemMb:0,freeMemPercentage:0},network:"not supported",drive:"not supported",uptime:0}}},computed:{showLogoutButton(){return!i.get(window,"disableJwtLogin",!1)}},async mounted(){A.events.on("getSystemInfo",t=>{this.system=t,this.$forceUpdate()}),await A.init(this.config),this.getSystemData()},destroyed(){this.destroyed=!0,clearTimeout(this.timer)},methods:{getTheme(){return i.get(F,"user.theme","light")==="dark"},async onChangeTheme(t){this.$vuetify.theme.dark=t},async logout(){await F.logout()},async getSystemData(){try{A.send({action:"getSystemInfo"})}catch(t){console.error(t)}this.destroyed||(this.timer=setTimeout(this.getSystemData,this.error?1e4:5e3))},select(t){this.$emit("selectItem",t)},timeAgo(t){return O().subtract(parseInt(t,10),"second").fromNow()},convertBytes(t){const e=["MB","GB","TB"];if(t===0)return"0 MB";if(Math.log(t)<=0)return`${t.toFixed(1)} MB`;const s=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return s<=0?t+" "+e[s]:(t/Math.pow(1024,s)).toFixed(1)+" "+e[s]}}};var jt=function(){var e=this,s=e._self._c;return s("div",{staticClass:"system-info"},[s(pe,{attrs:{"content-class":"system-info-menu","offset-y":"","close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:r}){return[s(v,e._g(e._b({attrs:{icon:""}},"v-btn",r,!1),a),[s(f,[e._v("mdi-cog-outline")])],1)]}}])},[s("div",{staticClass:"system-info-wrapper"},[s("div",{staticClass:"theme-switch"},[s("div",{staticClass:"theme-switch-container"},[s(f,[e._v("mdi-theme-light-dark")]),s(fe,{attrs:{"input-value":e.getTheme(),compact:"",dense:"","hide-details":"",solo:""},on:{change:e.onChangeTheme}})],1)]),s("div",{staticClass:"node-cms-title flex"},[e._v(" "+e._s(e._f("translate")("TL_SYSTEM"))+" "),e.showLogoutButton?s(v,{attrs:{color:"error",small:""},on:{click:function(a){return e.logout()}}},[s(f,{attrs:{small:"",color:"black"}},[e._v("mdi-link-variant-off")]),e._v(e._s(e._f("translate")("TL_LOGOUT")))],1):e._e()],1),s("div",{staticClass:"stats cpu"},[s("div",{staticClass:"node-cms-title"},[s("small",[s("b",[e._v("CPU Usage")])])]),s(W,{attrs:{color:"#6af",rounded:"",value:e.system.cpu.usage}}),s("small",{staticClass:"text"},[e._v(e._s(e.system.cpu.count)+" cores ("+e._s(e.system.cpu.model)+")")])],1),s("div",{staticClass:"stats ram"},[s("div",{staticClass:"node-cms-title"},[s("small",[s("b",[e._v("Memory Usage")])])]),s(W,{attrs:{color:"#6af",rounded:"",value:100-e.system.memory.freeMemPercentage}}),s("small",{staticClass:"text"},[e._v(e._s(e.convertBytes(e.system.memory.usedMemMb))+" / "+e._s(e.convertBytes(e.system.memory.totalMemMb)))])],1),e.system.drive!="not supported"?s("div",{staticClass:"stats drive"},[s("div",{staticClass:"node-cms-title"},[s("small",[s("b",[e._v("Disk Usage")])])]),s(W,{attrs:{color:"#6af",rounded:"",value:100-e.system.drive.usedPercentage}}),s("small",{staticClass:"text"},[e._v(e._s(e.convertBytes(e.system.drive.usedGb*1024))+" / "+e._s(e.convertBytes(e.system.drive.totalGb*1024)))])],1):e._e(),s("div",{staticClass:"stats two-by-two"},[e.system.network!="not supported"?s("div",{staticClass:"stats network"},[s("div",{staticClass:"node-cms-title"},[s("small",[s("b",[e._v("Network Usage")])])]),s("small",{staticClass:"text"},[e._v(e._s(e.convertBytes(e.system.network.total.outputMb))+" "),s(f,[e._v("mdi-arrow-up")]),e._v(" / "+e._s(e.convertBytes(e.system.network.total.inputMb))+" "),s(f,[e._v("mdi-arrow-down")])],1)]):e._e(),s("div",{staticClass:"stats uptime"},[s("div",{staticClass:"node-cms-title"},[s("small",[s("b",[e._v("Uptime")])])]),s("small",{staticClass:"text"},[e._v(e._s(e.timeAgo(e.system.uptime)))])])])])])],1)},Ht=[],zt=m(qt,jt,Ht,!1,null,"72b13096",null,null);const Kt=zt.exports;class Gt{constructor(){this.events=new ae}select(e){this.events.emit("select",e)}}const Le=new Gt;const Yt={props:{selectResourceCallback:{type:Function,default:()=>{}},groupedList:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},data(){return{showOmnibar:!1,search:null,resourcesList:[],results:[],highlightedItem:0,searchModes:["all","resources","fields"],searchMode:"all",shortcuts:{esc:["esc"],open:["ctrl","p"],"arrow-up":["arrowup"],"arrow-down":["arrowdown"],enter:["enter"],all:["shift","a"],resources:["shift","r"],fields:["shift","f"]}}},watch:{search(){this.highlightedItem=0;let t=[];this.results=[],this.searchMode==="all"?t=H.go(this.search,i.concat(this.resourcesList,this.fieldsList),{key:"displayname"}):this.searchMode==="resources"?t=H.go(this.search,this.resourcesList,{key:"title"}):this.searchMode==="fields"&&(t=H.go(this.search,this.fieldsList,{key:"title"})),this.results=i.map(t,e=>(e.html=H.highlight(e),e))}},mounted(){this.resourcesList=i.map(i.flatten(i.map(this.groupedList,"list")),t=>(t.type="resource",t.displayname=i.get(t,"displayname.enUS",i.get(t,"displayname",t.title)),t)),this.fieldsList=i.flatten(i.map(this.resourcesList,t=>i.map(t.schema,e=>(e.resource=t,e.displayname=`${t.displayname}.${i.get(e,"label.enUS",i.get(e,"label",e.field))}`,e.type="field",e))))},methods:{getIcon(t){return this.searchMode==="all"?t.obj.type==="resource"?"mdi-package":"mdi-cursor-text":this.searchMode==="resource"?"mdi-package":"mdi-cursor-text"},isCharHighlighted(t,e){return i.includes(i.values(t._indexes),e)},showHideOmnibar(t){this.showOmnibar=t,this.setSearchMode("all"),t&&this.$nextTick(()=>{i.get(this.$refs,"['search']",!1).focus()})},selectResult(t=-1){const e=i.get(this.results,`[${t===-1?this.highlightedItem:t}].obj`,!1),s=i.includes(["resource","plugin"],e.type)?e:e.resource;s!==this.selectedItem?(console.info(`Switching to resource ${s.title}`),this.selectResourceCallback(s)):e.type==="field"&&Le.events.emit("select",i.omit(e,"resource")),this.showHideOmnibar(!1)},setSearchMode(t){this.searchMode=t,this.search=""},async interactiveSearch(t){const e=i.get(t,"srcKey",!1);if(e){if(!this.showOmnibar){e==="open"&&this.showHideOmnibar(!0);return}e==="esc"||e==="open"?this.showHideOmnibar(!1):e==="arrow-up"?this.highlightedItem-=1:e==="arrow-down"?this.highlightedItem+=1:e==="enter"?this.selectResult():i.includes(this.searchModes,e)&&this.setSearchMode(e)}}}};var Wt=function(){var e=this,s=e._self._c;return s("div",{directives:[{name:"shortkey",rawName:"v-shortkey",value:e.shortcuts,expression:"shortcuts"}],attrs:{id:"omnibar"},on:{shortkey:e.interactiveSearch}},[s(k,{directives:[{name:"show",rawName:"v-show",value:e.showOmnibar,expression:"showOmnibar"}],attrs:{elevation:"24"}},[s(De,[s(K,{ref:"search",staticClass:"search-bar",attrs:{flat:"",outlined:"","hide-details":"",dense:"",placeholder:e._f("translate")("TL_SEARCH"),type:"text",autocomplete:"off",name:"search",prefix:e.searchMode==="all"?"":`${e.searchMode}:`},model:{value:e.search,callback:function(a){e.search=a},expression:"search"}})],1),e.results.length>0?[s(Oe),s(ge,{attrs:{dense:""}},e._l(e.results,function(a,r){return s(_e,{key:r,class:{highlighted:e.highlightedItem===r},on:{click:function(n){return e.selectResult(r)}}},[s(Me,[s(ve,[s(f,{attrs:{color:"light-grey",small:""}},[e._v(e._s(e.getIcon(a)))]),s("span",{domProps:{innerHTML:e._s(a.html)}})],1)],1)],1)}),1)]:e._e()],2)],1)},Qt=[],Xt=m(Yt,Wt,Qt,!1,null,null,null,null);const Zt=Xt.exports;const Jt={components:{Omnibar:Zt},props:{selectResourceCallback:{type:Function,default:()=>{}},resourceList:{type:Array,default:()=>[]},plugins:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},computed:{groupedList(){const t={name:"TL_OTHERS"},e={name:"TL_PLUGINS"};let s=[t,e],a=i.union(this.resourceList,i.map(this.plugins,r=>i.extend(r,{type:"plugin"})));return i.each(a,r=>{i.isEmpty(r.group)||i.isString(r.group)||i.find(s,l=>{if(i.isEqual(l.name,r.group))return l})||s.push({name:r.group})}),i.each(a,r=>{i.isEmpty(r.group)||i.isString(r.group)&&(i.find(s,l=>{if(l===r.group||l.name===r.group||i.includes(i.values(l.name),r.group))return l})||s.push({name:r.group}))}),i.each(a,r=>{const n=i.find(s,l=>{if(i.isEqual(l.name,r.group)||l===r.group||l.name===r.group||i.includes(i.values(l.name),r.group))return l});if(n){n.list=n.list||[],n.list.push(r);return}r.type==="plugin"?(e.list=e.list||[],e.list.push(r)):(t.list=t.list||[],t.list.push(r))}),s=i.orderBy(s,r=>r.name==="CMS"?String.fromCharCode(0):r===t?String.fromCharCode(255):`${h.get(r.name,"enUS")}`.toLowerCase(),"asc"),i.filter(s,r=>r.list&&r.list.length!==0)}},mounted(){this.$nextTick(()=>{i.isEmpty(this.selectedItem)&&this.selectResourceCallback(i.first(i.get(i.first(this.groupedList),"list",[])))})},methods:{getResourceTitle(t){return t.displayname?h.get(t.displayname):t.title},groupSelected(t){if(!this.selectedItem)return!1;const e=i.get(this.selectedItem,"group.enUS",i.get(this.selectedItem,"group",!1)),s=i.get(t,"name.enUS",t.name);return s==="TL_OTHERS"&&!e?!0:s===e}}};var es=function(){var e=this,s=e._self._c;return e.groupedList?s("div",{staticClass:"resources-content"},[s("omnibar",{attrs:{"select-resource-callback":e.selectResourceCallback,"grouped-list":e.groupedList,"selected-item":e.selectedItem}}),s("div",{staticClass:"resource-list"},e._l(e.groupedList,function(a,r){return s("div",{key:`resource-group-${r}`,staticClass:"resource"},[s(pe,{attrs:{"open-on-hover":"","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:n,attrs:l}){return[s(v,e._g(e._b({class:{selected:e.groupSelected(a)},attrs:{outlined:e.groupSelected(a),text:"",small:""}},"v-btn",l,!1),n),[e._v(" "+e._s(e._f("translate")(a.name))+" ")])]}}],null,!0)},[s(ge,{attrs:{dense:"",nav:""}},e._l(a.list,function(n){return s(_e,{key:n.name,class:{selected:e.selectedItem===n},attrs:{dense:""},on:{click:function(l){return e.selectResourceCallback(n)}}},[s(ve,[e._v(e._s(e.getResourceTitle(n)))])],1)}),1)],1)],1)}),0)],1):e._e()},ts=[],ss=m(Jt,es,ts,!1,null,"926610e4",null,null);const is=ss.exports;const as={components:{SystemInfo:Kt,ResourceList:is},props:{toolbarTitle:{type:[String,Boolean],default:!1},config:{type:[Object,Boolean],default:!1},localeClass:{type:Object,default:()=>{}},selectResourceCallback:{type:Function,default:()=>{}},resourceList:{type:Array,default:()=>[]},plugins:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},methods:{getPageTitle(){const t=[];this.toolbarTitle&&t.push(this.toolbarTitle);const e=this.getSelectedItemName();return e&&t.push(e),i.join(t," - ")},getSelectedItemName(){return i.get(this.selectedItem,"displayname",!1)?h.get(this.selectedItem.displayname):i.get(this.selectedItem,"name",!1)}}};var rs=function(){var e=this,s=e._self._c;return s("div",{staticClass:"nav-bar-wrapper"},[s(Fe,{staticClass:"nav-bar",class:e.localeClass,attrs:{"min-width":"100%",width:"100%",height:"50"}},[s(Ae,[e._v(e._s(e.getPageTitle()))]),s(oe),s("resource-list",{attrs:{"select-resource-callback":e.selectResourceCallback,"resource-list":e.resourceList,plugins:e.plugins,"selected-item":e.selectedItem}}),s(oe),e.config?s("system-info",{attrs:{config:e.config}}):e._e()],1)],1)},ns=[],ls=m(as,rs,ns,!1,null,null,null,null);const os=ls.exports,Te={methods:{getName(t){return this.getValue(t,i.first(this.resource.schema),this.resource.displayItem)},getValue(t,e,s){let a="";if(e){if(e.input==="file"){const r=i(t).get("_attachments",[]).find(n=>n._name===e.field);a=r&&r._filename}else if(e.input==="select"){let r=i.get(t,e.field);i.isString(r)&&(r=i.find(E.get(e.source),{_id:r}),r&&i.each(e.options&&e.options.extraSources,(n,l)=>{const o=i.get(r,l);i.isString(o)&&i.set(r,l,i.find(E.get(n),{_id:o}))})),e.options&&e.options.customLabel?a=te.render(e.options.customLabel,r||{}):a=i.get(r,i.chain(r).keys().first().value(),"")}a===""&&(this.resource.locales&&(e.localised||i.isUndefined(e.localised))?a=i.get(t,`${this.locale}.${e.field}`):a=i.get(t,e.field))}if(s){const r=i.clone(t);i.each(this.getExtraRessources(),(n,l)=>{const o=E.get(n);if(o){const c=i.find(o,{_id:i.get(r,l)});c&&i.set(r,l,c)}}),a=te.render(s,r)}return a},getExtraRessources(){return i.extend(i.get(this.resource,"extraSources",{}),i.get(this.resource,"schema[0].options.extraSources"))}}};const cs={mixins:[Te],props:{list:{type:[Array,Boolean],default:()=>[]},resource:{type:[Object,Boolean],default:()=>{}},selectedItem:{type:Object,default:()=>{}},locale:{type:String,default:"enUS"},multiselect:{type:Boolean,default:!1},multiselectItems:{type:[Array,Boolean],default:()=>[]}},data(){return{cachedMap:{},search:null,TranslateService:h,sift:{isQuery:!1,isValid:!1},query:{},localMultiselectItems:[],includes:i.includes}},computed:{maxCount(){return i.get(this.resource,"maxCount",0)},listCount(){return i.get(this.list,"length",0)},filteredList(){let t=this.getSearchableFields();return t.length===0&&(t=[i.first(this.resource.schema)]),i.forEach(this.list,e=>e._searchable={id:!1,keyFields:!1,query:!1}),this.sift.isQuery?i.forEach(this.list.filter(ye(this.query)),e=>e._searchable.query=!0):i.filter(this.list,e=>{if(i.isEmpty(this.search))return!0;const s=[];i.forEach(t,l=>{s.push(this.getValue(e,l,this.resource.displayItem))});let a=0,r=0;for(const l in this.query){const o=this.query[l];a=a+1;let c=i.get(e,l);i.isUndefined(c)===!1&&(i.isArray(c)?i.includes(c,o)&&(r=r+1):c===o&&(r=r+1))}let n=!1;return a>0&&a===r?(n=!0,e._searchable.query=!0):this.doesMatch(this.search,s)?(n=!0,e._searchable.keyFields=!0):new RegExp(this.search,"i").test(e._id)&&(n=!0,e._searchable.id=!0),n})}},watch:{search:function(){this.query=this.flatten(Ne.parse(this.search)),this.sift.isQuery=!1;try{this.search.search("sift:")===0&&(this.sift.isQuery=!0,this.query=be.parse(this.search.substr(5)),this.sift.isValid=!0)}catch{this.sift.isValid=!1,this.query={}}},multiselectItems(){this.localMultiselectItems=i.cloneDeep(this.multiselectItems)}},async mounted(){},methods:{selectAll(){this.multiselect&&(this.localMultiselectItems.length===this.filteredList.length?this.localMultiselectItems=[]:this.localMultiselectItems=this.filteredList,this.$emit("changeMultiselectItems",this.localMultiselectItems))},dive(t,e,s){for(let a in e)if(a in e){let r=a,n=e[a];t.length>0&&(r=t+"."+a),typeof n=="object"?this.dive(r,n,s):s[r]=n}},flatten(t){let e={};return this.dive("",t,e),e},async interactiveSearch(t){const e=i.get(t,"srcKey",!1),s=i.get(this.$refs,"['search']",!1);if(!(!e||!s))return e==="esc"?s.blur():s.focus()},select(t){this.multiselect?(i.includes(this.multiselectItems,t)?this.localMultiselectItems=i.difference(this.localMultiselectItems,[t]):this.localMultiselectItems.push(t),this.$emit("changeMultiselectItems",this.localMultiselectItems)):this.$emit("selectItem",t)},selectTo(t){if(this.multiselect){const e=i.first(this.localMultiselectItems);let s=!1;for(const a of this.filteredList)a===e&&(this.localMultiselectItems=[a]),s===!0&&this.localMultiselectItems.push(a),a===e&&(s=!0),a===t&&(s=!1);this.$emit("changeMultiselectItems",this.localMultiselectItems)}else this.$emit("selectItem",t)},onClickMultiselect(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!this.multiselect)},onClickNew(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!1),this.$emit("selectItem",{_local:!0})},getSearchableFields(){return i.filter(this.resource.schema,t=>t.searchable===!0)},doesMatch(t,e){let s=!1;return i.forEach(e,a=>{if(s=new RegExp(this.search,"i").test(a),s)return!1}),s}}};var ds=function(){var e=this,s=e._self._c;return e.maxCount!=1?s("div",{staticClass:"record-list"},[s("div",{staticClass:"top-bar"},[s("div",{directives:[{name:"shortkey",rawName:"v-shortkey",value:{esc:["esc"],open:["/"]},expression:"{esc: ['esc'], open: ['/']}"}],staticClass:"search",class:{"is-query":e.sift.isQuery,"is-valid":e.sift.isQuery&&e.sift.isValid==!0,"is-invalid":e.sift.isQuery&&e.sift.isValid==!1},on:{shortkey:e.interactiveSearch}},[s(K,{ref:"search",staticClass:"search-bar",attrs:{flat:"",outlined:"","hide-details":"",dense:"",placeholder:e._f("translate")("TL_SEARCH"),type:"text",name:"search"},model:{value:e.search,callback:function(a){e.search=a},expression:"search"}}),s("div",{staticClass:"multiselect",class:{active:e.multiselect},on:{click:e.onClickMultiselect}},[s(f,{attrs:{color:"black"}},[e._v("mdi-list-box")])],1),e.maxCount<=0||e.listCount<e.maxCount?[s("div",{staticClass:"new",on:{click:e.onClickNew}},[e._v("+")])]:e._e()],2)]),s("div",{directives:[{name:"shortkey",rawName:"v-shortkey",value:e.multiselect?["ctrl","a"]:!1,expression:"multiselect ? ['ctrl', 'a'] : false"}],staticClass:"records",on:{shortkey:function(a){return e.selectAll()}}},[s("RecycleScroller",{staticClass:"list",attrs:{items:e.filteredList,"item-size":80,"key-field":"_id"},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[s("div",{staticClass:"item",class:{selected:a==e.selectedItem||e.multiselect&&e.includes(e.multiselectItems,a),frozen:!a._local},on:{click:[function(r){return r.ctrlKey||r.shiftKey||r.altKey||r.metaKey?null:e.select(a)},function(r){return r.shiftKey?e.selectTo(a):null}]}},[a?s("div",{staticClass:"main"},[s("span",{staticClass:"icon"},[a._searchable?s("span",{staticClass:"searchable"},[a._searchable.query==!0?s(f,[e._v("mdi-target")]):a._searchable.id==!0?s(f,[e._v("mdi-key")]):a._searchable.keyFields==!0?s(f,[e._v("mdi-format-list-bulleted")]):s(f,{staticClass:"default"},[e._v("mdi-format-list-bulleted")])],1):e._e()]),s("span",[e._v(" "+e._s(e.getName(a))+" ")])]):e._e(),s("div",{staticClass:"meta"},[s("span",{staticClass:"id ng-binding"},[s("span",[e._v(e._s(a._id))])]),s("span",{staticClass:"ts"},[e._v(" "+e._s(e._f("translate")("TL_UPDATED"))+" "),s("timeago",{attrs:{since:a._updatedAt,locale:e.TranslateService.locale}})],1)])])]}}],null,!1,1004161279)})],1)]):e._e()},us=[],hs=m(cs,ds,us,!1,null,"eda298fe",null,null);const ms=hs.exports;let q;window.TranslateService?q=window.TranslateService:q=h;const ie=t=>{const e={},s=i.get(t,"model","").split(".");return i.get(t,"localised",!1)&&(e.locale=s.shift()),e.key=s.join("."),e},ps=t=>String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),U={url:t=>{try{return!!new URL(t)}catch{return!1}},number:t=>i.isNumber(t),integer:t=>i.isNumber(t)&&i.isInteger(t),double:t=>i.isNumber(t)&&(i.isInteger(t)||t===+t&&t!==(t|0)),text:t=>i.isString(t),array:t=>i.isArray(t),email:t=>ps(t)},D={fieldIsRequired:q.get("TL_FIELD_IS_REQUIRED"),invalidFormat:q.get("TL_INVALID_FORMAT")},Z=(t,e,s,a)=>{if(i.get(t,"required",!1)&&!i.isNumber(e))return D.fieldIsRequired;const r=i.get(U,a,!1);return r?r(Number(e||0),t,s,D):(console.error(`checkNumber - No validator found for type '${a}'`),!1)},x={array:t=>i.isArray(t),email:t=>new RegExp("/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/").test(t),text:(t,e,s)=>{if(i.get(e,"required",!1)&&(!i.isString(t)||i.isEmpty(t)))return D.fieldIsRequired;const a=i.head(i.get(e,"model","").split("."));if(i.get(e,"regex.value",!1)===!1&&i.get(e,`regex['${a}'].value`,!1)===!1)return!0;let r=!1,n=!1;if(e.localised&&a&&(r=i.get(e,`regex['${a}'].value`,!1),n=i.get(e,`regex['${a}'].description`,!1)),r===!1&&(r=i.get(e,"regex.value",!1),n=i.get(e,"regex.description",!1)),n===!1&&(n=r),r&&i.isString(r)){const l=r.match(/\/(.*?)\/([gimy])?$/);if(!new RegExp(l[1],l[2]||"").test(t))return`${D.invalidFormat} (${q.get(n)})`}return!0},number:(t,e,s)=>Z(e,t,s,"number"),double:(t,e,s)=>Z(e,t,s,"double"),integer:(t,e,s)=>(i.isUndefined(t)&&(t=""),t.toString().indexOf(".")!==-1?!1:Z(e,t,s,"integer")),image:(t,e,s)=>{const{key:a,locale:r}=ie(e),n=i.find(i.get(s,"_attachments",[]),l=>!(l._name!==a||r&&l._fields.locale!==r));return i.get(e,"required",!1)&&!n?D.fieldIsRequired:!0},file:(t,e,s)=>{const{key:a,locale:r}=ie(e),n=i.find(i.get(s,"_attachments",[]),l=>!(l._name!==a||r&&l._fields.locale!==r));return i.get(e,"required",!1)&&!n?D.fieldIsRequired:!0},select:(t,e,s)=>i.get(e,"required",!1)&&i.isEmpty(t)?D.fieldIsRequired:!0};let Re={string:{type:"input",overrideType:"CustomInput",validator:x.text},text:{type:"textarea",overrideType:"CustomTextarea",rows:5,validator:x.text},password:{type:"input",inputFieldType:"password",overrideType:"CustomInput"},email:{type:"input",overrideType:"CustomInput",inputFieldType:"email",validator:U.email},url:{type:"input",overrideType:"CustomInput",validator:U.url},number:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:x.number},double:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:x.double},integer:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:x.integer},checkbox:{type:"switch",overrideType:"CustomSwitch"},date:{type:"CustomDatetimePicker",format:"YYYY-MM-DD",customDatetimePickerOptions:{format:"YYYY-MM-DD"}},time:{type:"CustomDatetimePicker",format:"hh:mm:ss a",customDatetimePickerOptions:{format:"hh:mm:ss a"}},datetime:{type:"CustomDatetimePicker",format:"YYYY-MM-DD hh:mm:ss a",customDatetimePickerOptions:{format:"YYYY-MM-DD hh:mm:ss a"}},pillbox:{type:"CustomInputTag",selectOptions:{taggable:!0,multiple:!0,searchable:!0,onNewTag(t,e,s,a){s.push(t),a.push(t)}},values:[],validator:U.array},select:{type:"CustomMultiSelect",selectOptions:{multiple:!1,trackBy:"_id",customLabel:(t,e)=>i.get(e,t,t),searchable:!0},validator:x.select},multiselect:{type:"CustomChecklist",validator:U.array},json:{type:"TreeView",overrideType:"CustomTreeView",treeViewOptions:{maxDepth:4,rootObjectKey:"root",modifiable:!1}},code:{type:"Code",overrideType:"CustomCode",options:{}},wysiwyg:{type:"Wysiwyg",overrideType:"WysiwygField"},image:{type:"ImageView",validator:x.image},file:{type:"AttachmentView",validator:x.file},paragraph:{type:"ParagraphView"},group:{type:"group",overrideType:"Group"},object:{type:"JsonEditor"},color:{type:"ColorPicker",colorPickerOptions:{}},paragraphImage:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",fileType:"image",validator:x.image},paragraphFile:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",validator:x.file}};i.each(Re,t=>{t.dense=!0,t.outlined=!0});class fs{constructor(){this.typeMapper=Re}getKeyLocale(e){return ie(e)}}const de=new fs;let R;window.TranslateService?R=window.TranslateService:R=h;class gs{constructor(){this.typeMapper=de.typeMapper}getSchemaFields(e,s,a,r,n,l,o){let c=i.map(e,d=>{const _=s.locales&&(d.localised||i.isUndefined(d.localised)),b=d.label&&R.get(d.label);let g=i.extend({},this.typeMapper[d.input],{label:`${b||d.field}${_?` (${R.get(`TL_${a.toUpperCase()}`)})`:""}`,model:_?`${a}.${d.field}`:d.field,originalModel:d.field,placeholder:`${b||d.field}${_?` (${R.get(`TL_${a.toUpperCase()}`)})`:""}`,disabled:n||i.get(d,"options.disabled",!1),readonly:i.get(d,"options.readonly",!1),required:!!d.required,options:d.options,resource:s,locale:a,userLocale:r,rootView:o});if(g=i.merge({},d.options,g),d.input==="file"&&i.get(g,"maxCount",!1)===!1)g.maxCount=1/0;else if(d.input==="select"&&i.get(g,"labels",!1))g.selectOptions.label=i.map(g.labels,(L,I)=>({value:I,text:i.get(L,`${a}`,L)}));else if(d.input==="multiselect"&&i.get(g,"labels",!1)&&!i.isObject(i.first(d.source))){const L=[];i.forEach(d.source,I=>{L.push({text:i.get(g,`labels.${I}`,I),value:I})}),d.source=L}return(d.input==="select"||d.input==="pillbox")&&(g.selectOptions.selectLabel=R.get("TL_MULTISELECT_SELECT_LABEL"),g.selectOptions.selectGroupLabel=R.get("TL_MULTISELECT_SELECT_GROUP_LABEL"),g.selectOptions.selectedLabel=R.get("TL_MULTISELECT_SELECTED_LABEL"),g.selectOptions.deselectLabel=R.get("TL_MULTISELECT_DESELECT_LABEL"),g.selectOptions.deselectGroupLabel=R.get("TL_MULTISELECT_DESELECT_GROUP_LABEL"),g.selectOptions.tagPlaceholder=R.get("TL_MULTISELECT_TAG_PLACEHOLDER")),g});for(const d in e){const _=e[d];i.isArray(_.source)?c[d].values=_.source:i.isString(_.source)&&this.updateFieldSchema(c,_,d,a,l),c[d].localised=s.locales&&(_.localised||i.isUndefined(_.localised))}return c}updateFieldSchema(e,s,a,r,n){const l=E.get(s.source);n=i.extend({},n,i.get(s,"options.extraSources")),i.each(n,(_,b)=>{const g=E.get(_);i.each(l,L=>{const I=i.get(L,b);i.isString(I)&&i.set(L,b,i.find(g,{_id:I}))})});const o=E.getSchema(s.source),c=o&&i.first(o.schema);let d="_id";c&&(d=c.field,o.locales&&r&&(c.localised||i.isUndefined(c.localised))&&(d=`${r}.${d}`)),e[a].values=l||[],e[a].type==="CustomMultiSelect"?(e[a].selectOptions=e[a].selectOptions||{},e[a].selectOptions=i.clone(e[a].selectOptions),e[a].selectOptions.key="_id",e[a].selectOptions.customLabel=_=>{const b=i.isString(_)?i.find(l,{_id:_}):_;return e[a].customLabel?te.render(e[a].customLabel,b):i.get(b,d)}):e[a].type==="CustomChecklist"&&(e[a].customChecklistOptions=e[a].customChecklistOptions||{},e[a].customChecklistOptions.name=d,e[a].customChecklistOptions.value="_id")}getKeyLocale(e){return de.getKeyLocale(e)}getNestedGroups(e,s,a,r,n){let l=i.groupBy(s,o=>{let c=o.originalModel;return n&&(c=c.replace(n,"")),c=c.split("."),c[a]});return l=i.map(l,(o,c)=>{if(i.uniqBy(o,"originalModel").length===1){const b=i.first(o);return o.length>1&&console.warn(`duplicated field '${b.model}' detected in resource '${e.displayname||e.title}'`),b}let d=`${r}.${c}`;i.isUndefined(r)&&(d=c);let _=i.get(e,`groups.${d}.label`,c);return _=R.get(_),i.extend({},this.typeMapper.group,{label:_,key:c,path:r,groupOptions:{fields:this.getNestedGroups(e,o,a+1,r,n)}})}),l}}const z=new gs,ue=window.TranslateService||h,ne={mixins:[M],methods:{async uploadAttachments(t,e){this.$loading.start("uploadAttachments");try{for(const s of e){const a=new FormData;a.append(s._name,s.file),s._fields.locale&&a.append("locale",s._fields.locale),s._filename&&a.append("_filename",s._filename),s._fields.fileItemId&&a.append("fileItemId",s._fields.fileItemId),i.get(s,"cropOptions",!1)&&(console.warn("detected cropOptions, will add it to the request"),a.append("cropOptions",JSON.stringify(s.cropOptions))),i.get(s,"orderUpdated",!1)&&i.get(s,"order",!1)&&a.append("order",s.order),await $.post(`../api/${this.resource.title}/${t}/attachments`,a)}}catch(s){console.error("Error happen during uploadAttachments:",s)}this.$loading.stop("uploadAttachments")},async updateAttachments(t,e){this.$loading.start("updateAttachments");try{for(const[s,a]of e.entries()){const r=i.omit(i.get(a,"cropOptions",{}),["updated"]),n=i.get(a,"order",s+1);await $.put(`../api/${this.resource.title}/${t}/attachments/${a._id}`,{cropOptions:r,order:n})}}catch(s){console.error("Error happen during updateAttachments:",s)}this.$loading.stop("updateAttachments")},async removeAttachments(t,e){this.$loading.start("remove-attachments");try{for(const s of e)await $.delete(`../api/${this.resource.title}/${t}/attachments/${s._id}`)}catch(s){console.error("Error happen during removeAttachments:",s)}this.$loading.stop("remove-attachments")},getTypePrexix(t){let e=!1;return t==="create"?e="TL_ERROR_ON_RECORD_CREATION":t==="update"?e="TL_ERROR_ON_RECORD_UPDATE":t==="delete"&&(e="TL_ERROR_ON_RECORD_DELETE"),e?ue.get(e):"Error"},manageError(t,e,s){let a=this.getTypePrexix(e),r=a;if(i.get(t,"response.data.code",500)===400){const n=i.get(t,"response.data");i.get(n,"message",!1)?r=`${a}: ${n.message}`:r=`${a}: ${ue.get("TL_UNKNOWN_ERROR")}`}console.error(r,s),this.notify(r,"error")},async updateSchema(){try{const t=!(this.record&&this.record._local);this.$loading.start("loading-schema");const e=z.getSchemaFields(this.resource.schema,this.resource,this.locale||this.userLocale,this.userLocale,t,this.resource.extraSources);this.$loading.stop("loading-schema");const s=z.getNestedGroups(this.resource,e,0);this.schema.fields=s,this.originalFieldList=e}catch(t){console.error("AbstractEditorView - updateSchema - Error happen during updateSchema:",t)}}}},_s={mixins:[ne,M],props:{resourceList:{type:[Array,Boolean],default:()=>[]},resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}},locale:{type:String,default:()=>"enUS"},userLocale:{type:String,default:()=>"enUS"}},data(){return{formValid:!1,fileInputTypes:["file","img","image","imageView","attachmentView"],cachedMap:{},editingRecord:{},activeLocale:i.indexOf(this.resource.locales,this.locale),originalFieldList:[],schema:{fields:[]},isReady:!1,formOptions:{validateAfterLoad:!0,validateAfterChanged:!0},rowOptions:{justify:"start",align:"start",noGutters:!1}}},watch:{async locale(){await this.updateSchema(),this.editingRecord=i.clone(this.editingRecord),this.activeLocale=i.indexOf(this.resource.locales,this.locale),this.checkDirty()},async record(){await this.updateSchema(),this.cloneEditingRecord()},async userLocale(){await this.updateSchema(),this.editingRecord=i.clone(this.editingRecord),this.checkDirty()},model(){console.warn("MODEL CHANGED: ",this.model)}},async mounted(){await this.updateSchema(),this.cloneEditingRecord(),this.isReady=!0,console.warn("EDITING RECORD - ",this.editingRecord)},methods:{back(){this.$emit("back")},onError(t){console.log(999,"error",t)},selectLocale(t){this.activeLocale=i.indexOf(this.resource.locales,t),this.$emit("update:locale",t)},cloneEditingRecord(){const t={};i.each(this.resource.schema,e=>{if(i.includes(this.fileInputTypes,e.input))return;if(this.resource.locales&&(e.localised||i.isUndefined(e.localised)))i.each(this.resource.locales,a=>{const r=`${a}.${e.field}`;let n=i.get(this.record,r);e.input==="pillbox"?n=n||[]:e.input==="json"&&(n=n||{}),i.isPlainObject(n)&&(n=i.cloneDeep(n)),i.set(t,r,n)});else{const a=e.field;let r=i.get(this.record,a);e.input==="pillbox"&&(r=r||[]),e.input==="json"&&(r=r||{}),i.isPlainObject(r)&&(r=i.cloneDeep(r)),i.set(t,a,r)}}),this.editingRecord=i.clone(t),this.editingRecord._id=this.record._id;try{this.editingRecord._attachments=i.cloneDeep(this.record._attachments||[])}catch(e){console.error("Error during cloneEditingRecord:",e),this.editingRecord._attachments=[]}this.removeDirtyFlags()},async deleteRecord(){if(window.confirm(h.get("TL_ARE_YOU_SURE_TO_DELETE"),h.get("TL_YES"),h.get("TL_NO")))if(i.isUndefined(this.editingRecord._id))this.editingRecord={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await $.delete(`../api/${this.resource.title}/${this.editingRecord._id}`),this.notify(h.get("TL_RECORD_DELETED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",null)}catch(t){console.error("Error happen during deleteRecord:",t),this.manageError(t,"delete",this.editingRecord)}this.$loading.stop("delete-record")}},checkFormValid(){let t=!1;try{t=this.$refs.vfg.validate()}catch(s){console.error("Not valid: ",s),t=!1}const e=i.find(this.$refs.vfg.inputs,s=>!s.valid);if(i.isUndefined(e)||(t=!1,e.focus()),this.formValid=t,!this.formValid){const s=this.editingRecord._id?h.get("TL_ERROR_CREATING_RECORD_ID",null,{id:this.editingRecord._id}):h.get("TL_ERROR_CREATING_RECORD");this.notify(s,"error")}},fieldValueOrDefault(t,e){return t.input==="pillbox"?e||[]:t.input==="json"?e||{}:e},updateLocalisedField(t,e){i.each(this.resource.locales,s=>{if(!this.formValid)return this.handleFormNotValid();const a=`${s}.${e.field}`,r=this.fieldValueOrDefault(e,i.get(this.editingRecord,a));if(s!==this.locale&&e.required&&(i.isUndefined(r)||e.input==="string"&&r.length===0)){this.selectLocale(s),this.formValid=!1,this.$forceUpdate(),this.$nextTick(()=>{this.checkFormValid()}),console.warn("required field empty",e,this.formValid);return}i.isEqual(r,i.get(this.record,a))||i.set(t,a,r)})},handleFormNotValid(){console.info("form not valid")},async createUpdateClicked(){if(this.checkFormValid(),!this.formValid)return this.handleFormNotValid();const t={};i.each(this.resource.schema,s=>{if(!this.formValid||i.includes(this.fileInputTypes,s.input))return;if(this.resource.locales&&(s.localised||i.isUndefined(s.localised)))this.updateLocalisedField(t,s);else{const r=s.field,n=this.fieldValueOrDefault(s,i.get(this.editingRecord,r));i.isEqual(n,i.get(this.record,r))||i.set(t,r,n)}});const e=i.filter(this.editingRecord._attachments,s=>!s._id);if(i.isEmpty(e)||console.warn("NEW ATTACHMENTS = ",e),!this.formValid)return this.handleFormNotValid();if(i.isUndefined(this.editingRecord._id))return this.createRecord(t,e);this.updateRecord(t,e)},async createRecord(t,e){this.$loading.start("create-record");try{const{data:s}=await $.post(`../api/${this.resource.title}`,t);await this.uploadAttachments(s._id,e),this.notify(h.get("TL_RECORD_CREATED",null,{id:s._id})),this.$emit("updateRecordList",s)}catch(s){console.error("Error happen during createRecord:",s),this.manageError(s,"create")}this.$loading.stop("create-record")},async updateRecord(t,e){this.$loading.start("update-record");try{let s=this.editingRecord;console.warn("Will send",t),i.isEmpty(t)||(s=(await $.put(`../api/${this.resource.title}/${this.editingRecord._id}`,t)).data),await this.uploadAttachments(s._id,e);const a=i.map(e,"_id"),r=i.filter(this.editingRecord._attachments,l=>l._id&&!i.includes(a,l._id)&&(i.get(l,"cropOptions.updated",!1)||i.get(l,"orderUpdated",!1)));i.isEmpty(r)||(console.warn("UPDATED ATTACHMENTS = ",i.map(r,l=>`${l.orderUpdated}-${l.order}-${l._filename}`)),await this.updateAttachments(s._id,r));const n=i.filter(this.record._attachments,l=>!i.find(this.editingRecord._attachments,{_id:l._id}));i.isEmpty(n)||(console.warn("REMOVED ATTACHMENTS = ",i.map(n,l=>`${l.order}-${l._filename}`)),await this.removeAttachments(s._id,n)),this.notify(h.get("TL_RECORD_UPDATED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",s)}catch(s){console.error("Error happen during updateRecord:",s),this.manageError(s,"update",this.editingRecord)}this.$loading.stop("update-record")},getAttachmentModel(t){const e=[];return i.get(t,"_fields.locale",!1)&&e.push(t._fields.locale),e.push(t._name),i.join(e,".")},updateFields(t,e){if(!this.isAttachmentField(e))return i.set(this.editingRecord,e,t);i.set(this.editingRecord,"_attachments",t),console.info(`Will update attachment ${e}`,t)},onModelUpdated(t,e){this.updateFields(t,e),console.info("editingRecord =",this.editingRecord),this.$refs.vfg.validate(),this.checkDirty()},isAttachmentField(t){const e=i.get(i.find(i.get(this.schema,"fields",[]),{model:t}),"originalModel",!1),s=i.get(i.find(this.resource.schema,{field:e}),"input",!1);return i.includes(this.fileInputTypes,s)},checkDirty(){i.each(this.originalFieldList,t=>{let e=!0;if(i.includes(["AttachmentView","ImageView"],t.type)){const{key:s,locale:a}=this.getKeyLocale(t),r=i.filter(this.record._attachments,l=>l._name===s&&(l._fields&&l._fields.locale)===a),n=i.filter(this.editingRecord._attachments,l=>l._name===s&&(l._fields&&l._fields.locale)===a);e=i.isEqual(r,n)}else e=i.isEqual(i.get(this.record,t.model),i.get(this.editingRecord,t.model));t.labelClasses=e?"":"dirty"})},removeDirtyFlags(){i.each(this.originalFieldList,t=>{delete t.labelClasses})},getKeyLocale(t){const e={},s=t.model.split(".");return t.localised&&(e.locale=s.shift()),e.key=s.join("."),e}}};var vs=function(){var e=this,s=e._self._c;return e.record?s("div",{staticClass:"record-editor",class:{frozen:!e.record._local}},[s(Ve,{directives:[{name:"show",rawName:"v-show",value:e.resource.locales,expression:"resource.locales"}],attrs:{"fixed-tabs":"","background-color":"white",dark:"",height:"39","hide-slider":""},model:{value:e.activeLocale,callback:function(a){e.activeLocale=a},expression:"activeLocale"}},e._l(e.resource.locales,function(a){return s(Ue,{key:a,staticClass:"locale",on:{click:function(r){return e.selectLocale(a)}}},[e._v(" "+e._s(e._f("translate")("TL_"+a.toUpperCase()))+" ")])}),1),s(Pe,{ref:"vfg",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(a){e.formValid=a},expression:"formValid"}},[e.isReady?s("custom-form",{attrs:{schema:e.schema,"form-options":e.formOptions,model:e.editingRecord,row:e.rowOptions},on:{"update:model":function(a){e.editingRecord=a},error:e.onError,input:e.onModelUpdated}}):e._e()],1),s("div",{staticClass:"buttons"},[s(v,{staticClass:"back",on:{click:e.back}},[e._v(e._s(e._f("translate")("TL_BACK")))]),s(v,{staticClass:"update",attrs:{color:"primary"},on:{click:e.createUpdateClicked}},[e._v(e._s(e._f("translate")(e.editingRecord._id?"TL_UPDATE":"TL_CREATE")))]),s(v,{staticClass:"delete",attrs:{color:"error"},on:{click:e.deleteRecord}},[e._v(e._s(e._f("translate")("TL_DELETE")))])],1)],1):e._e()},ys=[],bs=m(_s,vs,ys,!1,null,null,null,null);const Ee=bs.exports,Cs={props:["resource","schema","items","locale","options"],data(){return{selectedRecords:[],showRecordsSelection:!1,columns:[],sourceData:[],tableData:[],filteredColumns:[],sortOption:{multipleSort:!0,sortAlways:!0,sortChange:t=>{console.log("sortChange::",i.keys(t),i.values(t)),this.tableData=i.sortBy(this.tableData,i.keys(t),i.values(t))}},columnHiddenOption:{defaultHiddenColumnKeys:["__RECORD_SELECTION__"]},clipboardOption:{copy:!0,paste:!1,cut:!1,delete:!1,beforeCopy:({data:t,selectionRangeIndexes:e,selectionRangeKeys:s})=>(navigator.clipboard.writeText(this.getDataToCopy(e)),!1)},columnWidthResizeOption:{enable:!0,minWidth:50}}},computed:{orderedItem(){return this.items},schemaFields(){let t=this.schema.fields,e=[];i.forEach(t,a=>{i.get(a,"options.breakdown",!1)&&i.forEach(this.resource.locales,r=>{if(a.model===`${r}.${a.originalModel}`)a.localised=!1;else{let n=i.clone(a);n.localised=!1;const l=a.originalModel&&h.get(a.originalModel);n.label=`${l} (${h.get(`TL_${r.toUpperCase()}`)})`,n.model=`${r}.${a.originalModel}`,e.push(n)}}),a.disabled=!0}),t=t.concat(e);let s=i.filter(t,a=>i.isNumber(i.get(a,"options.index",!1)));return i.isEmpty(s)?this.schema.fields:i.sortBy(s,a=>a.options.index)}},watch:{items(){this.resetRecordsFiltering()}},mounted(){this.resetRecordsFiltering(),this.createTableColumns()},methods:{getDataToCopy(t){let e=t.startColIndex,s=t.endColIndex;this.showRecordsSelection||(e++,s++);const a=this.columns.slice(e,s+1).map(l=>l.field),r=this.tableData.slice(t.startRowIndex,t.endRowIndex+1).map(l=>i.map(a,o=>i.get(l,o,"")));let n="";return i.each(r,(l,o)=>{o!==0&&(n+=`
`),n+=l.join("	")}),n},deleteSelectedRecords(){this.$emit("remove-records",i.filter(this.sourceData,t=>i.includes(this.selectedRecords,t._id)))},toggleSelection(){return this.showRecordsSelection=!this.showRecordsSelection,this.showRecordsSelection?this.$refs.tableRef.showColumnsByKeys(["__RECORD_SELECTION__"]):this.$refs.tableRef.hideColumnsByKeys(["__RECORD_SELECTION__"])},resetRecordsFiltering(){this.sourceData=this.orderedItem,this.tableData=this.sourceData.slice(0)},createTableColumns(){const t=[{field:"__RECORD_SELECTION__",key:"__RECORD_SELECTION__",title:h.get("TL_RECORD_SELECTION"),fixed:"left",align:"center",disableResizing:!0,width:50,renderBodyCell:({row:e,column:s,rowIndex:a},r)=>r("TableRecordSelection",{props:{row:e,selected:this.isRecordSelected(e),onChange:this.onSelectRecord}})}];i.each(this.schemaFields,(e,s)=>{const a=this.getFieldType(e),r="Table"+a,n={field:e.model,key:"a"+s,title:e.label,ellipsis:{showTitle:!0,lineClamp:i.get(e,"options.lineClamp",1)},renderBodyCell:({row:l,column:o,rowIndex:c},d)=>i.includes(["CustomInput","CustomMultiSelect"],a)?i.get(l,o.field,""):r in Vue.options.components?d(r,{props:{row:l,column:o,rowIndex:c,field:e}}):(console.error(`${r} isn't defined as a custom field type, will not render it`),i.get(l,o.field,""))};i.get(e,"options.filter",!1)&&(n.filter={filterList:i.uniqBy(i.map(this.sourceData,(l,o)=>({value:o,label:e.type==="switch"?h.get("TL_"+i.toUpper(i.get(l,e.model,!1))):i.get(l,e.model),realValue:i.get(l,e.model),selected:!1})),"label"),isMultiple:i.get(e,"options.filter",!1)==="multiple",filterConfirm:l=>{const o=l.filter(c=>c.selected).map(c=>c.realValue);this.searchBy(o,e.model),i.includes(this.filteredColumns,n.field)||this.filteredColumns.push(n.field)},filterReset:l=>{this.searchBy([],e.model),this.filteredColumns=i.filter(this.filteredColumns,n.field)},filterIcon:()=>i.includes(this.filteredColumns,n.field)?ce(f,["mdi-filter"]):ce(f,["mdi-filter-outline"]),maxHeight:200}),i.each(["sortBy","align"],l=>{const o=i.get(e,`options.${l}`,!1);o!==!1&&i.set(n,l,o)}),t.push(n)}),t.push({field:"__ACTIONS__",key:"__ACTIONS__",title:h.get("TL_ACTIONS"),fixed:"right",disableResizing:!0,width:180,renderBodyCell:({row:e,column:s,rowIndex:a},r)=>r("TableRowActions",{props:{row:e,column:s,rowIndex:a,remove:n=>{this.$emit("remove",n)},edit:n=>{this.$emit("edit",n)}}})}),this.columns=t},isRecordSelected(t){return i.includes(this.selectedRecords,i.get(t,"_id",!1))},onSelectRecord(t,e){t?this.selectedRecords.push(e):this.selectedRecords=i.filter(this.selectedRecords,s=>s!==e),console.warn("this.selectedRecords = ",this.selectedRecords)},searchBy(t,e){this.tableData=this.sourceData.filter(s=>t.length===0||t.includes(i.get(s,e)))},editRow(t){console.warn("editRow",t)},getFieldType(t){return i.get(t,"overrideType",i.get(t,"type",!1))}}};var ws=function(){var e=this,s=e._self._c;return s("div",{ref:"excel-container",staticClass:"vue-table-generator vue-form-generator table"},[s("div",{attrs:{id:"table-top"}},[s(v,{on:{click:function(a){return e.toggleSelection()}}},[e._v(e._s(e._f("translate")(`TL_${e.showRecordsSelection?"HIDE":"SHOW"}_RECORD_SELECTION`)))]),e.selectedRecords.length>0?s(v,{attrs:{color:"node-cms-red"},on:{click:function(a){return e.deleteSelectedRecords()}}},[e._v(e._s(e._f("translate")("TL_DELETE_SELECTED_RECORDS")))]):e._e()],1),s("ve-table",{ref:"tableRef",attrs:{"scroll-width":"0","sort-option":e.sortOption,"virtual-scroll-option":{enable:!0},"column-width-resize-option":e.columnWidthResizeOption,columns:e.columns,"table-data":e.tableData,"fixed-header":!0,"border-around":!0,"border-x":!0,"border-y":!0,"clipboard-option":e.clipboardOption,"column-hidden-option":e.columnHiddenOption,"max-height":"100%","row-key-field-name":"_id"}}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length===0,expression:"tableData.length === 0"}],staticClass:"empty-data"},[e._v(e._s(e._f("translate")("TL_NO_DATA_FOUND")))])],1)},$s=[],Ss=m(Cs,ws,$s,!1,null,"8ab39179",null,null);const Ls=Ss.exports,Ts={components:{VueTableGenerator:Ls,RecordEditor:Ee},mixins:[ne,M],props:{resourceList:{type:Array,default:()=>[]},recordList:{type:Array,default:()=>[]},locale:{type:String,default:"enUS"},resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}}},data(){return{page:1,isReady:!1,search:null,cachedMap:{},schema:{fields:[]},TranslateService:h,localLocale:!1,localRecord:{},clonedRecordList:null}},computed:{options(){return{paging:i.get(this.resource,"options.paging",10),displayId:i.get(this.resource,"options.displayId",!0),displayUpdatedAt:i.get(this.resource,"options.displayUpdatedAt",!0)}},pageCount(){return Math.ceil(this.listCount/this.options.paging)},maxCount(){return i.get(this.resource,"maxCount",0)},listCount(){return i.get(this.clonedRecordList,"length",0)},filteredList(){let t=this.getSearchableFields();return t.length===0&&(t=[i.first(this.resource.schema)]),i.filter(this.clonedRecordList,(e,s)=>{if(i.isEmpty(this.search))return s>=this.options.paging*(this.page-1)&&s<this.options.paging*this.page;const a=[];return i.forEach(t,r=>{a.push(this.getValue(e,r))}),this.doesMatch(this.search,a)||new RegExp(this.search,"i").test(e._id)})}},watch:{async locale(){this.isReady=!1,this.localLocale=this.locale,this.$emit("update:locale",this.localLocale),await this.updateSchema(),this.isReady=!0},async record(){this.localRecord=i.cloneDeep(this.record)},async recordList(){this.clonedRecordList=i.cloneDeep(this.recordList),this.isReady=!1,await this.updateSchema(),this.isReady=!0,this.$forceUpdate()},async userLocale(){this.isReady=!1,await this.updateSchema(),this.isReady=!0}},methods:{onPaginationClick(){console.warn("onPaginationClick ---",arguments)},updateRecordList(t){this.$emit("updateRecordList",t)},selectRecord(t){this.localLocale=this.locale,this.$emit("update:record",t)},editRecord(t){this.selectRecord(t)},askConfirmation(t=!1){return window.confirm(h.get(`TL_ARE_YOU_SURE_TO_DELETE${t?"_SELECTED_RECORDS":""}`),h.get("TL_YES"),h.get("TL_NO"))},async removeRecords(t){if(!this.askConfirmation(!0))return;console.warn("will delete selected records");const e=i.map(t,s=>this.removeRecord(s,!0));await Promise.all(e),console.warn("all selected records deleted !")},async removeRecord(t,e=!1){if(!(!e&&this.askConfirmation())){if(i.isUndefined(t._id))t={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await $.delete(`../api/${this.resource.title}/${t._id}`),this.notify(h.get("TL_RECORD_DELETED",null,{id:t._id})),this.$emit("updateRecordList",null)}catch(s){console.error("Error happen during deleteRecord:",s),this.manageError(s,"delete",this.editingRecord)}this.$loading.stop("delete-record")}this.clonedRecordList=i.filter(this.clonedRecordList,s=>t!==s)}},doesMatch(t,e){let s=!1;return i.forEach(e,a=>{if(s=new RegExp(this.search,"i").test(a),s)return!1}),s},async updateRecord(t){const e={};let s=i.find(this.recordList,{_id:t._id});i.each(this.resource.schema,n=>{if(n.input==="file"||n.input==="image")return;if(this.resource.locales&&(n.localised||i.isUndefined(n.localised)))i.each(this.resource.locales,o=>{const c=`${o}.${n.field}`;let d=i.get(t,c);n.input==="pillbox"?d=d||[]:n.input==="json"&&(d=d||{}),!i.isEqual(d,i.get(s,c))&&i.set(e,c,d)});else{const o=n.field;let c=i.get(t,o);if(n.input==="pillbox"?c=c||[]:n.input==="json"&&(c=c||{}),i.isEqual(c,i.get(s,o)))return;i.set(e,o,c)}});const a=i.filter(t._attachments,n=>!n._id),r=i.filter(s&&s._attachments,n=>!i.find(t._attachments,{_id:n._id}));if(i.isUndefined(t._id)){this.$loading.start("create-record");try{const n=await $.post(`../api/${this.resource.title}`,e);await this.uploadAttachments(n.data._id,a),this.notify(h.get("TL_RECORD_CREATED",null,{id:n.data._id})),this.$emit("updateRecordList",n.data)}catch(n){console.error("Error happend during updateRecord/create:",n),this.manageError(n,"create")}this.$loading.stop("create-record")}else{this.$loading.start("update-record");try{let n;i.isEmpty(e)?n={data:t}:n=await $.put(`../api/${this.resource.title}/${t._id}`,e),await this.uploadAttachments(n.data._id,a),await this.removeAttachments(n.data._id,r),(!i.isEmpty(e)||!i.isEmpty(a)||!i.isEmpty(r))&&this.notify(h.get("TL_RECORD_UPDATED",null,{id:t._id})),this.$emit("updateRecordList",n.data)}catch(n){console.error("Error happend during updateRecord/create:",n),this.manageError(n,"update",t)}this.$loading.stop("update-record")}},async updateRecords(){try{const t=[];this.$loading.start("update-records");let e=i.filter(this.recordList,s=>!i.find(this.clonedRecordList,{_id:s._id}));for(const s of e)t.push(async()=>{this.$loading.start("delete-record"),await $.delete(`../api/${this.resource.title}/${s._id}`),this.notify(h.get("TL_RECORD_DELETED",null,{id:s._id})),this.$emit("updateRecordList",null),this.$loading.stop("delete-record")});for(const s of i.reverse(this.clonedRecordList))t.push(async()=>await this.updateRecord(s));await B(t,{concurrency:10})}catch(t){console.error("Error happens during updateRecords:",t)}this.$loading.stop("update-records")},createRecord(){let t={_local:!0};i.each(this.schema.fields,e=>{i.set(t,e.model,void 0)}),this.clonedRecordList.push(t),this.selectRecord(t)},getSearchableFields(){return i.filter(this.resource.schema,t=>t.searchable===!0)},selectLocale(t){this.$emit("update:locale",t)},getValue(t,e){let s="";if(e)if(e.input==="file"){const a=i(t).get("_attachments",[]).find(r=>r._name===e.field);s=a&&a._filename}else this.resource.locales&&(e.localised||i.isUndefined(e.localised))?s=i.get(t,`${this.locale}.${e.field}`):s=i.get(t,e.field);return s},back(){this.$emit("unsetRecord")}}};var Rs=function(){var e=this,s=e._self._c;return s("div",{staticClass:"record-table"},[e.record?e._e():[s("ul",{directives:[{name:"show",rawName:"v-show",value:e.resource.locales,expression:"resource.locales"}],staticClass:"locales"},e._l(e.resource.locales,function(a){return s("li",{key:a,class:{selected:a==e.locale},on:{click:function(r){return e.selectLocale(a)}}},[e._v(" "+e._s(e._f("translate")("TL_"+a.toUpperCase()))+" ")])}),0),s("div",{attrs:{id:"top-actions"}},[s("div",{staticClass:"search"},[s(K,{attrs:{flat:"",dense:"",compact:"",outlined:"",solo:"","hide-details":"",clearable:"",placeholder:e._f("translate")("TL_SEARCH"),type:"text",name:"search"},model:{value:e.search,callback:function(a){e.search=a},expression:"search"}})],1),e.maxCount<=0||e.listCount<e.maxCount?s("div",{staticClass:"new",on:{click:e.createRecord}},[e._v("+")]):e._e()]),e.isReady?s("vue-table-generator",{attrs:{options:e.options,resource:e.resource,schema:e.schema,items:e.filteredList,locale:e.localLocale},on:{"update:locale":function(a){e.localLocale=a},remove:e.removeRecord,"remove-records":e.removeRecords,edit:e.editRecord}}):e._e()],e.record?s("record-editor",{key:e.record._id,staticClass:"has-back-button",attrs:{"resource-list":e.resourceList,record:e.localRecord,resource:e.resource,locale:e.localLocale,"user-locale":e.TranslateService.locale},on:{"update:record":function(a){e.localRecord=a},"update:locale":function(a){e.localLocale=a},updateRecordList:e.updateRecordList,back:e.back}}):e._e()],2)},Es=[],Is=m(Ts,Rs,Es,!1,null,null,null,null);const xs=Is.exports;const ks={components:{NavBar:os,RecordList:ms,RecordEditor:Ee,Loading:Se,LocaleList:Pt,RecordTable:xs},mixins:[M],data(){return{config:!1,locale:"enUS",resourceList:[],selectedResource:null,localeList:[],recordList:[],notification:{},toolbarTitle:!1,selectedResourceGroup:null,selectedRecord:null,selectedPlugin:null,LoadingService:re,TranslateService:h,user:null,multiselect:!1,multiselectItems:[]}},computed:{pluginList(){return i.filter(window.plugins,e=>i.isUndefined(e.allowed)?!0:i.isEmpty(this.user)?!1:i.includes(e.allowed,this.user.group))}},watch:{$route:function(){this.$route.query.id!=null&&this.selectResource(i.find(i.union(this.pluginList,this.resourceList),{title:this.$route.query.id}))}},destroyed(){se.events.off("notification",this.onGetNotification)},mounted(){this.$loading.start("init"),F.onLogout(()=>{console.info("User logged out"),window.location.reload()}),se.events.on("notification",this.onGetNotification),this.$nextTick(async()=>{if(await V.init(),this.config=V.config,await h.init(),this.setToolbarTitle(),i.get(window,"noLogin",!1))this.user={};else{F.init();try{this.user=await F.getStatus();const e=i.get(this.user,"theme","light")==="dark";this.$vuetify.theme.dark=e,this.$forceUpdate()}catch(e){const s=i.get(e,"response.data.message",e.message);throw this.notify(s,"error"),e}}try{const e=await $.get(`${window.location.pathname}resources`);this.$loading.stop("init");const s=i.sortBy(e.data,a=>a.title);if(this.resourceList=i.filter(s,a=>i.isUndefined(a.allowed)?!0:i.includes(a.allowed,this.user.group)),E.setSchemas(this.resourceList),this.localeList=h.config.locales,this.$route.query.id!=null){const a=i.find(i.union(this.pluginList,this.resourceList),{title:this.$route.query.id});this.selectResource(a)}}catch(e){console.error("Error while getting resources: ",e)}})},methods:{setToolbarTitle(){this.toolbarTitle=i.get(V.config,`toolbarTitle.${h.locale}`,i.get(V.config,"toolbarTitle",!1))},onGetNotification(t){this.notification=t},getNotificationClass(){return`notification-${this.notification.type}`},getThemeClass(){const t={};return i.set(t,`theme--${i.get(this.user,"theme","light")}`,!0),t},async selectResourceGroup(t){this.selectedResourceGroup=t},async selectResource(t){try{if(i.get(this.$router,"history.current.query.id",!1)!==t.title&&this.$router.push({query:{id:t.title}}).catch(s=>console.error("Router throw an error:",s)),t.type==="plugin"){this.selectedResource=null,this.selectedPlugin=t;return}if(this.onCancelMultiselectPage(),this.selectedResource=t,this.selectedPlugin=null,this.recordList=null,this.selectedRecord=null,!this.selectedResource)return;this.locale=i.first(this.selectedResource.locales),this.$loading.start("selectResource"),await this.cacheRelatedResources(t);const e=E.get(t.title);if(this.recordList=i.sortBy(e,s=>-s._updatedAt),i.get(t,"maxCount",0)===1){const s=i.get(this.recordList,"[0]",!1);s?this.selectRecord(s):this.selectRecord({_local:!0})}this.$loading.stop("selectResource")}catch(e){console.error("Error happen during selectResource:",e)}},async cacheRelatedResources(t){let e=i.union([t.title],i.values(t.extraSources));const s=a=>{i.isArray(a)?i.each(a,r=>{s(r)}):i.each(a,(r,n)=>{switch(n){case"input":{const l=i.get(a,"options.extraSources");switch(e.push(...i.values(l)),r){case"select":case"multiselect":const o=i.get(a,"source");if(i.isString(o)){e.push(o);const c=E.getSchema(o);e.push(...i.values(c.extraSources))}break;case"paragraph":i.each(i.get(a,"options.types"),c=>{s(c);const d=i.get(c,"schema");s(d)})}break}case"extraSources":e.push(...i.values(r))}})};s(t.schema),e=i.uniq(e),await B(i.map(e,a=>async()=>await E.cache(a)),{concurrency:10})},selectRecord(t){this.selectedRecord=t},onSelectMultiselect(t){this.multiselect=t,t&&this.unsetSelectedRecord()},onChangeMultiselectItems(t){this.multiselectItems=i.clone(t)},async updateRecordList(t){try{this.$loading.start("updateRecordList");const e=await E.cache(this.selectedResource.title);this.$loading.stop("updateRecordList"),this.recordList=i.sortBy(e,s=>-s._updatedAt),this.selectRecord(i.find(this.recordList,{_id:i.get(t,"_id")}))}catch(e){console.error("Error happen during updateRecordList:",e)}},unsetSelectedRecord(){this.selectedRecord=null},onCancelMultiselectPage(){this.multiselect=!1,this.multiselectItems=[]}}};var Ds=function(){var e=this,s=e._self._c;return s(Ce,[s(Be,[e.notification.type?s(qe,{staticClass:"notification",class:e.getNotificationClass(),attrs:{"multi-line":"",top:"",centered:"",timeout:e.notification.type==="error"?-1:1e3},scopedSlots:e._u([{key:"action",fn:function({attrs:a}){return[e.notification.type==="error"?s(v,e._b({attrs:{text:""},on:{click:function(r){e.notification={}}}},"v-btn",a,!1),[e._v(" "+e._s(e._f("translate")("TL_CLOSE"))+" ")]):e._e()]}}],null,!1,3083842718),model:{value:e.notification,callback:function(a){e.notification=a},expression:"notification"}},[s("p",[e._v(e._s(e.notification.message))])]):e._e()],1),e.user?s("div",{staticClass:"cms-layout"},[s("div",{staticClass:"cms-inner-layout",class:e.getThemeClass()},[e.resourceList.length>0?s("nav-bar",{attrs:{config:e.config,"toolbar-title":e.toolbarTitle,"locale-class":{locale:e.localeList&&e.localeList.length>1},"select-resource-group-callback":e.selectResourceGroup,"select-resource-callback":e.selectResource,"resource-list":e.resourceList,plugins:e.pluginList,"selected-resource-group":e.selectedResourceGroup,"selected-item":e.selectedResource||e.selectedPlugin}}):e._e(),s("div",{staticClass:"resources"},[e.localeList?s("locale-list",{attrs:{"locale-list":e.localeList}}):e._e()],1),s("div",{staticClass:"records"},[e.selectedResource&&(!e.selectedResource.view||e.selectedResource.view=="list")?[e.selectedResource?s("record-list",{attrs:{list:e.recordList,locale:e.locale,"selected-item":e.selectedRecord,resource:e.selectedResource,multiselect:e.multiselect,"multiselect-items":e.multiselectItems},on:{selectItem:e.selectRecord,changeMultiselectItems:e.onChangeMultiselectItems,selectMultiselect:e.onSelectMultiselect}}):e._e(),e.selectedRecord?s("record-editor",{key:e.selectedRecord._id,attrs:{"resource-list":e.resourceList,record:e.selectedRecord,resource:e.selectedResource,locale:e.locale,"user-locale":e.TranslateService.locale},on:{"update:record":function(a){e.selectedRecord=a},"update:locale":function(a){e.locale=a},updateRecordList:e.updateRecordList}}):e._e()]:e._e(),e.selectedResource&&e.selectedResource.view=="table"?s("record-table",{attrs:{"record-list":e.recordList,"resource-list":e.resourceList,resource:e.selectedResource,record:e.selectedRecord,locale:e.locale,"user-locale":e.TranslateService.locale},on:{"update:record":function(a){e.selectedRecord=a},"update:locale":function(a){e.locale=a},unsetRecord:e.unsetSelectedRecord,updateRecordList:e.updateRecordList}}):e._e(),e.selectedPlugin?s("plugin-page",{attrs:{plugin:e.selectedPlugin}}):e._e(),e.selectedResource&&e.multiselect?s("multiselect-page",{attrs:{"multiselect-items":e.multiselectItems,locale:e.locale,resource:e.selectedResource,"record-list":e.recordList},on:{cancel:e.onCancelMultiselectPage,changeMultiselectItems:e.onChangeMultiselectItems,updateRecordList:e.updateRecordList}}):e._e()],2),e.LoadingService.isShow?s("loading"):e._e()],1)]):e._e()],1)},Os=[],Ms=m(ks,Ds,Os,!1,null,null,null,null);const Fs=Ms.exports;const As={components:{Loading:Se},mixins:[M],data(){return{username:null,password:null,activeField:!1,loginFailed:!1,loggingIn:!1,showLoginForm:!1,loaded:!1,LoadingService:re,TranslateService:h}},async mounted(){console.warn("Login page mounted"),this.$loading.start("init");try{i.get(window,"noLogin",!1)||F.init(),await V.init(),await h.init(),this.loaded=!0}catch(t){console.error("Error happen during mounted:",t)}this.loaded=!0,this.$nextTick(()=>{setTimeout(()=>{this.showLoginForm=!0},100)}),this.$loading.stop("init")},methods:{async login(){if(!this.loggingIn){if(!this.username)return this.$refs.username.focus();if(!this.password)return this.$refs.password.focus();this.$loading.start("login"),this.loggingIn=!0;try{await $.post(`${window.location.pathname}login`,{username:this.username,password:this.password}),this.$loading.stop("login"),window.location.reload()}catch(t){console.error("Error happen during login:",t),this.loginFailed=!0,this.$loading.stop("login")}this.loggingIn=!1}}}};var Ns=function(){var e=this,s=e._self._c;return s(Ce,[e.loaded?s("div",{staticClass:"cms-layout",class:{displayed:e.showLoginForm}},[s("div",{staticClass:"login-canvas"},[s("form",{on:{submit:function(a){return a.preventDefault(),e.login.apply(null,arguments)}}},[s("div",{staticClass:"node-cms-title"},[e._v(" "+e._s(e._f("translate")("TL_LOGIN"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],ref:"username",attrs:{autofocus:"",type:"test",name:"nodeCmsUsername",autocomplete:"on",placeholder:e._f("translate")("TL_USERNAME")},domProps:{value:e.username},on:{input:function(a){a.target.composing||(e.username=a.target.value)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],ref:"password",attrs:{type:"password",name:"nodeCmsPassword",autocomplete:"on",placeholder:e._f("translate")("TL_PASSWORD")},domProps:{value:e.password},on:{input:function(a){a.target.composing||(e.password=a.target.value)}}}),e.loginFailed?s("span",{staticClass:"error-message"},[e._v(e._s(e._f("translate")("TL_LOGIN_FAIL")))]):e._e(),s("div",{staticClass:"login-btn-wrapper",class:{disabled:!e.username||!e.password||e.loggingIn}},[s("button",{attrs:{disabled:e.loggingIn}},[e._v(" "+e._s(e._f("translate")("TL_CONFIRM"))+" ")])])])])]):e._e(),e.LoadingService.isShow?s("loading"):e._e()],1)},Vs=[],Us=m(As,Ns,Vs,!1,null,"d22c9055",null,null);const Ps=Us.exports;const Bs={mixins:[Te,ne,M],props:{resource:{type:Object,default:()=>{}},locale:{type:String,default:"enUS"},multiselectItems:{type:Array,default:()=>[]},recordList:{type:Array,default:()=>[]}},data(){return{size:i.size,isEmpty:i.isEmpty}},methods:{onClickCancel(){this.$emit("cancel")},onClickSelectAll(){this.$emit("changeMultiselectItems",this.recordList)},onClickDeselectAll(){this.$emit("changeMultiselectItems",[])},async onClickDelete(){if(window.confirm(h.get("TL_ARE_YOU_SURE_TO_DELETE_RECORDS",null,{num:i.size(this.multiselectItems)}),h.get("TL_YES"),h.get("TL_NO"))){this.$loading.start("onDeleteMultiselectedItems");try{await B(i.map(this.multiselectItems,t=>async()=>{try{await C.delete(`../api/${this.resource.title}/${t._id}`),this.notify(h.get("TL_RECORD_DELETED",null,{id:t._id}))}catch(e){console.error(e),this.manageError(e,"delete",t)}}),{concurrency:1})}catch(t){console.error(t)}this.multiselect=!1,this.$loading.stop("onDeleteMultiselectedItems"),this.$emit("updateRecordList",null),this.$emit("cancel")}}}};var qs=function(){var e=this,s=e._self._c;return s("div",{staticClass:"multiselect-page"},[s("h3",[e._v(e._s(e._f("translate")("TL_YOU_HAVE_SELECTED_NUM_ITEMS",null,{num:e.size(e.multiselectItems)})))]),s("ul",e._l(e.multiselectItems,function(a){return s("li",{key:a._id},[e._v(" "+e._s(e.getName(a))+" ("+e._s(a._id)+") ")])}),0),s("br"),s("div",{staticClass:"actions"},[s(v,{on:{click:e.onClickSelectAll}},[e._v(e._s(e._f("translate")("TL_SELECT_ALL_ITEMS")))]),s(v,{attrs:{disabled:e.multiselectItems.length===0},on:{click:e.onClickDeselectAll}},[e._v(e._s(e._f("translate")("TL_DESELECT_ALL_ITEMS")))])],1),s("div",{staticClass:"buttons"},[s(v,{staticClass:"back",on:{click:e.onClickCancel}},[e._v(e._s(e._f("translate")("TL_CANCEL")))]),s(v,{staticClass:"delete right",attrs:{disabled:e.isEmpty(e.multiselectItems)},on:{click:e.onClickDelete}},[e._v(e._s(e._f("translate")("TL_DELETE")))])],1)])},js=[],Hs=m(Bs,qs,js,!1,null,"55ec3ee9",null,null);const zs=Hs.exports;const Ks={props:["schema","model","row","formOptions","disabled"],created(){i.each(this.schema.fields,t=>{const e=this.getFieldType(t);e in Vue.options.components||console.error(`${e} isn't defined as a custom field type, will not render it`),t.focused=!1}),Le.events.on("select",t=>{i.each(this.schema.fields,e=>{e.focused=e.model===`${e.localised?`${h.locale}.`:""}${t.field}`,e.focused&&setTimeout(()=>{e.focused=-1,this.$forceUpdate()},1)}),this.$forceUpdate()})},methods:{getFieldType(t){return i.get(t,"overrideType",i.get(t,"type",!1))},onInput(t,e){i.isUndefined(e)&&(e=i.get(i.first(t),"parentKey",!1)),this.$emit("input",t,e)}}};var Gs=function(){var e=this,s=e._self._c;return e.schema!=null?s("div",{staticClass:"vue-form-generator"},[e.schema.fields?s("fieldset",e._l(e.schema.fields,function(a){return s("div",{key:a.model,staticClass:"field-wrapper",class:{focused:!0}},[s(e.getFieldType(a),{key:a.model,tag:"component",attrs:{schema:a,model:e.model,"form-options":e.formOptions,disabled:e.disabled,focused:a.focused},on:{input:e.onInput}})],1)}),0):e._e()]):e._e()},Ys=[],Ws=m(Ks,Gs,Ys,!1,null,"47be4b8e",null,null);const Qs=Ws.exports,Xs={props:["plugin"],data(){return{}},watch:{},mounted(){},methods:{}};var Zs=function(){var e=this,s=e._self._c;return s("div",{staticClass:"plugin-page"},[s(e.plugin.component,{tag:"component"})],1)},Js=[],ei=m(Xs,Zs,Js,!1,null,null,null,null);const ti=ei.exports;const si={data(){return{timer:null,isLoading:!0,sysLog:[],error:!1,scrollBottom:!0,data:"",stickyId:-1,count:0,destroyed:!1,autoscroll:!0,lastId:-1,tempId:0,logLines:[],filterOutLines:[],searchKey:null,warningQty:0,errorQty:0,ignoreNextScrollEvent:!1,fakeData:[],config:null}},async mounted(){const{data:t}=await C.get(`${window.location.pathname}../api/_syslog/config`);this.config=t,this.config.wss&&A.events.on("syslog",e=>{i.isEmpty(e)||(this.error=!1,this.logLines.push(...e),this.lastId=i.last(this.logLines).id,this.updateSysLog()),this.autoscroll&&(this.ignoreNextScrollEvent=!0,this.$refs.scroller.scrollToBottom())}),this.$nextTick(()=>{this.refreshLog(),this.$refs.scroller&&this.$refs.scroller.$el.addEventListener("scroll",this.detectScroll)})},async destroyed(){this.destroyed=!0,this.$refs.scroller&&this.$refs.scroller.$el.removeEventListener("scroll",this.detectScroll),clearTimeout(this.timer)},methods:{filterLevel(t){this.searchKey=`sift:{level: {$gte: ${t}}}`,this.updateSysLog()},detectScroll(t){const e=i.get(t,"srcElement.scrollHeight",0),s=i.get(t,"srcElement.scrollTop",0),a=i.get(t,"srcElement.clientHeight",0);if(this.ignoreNextScrollEvent){this.ignoreNextScrollEvent=!1;return}this.$nextTick(()=>{this.autoscroll===!1&&s+a>=e&&(this.stickyId=-1),this.autoscroll=s+a>=e})},getLogViewerHeight(){return i.get(this.$refs["log-viewer"],"offsetHeight",100)},onInputSearch(){this.updateSysLog()},onClickRefresh(){this.error=!1,this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog(),this.lastId=-1},onClickClearSearch(){this.searchKey=null,this.updateSysLog()},onClickAutoscroll(){this.autoscroll=!this.autoscroll},onClickClear(){this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog()},calculateLineNumberSpacing(t){return i.padStart(t,8,"0")+" |"},jumpTo(t){if(!(!this.searchKey&&this.stickyId!==t)){if(this.stickyId===t){this.stickyId=-1,this.autoscroll=!0;return}this.ignoreNextScrollEvent=!0,this.autoscroll=!1,this.onClickClearSearch(),this.$nextTick(()=>{document.querySelector(`[data-line-id='${t}'][data-is-active='true']`)||this.$refs.scroller.scrollToItem(i.findIndex(this.logLines,s=>s.id===t)-14),this.stickyId=t})}},async refreshLog(){try{if(this.config.wss)A.client&&(A.send({action:"syslog",id:this.lastId}),this.isLoading=!1,this.error=!1);else{const t=await C.get(`${window.location.pathname}../api/_syslog`,{params:{id:this.lastId}});this.isLoading=!1,this.error=!1,i.isEmpty(t.data)||(this.error=!1,this.logLines.push(...t.data),this.lastId=i.last(this.logLines).id,this.updateSysLog()),this.autoscroll&&(this.ignoreNextScrollEvent=!0,this.$refs.scroller.scrollToBottom())}}catch(t){console.error(t),this.error=!0}this.destroyed||(this.timer=setTimeout(this.refreshLog,this.error?2e3:200))},updateSysLog(){let t=i.uniqBy(this.logLines,"id");const e=i.groupBy(this.logLines,"level");if(this.warningQty=i.get(e,"[1].length",0),this.errorQty=i.get(e,"[2].length",0),!i.isEmpty(this.searchKey))if(this.searchKey.search("sift:")===0)try{const s=be.parse(this.searchKey.substr(5));t=t.filter(ye(s))}catch{}else t=i.filter(t,s=>i.includes(i.toLower(s.line),i.toLower(this.searchKey)));this.sysLog=t,this.filterOutLines=i.get(this.logLines,"length",0)-i.get(this.sysLog,"length",0)}}};var ii=function(){var e=this,s=e._self._c;return s("div",{staticClass:"syslog"},[s("div",{staticClass:"buttons"},[s("button",{staticClass:"item autoscroll",class:{active:e.autoscroll},on:{click:e.onClickAutoscroll}},[e.autoscroll?s(f,[e._v("mdi-lock-outline")]):s(f,[e._v("mdi-unlock")])],1),s("button",{staticClass:"item clear",on:{click:e.onClickClear}},[s(f,[e._v("mdi-trash-can-outline")])],1),s("button",{staticClass:"item refresh",on:{click:e.onClickRefresh}},[s(f,[e._v("mdi-refresh")])],1),s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKey,expression:"searchKey"}],staticClass:"item search",class:{"is-sift":e.searchKey&&e.searchKey.search("sift:")===0},attrs:{placeholder:e._f("translate")("TL_SEARCH")},domProps:{value:e.searchKey},on:{input:[function(a){a.target.composing||(e.searchKey=a.target.value)},e.onInputSearch]}}),e.searchKey&&e.searchKey.length>0?s("button",{staticClass:"item clear-search",on:{click:e.onClickClearSearch}},[s(f,[e._v("mdi-close")])],1):e._e(),e.filterOutLines>0?s("div",{staticClass:"item filter-out"},[s(f,[e._v("mdi-target")]),e._v(e._s(e.filterOutLines)+" lines are filter out")],1):e._e(),s("div",{staticClass:"item logs-raised-flags"},[e.warningQty>=0?s("span",{staticClass:"flag-item flag-warning",on:{click:function(a){return e.filterLevel(1)}}},[s(f,[e._v("mdi-flag-outline")]),e._v(" "+e._s(e.warningQty))],1):e._e(),e.errorQty>=0?s("span",{staticClass:"flag-item flag-error",on:{click:function(a){return e.filterLevel(2)}}},[s(f,[e._v("mdi-alert-box-outline")]),e._v(" "+e._s(e.errorQty))],1):e._e()])]),e.error?s("div",{staticClass:"error"},[e._v(" "+e._s(e._f("translate")("TL_ERROR_RETRIEVE_SYSLOG"))+" ")]):e._e(),s("div",{ref:"log-viewer",staticClass:"log-viewer-wrapper"},[s("DynamicScroller",{ref:"scroller",staticClass:"scroller",attrs:{items:e.sysLog,"min-item-size":14},scopedSlots:e._u([{key:"default",fn:function({item:a,index:r,active:n}){return[s("DynamicScrollerItem",{attrs:{item:a,active:n,"size-dependencies":[e.calculateLineNumberSpacing(a.id),a.line],"data-index":r}},[s("div",{staticClass:"line-wrapper",attrs:{"data-line-id":a.id,"data-is-active":n}},[s("div",{staticClass:"line-number",class:{stickId:e.stickyId===a.id,search:e.searchKey},on:{click:function(l){return e.jumpTo(a.id)}}},[e._v(e._s(a.id))]),s("div",{staticClass:"line-content",domProps:{innerHTML:e._s(a.html)}})])])]}}])})],1)])},ai=[],ri=m(si,ii,ai,!1,null,"e330bd3e",null,null);const ni=ri.exports;const li={data(){return{config:null,status:null,error:null,type:0,loading:!1,uploadedXlsx:null}},async mounted(){const t=await C("./config");this.config=t.data.import},methods:{async onChangeXlsxFile(t){this.uploadedXlsx=null;const e=i.first(t.target.files);e&&(this.uploadedXlsx=e)},openFile(){window.open(`https://docs.google.com/spreadsheets/d/${this.config.gsheetId}/edit`,"_blank").focus()},async checkStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("cms-import"),this.type=0,this.$nextTick(async()=>{try{const t=await C("../import/status");this.status=t.data}catch(t){this.status=null,this.error=i.get(t,"message",t)}this.$loading.stop("cms-import"),this.loading=!1})},async execute(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("cms-import"),this.$nextTick(async()=>{try{const t=await C("../import/execute");this.status=t.data}catch(t){this.status=null,this.error=i.get(t,"message",t)}this.$loading.stop("cms-import"),this.loading=!1})},async checkXlsxStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("xlsx-import"),this.type=0,this.$nextTick(async()=>{try{const t=new FormData;t.append("xlsx",this.uploadedXlsx);const e=await C.post("../import/statusXlsx",t);this.status=e.data}catch(t){this.status=null,this.error=i.get(t,"message",t)}this.$loading.stop("xlsx-import"),this.loading=!1})},async executeXlsx(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("xlsx-import"),this.$nextTick(async()=>{try{const t=new FormData;t.append("xlsx",this.uploadedXlsx);const e=await C.post("../import/executeXlsx",t);this.status=e.data}catch(t){this.status=null,this.error=i.get(t,"message",t)}this.$loading.stop("xlsx-import"),this.loading=!1})}}};var oi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"cms-import"},[s("h3",[e._v("Cms Import")]),s("div",{staticClass:"main-container"},[s("div",{staticClass:"config-resources"},[s("h4",[e._v("Resources")]),e.config&&e.config.resources?s(je,{attrs:{column:""}},e._l(e.config.resources,function(a,r){return s(N,{key:r,attrs:{ripple:!1}},[e._v(" "+e._s(a)+" ")])}),1):e._e()],1),s("hr"),s("h4",[e._v("Actions")]),s("div",[s(v,{attrs:{dense:""},on:{click:function(a){return e.openFile()}}},[e._v("Edit Google Sheet")]),s("div",{staticClass:"other-actions"},[s(v,{attrs:{dense:"",disabled:e.loading},on:{click:function(a){return e.checkStatus()}}},[e._v("Check Difference")]),s(v,{attrs:{dense:"",disabled:e.loading},on:{click:function(a){return e.execute()}}},[e._v("Import from Remote")])],1)],1),s("hr"),s("h4",[e._v("Upload Xlsx")]),s(G,{ref:"xlsxFile",attrs:{dense:"","hide-details":"",outlined:"",type:"file"},on:{change:e.onChangeXlsxFile}}),s("div",{staticClass:"other-actions"},[s(v,{attrs:{dense:"",disabled:e.loading||!e.uploadedXlsx},on:{click:function(a){return e.checkXlsxStatus()}}},[e._v("Check Difference")]),s(v,{attrs:{dense:"",disabled:e.loading||!e.uploadedXlsx},on:{click:function(a){return e.executeXlsx()}}},[e._v("Import from Remote")])],1),e.status||e.error?s("div",[e.type==0?s("h4",[e._v("Difference:")]):s("h4",[e._v("Status:")]),s("pre",{domProps:{innerHTML:e._s(e.status)}}),e._v(" "),s("pre",{domProps:{innerHTML:e._s(e.error)}})]):e._e()],1)])},ci=[],di=m(li,oi,ci,!1,null,"84588550",null,null);const ui=di.exports;const hi={data(){return{statusInterval:null,error:null,config:null,selectedResource:null,recordData:{},reportData:{},syncStatus:{},uniqueKeyMap:{},environments:["local","remote"],syncingEnvironment:null,isEmpty:i.isEmpty,get:i.get,includes:i.includes}},destroyed(){this.statusInterval&&clearInterval(this.statusInterval)},async mounted(){let t;t=await C.get(`${window.location.pathname}resources`),i.each(t.data,e=>{let s=i.find(e.schema,{unique:!0});s&&(this.uniqueKeyMap[e.title]=s.field)}),t=await C.get(`${window.location.pathname}/config`),this.config=t.data,this.selectedResource&&this.update(),this.statusInterval=setInterval(async()=>{if(this.selectedResource){try{await B(i.map(["local","remote"],s=>async()=>{try{const a=await C.get(`${window.location.pathname}/sync/${s}/${this.selectedResource}/status`);this.syncStatus[s]=a.data,this.syncStatus=i.clone(this.syncStatus)}catch(a){console.error(a)}}))}catch{}const e=i.find(this.syncStatus,{status:"syncing"});!e&&this.syncingEnvironment&&(this.$loading.stop("deploy-resource"),e&&e.status==="error"&&(this.error=e.error),this.syncingEnvironment=!1,this.update())}},5*1e3)},methods:{onChangeResource(){this.update()},async update(){this.$loading.start("loading-resource");try{const t=this.uniqueKeyMap[this.selectedResource];this.recordData={},this.reportData={},await B(i.map(this.environments,l=>async()=>{try{let o;o=await C.get(`${window.location.pathname}sync/${l}/${this.selectedResource}`),i.set(this.recordData,l,o.data),o=await C.get(`${window.location.pathname}sync/${l}/${this.selectedResource}/status`),i.set(this.syncStatus,l,o.data),this.syncStatus=i.clone(this.syncStatus)}catch(o){console.error(o)}}),{concurrency:1}),this.recordData=i.clone(this.recordData);const e=this.recordData.local,s=this.recordData.remote,a=i.map(e,l=>l[t]),r=i.map(s,l=>l[t]);let n=i.intersection(a,r);n=i.filter(n,l=>{let o=i.find(e,d=>d[t]===l),c=i.find(s,d=>d[t]===l);return o._attachments=i.map(o._attachments,d=>i.omit(d,["url"])),c._attachments=i.map(c._attachments,d=>i.omit(d,["url"])),!i.isEqual(o,c)}),i.isEmpty(n)||i.each(n,l=>{console.log(l,"local",i.find(e,{[t]:l}),"remote",i.find(s,{[t]:l}))}),this.reportData={create:i.difference(a,r).length,remove:i.difference(r,a).length,update:n.length}}catch(t){console.error(t)}this.$loading.stop("loading-resource")},async onClickDeploy(t,e){this.error=null,this.$loading.start("deploy-resource"),this.syncingEnvironment=!0;try{await C.post(`../sync/${this.selectedResource}/from/${t}/to/${e}`),i.set(this.syncStatus,`${e}.status`,"syncing"),this.syncStatus=i.clone(this.syncStatus)}catch(s){console.error(s),this.syncingEnvironment=!1,this.$loading.stop("deploy-resource")}}}};var mi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sync-resources main"},[s("h1",[e._v("Sync Resources")]),e.config?s("div",[s("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedResource,expression:"selectedResource"}],on:{change:[function(a){var r=Array.prototype.filter.call(a.target.options,function(n){return n.selected}).map(function(n){var l="_value"in n?n._value:n.value;return l});e.selectedResource=a.target.multiple?r:r[0]},e.onChangeResource]}},e._l(e.config.sync.resources,function(a){return s("option",{key:a,domProps:{value:a}},[e._v(e._s(a))])}),0),e.isEmpty(e.recordData)?e._e():s("div",{staticClass:"num-records"},[s("span",[e._v("number of records")]),s("div",{staticClass:"num-records-wrapper"},e._l(e.environments,function(a){return s("div",{key:a,staticClass:"num-record",attrs:{num:e.environments.length}},[s("span",[e._v(e._s(a))]),s("span",[e._v(e._s(e.get(e.recordData,`${a}.length`,"N/A")))])])}),0)]),e.isEmpty(e.reportData)?e._e():s("div",{staticClass:"num-records"},[s("span",[e._v("records difference")]),s("div",{staticClass:"num-records-wrapper"},[s("div",{staticClass:"num-record",attrs:{num:"1",set:e.enabled=e.get(e.recordData,"local.length")!==void 0&&e.get(e.recordData,"remote.length")!==void 0}},[e.enabled?[e.get(e.syncStatus,"local.status")!=="syncing"&&e.get(e.syncStatus,"remote.status")!=="syncing"?[s("span",[e._v("local / remote")]),s("span",[e._v("create: "+e._s(e.reportData.create))]),s("span",[e._v("update: "+e._s(e.reportData.update))]),s("span",[e._v("remove: "+e._s(e.reportData.remove))]),e.includes(e.get(e.syncStatus,"remote.allows"),"write")?s("span",[s("button",{on:{click:function(a){return e.onClickDeploy("local","remote")}}},[e._v("push to remote")])]):e._e(),e.includes(e.get(e.syncStatus,"local.allows"),"write")?s("span",[s("button",{on:{click:function(a){return e.onClickDeploy("remote","local")}}},[e._v("pull from remote")])]):e._e()]:e._e(),e.get(e.syncStatus,"local.status")==="syncing"?[s("span",[e._v("resource: "+e._s(e.get(e.syncStatus,"local.resource")))]),s("span",[e._v("created: "+e._s(e.get(e.syncStatus,"local.created"))+" / "+e._s(e.get(e.syncStatus,"local.createTotal")))]),s("span",[e._v("updated: "+e._s(e.get(e.syncStatus,"local.updated"))+" / "+e._s(e.get(e.syncStatus,"local.updateTotal")))]),s("span",[e._v("removed: "+e._s(e.get(e.syncStatus,"local.removed"))+" / "+e._s(e.get(e.syncStatus,"local.removeTotal")))])]:e._e(),e.get(e.syncStatus,"remote.status")==="syncing"?[s("span",[e._v("resource: "+e._s(e.get(e.syncStatus,"remote.resource")))]),s("span",[e._v("created: "+e._s(e.get(e.syncStatus,"remote.created"))+" / "+e._s(e.get(e.syncStatus,"remote.createTotal")))]),s("span",[e._v("updated: "+e._s(e.get(e.syncStatus,"remote.updated"))+" / "+e._s(e.get(e.syncStatus,"remote.updateTotal")))]),s("span",[e._v("removed: "+e._s(e.get(e.syncStatus,"remote.removed"))+" / "+e._s(e.get(e.syncStatus,"remote.removeTotal")))])]:e._e()]:e._e(),e.enabled?e._e():s("span",{staticClass:"na-field"},[e._v(" N/A ")])],2)])])]):e._e(),e.error?s("div",{staticClass:"error"},[e._v(" Error: "+e._s(e.error)+" ")]):e._e()])},pi=[],fi=m(hi,mi,pi,!1,null,"90250774",null,null);const gi=fi.exports;let w={fieldIsRequired:"This field is required!",invalidFormat:"Invalid format!",numberTooSmall:"The number is too small! Minimum: {0}",numberTooBig:"The number is too big! Maximum: {0}",invalidNumber:"Invalid number",invalidInteger:"The value is not an integer",textTooSmall:"The length of text is too small! Current: {0}, Minimum: {1}",textTooBig:"The length of text is too big! Current: {0}, Maximum: {1}",thisNotText:"This is not a text!",thisNotArray:"This is not an array!",selectMinItems:"Select minimum {0} items!",selectMaxItems:"Select maximum {0} items!",invalidDate:"Invalid date!",dateIsEarly:"The date is too early! Current: {0}, Minimum: {1}",dateIsLate:"The date is too late! Current: {0}, Maximum: {1}",invalidEmail:"Invalid e-mail address!",invalidURL:"Invalid URL!",invalidCard:"Invalid card format!",invalidCardNumber:"Invalid card number!",invalidTextContainNumber:"Invalid text! Cannot contains numbers or special characters",invalidTextContainSpec:"Invalid text! Cannot contains special characters"};function T(t,e,s=w){return!u.isNil(t)&&t!==""?null:e?[y(s.fieldIsRequired)]:[]}function y(t){if(t!=null&&arguments.length>1)for(let e=1;e<arguments.length;e++)t=t.replace("{"+(e-1)+"}",arguments[e]);return t}const j={resources:w,required(t,e,s,a=w){return T(t,e.required,a)},number(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;let n=[];return u.isFinite(t)?(!u.isNil(e.min)&&t<e.min&&n.push(y(a.numberTooSmall,e.min)),!u.isNil(e.max)&&t>e.max&&n.push(y(a.numberTooBig,e.max))):n.push(y(a.invalidNumber)),n},integer(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;let n=j.number(t,e,s,a);return u.isInteger(t)||n.push(y(a.invalidInteger)),n},double(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!u.isNumber(t)||isNaN(t))return[y(a.invalidNumber)]},string(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;let n=[];return u.isString(t)?(!u.isNil(e.min)&&t.length<e.min&&n.push(y(a.textTooSmall,t.length,e.min)),!u.isNil(e.max)&&t.length>e.max&&n.push(y(a.textTooBig,t.length,e.max))):n.push(y(a.thisNotText)),n},array(t,e,s,a=w){if(e.required){if(!u.isArray(t))return[y(a.thisNotArray)];if(t.length===0)return[y(a.fieldIsRequired)]}if(!u.isNil(t)){if(!u.isNil(e.min)&&t.length<e.min)return[y(a.selectMinItems,e.min)];if(!u.isNil(e.max)&&t.length>e.max)return[y(a.selectMaxItems,e.max)]}},date(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;let n=new Date(t);if(isNaN(n.getDate()))return[y(a.invalidDate)];let l=[];if(!u.isNil(e.min)){let o=new Date(e.min);n.valueOf()<o.valueOf()&&l.push(y(a.dateIsEarly,O.format(n),O.format(o)))}if(!u.isNil(e.max)){let o=new Date(e.max);n.valueOf()>o.valueOf()&&l.push(y(a.dateIsLate,O.format(n),O.format(o)))}return l},regexp(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!u.isNil(e.pattern)&&!new RegExp(e.pattern).test(t))return[y(a.invalidFormat)]},email(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t))return[y(a.invalidEmail)]},url(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g.test(t))return[y(a.invalidURL)]},creditCard(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;const n=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,l=t.replace(/[^0-9]+/g,"");if(!n.test(l))return[y(a.invalidCard)];let o=0,c,d,_;for(let b=l.length-1;b>=0;b--)c=l.substring(b,b+1),d=parseInt(c,10),_?(d*=2,d>=10?o+=d%10+1:o+=d):o+=d,_=!_;if(!(o%10===0&&l))return[y(a.invalidCardNumber)]},alpha(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!/^[a-zA-Z]*$/.test(t))return[y(a.invalidTextContainNumber)]},alphaNumeric(t,e,s,a=w){let r=T(t,e.required,a);if(r!=null)return r;if(!/^[a-zA-Z0-9]*$/.test(t))return[y(a.invalidTextContainSpec)]}};Object.keys(j).forEach(t=>{const e=j[t];u.isFunction(e)&&(e.locale=s=>(a,r,n)=>e(a,r,n,u.defaults(s,w)))});const _i=(t,e="")=>typeof t.id<"u"?e+t.id:e+(t.inputName||t.label||t.model||"").toString().trim().toLowerCase().replace(/ |_/g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").replace(/([^a-zA-Z0-9-]+)/g,"");function he(t){return u.isString(t)?j[t]!=null?j[t]:(console.warn(`'${t}' is not a validator function!`),null):t}function J(t,e,s){let a=u.get(s.context,"schema.attributes",{}),r=e.value||"input";u.isString(r)&&(a=u.get(a,r)||a),u.forEach(a,(n,l)=>{t.setAttribute(l,n)})}const S={props:["model","schema","formOptions","disabled","focused"],data(){return{errors:[],debouncedValidateFunc:null,debouncedFormatFunc:null}},directives:{attributes:{bind:J,updated:J,componentUpdated:J}},watch:{focused(){if(this.focused===-1)return;let t=u.get(this.$refs,"input",!1);if(!t)return console.error("no input ref for ",this.schema);this.focused&&(u.isFunction(u.get(t,"$el.scrollIntoView",!1))?t.$el.scrollIntoView():t.scrollIntoView()),u.isFunction(t.focus)&&(this.focused?t.focus():t.blur(),console.warn(`focused changed ${this.focused}`,this.schema,t))}},computed:{value:{cache:!1,get(){return u.isFunction(u.get(this.schema,"get"))?this.schema.get(this.model):u.get(this.model,this.schema.model)},set(t){let e=this.value;u.isFunction(t)?t(t,e):this.updateModelValue(t,e)}}},methods:{getOpt(t,e){return u.get(this.schema,`options.${t}`,e)},validate(t){this.clearValidationErrors();let e=u.get(this.formOptions,"validateAsync",!1),s=[];if(this.schema.validator&&this.schema.readonly!==!0&&this.disabled!==!0){let r=[];u.isArray(this.schema.validator)?u.forEach(this.schema.validator,n=>{r.push(he(n).bind(this))}):r.push(he(this.schema.validator).bind(this)),u.forEach(r,n=>{if(e)s.push(n(this.value,this.schema,this.model));else{let l=n(this.value,this.schema,this.model);l&&u.isFunction(l.then)?l.then(o=>{o&&(this.errors=this.errors.concat(o));let c=this.errors.length===0;this.$emit("validated",c,this.errors,this)}):l&&(s=s.concat(l))}})}let a=r=>{let n=[];u.forEach(u.uniq(r),o=>{u.isArray(o)&&o.length>0?n=n.concat(o):u.isString(o)&&n.push(o)}),u.isFunction(this.schema.onValidated)&&this.schema.onValidated.call(this,this.model,n,this.schema);let l=n.length===0;return t||this.$emit("validated",l,n,this),this.errors=n,n};return e?Promise.all(s).then(a):a(s)},debouncedValidate(){u.isFunction(this.debouncedValidateFunc)||(this.debouncedValidateFunc=u.debounce(this.validate.bind(this),u.get(this.schema,"validateDebounceTime",u.get(this.formOptions,"validateDebounceTime",500)))),this.debouncedValidateFunc()},updateModelValue(t,e){let s=!1;u.isFunction(this.schema.set)?(this.schema.set(this.model,t),s=!0):this.schema.model&&(this.setModelValueByPath(this.schema.model,t),s=!0),s&&(u.isFunction(this.schema.onChanged)&&this.schema.onChanged.call(this,this.model,t,e,this.schema),u.get(this.formOptions,"validateAfterChanged",!1)===!0&&(u.get(this.schema,"validateDebounceTime",u.get(this.formOptions,"validateDebounceTime",0))>0?this.debouncedValidate():this.validate()),this.$emit("input",t,this.schema.model))},clearValidationErrors(){this.errors.splice(0)},setModelValueByPath(t,e){let s=t.replace(/\[(\w+)\]/g,".$1");s=s.replace(/^\./,"");let a=this.model;const r=s.split(".");let n=0;const l=r.length;for(;n<l;){let o=r[n];if(n<l-1)a[o]!==void 0||this.$root.$set(a,o,{}),a=a[o];else{this.$root.$set(a,o,e);return}++n}},getKeyLocale(){const t={},e=this.schema.model.split(".");return this.schema.localised&&(t.locale=e.shift()),t.key=e.join("."),t},getFieldID(t,e=!1){const s=u.get(this.formOptions,"fieldIdPrefix","");return _i(t,s)+(e?"-"+u.uniqueId():"")},getFieldClasses(){return u.get(this.schema,"fieldClasses",[])}}},vi={mixins:[S],data(){return{options:{maxDepth:0,modifiable:!this.disabled,rootObjectKey:this.schema.model}}},watch:{"schema.model":function(){this.options.rootObjectKey=this.schema.model}},methods:{onChangeData(t){console.warn("onChangeData - ",t),i.set(this.model,i.get(this.schema,"model",!1),t)},get:i.get}};var yi=function(){var e=this,s=e._self._c;return e.schema?s("tree-view",{key:e.schema.model,ref:"input",attrs:{data:e.get(e.model,e.schema.model),options:e.options},on:{"change-data":e.onChangeData}}):e._e()},bi=[],Ci=m(vi,yi,bi,!1,null,null,null,null);const wi=Ci.exports;const $i={components:{codemirror:He.codemirror},mixins:[S],data(){return{isReady:!1,cmOption:{height:"auto",viewportMargin:1/0,tabSize:this.getOpt("tabSize",2),styleActiveLine:this.getOpt("styleActiveLine",!0),lineNumbers:this.getOpt("lineNumbers",!0),line:this.getOpt("line",!0),foldGutter:this.getOpt("foldGutter",!0),styleSelectedText:this.getOpt("styleSelectedText",!0),mode:this.getOpt("mode","javascript"),keyMap:"sublime",matchBrackets:this.getOpt("matchBrackets",!0),showCursorWhenSelecting:this.getOpt("showCursorWhenSelecting",!0),theme:"dracula",extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1}}}},watch:{},mounted(){i.isObject(this.value)&&(this.value=""),i.get(this.cmOption,"mode",!1)==="json"&&(this.cmOption.mode="javascript"),this.isReady=!0},methods:{getStyle(){return i.merge({height:i.get(this.schema,"options.height","auto"),width:i.get(this.schema,"options.width","auto")},i.get(this.schema,"options.css",{}))},onChangeData(t){i.set(this.model,i.get(this.schema,"model",!1),t)}}};var Si=function(){var e=this,s=e._self._c;return s("div",{staticClass:"code-wrapper"},[s("div",{staticClass:"label"},[e._v(e._s(e.schema.label))]),e.isReady?s("codemirror",{ref:"input",style:e.getStyle(),attrs:{options:e.cmOption},on:{input:e.onChangeData},model:{value:e.value,callback:function(a){e.value=a},expression:"value"}}):e._e()],1)},Li=[],Ti=m($i,Si,Li,!1,null,null,null,null);const Ri=Ti.exports,Ei={mixins:[S],props:["locale"],data(){return{acceptedModes:["hexa","rgba","hsla","hex","rgb"],color:"",options:{outputModel:"hexa",hideInputs:!1,hideCanvas:!1,hideSliders:!1,hideModeSwitch:!1}}},watch:{color(){i.set(this.model,this.schema.model,this.color)},"schema.model":function(){this.color=this.getColor()}},created(){const t=i.extend(this.options,this.schema);i.indexOf(this.acceptedModes,t.outputModel)===-1&&(console.warn(`Invalid color mode detected: '${t.outputModel}', will default to hexa`),t.outputModel="hexa"),this.options=t},mounted(){this.color=this.getColor()},methods:{getColor(){return i.get(this.model,this.schema.model)}}};var Ii=function(){var e=this,s=e._self._c;return s("div",{staticClass:"wrapper-color"},[e.options.model?s(ze,{key:e.schema.model+"custom",ref:"input",class:{disabled:e.disabled},attrs:{"dot-size":e.options.dotSize,"hide-canvas":e.options.hideCanvas,"hide-sliders":e.options.hideSliders,"hide-inputs":e.options.hideInputs,"hide-mode-switch":e.options.hideModeSwitch,model:e.options.outputModel},model:{value:e.color,callback:function(a){e.color=a},expression:"color"}}):e._e()],1)},xi=[],ki=m(Ei,Ii,xi,!1,null,null,null,null);const Di=ki.exports,Oi={mixins:[S],data(){return{editor:null,originalValue:null}},watch:{"schema.model":function(){const t=i.extend(this.originalValue,i.get(this.model,this.schema.model));this.editor.setValue(t),i.set(this.model,this.schema.model,t)}},mounted(){const t=i.get(this.$refs,"input",!1);this.schema.jsonEditorOptions.title=" ";const e={schema:this.schema.jsonEditorOptions,theme:"cms",iconlib:"foundation3"};this.disabled&&(e.disable_array_delete=!0),Q.JSONEditor.defaults.themes.cms=class extends Q.JSONEditor.AbstractTheme{getRangeInput(a,r,n){return super.getRangeInput(a,r,n)}getGridContainer(){const a=document.createElement("div");return a.className="json-editor-grid-container",a}getGridRow(){const a=document.createElement("div");return a.className="json-editor-grid-row",a}getFormInputLabel(a){const r=super.getFormInputLabel(a);return r.style.display="inline-block",r.style.fontWeight="bold",r.className="json-editor-input-label",r}setGridColumnSize(a,r){a.className=`span${r}`}getSelectInput(a){return super.getSelectInput(a)}getFormInputField(a){return super.getFormInputField(a)}afterInputReady(a){if(!a.controlgroup&&(a.controlgroup=this.closest(a,".control-group"),a.controls=this.closest(a,".controls"),this.closest(a,".compact")&&(a.controlgroup.className=a.controlgroup.className.replace(/control-group/g,"").replace(/[ ]{2,}/g," "),a.controls.className=a.controlgroup.className.replace(/controls/g,"").replace(/[ ]{2,}/g," "),a.style.marginBottom=0),this.queuedInputErrorText)){const r=this.queuedInputErrorText;delete this.queuedInputErrorText,this.addInputError(a,r)}}getIndentedPanel(){return document.createElement("div")}getModal(){const a=document.createElement("div");return a.style.backgroundColor="white",a.style.border="1px solid black",a.style.boxShadow="3px 3px black",a.style.position="absolute",a.style.zIndex="10",a.style.display="none",a.style.width="auto",a}getInfoButton(a){const r=document.createElement("span");r.className="icon-info-sign pull-right",r.style.padding=".25rem",r.style.position="relative",r.style.display="inline-block";const n=document.createElement("span");return n.style["font-family"]="sans-serif",n.style.visibility="hidden",n.style["background-color"]="rgba(50, 50, 50, .75)",n.style.margin="0 .25rem",n.style.color="#FAFAFA",n.style.padding=".5rem 1rem",n.style["border-radius"]=".25rem",n.style.width="25rem",n.style.transform="translateX(-27rem) translateY(-.5rem)",n.style.position="absolute",n.innerText=a,r.onmouseover=function(){n.style.visibility="visible"},r.onmouseleave=function(){n.style.visibility="hidden"},r.appendChild(n),r}getFormInputDescription(a){const r=document.createElement("p");return r.className="help-inline",r.textContent=a,r}getFormControl(a,r,n,l){const o=document.createElement("div");o.className="control-group";const c=document.createElement("div");return c.className="controls",a&&r.getAttribute("type")==="checkbox"?(o.appendChild(c),a.className+=" checkbox",a.appendChild(r),c.appendChild(a),l&&c.appendChild(l),c.style.height="30px"):(a&&(a.className+=" control-label",o.appendChild(a)),l&&c.appendChild(l),c.appendChild(r),o.appendChild(c)),n&&c.appendChild(n),o}getHeaderButtonHolder(){const a=this.getButtonHolder();return a.className+=" btn-groups",a}getButtonHolder(){const a=document.createElement("div");return a.className="btn-group",a}getButton(a,r,n){const l=super.getButton(a,r,n);return l.className+=" btn btn-default",l}getTable(){const a=document.createElement("table");return a.className="table table-bordered",a}getTableCell(){return document.createElement("td")}addInputError(a,r){if(!a.controlgroup){this.queuedInputErrorText=r;return}!a.controlgroup||!a.controls||(a.controlgroup.className+=" error",a.errmsg?a.errmsg.style.display="":(a.errmsg=document.createElement("p"),a.errmsg.className="help-block errormsg",a.controls.appendChild(a.errmsg)),a.errmsg.textContent=r)}removeInputError(a){a.controlgroup||delete this.queuedInputErrorText,a.errmsg&&(a.errmsg.style.display="none",a.controlgroup.className=a.controlgroup.className.replace(/\s?error/g,""))}getTabHolder(a){const r=typeof a>"u"?"":a,n=document.createElement("div");return n.className="tabbable tabs-left",n.innerHTML=`<ul class='nav nav-tabs'  id='${r}'></ul><div class='tab-content well well-small' id='${r}'></div>`,n}getTopTabHolder(a){const r=typeof a>"u"?"":a,n=document.createElement("div");return n.className="tabbable tabs-over",n.innerHTML=`<ul class='nav nav-tabs' id='${r}'></ul><div class='tab-content well well-small'  id='${r}'></div>`,n}getTab(a,r){const n=document.createElement("li");n.className="nav-item";const l=document.createElement("a");return l.setAttribute("href",`#${r}`),l.appendChild(a),n.appendChild(l),n}getTopTab(a,r){const n=document.createElement("li");n.className="nav-item";const l=document.createElement("a");return l.setAttribute("href",`#${r}`),l.appendChild(a),n.appendChild(l),n}getTabContentHolder(a){return a.children[1]}getTopTabContentHolder(a){return a.children[1]}getTabContent(){const a=document.createElement("div");return a.className="tab-pane",a}getTopTabContent(){const a=document.createElement("div");return a.className="tab-pane",a}markTabActive(a){a.tab.className=a.tab.className.replace(/\s?active/g,""),a.tab.className+=" active",a.container.className=a.container.className.replace(/\s?active/g,""),a.container.className+=" active"}markTabInactive(a){a.tab.className=a.tab.className.replace(/\s?active/g,""),a.container.className=a.container.className.replace(/\s?active/g,"")}addTab(a,r){a.children[0].appendChild(r)}addTopTab(a,r){a.children[0].appendChild(r)}getProgressBar(){const a=document.createElement("div");a.className="progress";const r=document.createElement("div");return r.className="bar",r.style.width="0%",a.appendChild(r),a}updateProgressBar(a,r){a&&(a.firstChild.style.width=`${r}%`)}updateProgressBarUnknown(a){a&&(a.className="progress progress-striped active",a.firstChild.style.width="100%")}},this.editor=new Q.JSONEditor(t,e),this.disabled&&this.editor.disable(),this.editor.on("ready",()=>{this.originalValue=this.editor.getValue();const s=i.extend(this.originalValue,i.get(this.model,this.schema.model));this.editor.setValue(s),i.set(this.model,this.schema.model,s)}),this.editor.on("change",()=>{const s=this.editor.getValue();i.set(this.model,this.schema.model,s)})},methods:{}};var Mi=function(){var e=this,s=e._self._c;return s("div",{ref:"input",staticClass:"json-editor",attrs:{disabled:e.disabled}})},Fi=[],Ai=m(Oi,Mi,Fi,!1,null,null,null,null);const Ni=Ai.exports;const Vi={components:{TiptapVuetify:Ke},mixins:[S],data(){return{localObj:this.model,loaded:!1,key:null,extensions:[Ge,Ye,We,Qe,Xe,Ze,Je,et,tt,[st,{options:{levels:[1,2,3]}}],it,at,rt,nt,lt]}},watch:{model(){this.updateObj()}},mounted(){this.updateObj()},created(){},methods:{getColorForToolbar(){return this.$vuetify.theme.dark?"black":"white"},onInit(){setTimeout(()=>{const t=i.get(this.$refs.wysiwygWrapper,"children[1].children[0].children[0].children[0].children[0].children[0].children",[]);i.each(t,e=>{e.tabIndex=-1,i.each(e.children,s=>{s.tabIndex=-1,i.each(s.children,a=>{a.tabIndex=-1})})})},10)},updateObj(){if(!i.get(this.schema,"model",!1))return!1;const t=this.schema.model.split(".");this.key=t.pop(),this.localObj=i.reduce(t,(e,s)=>e[s],this.model),this.localObj[this.key]=this.localObj[this.key]||"",this.loaded=!0}}};var Ui=function(){var e=this,s=e._self._c;return s("div",{ref:"wysiwygWrapper",staticClass:"wysiwyg-wrapper"},[s("div",{staticClass:"field-label"},[e._v(e._s(e.schema.label))]),s("div",{staticClass:"border-wrapper"},[s("tiptap-vuetify",{ref:"input",attrs:{"card-props":{flat:!0},extensions:e.extensions,"toolbar-attributes":{color:e.getColorForToolbar(),dense:!0,outlined:!0,elevation:1},disabled:e.disabled,placeholder:"Write something …"},on:{init:e.onInit,blur:e.onInit,focus:e.onInit},model:{value:e.localObj[e.key],callback:function(a){e.$set(e.localObj,e.key,a)},expression:"localObj[key]"}})],1)])},Pi=[],Bi=m(Vi,Ui,Pi,!1,null,"a354f170",null,null);const qi=Bi.exports,Y={data(){return{dragging:!1,dragOptions:{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{onStartDrag(){this.dragging=!0},viewFile(t=!1){var e=t||this.attachment();const s=i.get(e,"_filename","").split("."),a=s.length>1?`.${i.last(s)}`:"";window.open(window.origin+e.url+a,"_blank").focus(),console.log(e)}}};const ji=["string","text","password","email","url","number","double","integer","checkbox","date","time","datetime","pillbox","json","code","wysiwyg","object","color","image","file"],Hi={mixins:[Y],props:["schema","vfg","model","disabled"],data(){return{items:i.cloneDeep(i.get(this.model,this.schema.model,[])),types:[],selectedType:!1,localModel:{},key:P()}},watch:{"schema.model":function(){this.items=i.cloneDeep(i.get(this.model,this.schema.model,[]))}},created(){this.updateLocalData()},mounted(){const t=i.get(this,"schema.types",ji);this.types=i.map(t,e=>(i.isString(e)&&(e={input:e,parentKey:this.schema.model}),e.label||(e.label=i.includes(["select","multiselect"],e.input)?`${e.input}(${e.source})`:e.input),e)),this.selectedType=i.first(this.types)},methods:{onError(t){console.error("ParagraphView - error",t)},updateLocalData(){this.localModel=i.cloneDeep(this.model)},validate(){return i.each(this.$refs.vfg,t=>{if(!t.validate())throw this.errors=t.errors,new Error("group validation error")}),!0},debouncedValidate(){i.each(this.$refs.vfg,t=>{t.debouncedValidate()})},clearValidationErrors(){i.each(this.$refs.vfg,t=>{t.clearValidationErrors()})},getSchema(t){let e=[];const{resource:s,locale:a,userLocale:r,disabled:n}=this.schema;if(t.input==="group")e=i.map(t.schema,d=>i.extend({},d,{field:`value.${d.field}`,localised:this.schema.localised,label:d.label||d.field}));else{const d=i.extend({},t,{field:"value",localised:this.schema.localised});e.push(d)}i.each(e,d=>{i.includes(["image","file"],d.input)&&(d.input=i.camelCase(`paragraph ${d.input}`))});let l={};i.isString(t.source)&&(l=i.get(E.getSchema(t.source),"extraSources",{}));const o=z.getSchemaFields(e,s,a,r,n,l,this.schema.rootView||this);return{fields:z.getNestedGroups(s,o,0,null,"value.")}},getAttachment(t,e){const s=i.find(this.model._attachments,{_fields:{fileItemId:t}});return e?i.get(s,e):s},onChangeType(t){const e=i.find(this.types,{label:t});if(i.isUndefined(e))return console.warn(`No type found for ${t} in types:`,this.types);this.selectedType=e},onClickAddNewItem(){if(this.selectedType){const t=i.cloneDeep(this.selectedType);this.items.push(t),i.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.localModel,this.schema.model)}},onClickRemoveItem(t){console.warn("onClickRemoveItem -",t);let e=i.get(this.model,"_attachments",[]);if(i.includes(["image","file","group"],t.input)){const s=r=>{const n=[];return i.each(r,(l,o)=>{if(o==="id")return n.push(l);(i.isPlainObject(l)||i.isArray(l))&&n.push(...s(l))}),n},a=s(t);console.warn("IDS = ",a),i.each(a,r=>{e=i.reject(e,{_fields:{fileItemId:r}})})}this.items=i.difference(this.items,[t]),i.set(this.localModel,this.schema.model,this.items),i.set(this.model,"_attachments",e),this.items=i.clone(this.items),this.key=P(),this.$emit("input",this.items,this.schema.model)},onChange(){i.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.items,this.schema.model)},onEndDrag(){this.dragging=!1,i.set(this.localModel,this.schema.model,this.items),this.key=P(),this.$emit("input",this.items,this.schema.model)},onModelUpdated(t,e){i.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.items,this.schema.model)}}};var zi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"paragraph-view"},[e.schema?s("draggable",e._b({key:`${e.schema.model}-${e.key}`,class:{disabled:e.disabled},attrs:{list:e.items,draggable:".item",handle:".handle",group:`${e.schema.model}-${e.key}`,"ghost-class":"ghost"},on:{end:e.onEndDrag,start:function(a){e.dragging=!0}}},"draggable",e.dragOptions,!1),[e._l(e.items,function(a,r){return s(k,{key:`paragraph-item-${r}`,staticClass:"item"},[s("span",{staticClass:"handle"}),s("div",{staticClass:"item-main-wrapper"},[s("div",{staticClass:"item-main"},[s("custom-form",{attrs:{schema:e.getSchema(a),model:a},on:{error:e.onError,input:e.onModelUpdated}})],1),s(v,{staticClass:"add-new-item",attrs:{fab:"",small:""},on:{click:function(n){return e.onClickRemoveItem(a)}}},[s(f,[e._v("mdi-minus")])],1)],1)])}),s("div",{attrs:{slot:"header"},slot:"header"},[s(ot,{ref:"input",attrs:{label:e.schema.label,value:e.selectedType,"menu-props":{bottom:!0,offsetY:!0},items:e.types,"item-text":"label","item-value":"label","hide-details":"",outlined:"",dense:"","persistent-placeholder":""},on:{change:e.onChangeType}}),s(v,{staticClass:"add-new-item",attrs:{fab:"",small:""},on:{click:e.onClickAddNewItem}},[s(f,[e._v("mdi-plus")])],1)],1)],2):e._e()],1)},Ki=[],Gi=m(Hi,zi,Ki,!1,null,"44bb6a3b",null,null);const Yi=Gi.exports,le={data(){return{dragover:!1,attachments:[],localModel:!1}},mounted(){this.localModel=i.cloneDeep(this.model),this.attachments=this.getAttachments()},methods:{onEndDrag({newIndex:t,oldIndex:e}){this.dragging=!1;const s=i.map(this.getAttachments(),(r,n)=>(r.order!==n+1&&(r.order=n+1,r.orderUpdated=!0),r));let a=i.map(this.localModel._attachments,r=>{if(!this.isSameAttachment(r))return r;const n=i.get(i.find(s,{orderUpdated:!0,_filename:r._filename,_size:r._size,url:r.url}),"order",0);return n!==0&&n!==i.get(r,"order",-1)&&(r.order=n,r.orderUpdated=!0),r});a=i.orderBy(a,["order"],["asc"]),this.attachments=i.filter(a,r=>this.isSameAttachment(r)),this.$emit("input",a,this.schema.model)},getImageSrc(t=!1){const e=t||this.attachment();return e.data?e.data:this.getPreviewUrl(e)},isImage(t=!1){const e=t||this.attachment();return e&&/image/g.test(e._contentType||e.file&&e.file.type)},getPreviewUrl(t=!1){return`${(t||this.attachment()).url}?resize=autox100`},isSameAttachment(t){const{key:e,locale:s}=this.getKeyLocale();return t._name===e&&(t._fields&&t._fields.locale)===s},attachment(){return i.find(this.localModel._attachments,t=>this.isSameAttachment(t))},getAttachments(){return i.get(this.attachments,"length",0)!==0?this.attachments:i.filter(this.localModel._attachments,t=>this.isSameAttachment(t))},imageSize(t=!1){const e=t||this.attachment();return this.bytesToSize(i.get(e,"_size",i.get(e,"file.size",!1)))},bytesToSize(t){if(t===0)return"0 Byte";const e=["Bytes","KB","MB","GB","TB"],s=parseInt(Math.floor(Math.log(t)/Math.log(1024))),a=Math.round(t/Math.pow(1024,s),2);return i.isNaN(a)?"Unknown":`${a} ${e[s]}`},isForMultipleImages(){if(this.schema.width&&this.schema.height)return!1;const t=this.getMaxCount();return t===-1?!0:t>1},isFieldDisabled(){const t=this.getMaxCount();return t===-1?!1:this.getAttachments().length>=t},getFieldType(){return i.toUpper(i.get(this.schema,"type","ImageView")==="ImageView"?"image":"file")},isFieldValid(){return i.get(i.compact(this.getRules()),"length",0)===0},getRules(){const t=[];return this.schema.required&&t.push(e=>!!e||i.get(this.getAttachments(),"length",0)!==0||h.get(`TL_${this.getFieldType()}_IS_MANDATORY`)),this.isForMultipleImages()?(t.push(e=>{const s=this.getMaxCount();return s===-1||i.get(this.getAttachments(),"length",0)+i.get(e,"length",0)<=s?!0:h.get(`TL_TOO_MANY_${this.getFieldType()}S`)}),i.get(this.schema,"options.limit",!1)&&t.push(e=>!e||!e.some(s=>s.size>this.schema.limit)||h.get(`TL_${this.getFieldType()}_IS_TOO_BIG`))):i.get(this.schema,"options.limit",!1)&&t.push(e=>!e||e.size<=this.schema.limit||h.get(`TL_${this.getFieldType()}_IS_TOO_BIG`)),t},getPlaceholder(){return`TL_CLICK_OR_DRAG_AND_DROP_TO_ADD_${this.getFieldType()}${this.isForMultipleImages()?"S":""}`},getMaxCount(){return i.get(this.schema,"options.maxCount",-1)},getFileSizeLimit(t){const e=t/1024;return e>1e3?`${e/1e3} MB`:`${e} KB`},removeImage(t){this.$refs.input.internalValue=null,this.$refs.input.$refs.input.value=null,this.localModel._attachments=i.filter(this.localModel._attachments,s=>s!==t),this.attachments=i.filter(this.localModel._attachments,s=>this.isSameAttachment(s)),this.$forceUpdate(),this.$emit("input",this.localModel._attachments,this.schema.model);const e=this.schema.label;this.schema.label=null,this.schema.label=e},onDrop(t){this.dragover=!1;const e=this.getMaxCount();if(e!==-1&&e<=1&&t.dataTransfer.files.length>1)return console.error("Only one file can be uploaded at a time..");this.onUploadChanged(t.dataTransfer.files)},async onUploadChanged(t){if(this.$refs.input.validate(),!this.$refs.input.valid||(t=i.isNull(t)?[]:t,i.isArray(t)||(t=[t]),!t.length))return;const e=this.getMaxCount(),s=this.getAttachments().length+t.length;e>1&&s>e?(console.warn("reached max",s,e),t=i.take(t,t.length-(s-e))):e===1&&s>1&&(this.localModel._attachments=i.filter(this.localModel._attachments,a=>!this.isSameAttachment(a))),this.attachments=i.filter(await this.readAllFiles(t),a=>this.isSameAttachment(a)),this.$forceUpdate(),this.$emit("input",this.localModel._attachments,this.schema.model)},async readAllFiles(t){let e=i.get(t,"length",1);return new Promise((s,a)=>{i.each(t,(r,n)=>{const l=new FileReader,o=this;l.onload=c=>{const{key:d,locale:_}=o.getKeyLocale(),b={_filename:r.name,_name:d,_fields:{locale:_},field:this.schema.model,localised:this.schema.localised,file:r,data:c.target.result};o.localModel._attachments.push(b),o.$forceUpdate(),e--,e===0&&(this.isForMultipleImages()&&i.each(o.localModel._attachments,(g,L)=>{g.order=L+1,g.orderUpdated=!0}),s(o.localModel._attachments))};try{l.readAsDataURL(r)}catch{}})})}}};const Wi={components:{Cropper:ct},mixins:[M,S,le,Y],data(){return{firstCropUpdate:!0,stencilProps:{class:"cropper-stencil",previewClass:"cropper-stencil__preview",draggingClass:"cropper-stencil--dragging",handlersClasses:{default:"cropper-handler",eastNorth:"cropper-handler--east-north",westNorth:"cropper-handler--west-north",eastSouth:"cropper-handler--east-south",westSouth:"cropper-handler--west-south"}}}},methods:{getDefaultCropPosition({imageSize:t,visibleArea:e,coordinates:s}){const a=this.attachment();if(i.get(a,"cropOptions",!1))return{left:a.cropOptions.left,top:a.cropOptions.top};console.warn("no crop options");const r=e||t;return{left:(e?e.left:0)+r.width/2-s.width/2,top:(e?e.top:0)+r.height/2-s.height/2}},getDefaultCropSize(){return{width:i.get(this.schema,"options.width",500),height:i.get(this.schema,"options.height",500)}},onCropperChange(t){const e=this.attachment();i.each(this.localModel._attachments,s=>{s._id===e._id&&(s.cropOptions=t.coordinates,this.firstCropUpdate?this.firstCropUpdate=!1:s.cropOptions.updated=!0)}),this.$emit("input",this.localModel._attachments,this.schema.model)},imageUrl(){const t=this.attachment();return t&&(t.url||t.data)}}};var Qi=function(){var e=this,s=e._self._c;return s("div",{staticClass:"image-view",class:{"full-width":!(e.schema.width&&e.schema.height)}},[e.disabled?e._e():s("form",{attrs:{enctype:"multipart/form-data"}},[s(k,{staticClass:"file-input-card",class:{"drag-and-drop":e.dragover},attrs:{elevation:"0"},on:{drop:function(a){return a.preventDefault(),e.onDrop(a)},dragover:function(a){a.preventDefault(),e.dragover=!0},dragenter:function(a){a.preventDefault(),e.dragover=!0},dragleave:function(a){a.preventDefault(),e.dragover=!1}}},[s(G,{ref:"input",attrs:{rules:e.getRules(),"hide-details":e.isFieldValid(),label:e.schema.label,placeholder:e._f("translate")(e.getPlaceholder()),clearable:!1,dense:"",outlined:"","persistent-placeholder":"","persistent-hint":"",multiple:e.isForMultipleImages(),accept:e.schema.accept,disabled:e.isForMultipleImages()&&e.isFieldDisabled()},on:{change:e.onUploadChanged},scopedSlots:e._u([{key:"selection",fn:function({index:a}){return[a===0?s("div",{staticClass:"v-file-input__text v-file-input__text--placeholder"},[e._v(" "+e._s(e._f("translate")(e.getPlaceholder()))+" ")]):e._e()]}}],null,!1,3100899402)})],1)],1),e.isForMultipleImages()?s("div",{staticClass:"preview-multiple"},[e.schema?s("draggable",e._b({key:`${e.schema.model}`,class:{disabled:e.disabled},attrs:{list:e.getAttachments(),draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},on:{end:e.onEndDrag,start:e.onStartDrag}},"draggable",e.dragOptions,!1),e._l(e.getAttachments(),function(a,r){return s(k,{key:`${a._filename}-${r}`,staticClass:"preview-attachment",class:{odd:r%2!==0}},[s(N,{staticClass:"filename",attrs:{close:""},on:{"click:close":function(n){return e.removeImage(a)}}},[e._v("#"+e._s(r+1)+" - "+e._s(e._f("truncate")(a._filename,10))+" ("+e._s(e.imageSize(a))+")")]),s("div",{staticClass:"row-handle"},[s("img",{attrs:{src:e.getImageSrc(a)}}),s(f,[e._v("mdi-drag")])],1)],1)}),1):e._e()],1):e.attachment()&&e.isImage()?[e.schema.width&&e.schema.height?[s("cropper",{ref:"cropper",staticClass:"cropper",attrs:{src:e.imageUrl(),transitions:!0,"image-restriction":"fill-area","image-class":"cropper__image","default-boundaries":"fill","default-size":e.schema.options.width&&e.schema.options.height?e.getDefaultCropSize():!1,"default-position":e.getDefaultCropPosition,"min-width":e.schema.options.width,"max-width":e.schema.options.width,"min-height":e.schema.options.height,"max-height":e.schema.options.height,"move-image":!!e.schema.options.moveImage,"resize-image":!!e.schema.options.resizeImage,"stencil-props":e.stencilProps},on:{change:e.onCropperChange}})]:s("div",{staticClass:"preview-single-attachment"},[s(N,{staticClass:"filename",attrs:{close:""},on:{"click:close":function(a){e.removeImage(e.attachment())}}},[e._v(e._s(e._f("truncate")(e.attachment()._filename,10))+" ("+e._s(e.imageSize(e.attachment()))+")")]),s("img",{staticClass:"preview",attrs:{src:e.getImageSrc()}})],1)]:e._e(),e.isForMultipleImages()?[s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),e.getMaxCount()!==-1?s("span",[e._v(e._s(e._f("translate")("TL_MAX_NUMBER_OF_IMAGES",null,{num:e.getMaxCount()})))]):s("span",[e._v(e._s(e._f("translate")("TL_UNLIMITED_NUMBER_OF_IMAGES")))])],1)]:e._e(),e.schema.width&&e.schema.height?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES_THE_FOLLOWING_SIZE"))+":"+e._s(e.schema.width)+"x"+e._s(e.schema.height))])],1):e._e(),e.schema.limit?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES_A_FILE_SIZE"))+": "+e._s(e.getFileSizeLimit(e.schema.limit)))])],1):e._e(),e.schema.accept?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES"))+": "+e._s(e.schema.accept))])],1):e._e()],2)},Xi=[],Zi=m(Wi,Qi,Xi,!1,null,"006c861d",null,null);const Ji=Zi.exports;const ea={mixins:[S,le,Y]};var ta=function(){var e=this,s=e._self._c;return s("div",{staticClass:"attachment-view"},[e.disabled?e._e():s("form",{attrs:{enctype:"multipart/form-data"}},[s(k,{staticClass:"file-input-card",class:{"drag-and-drop":e.dragover},attrs:{elevation:"0"},on:{drop:function(a){return a.preventDefault(),e.onDrop(a)},dragover:function(a){a.preventDefault(),e.dragover=!0},dragenter:function(a){a.preventDefault(),e.dragover=!0},dragleave:function(a){a.preventDefault(),e.dragover=!1}}},[s(G,{ref:"input",attrs:{rules:e.getRules(),label:e.schema.label,placeholder:e._f("translate")(e.getPlaceholder()),clearable:!1,dense:"",outlined:"","persistent-placeholder":"","persistent-hint":"",multiple:e.isForMultipleImages(),accept:e.schema.accept,disabled:e.isForMultipleImages()&&e.isFieldDisabled()},on:{change:e.onUploadChanged},scopedSlots:e._u([{key:"selection",fn:function({index:a}){return[a===0?s("div",{staticClass:"v-file-input__text v-file-input__text--placeholder"},[e._v(" "+e._s(e._f("translate")(e.getPlaceholder()))+" ")]):e._e()]}}],null,!1,3100899402)})],1)],1),e.isForMultipleImages()?s("div",{staticClass:"preview-multiple"},[e.schema?s("draggable",e._b({key:`${e.schema.model}`,class:{disabled:e.disabled},attrs:{list:e.getAttachments(),draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},on:{end:e.onEndDrag,start:e.onStartDrag}},"draggable",e.dragOptions,!1),e._l(e.getAttachments(),function(a,r){return s(k,{key:`${a._filename}-${r}`,staticClass:"preview-attachment",class:{odd:r%2!==0}},[s(N,{staticClass:"filename",attrs:{close:""},on:{"click:close":function(n){return e.removeImage(a)}}},[e._v("#"+e._s(r+1)+" - "+e._s(e._f("truncate")(a._filename,10))+" ("+e._s(e.imageSize(a))+")")]),s("div",{staticClass:"row-handle"},[e.isImage()?s("img",{attrs:{src:e.getImageSrc(a)}}):s(v,{attrs:{small:""},on:{click:function(n){return e.viewFile(a)}}},[e._v(e._s(e._f("translate")("TL_VIEW")))]),s(f,[e._v("mdi-drag")])],1)],1)}),1):e._e()],1):e.attachment()?s("div",{staticClass:"preview-single-attachment"},[s(N,{staticClass:"filename",attrs:{close:""},on:{"click:close":function(a){e.removeImage(e.attachment())}}},[e._v(e._s(e._f("truncate")(e.attachment()._filename,10))+" ("+e._s(e.imageSize(e.attachment()))+")")]),e.isImage()?s("img",{attrs:{src:e.getImageSrc()}}):s(v,{attrs:{small:""},on:{click:function(a){return e.viewFile()}}},[e._v(e._s(e._f("translate")("TL_VIEW")))])],1):e._e(),e.isForMultipleImages()?[s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),e.getMaxCount()!==-1?s("span",[e._v(e._s(e._f("translate")("TL_MAX_NUMBER_OF_FILES",null,{num:e.getMaxCount()})))]):s("span",[e._v(e._s(e._f("translate")("TL_UNLIMITED_NUMBER_OF_FILES")))])],1)]:e._e(),e.schema.width&&e.schema.height?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES_THE_FOLLOWING_SIZE"))+":"+e._s(e.schema.width)+"x"+e._s(e.schema.height))])],1):e._e(),e.schema.limit?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES_A_FILE_SIZE"))+": "+e._s(e.getFileSizeLimit(e.schema.limit)))])],1):e._e(),e.schema.accept?s("div",{staticClass:"help-block"},[s(f,{attrs:{small:""}},[e._v("mdi-information")]),s("span",[e._v(e._s(e._f("translate")("TL_THIS_FIELD_REQUIRES"))+": "+e._s(e.schema.accept))])],1):e._e()],2)},sa=[],ia=m(ea,ta,sa,!1,null,"4efa0cec",null,null);const aa=ia.exports;const ra={mixins:[S,le,Y],data(){return{dragover:!1,items:i.get(this.model,this.schema.model,[]),key:P(),attachments:[]}},watch:{"schema.model":function(){this.items=i.get(this.model,this.schema.model,[]),this.attachments=this.formatItems()}},mounted(){this.attachments=this.formatItems()},methods:{formatItems(){return i.map(this.items,t=>this.getAttachment(t))},onChange(){i.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model)},onEndDrag(){i.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model)},onDrop(t){if(this.dragover=!1,this.schema.maxCount<=1&&t.dataTransfer.files.length>1)return console.error("Only one file can be uploaded at a time..");t.dataTransfer.files.forEach(e=>{this.onChangeFile(e)})},onChangeFile(t){if(this.$refs.fileInput.validate(),!this.$refs.fileInput.valid)return;i.isArray(t)||(t=[t]);const{key:e,locale:s}=this.getKeyLocale();i.each(t,(a,r)=>{const n=P(),l={id:n};this.items.push(l),this.items=i.clone(this.items),i.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model);const o=this.schema.rootView.model._attachments=this.schema.rootView.model._attachments||[],c={_filename:a.name,order:r+1,orderUpdated:!0,_name:e,_fields:{locale:s,fileItemId:n},file:a};if(this.schema.fileType==="image")try{c.url=URL.createObjectURL(a)}catch(d){console.error(d)}o.push(c),console.warn("added attachment = ",c),event.target.value=null}),i.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model)},getAttachment(t,e){const s=i.find(this.schema.rootView.model._attachments,{_fields:{fileItemId:t.id}});return e?i.get(s,e):s},onClickRemoveFileItem(t){let e=this.schema.rootView.model._attachments=this.schema.rootView.model._attachments||[];e=i.reject(e,{_fields:{fileItemId:t.id}}),this.items=i.difference(this.items,[t]),i.set(this.schema.rootView.model,"_attachments",e),i.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model)}}};var na=function(){var e=this,s=e._self._c;return s("div",{staticClass:"paragraph-attachment-view"},[s(k,{class:{"drag-and-drop":e.dragover},attrs:{elevation:"0"},on:{drop:function(a){return a.preventDefault(),e.onDrop(a)},dragover:function(a){a.preventDefault(),e.dragover=!0},dragenter:function(a){a.preventDefault(),e.dragover=!0},dragleave:function(a){a.preventDefault(),e.dragover=!1}}},[s(G,{ref:"input",attrs:{rules:e.getRules(),accept:e.model.input==="image"?"image/*":"*",clearable:!1,placeholder:e._f("translate")(e.getPlaceholder()),dense:"",outlined:"","persistent-placeholder":"","persistent-hint":"",multiple:e.isForMultipleImages(),disabled:e.isForMultipleImages()&&e.isFieldDisabled()},on:{change:e.onChangeFile},scopedSlots:e._u([{key:"selection",fn:function({index:a}){return[a===0?s("div",{staticClass:"v-file-input__text v-file-input__text--placeholder"},[e._v(" "+e._s(e._f("translate")(e.getPlaceholder()))+" ")]):e._e()]}}])})],1),e.schema?s("draggable",e._b({key:`${e.schema.model}-${e.key}`,staticClass:"preview-multiple",class:{disabled:e.disabled},attrs:{group:`${e.schema.model}-${e.key}`,draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},on:{end:e.onEndDrag,start:e.onStartDrag},model:{value:e.items,callback:function(a){e.items=a},expression:"items"}},"draggable",e.dragOptions,!1),e._l(e.items,function(a,r){return s(k,{key:`${a._filename}-${r}`,staticClass:"preview-attachment",class:{odd:r%2!==0}},[s(N,{staticClass:"filename",attrs:{close:""},on:{"click:close":function(n){return e.onClickRemoveFileItem(a)}}},[e._v("#"+e._s(r+1)+" - "+e._s(e._f("truncate")(e.getAttachment(a,"_filename"),10))+" ("+e._s(e.imageSize(e.getAttachment(a)))+")")]),s("div",{staticClass:"row-handle"},[e.isImage()?s("img",{attrs:{src:e.getImageSrc(a)}}):e.getAttachment(a,"url")?s(v,{attrs:{small:""},on:{click:function(n){e.viewFile(e.getAttachment(a))}}},[e._v(e._s(e._f("translate")("TL_VIEW")))]):e._e(),s(f,[e._v("mdi-drag")])],1)],1)}),1):e._e()],1)},la=[],oa=m(ra,na,la,!1,null,"e74f504f",null,null);const ca=oa.exports;const da={props:["format","name","width","value"],data(){return{hideCal:!0,activePort:null,timeStamp:null,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Su","Mo","Tu","We","Th","Fr","Sa"],monthIndex:0,hourIndex:0,minuteIndex:0,year:2017,portsHolder:[],minute:0,hour:1,day:1,minuteSelectorVisible:!1,hourSelectorVisible:!1,period:"AM"}},computed:{ports:{get(){let t=[];if(this.portsHolder.length===0)for(let e=0;e<42;e++)t.push("");else t=this.portsHolder;return t},set(t){this.portsHolder=t}},month(){return this.months[this.monthIndex]},dateTime(){return`${this.timeStamp.getFullYear()}-${this.timeStamp.getMonth()+1}-${this.timeStamp.getUTCDay()}`},minutes(){const t=[];for(let e=0;e<60;e++)e<10?t.push(`0${e}`):t.push(`${e}`);return t},hours(){const t=[];for(let e=1;e<=12;e++)e<10?t.push(`0${e}`):t.push(`${e}`);return t},dateFormat(){return this.format||"YYYY-MM-DD hh:mm:ss a"},hideTime(){return this.dateFormat.indexOf("hh:mm:ss")===-1},hideDate(){return this.dateFormat==="hh:mm:ss a"}},created(){let t=new Date;this.value&&(t=new Date(this.value),this.timeStamp=t),this.year=t.getFullYear(),this.monthIndex=t.getMonth(),this.day=t.getDate(),this.period=t.getHours()>=12?"PM":"AM",this.hour=t.getHours(),this.hour===0?this.hour+=12:this.hour>12&&(this.hour-=12),this.minute=t.getMinutes()||0,this.updateCalendar(),document.addEventListener("keydown",this.keyIsDown),document.addEventListener("click",this.documentClicked),this.setDate()},destroyed(){document.removeEventListener("keydown",this.keyIsDown),document.removeEventListener("click",this.documentClicked)},methods:{padZero(t){return i.padStart(t,2,"0")},display(){return this.timeStamp?O(this.timeStamp).format(this.dateFormat):""},leftMonth(){const t=this.months.indexOf(this.month);t===0?this.monthIndex=11:this.monthIndex=t-1,this.updateCalendar()},rightMonth(){const t=this.months.indexOf(this.month);t===11?this.monthIndex=0:this.monthIndex=t+1,this.updateCalendar()},rightYear(){this.year++,this.updateCalendar()},leftYear(){this.year--,this.updateCalendar()},updateCalendar(){const t=this,s=new Date(t.year,t.monthIndex,1,0,0,0).getDay(),a=new Date(t.year,t.monthIndex+1,0).getDate(),r=[];let n=35;(s===6||s===5&&a===31)&&(n=42);let l=!1;for(let o=0;o<n;o++){const c=o-s,d=c<0||c>=a?"":c+1;r.push(d),this.timeStamp&&d===t.day&&this.timeStamp.getMonth()===t.monthIndex&&this.timeStamp.getFullYear()===t.year&&(t.activePort=o,l=!0)}l||(t.activePort=-1),this.ports=r},setDay(t,e){e!==""&&(this.activePort=t,this.day=e,this.timeStamp=new Date(this.year,this.monthIndex,this.day),this.setDate(!0))},setMinute(t,e){this.minuteIndex=t,this.minute=t,e&&(this.minuteSelectorVisible=!1)},setHour(t,e){this.hourIndex=t,this.hour=t+1,e&&(this.hourSelectorVisible=!1)},showHourSelector(){this.hourSelectorVisible=!0,this.minuteSelectorVisible=!1},showMinuteSelector(){this.minuteSelectorVisible=!0,this.hourSelectorVisible=!1},keyIsDown(t){const e=t.which||t.keycode;e===38?this.minuteSelectorVisible&&this.minuteIndex>0?(this.setMinute(this.minuteIndex-1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex>0&&(this.setHour(this.hourIndex-1,!1),this.scrollTopHour()):e===40?this.minuteSelectorVisible&&this.minuteIndex<this.minutes.length-1?(this.setMinute(this.minuteIndex+1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex<this.hours.length-1&&(this.setHour(this.hourIndex+1,!1),this.scrollTopHour()):e===13&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),(this.minuteSelectorVisible||this.hourSelectorVisible)&&(t.preventDefault(),this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1)},scrollTopMinute(){const t=this.$refs.minuteScroller.scrollHeight,e=this.$refs.minuteScrollerWrapper.clientHeight,s=t*(this.minuteIndex/(this.minutes.length-1))-e/2;this.$refs.minuteScroller.scrollTop=s},scrollTopHour(){const t=this.$refs.hourScroller.scrollHeight,e=this.$refs.hourScrollerWrapper.clientHeight,s=t*(this.hourIndex/(this.hours.length-1))-e/2;this.$refs.hourScroller.scrollTop=s},changePeriod(){this.period=this.period==="AM"?"PM":"AM"},calendarClicked(t){t.target.id!=="j-hour"&&t.target.id!=="j-minute"&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},documentClicked(t){t.target.id!=="tj-datetime-input"&&(this.hideCal=!0)},toggleCal(){this.hideCal=!this.hideCal},clearDate(){this.timeStamp="",this.$emit("input",""),this.hideCal=!0},setDate(t){let e=this.hour;this.hour===12&&this.period==="AM"&&(e=e-12),this.hour!==12&&this.period==="PM"&&(e=e+12);const s=new Date(this.year||1970,this.monthIndex||0,this.day||1,e,this.minute,0);t&&(this.timeStamp=s,this.$emit("input",s.getTime()),this.hideCal=!0)}}};var ua=function(){var e=this,s=e._self._c;return s("div",{staticClass:"datetime-picker",style:{width:e.width},on:{click:function(a){return e.calendarClicked(a)}}},[s("div",[s("input",{ref:"input",attrs:{id:"tj-datetime-input",readonly:"",type:"text",name:e.name,autocomplete:"off"},domProps:{value:e.display()},on:{click:e.toggleCal}}),s("div",{staticClass:"calender-div",class:{noDisplay:e.hideCal}},[s("div",{class:{noDisplay:e.hideDate}},[s("div",{staticClass:"year-month-wrapper"},[s("div",{staticClass:"month-setter"},[s("span",{staticClass:"nav-l",attrs:{type:"button"},on:{click:e.leftYear}},[e._v("<")]),s("span",{staticClass:"year"},[e._v(e._s(e.year))]),s("span",{staticClass:"nav-r",attrs:{type:"button"},on:{click:e.rightYear}},[e._v(">")])]),s("div",{staticClass:"month-setter"},[s("span",{staticClass:"nav-l",attrs:{type:"button"},on:{click:e.leftMonth}},[e._v("<")]),s("span",{staticClass:"month"},[e._v(e._s(e._f("translate")("TL_"+e.month.toUpperCase())))]),s("span",{staticClass:"nav-r",attrs:{type:"button"},on:{click:e.rightMonth,mousedown:function(a){a.stopPropagation(),a.preventDefault()}}},[e._v(">")])])]),s("div",{staticClass:"headers"},[e._l(e.days,function(a,r){return[s("span",{key:r,staticClass:"days"},[e._v(e._s(e._f("translate")("TL_"+a.toUpperCase())))])]})],2),s("div",[e._l(e.ports,function(a,r){return[s("span",{key:r,staticClass:"port",class:{activePort:r===e.activePort},on:{click:function(n){return e.setDay(r,a)}}},[e._v(e._s(a))])]})],2)]),s("div",{staticClass:"time-picker",class:{noDisplay:e.hideTime}},[s("div",{staticClass:"hour-selector"},[s("div",{attrs:{id:"j-hour"},on:{click:e.showHourSelector}},[e._v(e._s(e.padZero(e.hour)))]),s("div",{ref:"hourScrollerWrapper",staticClass:"scroll-hider",class:{showSelector:e.hourSelectorVisible}},[s("ul",{ref:"hourScroller"},[e._l(e.hours,function(a,r){return[s("li",{key:r,class:{active:r==e.hourIndex},on:{click:function(n){return e.setHour(r,!0)}}},[e._v(e._s(a))])]})],2)])]),e._m(0),s("div",{staticClass:"minute-selector"},[s("div",{attrs:{id:"j-minute"},on:{click:e.showMinuteSelector}},[e._v(e._s(e.padZero(e.minute)))]),s("div",{ref:"minuteScrollerWrapper",staticClass:"scroll-hider",class:{showSelector:e.minuteSelectorVisible}},[s("ul",{ref:"minuteScroller"},[e._l(e.minutes,function(a,r){return[s("li",{key:r,class:{active:r==e.minuteIndex},on:{click:function(n){return e.setMinute(r,!0)}}},[e._v(e._s(a))])]})],2)])]),e._m(1),s("div",{staticClass:"minute-selector"},[s("div",{on:{click:e.changePeriod}},[e._v(e._s(e._f("translate")("TL_"+e.period.toUpperCase())))])])]),s("span",{staticClass:"okButton",attrs:{type:"button"},on:{click:function(a){return e.setDate(!0)}}},[e._v(e._s(e._f("translate")("TL_OK")))]),s("span",{staticClass:"okButton",attrs:{type:"button"},on:{click:function(a){return e.clearDate()}}},[e._v(e._s(e._f("translate")("TL_CLEAR")))])])])])},ha=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"time-separator"},[e("span",[t._v(":")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"time-separator"},[e("span",[t._v(":")])])}],ma=m(da,ua,ha,!1,null,"97f35cb4",null,null);const pa=ma.exports,fa={components:{datetime:pa},mixins:[S],props:["options","customDatetimePickerOptions"],data(){return{}},created(){this.schema.format=this.schema.format||"DD/MM/YYYY h:i:s"},methods:{onChangeData(t){i.set(this.model,this.schema.model,t),this.$emit("model-updated",t,this.schema.model);const e=this.schema.label;this.schema.label=null,this.schema.label=e},get:i.get}};var ga=function(){var e=this,s=e._self._c;return s("div",[s("datetime",{ref:"input",attrs:{format:e.schema.format,value:e.get(e.model,e.schema.model)},on:{input:e.onChangeData}})],1)},_a=[],va=m(fa,ga,_a,!1,null,null,null,null);const ya=va.exports,ba={mixins:[S],data(){return{objectValue:this.value}},computed:{selectOptions(){return this.schema.selectOptions||{}},options(){let t=this.schema.values;return typeof t=="function"?t.apply(this,[this.model,this.schema]):t},formattedOptions(){const t=this.selectOptions.label||this.options;if(i.isString(i.first(t)))return t;const e=this.customLabel;return i.isFunction(this.customLabel)?i.map(t,s=>{const a=e(s);return i.isString(a)&&(s.text=a),i.isUndefined(i.get(s,"value",void 0))&&(s.value=i.get(s,"_id",void 0)),s}):t},hasCustomLabel(){const t=i.get(this.schema,"selectOptions");return typeof t<"u"&&typeof t.customLabel<"u"&&typeof t.customLabel=="function"},customLabel(){return i.isString(i.first(this.options))?this.options:this.hasCustomLabel?this.schema.selectOptions.customLabel:"text"}},methods:{getLabel(){return this.disabled?"":i.isString(this.selectOptions.label)?this.selectOptions.label:this.schema.label},updateSelected(t){this.objectValue=t;const e=i.get(this.schema,"selectOptions.key");e?this.value=i.get(this.objectValue,e):this.value=this.objectValue,this.$emit("input",t,this.schema.model)},addTag(t,e){const s=this.selectOptions.onNewTag;typeof s=="function"&&s(t,e,this.options,this.objectValue)},onSearchChange(t,e){const s=this.selectOptions.onSearch;typeof s=="function"&&s(t,e,this.options)}}};var Ca=function(){var e=this,s=e._self._c;return s("div",{staticClass:"multiselect-wrapper"},[s(dt,{ref:"input",attrs:{id:e.selectOptions.id,label:e.getLabel(),chips:e.selectOptions.multiple,value:e.objectValue,items:e.formattedOptions,"deletable-chips":e.selectOptions.multiple,"hide-selected":e.selectOptions.hideSelected,disabled:e.disabled,placeholder:e.schema.placeholder,multiple:e.selectOptions.multiple,clearable:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":""},on:{change:e.updateSelected,"search-change":e.onSearchChange,tag:e.addTag}})],1)},wa=[],$a=m(ba,Ca,wa,!1,null,null,null,null);const Sa=$a.exports;function La(t=""){return t.toString().trim().replace(/ /g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").replace(/([^a-zA-Z0-9-_/./:]+)/g,"")}const Ta={mixins:[S],data(){return{comboExpanded:!1}},computed:{items(){const t=this.schema.values;return typeof t=="function"?t.apply(this,[this.model,this.schema]):t},selectedCount(){return u.get(this,"value.length",0)},selectAllLabel(){return h.get(this.allSelected?"TL_DESELECT_ALL":"TL_SELECT_ALL")},allSelected(){return u.get(this.value,"length",0)===u.get(this.items,"length",0)}},methods:{onChangeSelectAll(t){this.value=t?u.map(this.items,e=>this.getItem(e,"value")):[],this.$forceUpdate()},getInputName(t){let e=this.getItem(t,"value");return this.schema&&this.schema.inputName&&this.schema.inputName.length>0&&(e=`${this.schema.inputName}_${e}`),La(e)},getItem(t,e){if(!u.isObject(t))return t;if(typeof this.schema.customChecklistOptions<"u"&&typeof this.schema.customChecklistOptions.value<"u")return t[u.get(this.schema.customChecklistOptions,e,!1)];const s=u.get(t,e,"undefined");if(typeof s<"u")return s;this.newError(e)},isItemChecked(t){return this.value&&this.value.indexOf(this.getItem(t,"value"))!==-1},onChanged(t,e){(u.isNil(this.value)||!Array.isArray(this.value))&&(this.value=[]);const s=u.clone(this.value);t?s.push(this.getItem(e,"value")):s.splice(this.value.indexOf(this.getItem(e,"value")),1),this.value=s},onExpandCombo(){this.comboExpanded=!this.comboExpanded}}};var Ra=function(){var e=this,s=e._self._c;return s("div",{staticClass:"wrapper custom-checklist"},[s("div",{staticClass:"field-label"},[e._v(e._s(e.schema.label))]),s("div",{staticClass:"border-wrapper"},[e.schema.listBox?s("div",{staticClass:"listbox form-control",attrs:{disabled:e.disabled}},[s("div",{staticClass:"select-all"},[s("label",[s(X,{attrs:{id:e.getFieldID(e.schema),ripple:!1,dense:"","hide-details":"","input-value":e.allSelected,label:e.selectAllLabel},on:{change:e.onChangeSelectAll}})],1)]),e._l(e.items,function(a,r){return s("div",{key:r,staticClass:"list-row",class:{"is-checked":e.isItemChecked(a)}},[s("label",[s(X,{attrs:{id:e.getFieldID(e.schema),ripple:!1,dense:"","hide-details":"","input-value":e.isItemChecked(a),disabled:e.disabled,label:e.getInputName(a),name:e.getInputName(a)},on:{change:function(n){return e.onChanged(n,a)}}})],1)])})],2):s("div",{staticClass:"combobox form-control",attrs:{disabled:e.disabled}},[s("div",{ref:"input",staticClass:"mainRow",class:{expanded:e.comboExpanded},on:{click:e.onExpandCombo}},[s("div",{staticClass:"node-cms-info"},[e._v(e._s(e.selectedCount)+" "+e._s(e._f("translate")("TL_SELECTED")))]),s("div",{staticClass:"arrow"})]),e.comboExpanded?s("div",{staticClass:"dropList"},e._l(e.items,function(a,r){return s("div",{key:r,staticClass:"list-row",class:{"is-checked":e.isItemChecked(a)}},[s("label",[s(X,{attrs:{id:e.getFieldID(e.schema)+r,ripple:!1,dense:"","hide-details":"",label:e.getInputName(a),"input-value":e.isItemChecked(a),disabled:e.disabled,name:e.getInputName(a)},on:{change:function(n){return e.onChanged(n,a)}}})],1)])}),0):e._e()])])])},Ea=[],Ia=m(Ta,Ra,Ea,!1,null,null,null,null);const xa=Ia.exports,ka={mixins:[S],data(){return{}},methods:{onChangeData(t){this.value=t},get(t){return i.get(this.schema,t,!1)},getAutocomplete(){return i.get(this.schema,"inputFieldType","text")==="password"?"current-password":"null"},getType(){return i.get(this.schema,"inputFieldType","text")},validateField(t){return this.schema.required&&(i.isNull(t)||i.isUndefined(t)||t==="")?!1:this.schema.validator&&i.isFunction(this.schema.validator)?!!this.schema.validator(t,this.schema.model,this.model):!0}}};var Da=function(){var e=this,s=e._self._c;return s(K,{ref:"input",class:[e.schema.labelClasses],attrs:{type:e.getType(),label:e.schema.label,value:e.value,"input-value":e.value,"max-length":e.schema.max,autocomplete:e.getAutocomplete(),"min-length":e.schema.min,rules:[e.validateField],dense:e.get("dense"),compact:e.get("compact"),disabled:e.get("disabled"),readonly:e.get("readonly"),filled:e.get("filled"),outlined:e.get("outlined"),solo:e.get("solo"),"persistent-placeholder":"","hide-details":""},on:{input:e.onChangeData},scopedSlots:e._u([e.schema.required?{key:"label",fn:function(){return[s("span",{staticClass:"red--text"},[s("strong",[e._v("* ")])]),e._v(e._s(e.schema.label)+" ")]},proxy:!0}:null],null,!0)})},Oa=[],Ma=m(ka,Da,Oa,!1,null,null,null,null);const Fa=Ma.exports;const Aa={mixins:[S],data(){return{}},methods:{onChangeData(t){this.value=t},getType(){return i.get(this.schema,"inputFieldType","text")}}};var Na=function(){var e=this,s=e._self._c;return s("div",{staticClass:"custom-textarea"},[s(ut,{ref:"input",class:[e.schema.labelClasses],attrs:{type:e.getType(),value:e.value,label:e.schema.label,"max-length":e.schema.max,"min-length":e.schema.min,dense:!!e.schema.dense,compact:!!e.schema.compact,disabled:!!e.schema.disabled,readonly:!!e.schema.readonly,filled:!!e.schema.filled,"hide-details":"",outlined:!!e.schema.outlined,solo:!!e.schema.solo},on:{input:e.onChangeData}})],1)},Va=[],Ua=m(Aa,Na,Va,!1,null,null,null,null);const Pa=Ua.exports;const Ba={mixins:[S],data(){return{}},computed:{},created(){},methods:{getValue(){const t=i.get(this.model,this.schema.model,!1);return i.isNull(t)?!1:t},onChange(t){this.$emit("input",t,this.schema.model)}}};var qa=function(){var e=this,s=e._self._c;return s("div",{staticClass:"custom-switch"},[s("div",{staticClass:"field-label"},[e._v(e._s(e.schema.label))]),s("div",{staticClass:"border-wrapper"},[s(fe,{ref:"input",staticClass:"switch",attrs:{"input-value":e.getValue(),compact:!!e.schema.compact,disabled:!!e.schema.disabled,readonly:!!e.schema.readonly,filled:!!e.schema.filled,dense:"","hide-details":"",solo:"",outlined:!!e.schema.outlined},on:{change:e.onChange}})],1)])},ja=[],Ha=m(Ba,qa,ja,!1,null,null,null,null);const za=Ha.exports,Ka={mixins:[S],props:["locale"],data(){return{tags:[],options:{allowDuplicates:this.getOpt("allowDuplicates",!0),readOnly:this.getOpt("disabled",!1),placeholder:this.getOpt("placeholder",""),dense:this.getOpt("dense",!1),multiple:this.getOpt("multiple",!1),outlined:this.getOpt("outlined",!1),deletableChips:this.getOpt("deletableChips",!1),smallChips:this.getOpt("smallChips",!1),limit:this.getOpt("limit",-1)}}},watch:{tags(){i.set(this.model,this.schema.model,this.tags)},"schema.model":function(){this.tags=i.get(this.model,this.schema.model)}},created(){this.options=i.extend(this.options,this.schema.selectOptions)},mounted(){this.tags=i.get(this.model,this.schema.model)},methods:{onChangeData(t){i.get(this.options,"limit",-1)!==-1?this.value=i.take(t,this.options.limit):this.value=t}}};var Ga=function(){var e=this,s=e._self._c;return s(ht,{ref:"input",attrs:{clearable:"","hide-details":"",outlined:"","deletable-chips":"","small-chips":"",dense:"","hide-selected":!e.options.allowDuplicates,readonly:e.options.readOnly,placeholder:e.options.tagPlaceholder,multiple:e.options.multiple},on:{change:e.onChangeData},model:{value:e.tags,callback:function(a){e.tags=a},expression:"tags"}})},Ya=[],Wa=m(Ka,Ga,Ya,!1,null,null,null,null);const Qa=Wa.exports;const Xa={mixins:[S],props:["groupOptions"],data(){return{errors:null}},methods:{onError(t){console.log(999,"error",t)},validate(){const t=this.$refs.input.validate();if(!t)throw this.errors=this.$refs.input.errors,new Error("group validation error");return t},debouncedValidate(){return this.$refs.input.debouncedValidate()},clearValidationErrors(){return this.$refs.input.clearValidationErrors()},onModelUpdated(t,e){this.$emit("model-updated",t,e)}}};var Za=function(){var e=this,s=e._self._c;return s("div",[s("div",{staticClass:"field-label"},[e._v(e._s(e.schema.label))]),s("div",{staticClass:"group"},[s("custom-form",{ref:"input",attrs:{schema:e.schema.groupOptions,model:e.model},on:{"update:model":function(a){e.model=a},error:e.onError,input:e.onModelUpdated}})],1)])},Ja=[],er=m(Xa,Za,Ja,!1,null,"d182998f",null,null);const tr=er.exports;const sr={props:["row","column","rowIndex","field"],methods:{getSrc(){const t=i.get(this.findAttachmentForField(this.row,this.field),"url",!1);return t?t+"?resize=autox50":!1},findAttachmentForField(t,e){return i.find(i.get(t,"_attachments",[]),s=>e.localised?i.get(s,"_fields.locale",!1)===e.locale&&s._name===e.originalModel:s._name===e.originalModel)}}};var ir=function(){var e=this,s=e._self._c;return e.getSrc()?s("img",{staticClass:"vue-table-generator-field image",attrs:{src:e.getSrc()}}):s("span",[e._v(e._s(e._f("translate")("TL_NO_IMAGE")))])},ar=[],rr=m(sr,ir,ar,!1,null,"e3374301",null,null);const nr=rr.exports,lr={props:["row","column","rowIndex","field"],methods:{getValue(){return i.get(this.row,this.column.field,!1)}}};var or=function(){var e=this,s=e._self._c;return s(mt,{staticClass:"vue-table-generator-field custom-switch",attrs:{ripple:!1,value:e.getValue()}})},cr=[],dr=m(lr,or,cr,!1,null,"37c72f05",null,null);const ur=dr.exports;const hr={props:["row","column","rowIndex","edit","remove"]};var mr=function(){var e=this,s=e._self._c;return s("div",{staticClass:"vue-table-generator-field table-column-actions"},[s(v,{attrs:{small:""},on:{click:function(a){return e.edit(e.row)}}},[e._v(e._s(e._f("translate")("TL_EDIT")))]),s(v,{staticClass:"delete-btn",attrs:{small:"",color:"node-cms-red"},on:{click:function(a){return e.remove(e.row)}}},[e._v(e._s(e._f("translate")("TL_DELETE")))])],1)},pr=[],fr=m(hr,mr,pr,!1,null,"b4a6d030",null,null);const gr=fr.exports,_r={install(t,e={}){this.installed||(this.installed=!0,this.params=e,t.prototype.$loading=re)}};function vr(t,e,s){return h.get(t,e,s)}function yr(t,e){return i.isString(e)?(i.includes(e,"n")&&console.warn("Truncate - should truncate the text by number of items"),i.truncate(t,{length:i.toNumber(e)})):i.truncate(t,{length:e})}window.Vue=p;p.component("CustomForm",Qs);p.component("AttachmentView",aa);p.component("ImageView",Ji);p.component("CustomInput",Fa);p.component("CustomTextarea",Pa);p.component("CustomSwitch",za);p.component("ParagraphAttachmentView",ca);p.component("ParagraphView",Yi);p.component("CustomTreeView",wi);p.component("CustomCode",Ri);p.component("ColorPicker",Di);p.component("JsonEditor",Ni);p.component("WysiwygField",qi);p.component("CustomDatetimePicker",ya);p.component("CustomChecklist",xa);p.component("Group",tr);p.component("CustomInputTag",Qa);p.component("CustomMultiSelect",Sa);p.component("PluginPage",ti);p.component("MultiselectPage",zs);p.component("Syslog",ni);p.component("CmsImport",ui);p.component("SyncResource",gi);p.component("Draggable",pt);p.component("TableImageView",nr);p.component("TableCustomSwitch",ur);p.component("TableRowActions",gr);p.mixin({filters:{translate:vr,truncate:yr}});p.use(_r);p.use(ft);p.use(gt);p.use(_t);p.use(we);p.use(vt);p.use(yt,{name:"timeago",locale:"enUS",locales:{enUS:bt,zhCN:Ct}});function ee(t,e,s="System",a=["admins","imagination"]){window.plugins=window.plugins||[],window.plugins.push({title:t,displayname:e,component:t,group:s,allowed:a,type:"plugin"})}window.addEventListener("load",async function(){window.TranslateService=h;const e=(await C.get(`${window.location.pathname}config`)).data;ee("Syslog","Syslog"),e.import&&ee("CmsImport","Cms Import"),e.sync&&!e.sync.disablePlugin&&ee("SyncResource","Sync Resource"),window.disableJwtLogin=i.get(e,"disableJwtLogin",!1),window.noLogin=window.disableJwtLogin&&i.get(e,"disableAuthentication",!1);const s=new we({});new p({el:"#app",vuetify:$e,router:s,render:function(a){return a(this.$el.getAttribute("type")==="login"?Ps:Fs)},mounted(){let a=document.createElement("script");a.setAttribute("src","./plugins/scripts/bundle.js"),document.head.appendChild(a)}})});
