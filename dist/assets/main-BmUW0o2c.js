import{_ as s,l as w}from"./lodash-BRLuuscK.js";import{V as rt}from"./vue-x0OgqZxs.js";import{E as Fe,c as N,d as U,e as K,h as ze,i as Ue,m as Te,s as je,q as ot,l as Ge,j as ge,v as se,o as at,t as nt,u as ct,V as dt,J as ut,w as ht,x as mt}from"./vendor-Cl56otIo.js";import{c as pt,u as gt,V as L,a as R,b as Ke,d as ie,e as we,f as Ye,g as ye,h as ve,i as de,j as _e,k as B,l as ft,m as Ne,n as yt,o as Q,p as X,q as vt,r as _t,s as bt,t as St,v as We,w as wt,x as le,y as kt,z as Xe,A as re,B as Lt,C as Ct}from"./vuetify-DRPXJEfl.js";import{f as n,i as m,ae as u,I,J as D,p as S,bc as f,G as v,L as p,H as h,al as y,C,j as b,k as V,z as ue,A as he,D as Ae,E as j,O as Re,P as E,M as It,N as Tt,aj as Rt,bv as Ee,g as Et,l as De,bu as Dt,q as Qe,ad as $t,h as Pe}from"./@vue-CW8kyeb2.js";import{F as Mt}from"./codemirror-editor-vue3-Bw8-68XU.js";import"./codemirror-BF7KXh6i.js";import{j as ke}from"./@json-editor-B2iin4oC.js";import{E as Ft,a as At,S as Vt,b as Ot,U as Ut,L as Nt}from"./@tiptap-D-NvZFyk.js";import"./prosemirror-state-CBx7f1ow.js";import"./prosemirror-model-BEHzNbie.js";import"./prosemirror-transform-DdM1Tj00.js";import"./prosemirror-dropcursor-B37wnm9f.js";import"./prosemirror-gapcursor-GAXGvD89.js";import"./prosemirror-keymap-BxyFIBnq.js";import"./prosemirror-view-EoNRIGXh.js";import"./prosemirror-history-ClfPcsMt.js";import"./prosemirror-commands-Cjp24vfw.js";import"./prosemirror-schema-list-BJuZ9OaB.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function l(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=l(i);fetch(i.href,r)}})();const Pt=pt({theme:{defaultTheme:"light",themes:{light:{dark:!1,primary:"#00095B","node-cms-black":"#00142E","node-cms-blue":"#00095B","node-cms-grabber":"#1700F4","node-cms-twilight":"#00142E","node-cms-grey":"#AFAFAF","node-cms-light-grey":"#DBDBDB","node-cms-light-white-grey":"#EDEDED","node-cms-off-white":"#F6F6F6","node-cms-red":"#C90000"},dark:{dark:!0,primary:"#FFFFFF","node-cms-black":"#00142E","node-cms-blue":"00142E","node-cms-grabber":"00142E","node-cms-twilight":"00142E","node-cms-grey":"00142E","node-cms-light-grey":"00142E","node-cms-light-white-grey":"00142E","node-cms-off-white":"00142E","node-cms-red":"00142E"}}},icons:{iconfont:"mdi"}}),T=(e,t)=>{const l=e.__vccOpts||e;for(const[o,i]of t)l[o]=i;return l},Bt={data(){return{}},async mounted(){},methods:{}},xt={ref:"test",class:"activations"};function Ht(e,t,l,o,i,r){return n(),m("div",xt," node-cms - Plugin example ",512)}const qt=T(Bt,[["render",Ht]]);window.plugins=[{title:"TestComponent",displayname:"TestComponent",name:"TestComponent",component:qt,group:"- Dashboard -"}];class zt{constructor(){this.isShow=!1,this.list=[]}start(t){this.isShow=!0,this.list=s.union(this.list,[t])}stop(t){this.list=s.difference(this.list,[t]),s.isEmpty(this.list)&&(this.isShow=!1)}}const Ve=new zt;class jt{constructor(){this.events=new Fe}send(t,l="success"){this.events.emit("notification",{message:t,type:l})}sendOmnibarDisplayStatus(t){this.events.emit("omnibar-display-status",t)}}const ee=new jt;class Gt{constructor(){this.events=new Fe,this.user=null,this.logoutCallbackList=[]}init(){console.info("LoginService - init"),setInterval(async()=>{this.checkStatus()},1e3*15)}async getStatus(){try{const{data:t}=await N.get(`${window.location.pathname}login`);return this.user=t,t}catch{return null}}async checkStatus(){let t;const l=s.cloneDeep(this.user);try{t=await this.getStatus()}catch{}s.isEmpty(t)&&!s.isEmpty(l)&&(console.info("will logout"),await this.logout())}async changeTheme(){try{const t=s.get(this.user,"theme","dark")==="dark"?"light":"dark";return this.events.emit("changed-theme",t),await N.get(`${window.location.pathname}changeTheme/${t}`),console.warn("Successfully changed the theme for user"),s.set(this.user,"theme",t),t}catch(t){console.error("Failed to change theme: ",t)}}async logout(){this.user=null;try{await N.get(`${window.location.pathname}logout`),window.location.reload()}catch(t){console.error("Failed to logout: ",t)}s.each(this.logoutCallbackList,t=>{t()})}onLogout(t){this.logoutCallbackList.push(t)}checkPermission(t){return s.includes(this.user.group.modules,t)}}const Y=new Gt;class Kt{constructor(){this.config={}}async init(){try{const{data:t}=await U.get(`${window.location.pathname}config`);this.config=t}catch(t){console.error("Error during init of ConfigService:",t)}}}const te=new Kt;let Yt=class{constructor(){this.dict={},this.locale="enUS"}async init(){const{data:t}=await U.get(`${window.location.pathname}i18n/config.json`);this.config=s.get(t,"config.language",{defaultLocale:"enUS",locales:["enUS"]}),this.locale=s.get(this.config,"defaultLocale","enUS");for(const l of this.config.locales)try{const{data:o}=await U.get(`${window.location.pathname}i18n/${l}.json`);this.dict[l]=o}catch(o){console.warn(`TranslateService wasn't able to pull ${l}: `,o)}}setLocale(t){this.locale=t}get(t,l,o){if(s.isString(t)){const i=this.dict[l||this.locale]&&this.dict[l||this.locale][t];return i?s.template(i)(o):t}return s.isEmpty(t)?"":t[l||this.locale]||""}};const k=new Yt;class Wt{constructor(){this.cacheMap={}}async cache(t){const{data:l}=await U.get(`${window.location.pathname}../api/${t}`);return s.get(l,"userLoggedOut",!1)?(console.info("Received userLoggedOut from server, will redirect to login page"),window.location.reload(),[]):(this.cacheMap[t]=l,this.get(t))}get(t){const l=this.cacheMap[t];return s.isUndefined(l)&&console.info(`resource (${t}) is not cached`),l}setSchemas(t){this.schemas=t}getSchema(t){return s.find(this.schemas,{title:t})}}const x=new Wt,Z={data(){return{}},mounted(){},methods:{notify(e,t="success"){s.get(console,t,console.info)(e),ee.send(e,t)},sendOmnibarDisplayStatus(e){ee.sendOmnibarDisplayStatus(e)}}},Xt={},Qt={class:"showbox active"},Zt=u("div",{class:"loader"},[u("svg",{class:"circular",viewBox:"25 25 50 50"},[u("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"})])],-1),Jt=[Zt];function es(e,t){return n(),m("div",Qt,Jt)}const Ze=T(Xt,[["render",es]]),ts={props:{localeList:{type:Array,default:()=>[]}},data(){return{TranslateService:k}},methods:{select(e){k.setLocale(e)}}},ss={key:0,class:"locale-list"},is=["onClick"];function ls(e,t,l,o,i,r){return l.localeList&&l.localeList.length>1?(n(),m("div",ss,[(n(!0),m(I,null,D(l.localeList,(a,d)=>(n(),m("div",{key:d,class:S(["locale",{active:i.TranslateService.locale==a}]),onClick:c=>r.select(a)},f(e.$filters.translate("TL_"+a.toUpperCase())),11,is))),128))])):v("",!0)}const rs=T(ts,[["render",ls]]),os={__name:"ThemeSwitch",setup(e){const t=gt();function l(){return t.global.name.value==="dark"}async function o(){t.global.name.value=await Y.changeTheme()}return(i,r)=>(n(),m("div",{class:"theme-switch",onClick:r[0]||(r[0]=a=>o())},[p(L,{class:S({selected:!l()})},{default:h(()=>[y("mdi-weather-sunny")]),_:1},8,["class"]),p(L,{class:S({selected:l()})},{default:h(()=>[y("mdi-weather-night")]),_:1},8,["class"])]))}},as=T(os,[["__scopeId","data-v-a7d0e43b"]]);K.extend(ze);const ns={components:{ThemeSwitch:as},props:{config:{type:[Object,Boolean],default:!1},settingsData:{type:[Object,Boolean],default:!1}},data(){return{TranslateService:k,destroyed:!1,type:null,timer:null,system:{cpu:{count:0,usage:0,model:"Unknown"},memory:{totalMemMb:0,usedMemMb:0,freeMemMb:0,freeMemPercentage:0},network:"not supported",drive:"not supported",uptime:0},eventSource:!1}},computed:{showLogoutButton(){return!s.get(window,"disableJwtLogin",!1)}},async mounted(){this.connectToLogStream(),this.$vuetify.theme.global.name=Y.user.theme},unmounted(){this.destroyed=!0,clearTimeout(this.timer)},methods:{disconnectFromLogStream(){this.eventSource.close()},connectToLogStream(){this.eventSource=new EventSource(`${window.location.pathname}../api/system`),this.eventSource.onmessage=e=>{try{this.system=JSON.parse(e.data),this.$forceUpdate()}catch(t){console.error("Failed to parse system info:",t)}},this.eventSource.addEventListener("end",()=>{this.eventSource.close(),console.warn("System info stream ended")}),this.eventSource.onerror=e=>{console.error("Error in SSE connection:",e),this.eventSource.close()}},isActiveLink(e){const t=new URL(window.location),l=new URL(e);return t.host===l.host},async logout(){await Y.logout()},select(e){this.$emit("selectItem",e)},timeAgo(e){return K().subtract(parseInt(e,10),"second").fromNow()},convertBytes(e){const t=["MB","GB","TB"];if(e===0)return"0 MB";if(Math.log(e)<=0)return`${e.toFixed(1)} MB`;const l=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return l<=0?e+" "+t[l]:(e/Math.pow(1024,l)).toFixed(1)+" "+t[l]}}},me=e=>(ue("data-v-e75073e5"),e=e(),he(),e),cs={class:"system-info"},ds={class:"links-wrapper"},us={class:"node-cms-title"},hs=["href"],ms={class:"system-info-wrapper"},ps={class:"node-cms-title flex"},gs={class:"stats cpu"},fs=me(()=>u("div",{class:"node-cms-title"},[u("small",null,[u("b",null,"CPU Usage")])],-1)),ys={class:"text"},vs={class:"stats ram"},_s=me(()=>u("div",{class:"node-cms-title"},[u("small",null,[u("b",null,"Memory Usage")])],-1)),bs={class:"text"},Ss={key:0,class:"stats drive"},ws=me(()=>u("div",{class:"node-cms-title"},[u("small",null,[u("b",null,"Disk Usage")])],-1)),ks={class:"text"},Ls={class:"stats two-by-two"},Cs={key:0,class:"stats network"},Is=me(()=>u("div",{class:"node-cms-title"},[u("small",null,[u("b",null,"Network Usage")])],-1)),Ts={class:"text"},Rs={class:"stats uptime"},Es={class:"node-cms-title"},Ds=me(()=>u("small",null,[u("b",null,"Uptime:")],-1)),$s={class:"text"};function Ms(e,t,l,o,i,r){const a=C("theme-switch");return n(),m("div",cs,[l.settingsData&&l.settingsData.linksGroups&&l.settingsData.linksGroups.length>0?(n(),b(ie,{key:0,"content-class":"links-menu",location:"bottom","close-on-content-click":!1,transition:"slide-y-transition",attach:".v-application"},{activator:h(({props:d})=>[p(R,V({icon:""},d),{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:h(()=>[u("div",ds,[(n(!0),m(I,null,D(l.settingsData.linksGroups,(d,c)=>(n(),m("div",{key:c,class:"group"},[u("div",us,f(d.value.title),1),(n(!0),m(I,null,D(d.value.links,(g,_)=>(n(),m("a",{key:_,class:S(["link",{active:r.isActiveLink(g.value.url)}]),href:g.value.url},f(g.value.name),11,hs))),128)),c<l.settingsData.linksGroups.length-1?(n(),b(Ke,{key:0})):v("",!0)]))),128))])]),_:1})):v("",!0),p(ie,{"content-class":"system-info-menu",theme:e.$vuetify.theme.dark?"dark":"light",location:"bottom","close-on-content-click":!1,transition:"slide-y-transition",attach:".v-application"},{activator:h(({props:d})=>[p(R,V({icon:""},d),{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-cog-outline")]),_:1})]),_:2},1040)]),default:h(()=>[u("div",ms,[u("div",ps,[u("span",null,f(e.$filters.translate("TL_SYSTEM")),1),p(a)]),u("div",gs,[fs,p(we,{rounded:"","model-value":i.system.cpu.usage},null,8,["model-value"]),u("small",ys,f(i.system.cpu.count)+" cores ("+f(i.system.cpu.model)+")",1)]),u("div",vs,[_s,p(we,{rounded:"","model-value":100-i.system.memory.freeMemPercentage},null,8,["model-value"]),u("small",bs,f(r.convertBytes(i.system.memory.usedMemMb))+" / "+f(r.convertBytes(i.system.memory.totalMemMb)),1)]),i.system.drive!="not supported"?(n(),m("div",Ss,[ws,p(we,{rounded:"","model-value":100-i.system.drive.usedPercentage},null,8,["model-value"]),u("small",ks,f(r.convertBytes(i.system.drive.usedGb*1024))+" / "+f(r.convertBytes(i.system.drive.totalGb*1024)),1)])):v("",!0),u("div",Ls,[i.system.network!="not supported"?(n(),m("div",Cs,[Is,u("small",Ts,[y(f(r.convertBytes(i.system.network.total.outputMb))+" ",1),p(L,null,{default:h(()=>[y("mdi-arrow-up")]),_:1}),y(" / "+f(r.convertBytes(i.system.network.total.inputMb))+" ",1),p(L,null,{default:h(()=>[y("mdi-arrow-down")]),_:1})])])):v("",!0),u("div",Rs,[u("div",Es,[Ds,y(),u("small",$s,f(r.timeAgo(i.system.uptime)),1)])])])])]),_:1},8,["theme"]),r.showLogoutButton?(n(),b(R,{key:1,icon:"",onClick:t[0]||(t[0]=d=>r.logout())},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-logout")]),_:1})]),_:1})):v("",!0)])}const Fs=T(ns,[["render",Ms],["__scopeId","data-v-e75073e5"]]);class As{constructor(){this.events=new Fe}select(t){this.events.emit("select",t)}}const oe=new As,Vs={mixins:[Z],props:{selectResourceCallback:{type:Function,default:()=>{}},groupedList:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},data(){return{showOmnibar:!1,search:null,scrolledToBottom:!1,resourcesList:[],results:[],highlightedItem:0,searchModes:["all","resource","field"],searchMode:"all",shortcutsWhenClosed:{open:["ctrl","p"]},shortcuts:{esc:["esc"],open:["ctrl","p"],"arrow-up":["arrowup"],"arrow-down":["arrowdown"],enter:["enter"],all:["shift","a"],resource:["shift","r"],field:["shift","f"]},searchOptions:{keys:["displayname"],scoreFn:e=>e[0]?e[0].score+(this.isResultInCurrentResource(e)?1e7:0):-1e7}}},watch:{search(){this.highlightedItem=0,this.results=[];const e=Ue.go(this.search,this.getDataForSearch(),this.searchOptions);this.results=s.compact(s.map(e,(t,l)=>s.isNull(s.get(t,"[0]",null))?!1:(t.obj.html=Ue.highlight(t[0]),t.obj.score=t.score,t.obj)))}},mounted(){this.resourcesList=s.map(s.flatten(s.map(this.groupedList,"list")),e=>(e.type="resource",e.displayname=s.get(e,"displayname.enUS",s.get(e,"displayname",e.title)),e)),this.fieldsList=s.flatten(s.map(this.resourcesList,e=>s.map(e.schema,t=>(t.resource=e,t.displayname=`${e.displayname}.${s.get(t,"label.enUS",s.get(t,"label",t.field))}`,t.type="field",t))))},methods:{getShortcuts(){return this.showOmnibar?this.shortcuts:this.shortcutsWhenClosed},onScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:l}}){this.scrolledToBottom=e+t>=l-50},isResultInCurrentResource(e){return s.startsWith(s.get(e[0],"target",""),s.get(this.selectedItem,"displayname",""))},getDataForSearch(){return this.searchMode==="all"?s.concat(this.resourcesList,this.fieldsList):this.searchMode==="resource"?this.resourcesList:this.fieldsList},getIconForResult(e){return this.getIcon(this.searchMode==="all"?e.type:this.searchMode)},getIcon(e){return`mdi-${e==="resource"?"package":"cursor-text"}`},isCharHighlighted(e,t){return s.includes(s.values(e._indexes),t)},showHideOmnibar(e){this.showOmnibar=e,this.setSearchMode("all"),e&&this.$nextTick(()=>{s.get(this.$refs,"['search']",!1).focus()}),this.sendOmnibarDisplayStatus(e)},selectResult(e=-1){const t=s.get(this.results,`[${e===-1?this.highlightedItem:e}]`,!1);if(!t)return;const l=s.includes(["resource","plugin"],t.type)?t:t.resource;l!==this.selectedItem?(console.info(`Switching to resource ${l.title}`),this.selectResourceCallback(l)):t.type==="field"&&oe.events.emit("select",s.omit(t,"resource")),this.showHideOmnibar(!1)},setSearchMode(e){this.searchMode=e,this.search=""},scrollToResult(e){const t=document.getElementById(`result-${this.highlightedItem}`);t&&t.scrollIntoView()},async interactiveSearch(e){const t=s.get(e,"srcKey",!1);if(t){if(!this.showOmnibar){t==="open"&&this.showHideOmnibar(!0);return}t==="esc"||t==="open"?this.showHideOmnibar(!1):t==="arrow-up"?(this.highlightedItem-1>=0?this.highlightedItem-=1:this.highlightedItem=0,this.scrollToResult()):t==="arrow-down"?(this.highlightedItem+1<=this.results.length-1?this.highlightedItem+=1:this.highlightedItem=this.results.length-1,this.scrollToResult()):t==="enter"?this.selectResult():s.includes(this.searchModes,t)&&this.setSearchMode(t)}}}},Os=["innerHTML"];function Us(e,t,l,o,i,r){const a=Ae("shortkey");return j((n(),m("div",{id:"omnibar",onShortkey:t[3]||(t[3]=(...d)=>r.interactiveSearch&&r.interactiveSearch(...d))},[u("div",{id:"omnibar-backdrop",class:S({displayed:i.showOmnibar}),onClick:t[0]||(t[0]=d=>r.showHideOmnibar(!1))},null,2),j(p(B,{elevation:"24"},{default:h(()=>[p(Ye,{class:"search"},{default:h(()=>[p(ye,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=d=>i.search=d),class:"search-bar",flat:"",variant:"solo-filled",rounded:"","hide-details":"","prepend-inner-icon":"mdi-magnify",density:"compact",placeholder:e.$filters.translate("TL_INSERT_KEYWORDS"),type:"text",autocomplete:"off",name:"search",prefix:i.searchMode==="all"?"":`${i.searchMode}:`},null,8,["modelValue","placeholder","prefix"])]),_:1}),i.results&&i.results.length>0?(n(),m(I,{key:0},[p(Ke),u("div",{ref:"scrollWrapper",class:S(["scroll-wrapper",{"scrolled-to-bottom":i.scrolledToBottom||i.results.length<20}]),onScroll:t[2]||(t[2]=(...d)=>r.onScroll&&r.onScroll(...d))},[p(ve,{density:"compact"},{default:h(()=>[(n(!0),m(I,null,D(i.results,(d,c)=>(n(),b(de,{id:"result-"+c,key:c,class:S(["list",{highlighted:i.highlightedItem===c}]),ripple:!1,onClick:g=>r.selectResult(c)},{default:h(()=>[p(_e,null,{default:h(()=>[p(L,{size:"small"},{default:h(()=>[y(f(r.getIconForResult(d)),1)]),_:2},1024),u("span",{innerHTML:d.html},null,8,Os)]),_:2},1024)]),_:2},1032,["id","class","onClick"]))),128))]),_:1})],34)],64)):v("",!0)]),_:1},512),[[Re,i.showOmnibar]])],32)),[[a,r.getShortcuts()]])}const Ns=T(Vs,[["render",Us]]),Ps={components:{Omnibar:Ns},props:{selectResourceCallback:{type:Function,default:()=>{}},groupedList:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},async mounted(){await this.$nextTick(),s.isEmpty(this.selectedItem)&&this.selectResourceCallback(s.first(s.get(s.first(this.groupedList),"list",[])))},methods:{getResourceTitle(e){return e.displayname?k.get(e.displayname):e.title},groupSelected(e){if(!this.selectedItem)return!1;const t=s.get(this.selectedItem,"group.enUS",s.get(this.selectedItem,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t}}},Bs={key:0,class:"resources-content"},xs={class:"resource-list"};function Hs(e,t,l,o,i,r){const a=C("omnibar");return l.groupedList?(n(),m("div",Bs,[p(a,{"select-resource-callback":l.selectResourceCallback,"grouped-list":l.groupedList,"selected-item":l.selectedItem},null,8,["select-resource-callback","grouped-list","selected-item"]),u("div",xs,[(n(!0),m(I,null,D(l.groupedList,(d,c)=>(n(),m("div",{key:`resource-group-${c}`,class:"resource"},[p(ie,{"open-on-hover":"",location:"bottom","close-on-content-click":!1,"content-class":"resources-menu",attach:".v-application",transition:"false"},{activator:h(({props:g})=>[u("div",V({class:"menu-btn-wrapper"},g),[p(R,{variant:"text",rounded:"",size:"small",class:S({selected:r.groupSelected(d)})},{default:h(()=>[y(f(e.$filters.translate(d.name)),1)]),_:2},1032,["class"])],16)]),default:h(()=>[p(ve,{rounded:""},{default:h(()=>[(n(!0),m(I,null,D(d.list,g=>(n(),b(de,{key:g.name,density:"compact",class:S({selected:l.selectedItem===g}),onClick:_=>l.selectResourceCallback(g)},{default:h(()=>[p(_e,null,{default:h(()=>[y(f(r.getResourceTitle(g)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024)]))),128))])])):v("",!0)}const qs=T(Ps,[["render",Hs],["__scopeId","data-v-31b9ae0a"]]),zs="data:image/svg+xml,%3csvg%20width='59'%20height='16'%20viewBox='0%200%2059%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_11_670)'%3e%3cpath%20d='M58.2236%200.785034H0.776367V15.2128H58.2236V0.785034Z'%20fill='black'/%3e%3cpath%20d='M13.7915%2010.6256L14.2265%209.23379L14.6532%2010.6235H13.7915V10.6256ZM43.8472%207.7804C43.8472%205.9642%2045.2897%204.49383%2047.0714%204.49383C48.8531%204.49383%2050.2955%205.9642%2050.2955%207.7804C50.2955%209.5966%2048.851%2011.0691%2047.0714%2011.0691C45.2918%2011.0691%2043.8472%209.5966%2043.8472%207.7804ZM34.4101%2010.6256L34.8409%209.23379L35.2801%2010.632L34.4101%2010.6278V10.6256ZM0%200H59V16H0V0ZM2.73291%202.75401V13.2417H5.06826V2.75401H2.73291ZM19.8276%206.10423V8.21748H23.5138C23.3036%209.82575%2021.9528%2011.067%2020.3147%2011.067C18.5351%2011.067%2017.0926%209.59448%2017.0926%207.77828C17.0926%205.96207%2018.5351%204.49171%2020.3147%204.49171C21.1119%204.49171%2021.8404%204.78663%2022.4086%205.27251L23.7886%203.44357C22.8394%202.65853%2021.6301%202.18751%2020.3147%202.18751C18.0709%202.18751%2016.1373%203.56451%2015.2776%205.54409L14.1828%202.07081L12.0389%208.97706L12.0306%202.08991L8.85437%206.26973C7.75746%204.90333%206.73132%203.37992%205.6802%202.08779V13.2396H7.97185V8.92826L8.85437%2010.074L9.80766%208.88158L9.81807%2013.2375H12.9798L13.2462%2012.3655H15.1985L15.4754%2013.2375H17.6921L17.4819%2012.567C18.3082%2013.0784%2019.2761%2013.369%2020.3126%2013.369C22.2567%2013.369%2023.9613%2012.3443%2024.9354%2010.7911V13.2439H27.2437V2.76886H24.9354V6.10423H19.8256H19.8276ZM54.1649%206.21032L51.305%201.9138V4.22225C50.2997%202.97891%2048.7719%202.18751%2047.0693%202.18751C45.3667%202.18751%2043.8993%202.94921%2042.894%204.15011H42.8378V2.75189H36.173V4.75056H37.1888L37.1971%209.72603C37.168%209.7133%2034.8055%202.06233%2034.8055%202.06233L32.9239%208.12837V2.75401H30.5844V6.09999L27.8973%202.09415V13.2439H30.1931L30.2014%2010.1249L32.2558%2013.2439H33.5942L33.9314%2012.1681H35.7609L36.1023%2013.2439H39.52V4.75056H40.5461V13.2396H42.869V11.3704C43.8743%2012.5925%2045.3833%2013.369%2047.0714%2013.369C48.7594%2013.369%2050.335%2012.5585%2051.3362%2011.2919V13.2354H53.6341V9.57963L56.367%2013.7022V2.75401H54.1753L54.169%206.21244L54.1649%206.21032Z'%20fill='white'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_11_670'%3e%3crect%20width='59'%20height='16'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",js={components:{SystemInfo:Fs,ResourceList:qs},props:{toolbarTitle:{type:[String,Boolean],default:!1},groupedList:{type:Array,default:()=>[]},config:{type:[Object,Boolean],default:!1},localeClass:{type:Object,default:()=>{}},selectResourceCallback:{type:Function,default:()=>{}},selectedItem:{type:Object,default:()=>{}}},data(){return{settingsData:!1}},mounted(){this.getSettingsData()},methods:{getDefaultLogo(){return zs},getLogo(){const e=s.find(s.get(this.settingsData,"_attachments",[]),{_name:"logo"});return s.isUndefined(e)?!1:s.get(e,"url","")},hasLogoOrTitle(){return this.getLogo()||s.get(this.settingsData,"title",!1)},async getSettingsData(){try{this.settingsData=s.first(await x.cache("_settings"))}catch(e){console.error(e)}},getSelectedItemName(){return s.get(this.selectedItem,"displayname",!1)?k.get(this.selectedItem.displayname):s.get(this.selectedItem,"name",!1)}}},Gs={class:"nav-bar-wrapper"},Ks=["src"],Ys=["src"];function Ws(e,t,l,o,i,r){const a=C("resource-list"),d=C("system-info");return n(),m("div",Gs,[p(yt,{class:S(["nav-bar",l.localeClass]),height:"58"},{default:h(()=>[p(ft,null,{default:h(()=>[i.settingsData&&r.hasLogoOrTitle()?(n(),m(I,{key:0},[r.getLogo()?(n(),m("img",{key:0,src:r.getLogo(),class:"logo"},null,8,Ks)):i.settingsData.title&&i.settingsData.title.length>0?(n(),m(I,{key:1},[y(f(i.settingsData.title),1)],64)):v("",!0)],64)):(n(),m("img",{key:1,src:r.getDefaultLogo(),class:"logo"},null,8,Ys))]),_:1}),p(Ne),p(a,{"select-resource-callback":l.selectResourceCallback,"grouped-list":l.groupedList,"selected-item":l.selectedItem},null,8,["select-resource-callback","grouped-list","selected-item"]),p(Ne),l.config?(n(),b(d,{key:0,config:l.config,"settings-data":i.settingsData},null,8,["config","settings-data"])):v("",!0)]),_:1},8,["class"])])}const Xs=T(js,[["render",Ws]]),Qs={methods:{getName(e){const t=this.getValue(e,s.first(this.resource.schema),this.resource.displayItem);return s.isString(t)?t:s.get(e,"_id",!1)},getValue(e,t,l){let o="";if(t){if(t.input==="file"){const i=s(e).get("_attachments",[]).find(r=>r._name===t.field);o=i&&i._filename}else if(t.input==="select"){let i=s.get(e,t.field);s.isString(i)&&(i=s.find(x.get(t.source),{_id:i}),i&&s.each(t.options&&t.options.extraSources,(r,a)=>{const d=s.get(i,a);s.isString(d)&&s.set(i,a,s.find(x.get(r),{_id:d}))})),t.options&&t.options.customLabel?o=Te.render(t.options.customLabel,i||{}):o=s.get(i,s.chain(i).keys().first().value(),"")}o===""&&(this.resource.locales&&(t.localised||s.isUndefined(t.localised))?o=s.get(e,`${this.locale}.${t.field}`):o=s.get(e,t.field))}if(l){const i=s.clone(e);s.each(this.getExtraRessources(),(r,a)=>{const d=x.get(r);if(d){const c=s.find(d,{_id:s.get(i,a)});c&&s.set(i,a,c)}}),o=Te.render(l,i)}return o},getExtraRessources(){return s.extend(s.get(this.resource,"extraSources",{}),s.get(this.resource,"schema[0].options.extraSources"))}}};K.extend(ze);const Zs={mixins:[Z,Qs],props:{list:{type:[Array,Boolean],default:()=>[]},resource:{type:[Object,Boolean],default:()=>{}},groupedList:{type:[Array,Boolean],default:()=>[]},resourceGroup:{type:[Object,Boolean],default:()=>{}},selectedItem:{type:Object,default:()=>{}},selectResourceCallback:{type:Function,default:()=>{}},updateRecordList:{type:Function,default:()=>{}},locale:{type:String,default:"enUS"},multiselect:{type:Boolean,default:!1},multiselectItems:{type:[Array,Boolean],default:()=>[]}},data(){return{lastSelectedItem:!1,menuOpened:!1,search:null,TranslateService:k,omnibarDisplayed:!1,sift:{isQuery:!1,isValid:!1},query:{},localMultiselectItems:[]}},computed:{selectedResourceGroup(){return s.find(this.groupedList,e=>this.groupSelected(e))},maxCount(){return s.get(this.resource,"maxCount",0)},listCount(){return s.get(this.list,"length",0)},filteredList(){let e=this.getSearchableFields();return e.length===0&&(e=[s.first(this.resource.schema)]),s.forEach(this.list,t=>t._searchable={id:!1,keyFields:!1,query:!1}),this.sift.isQuery?s.forEach(this.list.filter(je(this.query)),t=>t._searchable.query=!0):s.filter(this.list,t=>{if(s.isEmpty(this.search))return!0;const l=[];s.forEach(e,a=>{l.push(this.getValue(t,a,this.resource.displayItem))});let o=0,i=0;for(const a in this.query){const d=this.query[a];o=o+1;let c=s.get(t,a);s.isUndefined(c)===!1&&(s.isArray(c)?s.includes(c,d)&&(i=i+1):c===d&&(i=i+1))}let r=!1;return o>0&&o===i?(r=!0,t._searchable.query=!0):this.doesMatch(this.search,l)?(r=!0,t._searchable.keyFields=!0):new RegExp(this.search,"i").test(t._id)&&(r=!0,t._searchable.id=!0),r})}},watch:{selectedResourceGroup(){this.search=""},search(){this.query=this.flatten(ot.parse(this.search)),this.sift.isQuery=!1;try{this.search.search("sift:")===0&&(this.sift.isQuery=!0,this.query=Ge.parse(this.search.substr(5)),this.sift.isValid=!0)}catch{this.sift.isValid=!1,this.query={}}},multiselectItems(){this.localMultiselectItems=s.cloneDeep(this.multiselectItems)}},mounted(){ee.events.on("omnibar-display-status",this.onGetOmnibarDisplayStatus)},methods:{getTimeAgo(e){return K().to(K(s.get(e,"_updatedAt",0)))},onGetOmnibarDisplayStatus(e){this.omnibarDisplayed=e},getShortcuts(){return this.omnibarDisplayed?{}:{esc:["esc"],open:["ctrl","/"]}},getSelectedRecordIds(){return s.map(this.localMultiselectItems,"_id")},allRecordsSelected(){const e=this.getSelectedRecordIds();return s.get(s.filter(this.filteredList,t=>!s.includes(e,t._id)),"length",0)===0},onClickSelectAll(){const e=this.getSelectedRecordIds();s.each(this.filteredList,t=>{s.includes(e,t._id)||this.localMultiselectItems.push(t)}),this.$emit("changeMultiselectItems",this.localMultiselectItems)},onClickDeselectAll(){this.$emit("changeMultiselectItems",[])},toggleViewMode(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!this.multiselect)},isCreatingNewRecord(){return this.selectedItem&&!s.get(this.selectedItem,"_id",!1)},copyIdToClipboard(e){navigator.clipboard.writeText(e)},hasEditableRecords(){return s.get(s.filter(this.filteredList,e=>s.get(e,"_local",!1)),"length",0)!==0},isItemSelected(e){return this.multiselect?s.includes(s.map(this.localMultiselectItems,"_id"),e._id):e===this.selectedItem||s.includes(s.map(this.localMultiselectItems,"_id"),e._id)},getTypePrefix(e){let t="TL_ERROR_ON_RECORD_";return e==="create"?t+="CREATION":e==="update"?t+="UPDATE":e==="delete"&&(t+="DELETE"),t?k.get(t):"Error"},manageError(e,t,l){let o=this.getTypePrefix(t),i=o;if(s.get(e,"response.data.code",500)===400){const r=s.get(e,"response.data");s.get(r,"message",!1)?i=`${o}: ${r.message}`:i=`${o}: ${k.get("TL_UNKNOWN_ERROR")}`}console.error(i,l),this.notify(i,"error")},groupSelected(e){if(!this.resource)return!1;const t=s.get(this.resource,"group.enUS",s.get(this.resource,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t},getResourceTitle(e){return e?e.displayname?k.get(e.displayname):e.title:""},selectAll(){this.localMultiselectItems.length===this.filteredList.length?this.localMultiselectItems=[]:this.localMultiselectItems=this.filteredList,this.$emit("changeMultiselectItems",this.localMultiselectItems)},dive(e,t,l){for(let o in t)if(o in t){let i=o,r=t[o];e.length>0&&(i=e+"."+o),typeof r=="object"?this.dive(i,r,l):l[i]=r}},flatten(e){let t={};return this.dive("",e,t),t},async interactiveSearch(e){const t=s.get(e,"srcKey",!1),l=s.get(this.$refs,"['search']",!1);if(!(!t||!l))return t==="esc"?l.blur():l.focus()},select(e,t=!1){if(!e._local)return this.$emit("selectItem",e);if(this.lastSelectedItem=e._id,!t)this.localMultiselectItems=[e],this.$emit("selectItem",e);else{if(this.selectedItem&&this.selectedItem._id===e._id)return;this.isItemSelected(e)?this.localMultiselectItems=s.filter(this.localMultiselectItems,l=>l._id!==e._id):this.localMultiselectItems.push(e)}this.$emit("changeMultiselectItems",this.localMultiselectItems)},checkIndex(e){return e+1<=this.filteredList.length?e+1:-1},selectTo(e,t=!1){if(!this.multiselect)return;if(t||e._id===this.lastSelectedItem)return s.isUndefined(s.find(this.localMultiselectItems,{_id:e._id}))?this.localMultiselectItems.push(e):this.localMultiselectItems=s.filter(this.localMultiselectItems,c=>c._id!==e._id),this.$emit("changeMultiselectItems",this.localMultiselectItems);this.lastSelectedItem||(this.lastSelectedItem=e._id);const l=s.isUndefined(s.find(this.localMultiselectItems,{_id:e._id}))?"check":"uncheck",o=s.findIndex(this.filteredList,c=>c._id===e._id),i=s.findIndex(this.filteredList,c=>c._id===this.lastSelectedItem),r=o<=i?o:i,a=this.checkIndex(o<=i?i:o),d=s.slice(this.filteredList,r,a);if(l==="check")s.each(d,c=>{s.isUndefined(s.find(this.localMultiselectItems,{_id:c._id}))&&this.localMultiselectItems.push(c)});else{const c=s.map(d,"_id");this.localMultiselectItems=s.filter(this.localMultiselectItems,g=>!s.includes(c,g._id))}this.lastSelectedItem=e._id,this.$emit("changeMultiselectItems",this.localMultiselectItems)},onClickNew(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!1),this.$emit("selectItem",{_local:!0})},getSearchableFields(){return s.filter(this.resource.schema,e=>e.searchable===!0)},doesMatch(e,t){return s.find(t,l=>!!new RegExp(this.search,"i").test(l))}}},Js={key:0,class:"record-list"},ei={class:"record-list-top-bar"},ti={class:"resource-title"},si={key:0,class:"records-top-bar"},ii={key:0,class:"multiselect-buttons"},li=["onClick"],ri={class:"item-info"},oi=["onClick"],ai={class:"infos-wrapper"},ni={key:0,class:"main"},ci={class:"meta"},di={class:"ts"},ui=["onClick"];function hi(e,t,l,o,i,r){const a=C("RecycleScroller"),d=Ae("shortkey");return r.maxCount!=1?(n(),m("div",Js,[u("div",ei,[r.selectedResourceGroup&&l.groupedList?(n(),b(ie,{key:0,modelValue:i.menuOpened,"onUpdate:modelValue":t[0]||(t[0]=c=>i.menuOpened=c),"content-class":"resources-menu sidebar",location:"bottom","close-on-content-click":!0,attach:".v-application"},{activator:h(({props:c})=>[u("div",V({class:["resource-selector",{opened:i.menuOpened}]},c),[u("div",ti,f(r.getResourceTitle(l.resource)),1),p(L,{size:"large"},{default:h(()=>[y("mdi-chevron-down")]),_:1})],16)]),default:h(()=>[p(ve,{rounded:""},{default:h(()=>[(n(!0),m(I,null,D(r.selectedResourceGroup.list,c=>(n(),b(de,{key:c.name,density:"compact",class:S({selected:c===l.resource}),onClick:g=>c!==l.resource?l.selectResourceCallback(c):""},{default:h(()=>[p(_e,null,{default:h(()=>[y(f(r.getResourceTitle(c)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])):v("",!0),j((n(),m("div",{class:S(["search",{"is-query":i.sift.isQuery,"is-valid":i.sift.isQuery&&i.sift.isValid==!0,"is-invalid":i.sift.isQuery&&i.sift.isValid==!1}]),onShortkey:t[2]||(t[2]=(...c)=>r.interactiveSearch&&r.interactiveSearch(...c))},[p(ye,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=c=>i.search=c),"prepend-inner-icon":"mdi-magnify",class:"search-bar",flat:"",variant:"solo-filled",rounded:"","hide-details":"",density:"compact",placeholder:e.$filters.translate("TL_SEARCH"),type:"text",name:"search"},null,8,["modelValue","placeholder"]),r.maxCount<=0||r.listCount<r.maxCount?(n(),b(R,{key:0,elevation:"0",icon:"",class:S(["new-record",{active:r.isCreatingNewRecord()}]),onClick:r.onClickNew},{default:h(()=>[l.selectedItem&&!l.multiselect?(n(),b(L,{key:0},{default:h(()=>[y("mdi-note-edit-outline")]),_:1})):(n(),b(L,{key:1},{default:h(()=>[y("mdi-note-plus-outline")]),_:1}))]),_:1},8,["class","onClick"])):v("",!0)],34)),[[d,r.getShortcuts()]])]),r.hasEditableRecords()?(n(),m("div",si,[u("div",{class:"toggle-view-mode",onClick:t[3]||(t[3]=c=>r.toggleViewMode())},[p(L,{class:S({selected:!l.multiselect})},{default:h(()=>[y("mdi-note-edit-outline")]),_:1},8,["class"]),p(L,{class:S({selected:l.multiselect})},{default:h(()=>[y("mdi-format-list-checks")]),_:1},8,["class"])]),l.multiselect?(n(),m("div",ii,[u("span",{class:S({disabled:r.allRecordsSelected()}),onClick:t[4]||(t[4]=(...c)=>r.onClickSelectAll&&r.onClickSelectAll(...c))},f(e.$filters.translate("TL_SELECT_ALL")),3),u("span",{class:S({disabled:l.multiselectItems.length===0}),onClick:t[5]||(t[5]=(...c)=>r.onClickDeselectAll&&r.onClickDeselectAll(...c))},f(e.$filters.translate("TL_DESELECT_ALL")),3)])):v("",!0)])):v("",!0),j((n(),m("div",{class:"records",onShortkey:t[6]||(t[6]=c=>r.selectAll())},[p(a,{class:"list",items:r.filteredList||[],"item-size":58,"key-field":"_id"},{default:h(({item:c})=>[u("div",{class:S(["item",{selected:r.isItemSelected(c),frozen:!c._local}]),onClick:[E(g=>r.select(c),["exact"]),E(g=>r.selectTo(c),["shift"]),E(g=>r.selectTo(c,!0),["ctrl"])]},[u("div",ri,[l.multiselect?(n(),m("div",{key:0,class:"checkbox",onClick:E(g=>r.select(c,!0),["exact"])},[c._local?(n(),b(L,{key:0,class:S({displayed:r.isItemSelected(c)}),size:"small"},{default:h(()=>[y("mdi-check-bold")]),_:2},1032,["class"])):v("",!0)],8,oi)):v("",!0),u("div",ai,[c?(n(),m("div",ni,[p(Q,{location:"right",eager:""},{activator:h(({props:g})=>[u("span",It(Tt(g)),f(e.$filters.truncate(e.getName(c),15)),17)]),default:h(()=>[u("span",null,f(e.getName(c)),1)]),_:2},1024)])):v("",!0),u("div",ci,[u("div",di,[c._updatedBy?(n(),m(I,{key:0},[y(f(c._updatedBy)+" - ",1)],64)):(n(),m(I,{key:1},[y(f(e.$filters.translate("TL_UPDATED")),1)],64)),y(),u("span",{class:"time-ago",onClick:g=>r.copyIdToClipboard(c._id)},f(r.getTimeAgo(c)),9,ui)])])])])],10,li)]),_:1},8,["items"])],32)),[[d,l.multiselect?["ctrl","a"]:!1]])])):v("",!0)}const mi=T(Zs,[["render",hi]]);let ae;window.TranslateService?ae=window.TranslateService:ae=k;const $e=e=>{const t={},l=s.get(e,"model","").split(".");return s.get(e,"localised",!1)&&(t.locale=l.shift()),t.key=l.join("."),t},pi=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),pe={url:e=>{try{return!!new URL(e)}catch{return!1}},number:e=>s.isNumber(e),integer:e=>s.isNumber(e)&&s.isInteger(e),double:e=>s.isNumber(e)&&(s.isInteger(e)||e===+e&&e!==(e|0)),text:e=>s.isString(e),array:e=>s.isArray(e),email:e=>pi(e)},W={fieldIsRequired:ae.get("TL_FIELD_IS_REQUIRED"),invalidFormat:ae.get("TL_INVALID_FORMAT")},Le=(e,t,l,o)=>{if(s.get(e,"required",!1)&&!s.isNumber(t))return W.fieldIsRequired;const i=s.get(pe,o,!1);return i?i(Number(t||0),e,l,W):(console.error(`checkNumber - No validator found for type '${o}'`),!1)},Be=(e,t)=>s.get(t,e,e),z={array:e=>s.isArray(e),email:e=>new RegExp("/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/").test(e),text:(e,t,l)=>{if(s.get(t,"required",!1)&&(!s.isString(e)||s.isEmpty(e)))return W.fieldIsRequired;const o=s.head(s.get(t,"model","").split("."));if(s.get(t,"regex.value",!1)===!1&&s.get(t,`regex['${o}'].value`,!1)===!1)return!0;let i=!1,r=!1;if(t.localised&&o&&(i=s.get(t,`regex['${o}'].value`,!1),r=s.get(t,`regex['${o}'].description`,!1)),i===!1&&(i=s.get(t,"regex.value",!1),r=s.get(t,"regex.description",!1)),r===!1&&(r=i),i&&s.isString(i)){const a=i.match(/\/(.*?)\/([gimy])?$/);if(!new RegExp(a[1],a[2]||"").test(e))return`${W.invalidFormat} (${ae.get(r)})`}return!0},number:(e,t,l)=>Le(t,e,l,"number"),double:(e,t,l)=>Le(t,e,l,"double"),integer:(e,t,l)=>(s.isUndefined(e)&&(e=""),e.toString().indexOf(".")!==-1?!1:Le(t,e,l,"integer")),image:(e,t,l)=>{const{key:o,locale:i}=$e(t),r=s.find(s.get(l,"_attachments",[]),a=>a._name===o&&(!i||a._fields.locale===i));return s.get(t,"required",!1)&&!r?W.fieldIsRequired:!0},file:(e,t,l)=>{const{key:o,locale:i}=$e(t),r=s.find(s.get(l,"_attachments",[]),a=>a._name===o&&(!i||a._fields.locale===i));return s.get(t,"required",!1)&&!r?W.fieldIsRequired:!0},select:(e,t,l)=>s.get(t,"required",!1)&&s.isEmpty(e)?W.fieldIsRequired:!0,pillbox:(e,t,l)=>s.get(t,"required",!1)&&(!s.isArray(e)||s.isEmpty(e))?W.fieldIsRequired:!0};let Je={string:{type:"input",overrideType:"CustomInput",validator:z.text},text:{type:"textarea",overrideType:"CustomTextarea",rows:5,validator:z.text},password:{type:"input",inputFieldType:"password",overrideType:"CustomInput"},email:{type:"input",overrideType:"CustomInput",inputFieldType:"email",validator:pe.email},url:{type:"input",overrideType:"CustomInput",validator:pe.url},number:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:z.number},double:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:z.double},integer:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:z.integer},checkbox:{type:"switch",overrideType:"CustomCheckbox"},date:{type:"CustomDatetimePicker",format:"YYYY-MM-DD",customDatetimePickerOptions:{format:"YYYY-MM-DD"}},time:{type:"CustomDatetimePicker",format:"hh:mm:ss a",customDatetimePickerOptions:{format:"hh:mm:ss a"}},datetime:{type:"CustomDatetimePicker",format:"YYYY-MM-DD hh:mm:ss a",customDatetimePickerOptions:{format:"YYYY-MM-DD hh:mm:ss a"}},pillbox:{type:"CustomInputTag",selectOptions:{multiple:!0,searchable:!0,onNewTag(e,t,l,o){l.push(e),o.push(e)}},values:[],validator:z.pillbox},select:{type:"CustomMultiSelect",selectOptions:{multiple:!1,trackBy:"_id",customLabel:Be,searchable:!0},validator:z.select},multiselect:{type:"CustomMultiSelect",selectOptions:{multiple:!0,listBox:!0,trackBy:"_id",chips:!0,deletableChips:!0,customLabel:Be,searchable:!0},validator:pe.array},json:{type:"TreeView",overrideType:"CustomTreeView",treeViewOptions:{maxDepth:4,rootObjectKey:"root",modifiable:!1}},code:{type:"Code",overrideType:"CustomCode",options:{}},wysiwyg:{type:"Wysiwyg",overrideType:"WysiwygField"},image:{type:"ImageView",validator:z.image},file:{type:"AttachmentView",validator:z.file},paragraph:{type:"ParagraphView"},group:{type:"group",overrideType:"Group"},object:{type:"JsonEditor"},color:{type:"ColorPicker",colorPickerOptions:{}},paragraphImage:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",fileType:"image",validator:z.image},paragraphFile:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",validator:z.file}};s.each(Je,e=>{e.density="compact",e.rounded=!0,e.flat=!0,s.set(e,"solo-filled",!0)});class gi{constructor(){this.typeMapper=Je}getKeyLocale(t){return $e(t)}}const xe=new gi;let q;window.TranslateService?q=window.TranslateService:q=k;class fi{constructor(){this.typeMapper=xe.typeMapper}getSchemaFields(t,l,o,i,r,a,d){let c=s.map(t,g=>{const _=l.locales&&(g.localised||s.isUndefined(g.localised)),$=g.label&&q.get(g.label);let F=s.extend({},this.typeMapper[g.input],{label:`${$||g.field}${_?` (${q.get(`TL_${o.toUpperCase()}`)})`:""}`,model:_?`${o}.${g.field}`:g.field,originalModel:g.field,placeholder:`${$||g.field}${_?` (${q.get(`TL_${o.toUpperCase()}`)})`:""}`,disabled:r||s.get(g,"options.disabled",!1),readonly:s.get(g,"options.readonly",!1),required:!!g.required,options:g.options,hint:g.hint,resource:l,locale:o,userLocale:i,rootView:d});if(s.each(g.options,(A,G)=>{s.set(F,G,A)}),g.input==="file"&&s.get(F,"maxCount",!1)===!1)F.maxCount=1/0;else if(g.input==="select"&&s.get(F,"labels",!1))F.selectOptions.label=s.map(F.labels,(A,G)=>({value:G,text:s.get(A,`${o}`,A)}));else if(g.input==="multiselect"&&s.get(F,"labels",!1)&&!s.isObject(s.first(g.source))){const A=[];s.forEach(g.source,G=>{A.push({text:s.get(F,`labels.${G}`,G),value:G})}),g.source=A}return(g.input==="select"||g.input==="pillbox")&&(F.selectOptions.selectLabel=q.get("TL_MULTISELECT_SELECT_LABEL"),F.selectOptions.selectGroupLabel=q.get("TL_MULTISELECT_SELECT_GROUP_LABEL"),F.selectOptions.selectedLabel=q.get("TL_MULTISELECT_SELECTED_LABEL"),F.selectOptions.deselectLabel=q.get("TL_MULTISELECT_DESELECT_LABEL"),F.selectOptions.deselectGroupLabel=q.get("TL_MULTISELECT_DESELECT_GROUP_LABEL"),F.selectOptions.tagPlaceholder=q.get("TL_MULTISELECT_TAG_PLACEHOLDER")),g.input==="pillbox"&&(F.selectOptions.min=g.min,F.selectOptions.max=g.max),F});for(const g in t){const _=t[g];s.isArray(_.source)?c[g].values=_.source:s.isString(_.source)&&this.updateFieldSchema(c,_,g,o,a),c[g].localised=l.locales&&(_.localised||s.isUndefined(_.localised))}return c}updateFieldSchema(t,l,o,i,r){const a=x.get(l.source);r=s.extend({},r,s.get(l,"options.extraSources")),s.each(r,(_,$)=>{const F=x.get(_);s.each(a,A=>{const G=s.get(A,$);s.isString(G)&&s.set(A,$,s.find(F,{_id:G}))})});const d=x.getSchema(l.source),c=d&&s.first(d.schema);let g="_id";c&&(g=c.field,d.locales&&i&&(c.localised||s.isUndefined(c.localised))&&(g=`${i}.${g}`)),t[o].values=a||[],t[o].type==="CustomMultiSelect"&&(t[o].selectOptions=s.clone(t[o].selectOptions||{}),t[o].selectOptions.key="_id",t[o].selectOptions.customLabel=_=>{const $=s.isString(_)?s.find(a,{_id:_}):_;return t[o].customLabel?Te.render(t[o].customLabel,$):s.get($,g)})}getKeyLocale(t){return xe.getKeyLocale(t)}getNestedGroups(t,l,o,i,r){let a=s.groupBy(l,d=>{let c=d.originalModel;return r&&(c=c.replace(r,"")),c=c.split("."),c[o]});return a=s.map(a,(d,c)=>{if(s.uniqBy(d,"originalModel").length===1){const $=s.first(d);return d.length>1&&console.warn(`duplicated field '${$.model}' detected in resource '${t.displayname||t.title}'`),$}let g=`${i}.${c}`;s.isUndefined(i)&&(g=c);let _=s.get(t,`groups.${g}.label`,c);return _=q.get(_),s.extend({},this.typeMapper.group,{label:_,key:c,path:i,groupOptions:{fields:this.getNestedGroups(t,d,o+1,i,r)}})}),a}}const fe=new fi,He=window.TranslateService||k,et={mixins:[Z],methods:{async uploadAttachments(e,t){this.$loading.start("uploadAttachments");try{for(const l of t){const o=new FormData;o.append(l._name,l.file),l._fields.locale&&o.append("locale",l._fields.locale),l._filename&&o.append("_filename",l._filename),l._fields.fileItemId&&o.append("fileItemId",l._fields.fileItemId),s.get(l,"cropOptions",!1)&&(console.warn("detected cropOptions, will add it to the request"),o.append("cropOptions",JSON.stringify(l.cropOptions))),s.get(l,"orderUpdated",!1)&&s.get(l,"order",!1)&&o.append("order",l.order),await U.post(`../api/${this.resource.title}/${e}/attachments`,o)}}catch(l){console.error("Error happen during uploadAttachments:",l)}this.$loading.stop("uploadAttachments")},async updateAttachments(e,t){this.$loading.start("updateAttachments");try{for(const[l,o]of t.entries()){const i=s.omit(s.get(o,"cropOptions",{}),["updated"]),r=s.get(o,"order",l+1);await U.put(`../api/${this.resource.title}/${e}/attachments/${o._id}`,{cropOptions:i,order:r})}}catch(l){console.error("Error happen during updateAttachments:",l)}this.$loading.stop("updateAttachments")},async removeAttachments(e,t){this.$loading.start("remove-attachments");try{for(const l of t)await U.delete(`../api/${this.resource.title}/${e}/attachments/${l._id}`)}catch(l){console.error("Error happen during removeAttachments:",l)}this.$loading.stop("remove-attachments")},getTypePrexix(e){let t="TL_ERROR_ON_RECORD_";return e==="create"?t+="CREATION":e==="update"?t+="UPDATE":e==="delete"&&(t+="DELETE"),t?He.get(t):"Error"},manageError(e,t,l){let o=this.getTypePrexix(t),i=o;if(s.get(e,"response.data.code",500)===400){const r=s.get(e,"response.data");s.get(r,"message",!1)?i=`${o}: ${r.message}`:i=`${o}: ${He.get("TL_UNKNOWN_ERROR")}`}console.error(i,l),this.notify(i,"error")},formatSchemaLayout(e){if(!s.get(e,"layout.lines",!1))return e;const t=[];return s.each(e.layout.lines,l=>{l.slots=l.slots||s.get(l,"fields.length",1),s.each(l.fields,o=>{o.schema=s.find(e.fields,{model:o.model}),s.isUndefined(o.schema)&&(o.schema=s.find(e.fields,{originalModel:o.model})),s.isUndefined(o.schema)?console.error(`Couldn't find schema for field ${o.model}`):t.push(o.model)})}),s.each(e.fields,l=>{!s.includes(t,l.model)&&!s.includes(t,l.originalModel)&&e.layout.lines.push({fields:[{model:l.model,schema:l}]})}),e},async updateSchema(){try{const e=!(this.record&&this.record._local);this.$loading.start("loading-schema");const t=fe.getSchemaFields(this.resource.schema,this.resource,this.locale||this.userLocale,this.userLocale,e,this.resource.extraSources),l=fe.getNestedGroups(this.resource,t,0);this.schema=this.formatSchemaLayout({fields:l,layout:s.cloneDeep(this.resource.layout)}),this.$loading.stop("loading-schema"),this.originalFieldList=t}catch(e){console.error("AbstractEditorView - updateSchema - Error happen during updateSchema:",e)}}}},yi={props:{locales:{type:Array,default:()=>[]},locale:{type:String,default:""},back:{type:Function,default:()=>{}},selectLocale:{type:Function,default:()=>{}}},methods:{getLocaleTranslation(e){return k.get("TL_"+e.toUpperCase())},toggleLocale(){this.selectLocale(s.find(this.locales,e=>e!==this.locale))}}},vi={class:"locales"};function _i(e,t,l,o,i,r){return n(),m("div",{class:S(["top-bar-locale-list",{hidden:!l.locales||l.locales.length===0}])},[l.locales&&l.locales.length===2?(n(),m(I,{key:0},[p(R,{elevation:"0",class:"back",rounded:"",variant:"text",size:"small",onClick:l.back},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-chevron-left")]),_:1}),y(" "+f(e.$filters.translate("TL_BACK")),1)]),_:1},8,["onClick"]),j(u("div",{class:"locales toggle-mode",onClick:t[0]||(t[0]=a=>r.toggleLocale())},[(n(!0),m(I,null,D(l.locales,(a,d)=>(n(),b(X,{key:d,size:"small",ripple:!1,class:S({selected:a===l.locale})},{default:h(()=>[y(f(r.getLocaleTranslation(a)),1)]),_:2},1032,["class"]))),128))],512),[[Re,l.locales]])],64)):(n(),m(I,{key:1},[p(R,{elevation:"0",class:"back",rounded:"",variant:"text",size:"small",onClick:l.back},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-chevron-left")]),_:1}),y(" "+f(e.$filters.translate("TL_BACK")),1)]),_:1},8,["onClick"]),j(u("div",vi,[(n(!0),m(I,null,D(l.locales,(a,d)=>(n(),b(X,{key:d,size:"small",ripple:!1,class:S({selected:a===l.locale}),onClick:c=>l.selectLocale(a)},{default:h(()=>[y(f(r.getLocaleTranslation(a)),1)]),_:2},1032,["class","onClick"]))),128))],512),[[Re,l.locales]])],64))],2)}const tt=T(yi,[["render",_i]]),bi={components:{TopBarLocaleList:tt},mixins:[et,Z],props:{resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}},locale:{type:String,default:()=>"enUS"},userLocale:{type:String,default:()=>"enUS"}},data(){return{scrolledToBottom:!1,randomId:Math.random(),formValid:!1,fileInputTypes:["file","img","image","imageView","attachmentView"],cachedMap:{},editingRecord:{},originalFieldList:[],schema:{fields:[]},isReady:!1,formElem:!1,formOptions:{validateAfterLoad:!0,validateAfterChanged:!0}}},watch:{async locale(){await this.updateSchema(),this.editingRecord=s.clone(this.editingRecord),this.checkDirty()},async record(){await this.updateSchema(),this.cloneEditingRecord()},async userLocale(){await this.updateSchema(),this.editingRecord=s.clone(this.editingRecord),this.checkDirty()}},async mounted(){await this.updateSchema(),this.cloneEditingRecord(),this.isReady=!0,oe.events.on("select",this.onFieldSelected),this.$nextTick(()=>{this.formElem=document.getElementById(this.randomId)})},beforeUnmount(){oe.events.off("select",this.onFieldSelected)},methods:{onScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:l}}){this.scrolledToBottom=e+t>=l-50},toggleLocale(){this.selectLocale(s.find(this.resource.locales,e=>e!==this.locale))},getLocaleTranslation(e){return k.get("TL_"+e.toUpperCase())},getFieldRealOffset(e){return s.get(e,"$el.offsetTop",e.offsetTop)-50},onFieldSelected(e){this.schema.fields=s.map(this.schema.fields,t=>{const l=`${t.localised?`${k.locale}.`:""}${e.field}`;if(t.model===l){const o=document.getElementById(`${l}-${this.randomId}`),i=this.getFieldRealOffset(o);this.formElem.scrollTo({top:i})}return t})},back(){this.$emit("back")},onError(e){console.log(999,"error",e)},selectLocale(e){this.$emit("update:locale",e)},cloneEditingRecord(){const e={};s.each(this.resource.schema,t=>{if(s.includes(this.fileInputTypes,t.input))return;if(this.resource.locales&&(t.localised||s.isUndefined(t.localised)))s.each(this.resource.locales,o=>{const i=`${o}.${t.field}`;let r=s.get(this.record,i);t.input==="pillbox"?r=r||[]:t.input==="json"&&(r=r||{}),s.isPlainObject(r)&&(r=s.cloneDeep(r)),s.set(e,i,r)});else{const o=t.field;let i=s.get(this.record,o);t.input==="pillbox"&&(i=i||[]),t.input==="json"&&(i=i||{}),s.isPlainObject(i)&&(i=s.cloneDeep(i)),s.set(e,o,i)}}),this.editingRecord=s.clone(e),this.editingRecord._id=this.record._id;try{this.editingRecord._attachments=s.cloneDeep(this.record._attachments||[]),console.log("attachments are",this.editingRecord._attachments)}catch(t){console.error("Error during cloneEditingRecord:",t),this.editingRecord._attachments=[]}this.removeDirtyFlags()},async deleteRecord(){if(window.confirm(k.get("TL_ARE_YOU_SURE_TO_DELETE"),k.get("TL_YES"),k.get("TL_NO")))if(s.isUndefined(this.editingRecord._id))this.editingRecord={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await U.delete(`../api/${this.resource.title}/${this.editingRecord._id}`),this.notify(k.get("TL_RECORD_DELETED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",null)}catch(e){console.error("Error happen during deleteRecord:",e),this.manageError(e,"delete",this.editingRecord)}this.$loading.stop("delete-record")}},async checkFormValid(){let e=!1;try{this.$refs.vfg.resetValidation(),e=s.get(await this.$refs.vfg.validate(),"valid",!1)}catch(l){console.error("Not valid: ",l),e=!1}const t=s.find(this.$refs.vfg.items,l=>!l.isValid);if(s.isUndefined(t)||(e=!1,document.querySelector(`#${t.id}`).focus()),this.formValid=e,!this.formValid){const l=this.editingRecord._id?k.get("TL_ERROR_CREATING_RECORD_ID",null,{id:this.editingRecord._id}):k.get("TL_ERROR_CREATING_RECORD");this.notify(l,"error")}},fieldValueOrDefault(e,t){return e.input==="pillbox"?t||[]:e.input==="json"?t||{}:t},updateLocalisedField(e,t){s.each(this.resource.locales,l=>{if(!this.formValid)return this.handleFormNotValid();const o=`${l}.${t.field}`,i=this.fieldValueOrDefault(t,s.get(this.editingRecord,o));if(l!==this.locale&&t.required&&(s.isUndefined(i)||t.input==="string"&&i.length===0)){this.selectLocale(l),this.formValid=!1,this.$forceUpdate(),this.$nextTick(async()=>{await this.checkFormValid()}),console.warn("required field empty",t,this.formValid);return}s.isEqual(i,s.get(this.record,o))||s.set(e,o,s.isUndefined(i)?null:i)})},handleFormNotValid(){console.info("form not valid")},async createUpdateClicked(){if(await this.checkFormValid(),!this.formValid)return this.handleFormNotValid();const e={};s.each(this.resource.schema,l=>{if(!this.formValid||s.includes(this.fileInputTypes,l.input))return;if(this.resource.locales&&(l.localised||s.isUndefined(l.localised)))this.updateLocalisedField(e,l);else{const i=l.field,r=this.fieldValueOrDefault(l,s.get(this.editingRecord,i));s.isEqual(r,s.get(this.record,i))||s.set(e,i,s.isUndefined(r)?null:r)}});const t=s.filter(this.editingRecord._attachments,l=>!l._id);if(s.isEmpty(t)||console.warn("NEW ATTACHMENTS = ",t),!this.formValid)return this.handleFormNotValid();if(s.isUndefined(this.editingRecord._id))return this.createRecord(e,t);this.updateRecord(e,t)},async createRecord(e,t){this.$loading.start("create-record");try{const{data:l}=await U.post(`../api/${this.resource.title}`,e);await this.uploadAttachments(l._id,t),this.notify(k.get("TL_RECORD_CREATED",null,{id:l._id})),this.$emit("updateRecordList",l)}catch(l){console.error("Error happen during createRecord:",l),this.manageError(l,"create")}this.$loading.stop("create-record")},async updateRecord(e,t){this.$loading.start("update-record");try{let l=this.editingRecord;s.isEmpty(e)||(console.info("Will send",e),l=(await U.put(`../api/${this.resource.title}/${this.editingRecord._id}`,e)).data),await this.uploadAttachments(l._id,t);const o=s.map(t,"_id"),i=s.filter(this.editingRecord._attachments,a=>a._id&&!s.includes(o,a._id)&&(s.get(a,"cropOptions.updated",!1)||s.get(a,"orderUpdated",!1)));s.isEmpty(i)||(console.warn("UPDATED ATTACHMENTS = ",s.map(i,a=>`${a.order}-${a._filename}`)),await this.updateAttachments(l._id,i));const r=s.filter(this.record._attachments,a=>!s.find(this.editingRecord._attachments,{_id:a._id}));s.isEmpty(r)||(console.warn("REMOVED ATTACHMENTS = ",s.map(r,a=>`${a.order}-${a._name}-${a._filename}`),r),await this.removeAttachments(l._id,r)),this.notify(k.get("TL_RECORD_UPDATED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",l),console.log("record is now: ",l)}catch(l){console.error("Error happen during updateRecord:",l),this.manageError(l,"update",this.editingRecord)}this.$loading.stop("update-record")},getAttachmentModel(e){const t=[];return s.get(e,"_fields.locale",!1)&&t.push(e._fields.locale),t.push(e._name),s.join(t,".")},getUpdatedAttachments(e){return s.filter(e,t=>s.get(t,"cropOptions.updated",!1))},updateFields(e,t){if(!this.isAttachmentField(t))return!t||s.isUndefined(t)?void 0:s.set(this.editingRecord,t,e);const l=this.getUpdatedAttachments(e);console.info(`Will update attachment ${t}`,e);let o=e;l.length>0&&(o=l),this.editingRecord._attachments=s.compact(s.map(s.get(this.editingRecord,"_attachments",[]),i=>{let r=i._name;const a=s.get(i,"_fields.locale",!1);a&&(r=`${a}.${r}`);const d=s.find(o,{_name:r});return s.isUndefined(d)&&r===t?!1:s.isUndefined(d)?i:d})),s.each(e,i=>{s.isUndefined(s.find(this.editingRecord._attachments,{_name:i._name,order:i.order}))&&this.editingRecord._attachments.push(i)}),console.log("attachments are now: ",e,this.editingRecord._attachments)},onModelUpdated(e,t){this.updateFields(e,t),this.checkDirty()},isAttachmentField(e){const t=s.get(s.find(s.get(this.schema,"fields",[]),{model:e}),"originalModel",!1),l=s.get(s.find(this.resource.schema,{field:t}),"input",!1);return s.includes(this.fileInputTypes,l)},checkDirty(){s.each(this.originalFieldList,e=>{let t=!0;if(s.includes(["AttachmentView","ImageView"],e.type)){const{key:l,locale:o}=this.getKeyLocale(e),i=s.filter(this.record._attachments,a=>a._name===l&&(a._fields&&a._fields.locale)===o),r=s.filter(this.editingRecord._attachments,a=>a._name===l&&(a._fields&&a._fields.locale)===o);t=s.isEqual(i,r)}else t=s.isEqual(s.get(this.record,e.model),s.get(this.editingRecord,e.model));e.labelClasses=t?"":"dirty"})},removeDirtyFlags(){s.each(this.originalFieldList,e=>{delete e.labelClasses})},getKeyLocale(e){const t={},l=e.model.split(".");return e.localised&&(t.locale=l.shift()),t.key=l.join("."),t}}},Si={class:"top-bar"},wi={class:"buttons"};function ki(e,t,l,o,i,r){const a=C("top-bar-locale-list"),d=C("custom-form");return l.record?(n(),b(B,{key:0,dark:e.$vuetify.theme.dark,elevation:"0",class:S(["record-editor",{frozen:!l.record._local}])},{default:h(()=>[u("div",Si,[p(a,{locales:l.resource.locales,locale:l.locale,"select-locale":r.selectLocale,back:r.back},null,8,["locales","locale","select-locale","back"]),u("div",wi,[i.editingRecord._id?(n(),b(R,{key:0,elevation:"0",class:"delete",icon:"",onClick:r.deleteRecord},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-trash-can-outline")]),_:1})]),_:1},8,["onClick"])):v("",!0),p(R,{elevation:"0",class:"update",rounded:"",onClick:r.createUpdateClicked},{default:h(()=>[y(f(e.$filters.translate(i.editingRecord._id?"TL_UPDATE":"TL_CREATE")),1)]),_:1},8,["onClick"])])]),u("div",{class:S(["scroll-wrapper",{"scrolled-to-bottom":i.scrolledToBottom}]),onScroll:t[2]||(t[2]=(...c)=>r.onScroll&&r.onScroll(...c))},[p(vt,{id:i.randomId,ref:"vfg",modelValue:i.formValid,"onUpdate:modelValue":t[1]||(t[1]=c=>i.formValid=c),class:"record-editor-form","lazy-validation":""},{default:h(()=>[i.isReady?(n(),b(d,{key:0,model:i.editingRecord,"onUpdate:model":t[0]||(t[0]=c=>i.editingRecord=c),schema:i.schema,"form-id":i.randomId,"form-options":i.formOptions,"paragraph-level":1,onError:r.onError,onInput:r.onModelUpdated},null,8,["model","schema","form-id","form-options","onError","onInput"])):v("",!0)]),_:1},8,["id","modelValue"])],34)]),_:1},8,["dark","class"])):v("",!0)}const st=T(bi,[["render",ki]]),Li={props:["resource","schema","items","locale","options","selectedRecords","theme"],data(){return{localSelectedRecords:[],columns:[],sourceData:[],tableData:[],filteredColumns:[],itemsSelected:[],sortBy:[]}},computed:{orderedItem(){return this.items},schemaFields(){let e=this.schema.fields,t=[];s.forEach(e,o=>{s.get(o,"options.breakdown",!1)&&s.forEach(this.resource.locales,(i,r)=>{if(o.model===`${i}.${o.originalModel}`)o.localised=!1,o.options.localeIndex=r+1;else{let a=s.cloneDeep(o);a.localised=!1;const d=o.originalModel&&k.get(o.originalModel);a.label=`${d} (${k.get(`TL_${i.toUpperCase()}`)})`,a.model=`${i}.${o.originalModel}`,s.set(a,"options.localeIndex",r+1),t.push(a)}}),o.disabled=!0}),e=e.concat(t);let l=s.filter(e,o=>s.isNumber(s.get(o,"options.index",!1)));return s.isEmpty(l)?this.schema.fields:s.sortBy(l,o=>`${o.options.index}${s.get(o,"options.localeIndex",0)}`)}},watch:{items(){this.resetRecordsFiltering()},localSelectedRecords(){this.$emit("update:selectedRecords",this.localSelectedRecords)}},mounted(){this.resetRecordsFiltering(),this.createTableColumns()},methods:{getSrc(e,t){const l=s.get(this.findAttachmentForField(e,t),"url",!1);return l?l+"?resize=autox50":!1},findAttachmentForField(e,t){return s.find(s.get(e,"_attachments",[]),l=>t.localised?s.get(l,"_fields.locale",!1)===t.locale&&l._name===t.originalModel:l._name===t.originalModel)},getFields(e){return s.filter(this.schemaFields,{type:e})},getVal(e,t,l=!1){return s.get(e,t,l)},onChangeSortBy(e){this.sortBy=e},resetRecordsFiltering(){this.sourceData=this.orderedItem,this.tableData=this.sourceData.slice(0)},createTableColumns(){const e=s.map(this.schemaFields,(t,l)=>{const o={value:t.model,key:t.model,title:t.label,sortable:!0,ellipsis:{showTitle:!0,lineClamp:s.get(t,"options.lineClamp",1)}};return s.each(["sortBy","align"],i=>{const r=s.get(t,`options.${i}`,!1);r!==!1&&s.set(o,i,r)}),o});e.push({value:"__ACTIONS__",key:"__ACTIONS__",sortable:!1,title:k.get("TL_ACTIONS"),width:75}),this.columns=e},edit(e){this.$emit("edit",e)},remove(e){this.$emit("remove",e)},isRecordSelected(e){return s.includes(this.localSelectedRecords,s.get(e,"_id",!1))},onSelectRecord(e,t){t?this.localSelectedRecords.push(e):this.localSelectedRecords=s.filter(this.localSelectedRecords,l=>l!==e),this.$emit("update:selectedRecords",this.localSelectedRecords)},searchBy(e,t){this.tableData=this.sourceData.filter(l=>e.length===0||e.includes(s.get(l,t)))},editRow(e){console.warn("editRow",e)},getFieldType(e){return s.get(e,"overrideType",s.get(e,"type",!1))}}},Ci={class:"vue-table-generator vue-form-generator table"},Ii={class:"checkbox"},Ti=["src"],Ri={key:1},Ei={class:"vue-table-generator-field table-column-actions"};function Di(e,t,l,o,i,r){return n(),m("div",Ci,[p(_t,{modelValue:i.localSelectedRecords,"onUpdate:modelValue":t[0]||(t[0]=a=>i.localSelectedRecords=a),theme:l.theme,"sort-by":i.sortBy,height:"73vh",density:"compact","multi-sort":"","show-select":"",sticky:"","no-data-text":e.$filters.translate("TL_NO_DATA_FOUND"),"item-value":a=>a._id,"fixed-header":"",items:i.tableData,headers:i.columns,"onUpdate:sortBy":r.onChangeSortBy},Rt({"item.__ACTIONS__":h(({item:a})=>[u("div",Ei,[p(R,{size:"small",variant:"flat",icon:"",onClick:d=>r.edit(a)},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-note-edit-outline")]),_:1})]),_:2},1032,["onClick"]),p(R,{size:"small",variant:"flat",class:"delete-btn",icon:"",onClick:d=>r.remove(a)},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-trash-can-outline")]),_:1})]),_:2},1032,["onClick"])])]),_:2},[D(r.getFields("switch"),a=>({name:`item.${a.model}`,fn:h(({item:d})=>[u("div",Ii,[p(L,{size:"small",class:S({displayed:r.getVal(d,a.model)})},{default:h(()=>[y("mdi-check-bold")]),_:2},1032,["class"])])])})),D(r.getFields("ImageView"),a=>({name:`item.${a.model}`,fn:h(({item:d})=>[r.getSrc(d,a)?(n(),m("img",{key:0,class:"vue-table-generator-field image",src:r.getSrc(d,a)},null,8,Ti)):(n(),m("span",Ri,f(e.$filters.translate("TL_NO_IMAGE")),1))])}))]),1032,["modelValue","theme","sort-by","no-data-text","item-value","items","headers","onUpdate:sortBy"])])}const $i=T(Li,[["render",Di],["__scopeId","data-v-8489b19a"]]),it={data(){return{theme:"light"}},mounted(){Y.events.on("changed-theme",e=>{this.theme=e}),this.theme=w.get(Y,"user.theme","light")}},Mi={components:{VueTableGenerator:$i,RecordEditor:st,TopBarLocaleList:tt},mixins:[et,Z,it],props:{groupedList:{type:Array,default:()=>[]},recordList:{type:Array,default:()=>[]},locale:{type:String,default:"enUS"},selectedResourceCallback:{type:Function,default:()=>{}},resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}}},data(){return{menuOpened:!1,isReady:!1,omnibarDisplayed:!1,search:null,cachedMap:{},selectedRecords:[],schema:{fields:[]},TranslateService:k,localLocale:!1,localRecord:{},clonedRecordList:null}},computed:{selectedResourceGroup(){return s.find(this.groupedList,e=>this.groupSelected(e))},options(){return{paging:s.get(this.resource,"options.paging",10),displayId:s.get(this.resource,"options.displayId",!0),displayUpdatedAt:s.get(this.resource,"options.displayUpdatedAt",!0)}},maxCount(){return s.get(this.resource,"maxCount",0)},listCount(){return s.get(this.clonedRecordList,"length",0)},filteredList(){let e=this.getSearchableFields();return e.length===0&&(e=[s.first(this.resource.schema)]),s.isEmpty(this.search)?this.clonedRecordList:s.filter(this.clonedRecordList,(t,l)=>{const o=[];return s.forEach(e,i=>{o.push(this.getValue(t,i))}),this.doesMatch(this.search,o)||new RegExp(this.search,"i").test(t._id)})}},watch:{async locale(){this.isReady=!1,this.localLocale=this.locale,this.$emit("update:locale",this.localLocale),await this.updateSchema(),this.isReady=!0},async record(){this.localRecord=s.cloneDeep(this.record)},async recordList(){this.clonedRecordList=s.cloneDeep(this.recordList),this.isReady=!1,await this.updateSchema(),this.isReady=!0,this.$forceUpdate()},async userLocale(){this.isReady=!1,await this.updateSchema(),this.isReady=!0}},mounted(){ee.events.on("omnibar-display-status",this.onGetOmnibarDisplayStatus)},methods:{onGetOmnibarDisplayStatus(e){this.omnibarDisplayed=e},getShortcuts(){return this.omnibarDisplayed?{}:{esc:["esc"],open:["ctrl","/"]}},async interactiveSearch(e){const t=s.get(e,"srcKey",!1),l=s.get(this.$refs,"['search']",!1);if(!(!t||!l))return t==="esc"?l.blur():l.focus()},getResourceTitle(e){return e?e.displayname?k.get(e.displayname):e.title:""},groupSelected(e){if(!this.resource)return!1;const t=s.get(this.resource,"group.enUS",s.get(this.resource,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t},onPaginationClick(){console.warn("onPaginationClick ---",arguments)},updateRecordList(e){this.$emit("updateRecordList",e)},selectRecord(e){this.localLocale=this.locale,this.$emit("update:record",e)},editRecord(e){this.selectRecord(e)},askConfirmation(e=!1){return window.confirm(k.get(`TL_ARE_YOU_SURE_TO_DELETE${e?"_SELECTED_RECORDS":""}`),k.get("TL_YES"),k.get("TL_NO"))},async removeRecords(){this.askConfirmation(!0)&&await Promise.all(s.map(this.selectedRecords,e=>this.removeRecord({_id:e},!0)))},async removeRecord(e,t=!1){if(!(!t&&!this.askConfirmation())){if(s.isUndefined(e._id))e={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await U.delete(`../api/${this.resource.title}/${e._id}`),this.notify(k.get("TL_RECORD_DELETED",null,{id:e._id})),this.$emit("updateRecordList",null)}catch(l){console.error("Error happen during deleteRecord:",l),this.manageError(l,"delete",this.editingRecord)}this.$loading.stop("delete-record")}this.clonedRecordList=s.filter(this.clonedRecordList,l=>e!==l)}},doesMatch(e,t){let l=!1;return s.forEach(t,o=>{if(l=new RegExp(this.search,"i").test(o),l)return!1}),l},getFieldValue(e,t,l){const o=s.get(e,t);return s.includes(["pillbox","json"],l.input)?o||(l.input==="pillbox"?[]:{}):o},async updateRecord(e){const t={};let l=s.find(this.recordList,{_id:e._id});s.each(this.resource.schema,r=>{if(s.includes(["file","image"],r.input))return;if(this.resource.locales&&(r.localised||s.isUndefined(r.localised)))s.each(this.resource.locales,d=>{const c=`${d}.${r.field}`,g=this.getFieldValue(e,c,r);s.isEqual(g,s.get(l,c))||s.set(t,c,g)});else{const d=r.field,c=this.getFieldValue(e,d,r);if(s.isEqual(c,s.get(l,d)))return;s.set(t,d,c)}});const o=s.filter(e._attachments,r=>!r._id),i=s.filter(l&&l._attachments,r=>!s.find(e._attachments,{_id:r._id}));if(s.isUndefined(e._id)){this.$loading.start("create-record");try{const r=await U.post(`../api/${this.resource.title}`,t);await this.uploadAttachments(r.data._id,o),this.notify(k.get("TL_RECORD_CREATED",null,{id:r.data._id})),this.$emit("updateRecordList",r.data)}catch(r){console.error("Error happend during updateRecord/create:",r),this.manageError(r,"create")}this.$loading.stop("create-record")}else{this.$loading.start("update-record");try{let r;s.isEmpty(t)?r={data:e}:r=await U.put(`../api/${this.resource.title}/${e._id}`,t),await this.uploadAttachments(r.data._id,o),await this.removeAttachments(r.data._id,i),(!s.isEmpty(t)||!s.isEmpty(o)||!s.isEmpty(i))&&this.notify(k.get("TL_RECORD_UPDATED",null,{id:e._id})),this.$emit("updateRecordList",r.data)}catch(r){console.error("Error happend during updateRecord/create:",r),this.manageError(r,"update",e)}this.$loading.stop("update-record")}},async updateRecords(){try{const e=[];this.$loading.start("update-records");let t=s.filter(this.recordList,l=>!s.find(this.clonedRecordList,{_id:l._id}));for(const l of t)e.push(async()=>{this.$loading.start("delete-record"),await U.delete(`../api/${this.resource.title}/${l._id}`),this.notify(k.get("TL_RECORD_DELETED",null,{id:l._id})),this.$emit("updateRecordList",null),this.$loading.stop("delete-record")});for(const l of s.reverse(this.clonedRecordList))e.push(async()=>await this.updateRecord(l));await ge(e,{concurrency:10})}catch(e){console.error("Error happens during updateRecords:",e)}this.$loading.stop("update-records")},createRecord(){let e={_local:!0};s.each(this.schema.fields,t=>{s.set(e,t.model,void 0)}),this.clonedRecordList.push(e),this.selectRecord(e)},getSearchableFields(){return s.filter(this.resource.schema,{searchable:!0})},selectLocale(e){this.$emit("update:locale",e)},getValue(e,t){if(!t)return"";if(t.input==="file"){const l=s(e).get("_attachments",[]).find(o=>o._name===t.field);return l&&l._filename}return this.resource.locales&&(t.localised||s.isUndefined(t.localised))?s.get(e,`${this.locale}.${t.field}`):s.get(e,t.field)},back(){this.$emit("unsetRecord")}}},Fi={class:"record-table-wrapper"},Ai={class:"resource-title"},Vi={key:0,class:"top-bar"},Oi={class:"buttons"};function Ui(e,t,l,o,i,r){const a=C("top-bar-locale-list"),d=C("vue-table-generator"),c=C("record-editor"),g=Ae("shortkey");return n(),m("div",Fi,[r.selectedResourceGroup&&l.groupedList?(n(),b(ie,{key:0,modelValue:i.menuOpened,"onUpdate:modelValue":t[0]||(t[0]=_=>i.menuOpened=_),"content-class":"resources-menu full-width",location:"bottom","close-on-content-click":!0,attach:".v-application"},{activator:h(({props:_})=>[u("div",V({class:"resource-selector"},_,{class:{opened:i.menuOpened}}),[u("div",Ai,f(r.getResourceTitle(l.resource)),1),p(L,{size:"large"},{default:h(()=>[y("mdi-chevron-down")]),_:1})],16)]),default:h(()=>[p(ve,{rounded:""},{default:h(()=>[(n(!0),m(I,null,D(r.selectedResourceGroup.list,_=>(n(),b(de,{key:_.name,density:"compact",class:S({selected:_===l.resource}),onClick:$=>_!==l.resource?e.selectResourceCallback(_):""},{default:h(()=>[p(_e,null,{default:h(()=>[y(f(r.getResourceTitle(_)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])):v("",!0),p(B,{class:S(["record-table",{"has-back-button":l.record}]),elevation:"0"},{default:h(()=>[l.record?v("",!0):(n(),m("div",Vi,[p(a,{locales:l.resource.locales,locale:l.locale,"select-locale":r.selectLocale,back:r.back},null,8,["locales","locale","select-locale","back"]),j((n(),m("div",{class:"search",onShortkey:t[2]||(t[2]=(..._)=>r.interactiveSearch&&r.interactiveSearch(..._))},[p(ye,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=_=>i.search=_),"prepend-inner-icon":"mdi-magnify",class:"search-bar",flat:"",variant:"solo-filled",rounded:"","hide-details":"",density:"compact",placeholder:e.$filters.translate("TL_SEARCH"),type:"text",name:"search"},null,8,["modelValue","placeholder"])],32)),[[g,r.getShortcuts()]]),u("div",Oi,[i.selectedRecords.length>0?(n(),b(R,{key:0,elevation:"0",rounded:"",class:"delete-selected-records",onClick:r.removeRecords},{default:h(()=>[y(f(e.$filters.translate("TL_DELETE_SELECTED_RECORDS")),1)]),_:1},8,["onClick"])):v("",!0),r.maxCount<=0||r.listCount<r.maxCount?(n(),b(R,{key:1,elevation:"0",rounded:"",class:"new",onClick:r.createRecord},{default:h(()=>[y(f(e.$filters.translate("TL_ADD_NEW_RECORD")),1)]),_:1},8,["onClick"])):v("",!0)])])),l.record?v("",!0):(n(),m(I,{key:1},[i.isReady?(n(),b(d,{key:0,"selected-records":i.selectedRecords,"onUpdate:selectedRecords":t[3]||(t[3]=_=>i.selectedRecords=_),locale:i.localLocale,"onUpdate:locale":t[4]||(t[4]=_=>i.localLocale=_),theme:e.theme,options:r.options,resource:l.resource,schema:i.schema,items:r.filteredList,onRemove:r.removeRecord,onEdit:r.editRecord},null,8,["selected-records","locale","theme","options","resource","schema","items","onRemove","onEdit"])):v("",!0)],64)),l.record?(n(),b(c,{key:l.record._id,record:i.localRecord,"onUpdate:record":t[5]||(t[5]=_=>i.localRecord=_),locale:i.localLocale,"onUpdate:locale":t[6]||(t[6]=_=>i.localLocale=_),resource:l.resource,"user-locale":i.TranslateService.locale,onUpdateRecordList:r.updateRecordList,onBack:r.back},null,8,["record","locale","resource","user-locale","onUpdateRecordList","onBack"])):v("",!0)]),_:1},8,["class"])])}const Ni=T(Mi,[["render",Ui]]),Pi={components:{NavBar:Xs,RecordList:mi,RecordEditor:st,Loading:Ze,LocaleList:rs,RecordTable:Ni},mixins:[Z],data(){return{config:!1,locale:"enUS",resourceList:[],selectedResource:null,localeList:[],recordList:[],notification:{},showSnackBar:!1,toolbarTitle:!1,selectedResourceGroup:null,selectedRecord:null,selectedPlugin:null,LoadingService:Ve,TranslateService:k,user:null,multiselect:!1,multiselectItems:[]}},computed:{groupedList(){const e={name:"TL_OTHERS"},t={name:"TL_PLUGINS"};let l=[e,t],o=s.union(this.resourceList,s.map(this.pluginList,i=>s.extend(i,{type:"plugin"})));return s.each(o,i=>{s.isEmpty(i.group)||s.isString(i.group)||s.find(l,a=>{if(s.isEqual(a.name,i.group))return a})||l.push({name:i.group})}),s.each(o,i=>{s.isEmpty(i.group)||s.isString(i.group)&&(s.find(l,a=>{if(a===i.group||a.name===i.group||s.includes(s.values(a.name),i.group))return a})||l.push({name:i.group}))}),s.each(o,i=>{const r=s.find(l,a=>{if(s.isEqual(a.name,i.group)||a===i.group||a.name===i.group||s.includes(s.values(a.name),i.group))return a});if(r){r.list=r.list||[],r.list.push(i);return}i.type==="plugin"?(t.list=t.list||[],t.list.push(i)):(e.list=e.list||[],e.list.push(i))}),l=s.orderBy(l,i=>i.name==="CMS"?"\0":i===e?"":`${k.get(i.name,"enUS")}`.toLowerCase(),"asc"),s.filter(l,i=>i.list&&i.list.length!==0)},pluginList(){return s.filter(window.plugins,t=>s.isUndefined(t.allowed)?!0:s.isEmpty(this.user)?!1:s.includes(t.allowed,this.user.group))}},watch:{$route:function(){if(this.$route.query.id!=null){const e=s.union(this.pluginList,this.resourceList);e.length>0&&this.selectResource(s.find(e,{title:this.$route.query.id}))}}},unmounted(){ee.events.off("notification",this.onGetNotification)},mounted(){this.$loading.start("init"),Y.onLogout(()=>{console.info("User logged out"),window.location.reload()}),ee.events.on("notification",this.onGetNotification),this.$nextTick(async()=>{if(await te.init(),this.config=te.config,await k.init(),this.setToolbarTitle(),s.get(window,"noLogin",!1))this.user={};else{Y.init();try{this.user=await Y.getStatus();const t=s.get(this.user,"theme","light")==="dark";this.$vuetify.theme.dark=t,this.$forceUpdate()}catch(t){const l=s.get(t,"response.data.message",t.message);throw this.notify(l,"error"),t}}try{const t=await U.get(`${window.location.pathname}resources`);this.$loading.stop("init");const l=s.sortBy(t.data,o=>o.title);if(this.resourceList=s.filter(l,o=>s.isUndefined(o.allowed)?!0:s.includes(o.allowed,this.user.group)),x.setSchemas(this.resourceList),this.localeList=k.config.locales,this.$route.query.id!=null){const o=s.find(s.union(this.pluginList,this.resourceList),{title:this.$route.query.id});this.selectResource(o)}}catch(t){console.error("Error while getting resources: ",t)}})},methods:{getTheme(){return s.get(this.$vuetify,"theme.dark",!1)?"dark":"light"},resetNotification(){this.showSnackBar=!1},setToolbarTitle(){this.toolbarTitle=s.get(te.config,`toolbarTitle.${k.locale}`,s.get(te.config,"toolbarTitle",!1))},onGetNotification(e){this.notification=e,this.showSnackBar=!0},getNotificationClass(){return`notification-${this.notification.type}`},async selectResourceGroup(e){this.selectedResourceGroup=e},async selectResource(e){if(!s.isUndefined(e))try{if(s.get(this.$router,"history.current.query.id",!1)!==e.title&&this.$router.push({query:{id:e.title}}).catch(l=>console.error("Router throw an error:",l)),e.type==="plugin"){this.selectedResource=null,this.selectedPlugin=e;return}if(this.onCancelMultiselectPage(),this.selectedResource=e,this.selectedPlugin=null,this.recordList=null,this.selectedRecord=null,!this.selectedResource)return;this.locale=s.first(this.selectedResource.locales),this.$loading.start("selectResource"),await this.cacheRelatedResources(e);const t=x.get(e.title);if(this.recordList=s.sortBy(t,l=>-l._updatedAt),s.get(e,"maxCount",0)===1){const l=s.get(this.recordList,"[0]",!1);l?this.selectRecord(l):this.selectRecord({_local:!0})}this.$loading.stop("selectResource")}catch(t){console.error("Error happen during selectResource:",t)}},async cacheRelatedResources(e){let t=s.union([e.title],s.values(e.extraSources));const l=o=>{s.isArray(o)?s.each(o,i=>{l(i)}):s.each(o,(i,r)=>{switch(r){case"input":{const a=s.get(o,"options.extraSources");switch(t.push(...s.values(a)),i){case"select":case"multiselect":const d=s.get(o,"source");if(s.isString(d)){t.push(d);const c=x.getSchema(d);t.push(...s.values(c.extraSources))}break;case"paragraph":s.each(s.get(o,"options.types"),c=>{l(c);const g=s.get(c,"schema");l(g)})}break}case"extraSources":t.push(...s.values(i))}})};l(e.schema),t=s.uniq(t),await ge(s.map(t,o=>async()=>await x.cache(o)),{concurrency:10})},selectRecord(e){this.selectedRecord=e},onSelectMultiselect(e){this.multiselect=e,e&&this.unsetSelectedRecord()},onChangeMultiselectItems(e){this.multiselectItems=s.clone(e)},async updateRecordList(e){try{this.$loading.start("updateRecordList");const t=await x.cache(this.selectedResource.title);this.$loading.stop("updateRecordList"),this.recordList=s.sortBy(t,l=>-l._updatedAt),this.selectRecord(s.find(this.recordList,{_id:s.get(e,"_id")}))}catch(t){console.error("Error happen during updateRecordList:",t)}},unsetSelectedRecord(){this.selectedRecord=null},onCancelMultiselectPage(){this.multiselect=!1,this.multiselectItems=[]}}},Bi={key:0,class:"cms-layout"},xi={class:"cms-inner-layout"},Hi={class:"resources"},qi={class:"records"};function zi(e,t,l,o,i,r){const a=C("nav-bar"),d=C("locale-list"),c=C("record-list"),g=C("record-editor"),_=C("record-table"),$=C("plugin-page"),F=C("loading");return n(),b(We,null,{default:h(()=>[p(St,{theme:r.getTheme()},{default:h(()=>[p(bt,{modelValue:i.showSnackBar,"onUpdate:modelValue":[t[1]||(t[1]=A=>i.showSnackBar=A),t[2]||(t[2]=A=>r.resetNotification())],transition:"scroll-y-reverse-transition","multi-line":"",location:"centered",class:S(["notification elevation-10",r.getNotificationClass()]),timeout:i.notification.type==="error"?-1:1e3},{actions:h(()=>[p(R,{rounded:"",onClick:t[0]||(t[0]=A=>r.resetNotification())},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-close-circle-outline")]),_:1})]),_:1})]),default:h(()=>[u("p",null,f(i.notification.message),1)]),_:1},8,["modelValue","timeout","class"]),i.user?(n(),m("div",Bi,[u("div",xi,[i.resourceList.length>0?(n(),b(a,{key:0,config:i.config,"toolbar-title":i.toolbarTitle,"locale-class":{locale:i.localeList&&i.localeList.length>1},"select-resource-group-callback":r.selectResourceGroup,"select-resource-callback":r.selectResource,"grouped-list":r.groupedList,"selected-resource-group":i.selectedResourceGroup,"selected-item":i.selectedResource||i.selectedPlugin},null,8,["config","toolbar-title","locale-class","select-resource-group-callback","select-resource-callback","grouped-list","selected-resource-group","selected-item"])):v("",!0),u("div",Hi,[i.localeList?(n(),b(d,{key:0,"locale-list":i.localeList},null,8,["locale-list"])):v("",!0)]),u("div",qi,[i.selectedResource&&(!i.selectedResource.view||i.selectedResource.view=="list")?(n(),m(I,{key:0},[i.selectedResource?(n(),b(c,{key:0,list:i.recordList,locale:i.locale,"selected-item":i.selectedRecord,"grouped-list":r.groupedList,"resource-group":i.selectedResourceGroup,resource:i.selectedResource,"select-resource-callback":r.selectResource,multiselect:i.multiselect,"multiselect-items":i.multiselectItems,onSelectItem:r.selectRecord,onChangeMultiselectItems:r.onChangeMultiselectItems,onSelectMultiselect:r.onSelectMultiselect,onUpdateRecordList:r.updateRecordList},null,8,["list","locale","selected-item","grouped-list","resource-group","resource","select-resource-callback","multiselect","multiselect-items","onSelectItem","onChangeMultiselectItems","onSelectMultiselect","onUpdateRecordList"])):v("",!0),i.selectedRecord&&!i.multiselect?(n(),b(g,{key:i.selectedRecord._id,record:i.selectedRecord,"onUpdate:record":t[3]||(t[3]=A=>i.selectedRecord=A),locale:i.locale,"onUpdate:locale":t[4]||(t[4]=A=>i.locale=A),resource:i.selectedResource,"user-locale":i.TranslateService.locale,onUpdateRecordList:r.updateRecordList},null,8,["record","locale","resource","user-locale","onUpdateRecordList"])):v("",!0)],64)):v("",!0),i.selectedResource&&i.selectedResource.view=="table"?(n(),b(_,{key:1,record:i.selectedRecord,"onUpdate:record":t[5]||(t[5]=A=>i.selectedRecord=A),locale:i.locale,"onUpdate:locale":t[6]||(t[6]=A=>i.locale=A),"grouped-list":r.groupedList,"resource-group":i.selectedResourceGroup,"select-resource-callback":r.selectResource,"record-list":i.recordList,resource:i.selectedResource,"user-locale":i.TranslateService.locale,onUnsetRecord:r.unsetSelectedRecord,onUpdateRecordList:r.updateRecordList},null,8,["record","locale","grouped-list","resource-group","select-resource-callback","record-list","resource","user-locale","onUnsetRecord","onUpdateRecordList"])):v("",!0),i.selectedPlugin?(n(),b($,{key:2,plugin:i.selectedPlugin},null,8,["plugin"])):v("",!0)]),i.LoadingService.isShow?(n(),b(F,{key:1})):v("",!0)])])):v("",!0)]),_:1},8,["theme"])]),_:1})}const Me=T(Pi,[["render",zi]]),ji={components:{Loading:Ze},mixins:[Z],data(){return{username:null,password:null,activeField:!1,loginFailed:!1,loggingIn:!1,showLoginForm:!1,loaded:!1,LoadingService:Ve,TranslateService:k}},async mounted(){console.warn("Login page mounted"),this.$loading.start("init");try{s.get(window,"noLogin",!1)||Y.init(),await te.init(),await k.init(),this.loaded=!0}catch(e){console.error("Error happen during mounted:",e)}this.loaded=!0,this.$nextTick(()=>{setTimeout(()=>{this.showLoginForm=!0},100)}),this.$loading.stop("init")},methods:{async login(){if(!this.loggingIn){if(!this.username)return this.$refs.username.focus();if(!this.password)return this.$refs.password.focus();this.$loading.start("login"),this.loggingIn=!0;try{await U.post(`${window.location.pathname}login`,{username:this.username,password:this.password}),this.$loading.stop("login"),window.location.reload()}catch(e){console.error("Error happen during login:",e),this.loginFailed=!0,this.$loading.stop("login")}this.loggingIn=!1}}}},Gi={class:"login-canvas"},Ki={class:"node-cms-title"},Yi=["placeholder"],Wi=["placeholder"],Xi={key:0,class:"error-message"},Qi=["disabled"];function Zi(e,t,l,o,i,r){const a=C("loading");return n(),b(We,null,{default:h(()=>[i.loaded?(n(),m("div",{key:0,class:S(["cms-layout",{displayed:i.showLoginForm}])},[u("div",Gi,[u("form",{onSubmit:t[2]||(t[2]=E((...d)=>r.login&&r.login(...d),["prevent"]))},[u("div",Ki,f(e.$filters.translate("TL_LOGIN")),1),j(u("input",{ref:"username","onUpdate:modelValue":t[0]||(t[0]=d=>i.username=d),autofocus:"",type:"test",name:"nodeCmsUsername",autocomplete:"on",placeholder:e.$filters.translate("TL_USERNAME")},null,8,Yi),[[Ee,i.username]]),j(u("input",{ref:"password","onUpdate:modelValue":t[1]||(t[1]=d=>i.password=d),type:"password",name:"nodeCmsPassword",autocomplete:"on",placeholder:e.$filters.translate("TL_PASSWORD")},null,8,Wi),[[Ee,i.password]]),i.loginFailed?(n(),m("span",Xi,f(e.$filters.translate("TL_LOGIN_FAIL")),1)):v("",!0),u("div",{class:S(["login-btn-wrapper",{disabled:!i.username||!i.password||i.loggingIn}])},[u("button",{disabled:i.loggingIn},f(e.$filters.translate("TL_CONFIRM")),9,Qi)],2)],32)])],2)):v("",!0),i.LoadingService.isShow?(n(),b(a,{key:1})):v("",!0)]),_:1})}const Ji=T(ji,[["render",Zi],["__scopeId","data-v-6c8f3437"]]),el={mixins:[it],props:["formId","schema","model","formOptions","disabled","paragraphIndex","paragraphLevel"],created(){s.each(this.schema.fields,e=>{const t=this.getFieldType(e);t in Et().appContext.components||console.error(`${t} isn't defined as a custom field type, will not render it`),e.focused=!1}),oe.events.on("select",this.onFieldSelected)},beforeUnmount(){oe.events.off("select",this.onFieldSelected)},methods:{getFieldId(e){return`${s.isUndefined(e.model)?this.getFieldType(e):e.model}-${s.isUndefined(this.formId)?"1":this.formId}`},getFieldClasses(e){const t=[`width-${s.get(e,"width","1")}`];return e.schema&&e.schema.focused===-1&&t.push("focused"),t},getLineClasses(e){return[`slots-${s.get(e,"slots","1")}`,`nb-fields-${s.get(e,"fields.length",1)}`]},onFieldSelected(e){s.each(this.schema.fields,t=>{t.focused=t.model===`${t.localised?`${k.locale}.`:""}${e.field}`,t.focused&&setTimeout(()=>{t.focused=-1,this.$forceUpdate()},1)}),this.$forceUpdate()},getFieldType(e){return s.get(e,"overrideType",s.get(e,"type",!1))},onInput(e,t){s.isUndefined(t)&&(t=s.get(s.first(e),"parentKey",!1)),this.$emit("input",e,t,this.paragraphIndex)}}},tl={key:0,class:"vue-form-generator"},sl={key:0},il=["id"],ll=["id","data-model"],rl=["id","data-model"];function ol(e,t,l,o,i,r){return l.schema!=null?(n(),m("div",tl,[l.schema.fields?(n(),m("fieldset",sl,[l.schema.layout&&l.schema.layout.lines?(n(!0),m(I,{key:0},D(l.schema.layout.lines,(a,d)=>(n(),m("div",{id:`${l.formId}-${d}`,key:d,class:S(["line-wrapper",r.getLineClasses(a)])},[(n(!0),m(I,null,D(a.fields,c=>(n(),m("div",{id:r.getFieldId(c),key:c.model,class:S(["field-wrapper",r.getFieldClasses(c)]),"data-model":c.model},[c.schema?(n(),b(De(r.getFieldType(c.schema)),{key:c.model,theme:e.theme,"paragraph-level":l.paragraphLevel,schema:c.schema,model:l.model,"form-options":l.formOptions,disabled:c.schema&&c.schema.disabled,focused:c.schema.focused,onInput:r.onInput},null,40,["theme","paragraph-level","schema","model","form-options","disabled","focused","onInput"])):v("",!0)],10,ll))),128))],10,il))),128)):(n(!0),m(I,{key:1},D(l.schema.fields,a=>(n(),m("div",{id:r.getFieldId(a),key:a.model,class:S(["field-wrapper",{focused:a.focused===-1}]),"data-model":a.model},[(n(),b(De(r.getFieldType(a)),{key:a.model,theme:e.theme,"paragraph-level":l.paragraphLevel,schema:a,model:l.model,"form-options":l.formOptions,disabled:a.schema&&a.schema.disabled,focused:a.focused,onInput:r.onInput},null,40,["theme","paragraph-level","schema","model","form-options","disabled","focused","onInput"]))],10,rl))),128))])):v("",!0)])):v("",!0)}const al=T(el,[["render",ol],["__scopeId","data-v-0a347094"]]),nl={props:["plugin"]},cl={class:"plugin-page"};function dl(e,t,l,o,i,r){return n(),m("div",cl,[(n(),b(De(l.plugin.component),{component:l.plugin.component},null,8,["component"]))])}const ul=T(nl,[["render",dl],["__scopeId","data-v-8c815112"]]),hl={data(){return{timer:null,isLoading:!0,sysLog:[],error:!1,scrollBottom:!0,data:"",stickyId:-1,count:0,destroyed:!1,autoscroll:!0,lastId:-1,tempId:0,logLines:[],filterOutLines:[],searchKey:null,warningQty:0,errorQty:0,ignoreNextScrollEvent:!1,fakeData:[],eventSource:!1}},mounted(){this.$nextTick(()=>{this.connectToLogStream(),this.$refs.scroller&&this.$refs.scroller.$el.addEventListener("scroll",this.detectScroll)})},async unmounted(){this.destroyed=!0,this.disconnectFromLogStream(),this.$refs.scroller&&this.$refs.scroller.$el.removeEventListener("scroll",this.detectScroll),clearTimeout(this.timer)},methods:{disconnectFromLogStream(){this.eventSource.close()},connectToLogStream(){this.eventSource=new EventSource(`${window.location.pathname}../api/_syslog`),this.eventSource.onmessage=e=>{this.logLines.push(JSON.parse(e.data)),this.autoscroll&&(this.ignoreNextScrollEvent=!0,s.get(this.$refs,"scroller",!1)&&this.$refs.scroller.scrollToBottom()),this.updateSysLog()},this.eventSource.addEventListener("end",()=>{this.eventSource.close(),console.warn("Log stream ended")}),this.eventSource.onerror=e=>{console.error("Error in SSE connection:",e),this.eventSource.close()}},filterLevel(e){this.searchKey=`sift:{level: {$gte: ${e}}}`,this.updateSysLog()},detectScroll(e){const t=s.get(e,"srcElement.scrollHeight",0),l=s.get(e,"srcElement.scrollTop",0),o=s.get(e,"srcElement.clientHeight",0);if(this.ignoreNextScrollEvent){this.ignoreNextScrollEvent=!1;return}this.$nextTick(()=>{this.autoscroll===!1&&l+o>=t&&(this.stickyId=-1),this.autoscroll=l+o>=t})},getLogViewerHeight(){return s.get(this.$refs["log-viewer"],"offsetHeight",100)},onInputSearch(){this.updateSysLog()},onClickRefresh(){this.error=!1,this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog(),this.lastId=-1},onClickClearSearch(){this.searchKey=null,this.updateSysLog()},onClickAutoscroll(){this.autoscroll=!this.autoscroll},onClickClear(){this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog()},calculateLineNumberSpacing(e){return s.padStart(e,8,"0")+" |"},jumpTo(e){if(!(!this.searchKey&&this.stickyId!==e)){if(this.stickyId===e){this.stickyId=-1,this.autoscroll=!0;return}this.ignoreNextScrollEvent=!0,this.autoscroll=!1,this.onClickClearSearch(),this.$nextTick(()=>{document.querySelector(`[data-line-id='${e}'][data-is-active='true']`)||this.$refs.scroller.scrollToItem(s.findIndex(this.logLines,l=>l.id===e)-14),this.stickyId=e})}},updateSysLog(){let e=s.uniqBy(this.logLines,"id");const t=s.groupBy(this.logLines,"level");if(this.warningQty=s.get(t,"[1].length",0),this.errorQty=s.get(t,"[2].length",0),!s.isEmpty(this.searchKey))if(this.searchKey.search("sift:")===0)try{const l=Ge.parse(this.searchKey.substr(5));e=e.filter(je(l))}catch{}else e=s.filter(e,l=>s.includes(s.toLower(l.line),s.toLower(this.searchKey)));this.sysLog=e,this.filterOutLines=s.get(this.logLines,"length",0)-s.get(this.sysLog,"length",0)}}},ml={class:"syslog"},pl={class:"buttons"},gl=["placeholder"],fl={key:1,class:"item filter-out"},yl={class:"item logs-raised-flags"},vl={key:0,class:"bg-error"},_l={ref:"log-viewer",class:"log-viewer-wrapper"},bl=["data-line-id","data-is-active"],Sl=["onClick"],wl=["innerHTML"];function kl(e,t,l,o,i,r){const a=C("DynamicScrollerItem"),d=C("DynamicScroller");return n(),m("div",ml,[u("div",pl,[u("button",{class:S(["item autoscroll",{active:i.autoscroll}]),onClick:t[0]||(t[0]=(...c)=>r.onClickAutoscroll&&r.onClickAutoscroll(...c))},[i.autoscroll?(n(),b(L,{key:0},{default:h(()=>[y("mdi-lock-outline")]),_:1})):(n(),b(L,{key:1},{default:h(()=>[y("mdi-unlock")]),_:1}))],2),u("button",{class:"item clear",onClick:t[1]||(t[1]=(...c)=>r.onClickClear&&r.onClickClear(...c))},[p(L,null,{default:h(()=>[y("mdi-trash-can-outline")]),_:1})]),u("button",{class:"item refresh",onClick:t[2]||(t[2]=(...c)=>r.onClickRefresh&&r.onClickRefresh(...c))},[p(L,null,{default:h(()=>[y("mdi-refresh")]),_:1})]),j(u("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>i.searchKey=c),class:S([{"is-sift":i.searchKey&&i.searchKey.search("sift:")===0},"item search"]),placeholder:e.$filters.translate("TL_SEARCH"),onInput:t[4]||(t[4]=(...c)=>r.onInputSearch&&r.onInputSearch(...c))},null,42,gl),[[Ee,i.searchKey]]),i.searchKey&&i.searchKey.length>0?(n(),m("button",{key:0,class:"item clear-search",onClick:t[5]||(t[5]=(...c)=>r.onClickClearSearch&&r.onClickClearSearch(...c))},[p(L,null,{default:h(()=>[y("mdi-close")]),_:1})])):v("",!0),i.filterOutLines>0?(n(),m("div",fl,[p(L,null,{default:h(()=>[y("mdi-target")]),_:1}),y(f(i.filterOutLines)+" lines are filter out",1)])):v("",!0),u("div",yl,[i.warningQty>=0?(n(),m("span",{key:0,class:"flag-item flag-warning",onClick:t[6]||(t[6]=c=>r.filterLevel(1))},[p(L,null,{default:h(()=>[y("mdi-flag-outline")]),_:1}),y(" "+f(i.warningQty),1)])):v("",!0),i.errorQty>=0?(n(),m("span",{key:1,class:"flag-item flag-error",onClick:t[7]||(t[7]=c=>r.filterLevel(2))},[p(L,null,{default:h(()=>[y("mdi-alert-box-outline")]),_:1}),y(" "+f(i.errorQty),1)])):v("",!0)])]),i.error?(n(),m("div",vl,f(e.$filters.translate("TL_ERROR_RETRIEVE_SYSLOG")),1)):v("",!0),u("div",_l,[p(d,{ref:"scroller",items:i.sysLog,"min-item-size":14,class:"scroller"},{default:h(({item:c,index:g,active:_})=>[p(a,{item:c,active:_,"size-dependencies":[r.calculateLineNumberSpacing(c.id),c.line],"data-index":g},{default:h(()=>[u("div",{class:"line-wrapper","data-line-id":c.id,"data-is-active":_},[u("div",{class:S(["line-number",{stickId:i.stickyId===c.id,search:i.searchKey}]),onClick:$=>r.jumpTo(c.id)},f(c.id),11,Sl),u("div",{class:"line-content",innerHTML:c.html},null,8,wl)],8,bl)]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])],512)])}const Ll=T(hl,[["render",kl],["__scopeId","data-v-4195c8f5"]]),Cl={data(){return{config:null,status:null,error:null,type:0,loading:!1,uploadedXlsx:null,dragover:!1}},async mounted(){const e=await N("./config");this.config=e.data.import},methods:{getRules(){return[e=>!e||e.type==="text/xlsx"||e.type==="text/xls"||e.type==="text/csv"||"Only XLSX/XLS/CSV files allowed"]},clickOnFileInput(){this.$refs.xlsxFile.$refs.input.click()},onDrop(e){if(this.dragover=!1,e.dataTransfer.files.length>1)return console.error("Only one file can be uploaded at a time..");this.onChangeXlsxFile(e,e.dataTransfer.files)},async onChangeXlsxFile(e,t=!1){this.uploadedXlsx=null;const l=s.first(t||s.get(e,"target.files",e))||e;l&&(this.uploadedXlsx=l)},openFile(){window.open(`https://docs.google.com/spreadsheets/d/${this.config.gsheetId}/edit`,"_blank").focus()},async checkStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("cms-import"),this.type=0,this.$nextTick(async()=>{try{const e=await N("../import/status");this.status=e.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("cms-import"),this.loading=!1})},async execute(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("cms-import"),this.$nextTick(async()=>{try{const e=await N("../import/execute");this.status=e.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("cms-import"),this.loading=!1})},async checkXlsxStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("xlsx-import"),this.type=0,this.$nextTick(async()=>{try{const e=new FormData;e.append("xlsx",this.uploadedXlsx);const t=await N.post("../import/statusXlsx",e);this.status=t.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("xlsx-import"),this.loading=!1})},async executeXlsx(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("xlsx-import"),this.$nextTick(async()=>{try{const e=new FormData;e.append("xlsx",this.uploadedXlsx);const t=await N.post("../import/executeXlsx",e);this.status=t.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("xlsx-import"),this.loading=!1})}}},J=e=>(ue("data-v-9cc42c50"),e=e(),he(),e),Il={class:"plugin-wrapper"},Tl=J(()=>u("div",{class:"plugin-title"},[u("h5",null,"Cms Import")],-1)),Rl={class:"main-container"},El={class:"config-resources"},Dl=J(()=>u("h5",null,"Resources",-1)),$l=J(()=>u("div",{class:"divider dashed"},null,-1)),Ml=J(()=>u("h5",null,"Actions",-1)),Fl={class:"other-actions"},Al=J(()=>u("div",{class:"divider dashed"},null,-1)),Vl=J(()=>u("h5",null,"Upload Xlsx",-1)),Ol=J(()=>u("div",{class:"subtext"},"Import Excel",-1)),Ul={class:"other-actions margin-top"},Nl={key:0},Pl={key:0},Bl={key:1},xl=["innerHTML"],Hl=["innerHTML"];function ql(e,t,l,o,i,r){return n(),m("div",Il,[Tl,p(B,{elevation:"0",class:"cms-import"},{default:h(()=>[u("div",Rl,[u("div",El,[Dl,i.config&&i.config.resources?(n(),b(wt,{key:0,column:""},{default:h(()=>[(n(!0),m(I,null,D(i.config.resources,(a,d)=>(n(),b(X,{key:d,size:"small",ripple:!1},{default:h(()=>[y(f(a),1)]),_:2},1024))),128))]),_:1})):v("",!0)]),$l,Ml,u("div",null,[p(R,{rounded:"",density:"compact",onClick:t[0]||(t[0]=a=>r.openFile())},{default:h(()=>[y("Edit Google Sheet")]),_:1}),u("div",Fl,[p(R,{rounded:"",density:"compact",disabled:i.loading,onClick:t[1]||(t[1]=a=>r.checkStatus())},{default:h(()=>[y("Check Difference")]),_:1},8,["disabled"]),p(R,{rounded:"",density:"compact",disabled:i.loading,onClick:t[2]||(t[2]=a=>r.execute())},{default:h(()=>[y("Import from Remote")]),_:1},8,["disabled"])])]),Al,Vl,Ol,p(B,{class:S(["file-input-card",{"drag-and-drop":i.dragover,bold:i.uploadedXlsx&&i.uploadedXlsx.name}]),elevation:"0",onDrop:t[3]||(t[3]=E(a=>r.onDrop(a),["prevent"])),onDragover:t[4]||(t[4]=E(a=>i.dragover=!0,["prevent"])),onClick:t[5]||(t[5]=a=>r.clickOnFileInput()),onDragenter:t[6]||(t[6]=E(a=>i.dragover=!0,["prevent"])),onDragleave:t[7]||(t[7]=E(a=>i.dragover=!1,["prevent"]))},{default:h(()=>[i.uploadedXlsx?(n(),m(I,{key:1},[y(f(i.uploadedXlsx.name),1)],64)):(n(),m(I,{key:0},[y("Click or drag & drop to import an .xlsx file")],64)),p(le,{ref:"xlsxFile",accept:".xlsx, .xls, .csv",rules:r.getRules(),class:"hidden-field",flat:"",density:"compact","hide-details":"",onChange:r.onChangeXlsxFile},null,8,["rules","onChange"])]),_:1},8,["class"]),u("div",Ul,[p(R,{rounded:"",density:"compact",disabled:i.loading||!i.uploadedXlsx,onClick:t[8]||(t[8]=a=>r.checkXlsxStatus())},{default:h(()=>[y("Check Difference")]),_:1},8,["disabled"]),p(R,{rounded:"",density:"compact",disabled:i.loading||!i.uploadedXlsx,onClick:t[9]||(t[9]=a=>r.executeXlsx())},{default:h(()=>[y("Import from Remote")]),_:1},8,["disabled"])]),i.status||i.error?(n(),m("div",Nl,[i.type==0?(n(),m("h6",Pl,"Difference:")):(n(),m("h6",Bl,"Status:")),u("pre",{innerHTML:i.status},null,8,xl),u("pre",{innerHTML:i.error},null,8,Hl)])):v("",!0)])]),_:1})])}const zl=T(Cl,[["render",ql],["__scopeId","data-v-9cc42c50"]]),jl={data(){return{statusInterval:null,error:null,config:null,selectedResource:null,recordData:{},reportData:{},syncStatus:{},uniqueKeyMap:{},environments:["local","remote"],syncingEnvironment:null,isEmpty:s.isEmpty,get:s.get,includes:s.includes}},unmounted(){this.statusInterval&&clearInterval(this.statusInterval)},async mounted(){let e;e=await N.get(`${window.location.pathname}resources`),s.each(e.data,t=>{let l=s.find(t.schema,{unique:!0});l&&(this.uniqueKeyMap[t.title]=l.field)}),e=await N.get(`${window.location.pathname}/config`),this.config=e.data,this.selectedResource&&this.update(),this.statusInterval=setInterval(async()=>{if(this.selectedResource){try{await ge(s.map(["local","remote"],l=>async()=>{try{const o=await N.get(`${window.location.pathname}/sync/${l}/${this.selectedResource}/status`);this.syncStatus[l]=o.data,this.syncStatus=s.clone(this.syncStatus)}catch(o){console.error(o)}}))}catch{}const t=s.find(this.syncStatus,{status:"syncing"});!t&&this.syncingEnvironment&&(this.$loading.stop("deploy-resource"),t&&t.status==="error"&&(this.error=t.error),this.syncingEnvironment=!1,this.update())}},5*1e3)},methods:{onChangeResource(){this.update()},async update(){this.$loading.start("loading-resource");try{const e=this.uniqueKeyMap[this.selectedResource];this.recordData={},this.reportData={},await ge(s.map(this.environments,a=>async()=>{try{let d;d=await N.get(`${window.location.pathname}sync/${a}/${this.selectedResource}`),s.set(this.recordData,a,d.data),d=await N.get(`${window.location.pathname}sync/${a}/${this.selectedResource}/status`),s.set(this.syncStatus,a,d.data),this.syncStatus=s.clone(this.syncStatus)}catch(d){console.error(d)}}),{concurrency:1}),this.recordData=s.clone(this.recordData);const t=this.recordData.local,l=this.recordData.remote,o=s.map(t,a=>a[e]),i=s.map(l,a=>a[e]);let r=s.intersection(o,i);r=s.filter(r,a=>{let d=s.find(t,g=>g[e]===a),c=s.find(l,g=>g[e]===a);return d._attachments=s.map(d._attachments,g=>s.omit(g,["url"])),c._attachments=s.map(c._attachments,g=>s.omit(g,["url"])),!s.isEqual(d,c)}),s.isEmpty(r)||s.each(r,a=>{console.log(a,"local",s.find(t,{[e]:a}),"remote",s.find(l,{[e]:a}))}),this.reportData={create:s.difference(o,i).length,remove:s.difference(i,o).length,update:r.length}}catch(e){console.error(e)}this.$loading.stop("loading-resource")},async onClickDeploy(e,t){this.error=null,this.$loading.start("deploy-resource"),this.syncingEnvironment=!0;try{await N.post(`../sync/${this.selectedResource}/from/${e}/to/${t}`),s.set(this.syncStatus,`${t}.status`,"syncing"),this.syncStatus=s.clone(this.syncStatus)}catch(l){console.error(l),this.syncingEnvironment=!1,this.$loading.stop("deploy-resource")}}}},be=e=>(ue("data-v-5bc476c0"),e=e(),he(),e),Gl={class:"sync-resources main"},Kl=be(()=>u("h1",null,"Sync Resources",-1)),Yl={key:0},Wl=["value"],Xl={key:0,class:"num-records"},Ql=be(()=>u("span",null,"number of records",-1)),Zl={class:"num-records-wrapper"},Jl=["num"],er={key:1,class:"num-records"},tr=be(()=>u("span",null,"records difference",-1)),sr={class:"num-records-wrapper"},ir=["set"],lr=be(()=>u("span",null,"local / remote",-1)),rr={key:0},or={key:1},ar={key:1,class:"na-field"},nr={key:1,class:"bg-error"};function cr(e,t,l,o,i,r){return n(),m("div",Gl,[Kl,i.config?(n(),m("div",Yl,[j(u("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.selectedResource=a),onChange:t[1]||(t[1]=(...a)=>r.onChangeResource&&r.onChangeResource(...a))},[(n(!0),m(I,null,D(i.config.sync.resources,a=>(n(),m("option",{key:a,value:a},f(a),9,Wl))),128))],544),[[Dt,i.selectedResource]]),i.isEmpty(i.recordData)?v("",!0):(n(),m("div",Xl,[Ql,u("div",Zl,[(n(!0),m(I,null,D(i.environments,a=>(n(),m("div",{key:a,class:"num-record",num:i.environments.length},[u("span",null,f(a),1),u("span",null,f(i.get(i.recordData,`${a}.length`,"N/A")),1)],8,Jl))),128))])])),i.isEmpty(i.reportData)?v("",!0):(n(),m("div",er,[tr,u("div",sr,[u("div",{class:"num-record",num:"1",set:e.enabled=i.get(i.recordData,"local.length")!==void 0&&i.get(i.recordData,"remote.length")!==void 0},[e.enabled?(n(),m(I,{key:0},[i.get(i.syncStatus,"local.status")!=="syncing"&&i.get(i.syncStatus,"remote.status")!=="syncing"?(n(),m(I,{key:0},[lr,u("span",null,"create: "+f(i.reportData.create),1),u("span",null,"update: "+f(i.reportData.update),1),u("span",null,"remove: "+f(i.reportData.remove),1),i.includes(i.get(i.syncStatus,"remote.allows"),"write")?(n(),m("span",rr,[u("button",{onClick:t[2]||(t[2]=a=>r.onClickDeploy("local","remote"))},"push to remote")])):v("",!0),i.includes(i.get(i.syncStatus,"local.allows"),"write")?(n(),m("span",or,[u("button",{onClick:t[3]||(t[3]=a=>r.onClickDeploy("remote","local"))},"pull from remote")])):v("",!0)],64)):v("",!0),i.get(i.syncStatus,"local.status")==="syncing"?(n(),m(I,{key:1},[u("span",null,"resource: "+f(i.get(i.syncStatus,"local.resource")),1),u("span",null,"created: "+f(i.get(i.syncStatus,"local.created"))+" / "+f(i.get(i.syncStatus,"local.createTotal")),1),u("span",null,"updated: "+f(i.get(i.syncStatus,"local.updated"))+" / "+f(i.get(i.syncStatus,"local.updateTotal")),1),u("span",null,"removed: "+f(i.get(i.syncStatus,"local.removed"))+" / "+f(i.get(i.syncStatus,"local.removeTotal")),1)],64)):v("",!0),i.get(i.syncStatus,"remote.status")==="syncing"?(n(),m(I,{key:2},[u("span",null,"resource: "+f(i.get(i.syncStatus,"remote.resource")),1),u("span",null,"created: "+f(i.get(i.syncStatus,"remote.created"))+" / "+f(i.get(i.syncStatus,"remote.createTotal")),1),u("span",null,"updated: "+f(i.get(i.syncStatus,"remote.updated"))+" / "+f(i.get(i.syncStatus,"remote.updateTotal")),1),u("span",null,"removed: "+f(i.get(i.syncStatus,"remote.removed"))+" / "+f(i.get(i.syncStatus,"remote.removeTotal")),1)],64)):v("",!0)],64)):v("",!0),e.enabled?v("",!0):(n(),m("span",ar," N/A "))],8,ir)])]))])):v("",!0),i.error?(n(),m("div",nr," Error: "+f(i.error),1)):v("",!0)])}const dr=T(jl,[["render",cr],["__scopeId","data-v-5bc476c0"]]),ur={props:{schema:{type:Object,default:()=>{}},label:{type:String,default:()=>""}},methods:{getHint(){return s.get(this.schema,"hint","")},getLabel(){return this.label.length>0?this.label:this.schema.label}}},lt=e=>(ue("data-v-8eee518d"),e=e(),he(),e),hr={class:"field-label"},mr={key:0,class:"text-red"},pr=lt(()=>u("strong",null,"* ",-1)),gr=[pr],fr={key:0,class:"text-red"},yr=lt(()=>u("strong",null,"* ",-1)),vr=[yr];function _r(e,t,l,o,i,r){return n(),m("div",hr,[r.getHint().length>0?(n(),b(Q,{key:0,eager:"",location:"right"},{activator:h(({props:a})=>[u("div",V({class:"test"},a),[l.schema.required?(n(),m("span",mr,gr)):v("",!0),y(f(r.getLabel()),1),p(L,{size:"x-small"},{default:h(()=>[y("mdi-help-circle-outline")]),_:1})],16)]),default:h(()=>[u("span",null,f(l.schema.hint),1)]),_:1})):(n(),m(I,{key:1},[l.schema.required?(n(),m("span",fr,vr)):v("",!0),y(f(r.getLabel()),1)],64))])}const br=T(ur,[["render",_r],["__scopeId","data-v-8eee518d"]]);let O={fieldIsRequired:"This field is required!",invalidFormat:"Invalid format!",numberTooSmall:"The number is too small! Minimum: {0}",numberTooBig:"The number is too big! Maximum: {0}",invalidNumber:"Invalid number",invalidInteger:"The value is not an integer",textTooSmall:"The length of text is too small! Current: {0}, Minimum: {1}",textTooBig:"The length of text is too big! Current: {0}, Maximum: {1}",thisNotText:"This is not a text!",thisNotArray:"This is not an array!",selectMinItems:"Select minimum {0} items!",selectMaxItems:"Select maximum {0} items!",invalidDate:"Invalid date!",dateIsEarly:"The date is too early! Current: {0}, Minimum: {1}",dateIsLate:"The date is too late! Current: {0}, Maximum: {1}",invalidEmail:"Invalid e-mail address!",invalidURL:"Invalid URL!",invalidCard:"Invalid card format!",invalidCardNumber:"Invalid card number!",invalidTextContainNumber:"Invalid text! Cannot contains numbers or special characters",invalidTextContainSpec:"Invalid text! Cannot contains special characters"};function H(e,t,l=O){return!w.isNil(e)&&e!==""?null:t?[M(l.fieldIsRequired)]:[]}function M(e){if(e!=null&&arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace("{"+(t-1)+"}",arguments[t]);return e}const ne={resources:O,required(e,t,l,o=O){return H(e,t.required,o)},number(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;let r=[];return w.isFinite(e)?(!w.isNil(t.min)&&e<t.min&&r.push(M(o.numberTooSmall,t.min)),!w.isNil(t.max)&&e>t.max&&r.push(M(o.numberTooBig,t.max))):r.push(M(o.invalidNumber)),r},integer(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;let r=ne.number(e,t,l,o);return w.isInteger(e)||r.push(M(o.invalidInteger)),r},double(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!w.isNumber(e)||isNaN(e))return[M(o.invalidNumber)]},string(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;let r=[];return w.isString(e)?(!w.isNil(t.min)&&e.length<t.min&&r.push(M(o.textTooSmall,e.length,t.min)),!w.isNil(t.max)&&e.length>t.max&&r.push(M(o.textTooBig,e.length,t.max))):r.push(M(o.thisNotText)),r},array(e,t,l,o=O){if(t.required){if(!w.isArray(e))return[M(o.thisNotArray)];if(e.length===0)return[M(o.fieldIsRequired)]}if(!w.isNil(e)){if(!w.isNil(t.min)&&e.length<t.min)return[M(o.selectMinItems,t.min)];if(!w.isNil(t.max)&&e.length>t.max)return[M(o.selectMaxItems,t.max)]}},date(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;let r=new Date(e);if(isNaN(r.getDate()))return[M(o.invalidDate)];let a=[];if(!w.isNil(t.min)){let d=new Date(t.min);r.valueOf()<d.valueOf()&&a.push(M(o.dateIsEarly,K.format(r),K.format(d)))}if(!w.isNil(t.max)){let d=new Date(t.max);r.valueOf()>d.valueOf()&&a.push(M(o.dateIsLate,K.format(r),K.format(d)))}return a},regexp(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!w.isNil(t.pattern)&&!new RegExp(t.pattern).test(e))return[M(o.invalidFormat)]},email(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))return[M(o.invalidEmail)]},url(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g.test(e))return[M(o.invalidURL)]},creditCard(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;const r=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,a=e.replace(/[^0-9]+/g,"");if(!r.test(a))return[M(o.invalidCard)];let d=0,c,g,_;for(let $=a.length-1;$>=0;$--)c=a.substring($,$+1),g=parseInt(c,10),_?(g*=2,g>=10?d+=g%10+1:d+=g):d+=g,_=!_;if(!(d%10===0&&a))return[M(o.invalidCardNumber)]},alpha(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!/^[a-zA-Z]*$/.test(e))return[M(o.invalidTextContainNumber)]},alphaNumeric(e,t,l,o=O){let i=H(e,t.required,o);if(i!=null)return i;if(!/^[a-zA-Z0-9]*$/.test(e))return[M(o.invalidTextContainSpec)]}};Object.keys(ne).forEach(e=>{const t=ne[e];w.isFunction(t)&&(t.locale=l=>(o,i,r)=>t(o,i,r,w.defaults(l,O)))});function qe(e){return w.isString(e)?ne[e]!=null?ne[e]:(console.warn(`'${e}' is not a validator function!`),null):e}function Ce(e,t,l){let o=w.get(l.context,"schema.attributes",{}),i=t.value||"input";w.isString(i)&&(o=w.get(o,i)||o),w.forEach(o,(r,a)=>{e.setAttribute(a,r)})}const P={props:["model","schema","formOptions","disabled","focused","paragraphLevel","theme"],data(){return{errors:[],debouncedValidateFunc:null,debouncedFormatFunc:null}},directives:{attributes:{bind:Ce,updated:Ce,componentUpdated:Ce}},watch:{focused(){if(this.focused===-1)return;let e=w.get(this.$refs,"input",!1);if(!e&&w.get(this.schema,"type",!1)!=="Wysiwyg")return console.error("no input ref for ",this.schema);w.isFunction(e.focus)&&this.focused&&e.focus()}},computed:{value:{cache:!1,get(){return w.isFunction(w.get(this.schema,"get"))?this.schema.get(this.model):w.get(this.model,this.schema.model)},set(e){let t=this.value;w.isFunction(e)?e(e,t):this.updateModelValue(e,t)}}},methods:{get(e,t=!1){return w.get(this.schema,e,t)},getOpt(e,t){return w.get(this.schema,`options.${e}`,t)},getVariant(){let e=[];return w.forEach(["underlined","outlined","filled","solo","solo-inverted","solo-filled","plain"],t=>{this.get(t)&&e.push(t)}),w.join(e," ")},onChangeData(e){this.value=e},async validate(e){this.clearValidationErrors();let t=w.get(this.formOptions,"validateAsync",!1),l=[];if(this.schema.validator&&this.schema.readonly!==!0&&this.disabled!==!0){let i=[];w.isArray(this.schema.validator)?w.forEach(this.schema.validator,r=>{i.push(qe(r).bind(this))}):i.push(qe(this.schema.validator).bind(this)),w.forEach(i,r=>{if(t)l.push(r(this.value,this.schema,this.model));else{let a=r(this.value,this.schema,this.model);a&&w.isFunction(a.then)?a.then(d=>{d&&(this.errors=this.errors.concat(d));let c=this.errors.length===0;this.$emit("validated",c,this.errors,this)}):a&&(l=l.concat(a))}})}let o=i=>{let r=[];w.forEach(w.uniq(i),d=>{w.isArray(d)&&d.length>0?r=r.concat(d):w.isString(d)&&r.push(d)}),w.isFunction(this.schema.onValidated)&&this.schema.onValidated.call(this,this.model,r,this.schema);let a=r.length===0;return e||this.$emit("validated",a,r,this),this.errors=r,r};return t?Promise.all(l).then(o):o(l)},debouncedValidate(){w.isFunction(this.debouncedValidateFunc)||(this.debouncedValidateFunc=w.debounce(this.validate.bind(this),w.get(this.schema,"validateDebounceTime",w.get(this.formOptions,"validateDebounceTime",500)))),this.debouncedValidateFunc()},async updateModelValue(e,t){let l=!1;w.isFunction(this.schema.set)?(this.schema.set(this.model,e),l=!0):this.schema.model&&(this.setModelValueByPath(this.schema.model,e),l=!0),l&&(w.isFunction(this.schema.onChanged)&&this.schema.onChanged.call(this,this.model,e,t,this.schema),w.get(this.formOptions,"validateAfterChanged",!1)===!0&&(w.get(this.schema,"validateDebounceTime",w.get(this.formOptions,"validateDebounceTime",0))>0?this.debouncedValidate():await this.validate()),this.$emit("input",e,this.schema.model))},clearValidationErrors(){this.errors.splice(0)},setModelValueByPath(e,t){let l=e.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");let o=this.model;const i=l.split(".");let r=0;const a=i.length;for(;r<a;){let d=i[r];if(r<a-1)o[d]!==void 0||w.set(this.model,d,{}),o=o[d];else{w.set(this.model,d,t);return}++r}},getKeyLocale(){const e={},t=this.schema.model.split(".");return this.schema.localised&&(e.locale=t.shift()),e.key=t.join("."),e},getFieldClasses(){return w.get(this.schema,"fieldClasses",[])}}},Sr={mixins:[P],data(){return{options:{maxDepth:0,modifiable:!this.disabled,rootObjectKey:this.schema.model}}},watch:{"schema.model":function(){this.options.rootObjectKey=this.schema.model}},methods:{getData(){return w.get(this.model,this.schema.model,!1)}}},wr={class:"json-viewer-wrapper"};function kr(e,t,l,o,i,r){const a=C("field-label"),d=C("json-viewer");return n(),m("div",wr,[p(a,{schema:e.schema},null,8,["schema"]),e.schema?(n(),b(d,{ref:"input",key:e.schema.model,value:r.getData(),copyable:!0},{copy:h(()=>[p(R,{icon:"",size:"small",elevation:"0",variant:"flat"},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-content-copy")]),_:1})]),_:1})]),_:1},8,["value"])):v("",!0)])}const Lr=T(Sr,[["render",kr]]),Cr={components:{Codemirror:Mt},mixins:[P],data(){return{isReady:!1,cmOption:{height:"auto",viewportMargin:1/0,tabSize:this.getOpt("tabSize",2),styleActiveLine:this.getOpt("styleActiveLine",!0),lineNumbers:this.getOpt("lineNumbers",!0),line:this.getOpt("line",!0),foldGutter:this.getOpt("foldGutter",!0),styleSelectedText:this.getOpt("styleSelectedText",!0),mode:this.getOpt("mode","text/javascript"),keyMap:"sublime",matchBrackets:this.getOpt("matchBrackets",!0),showCursorWhenSelecting:this.getOpt("showCursorWhenSelecting",!0),theme:"dracula",extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1}}}},watch:{},mounted(){s.isObject(this.value)&&(this.value=""),s.get(this.cmOption,"mode",!1)==="json"&&(this.cmOption.mode="javascript"),this.isReady=!0},methods:{getStyle(){return s.merge({height:s.get(this.schema,"options.height","100%"),width:s.get(this.schema,"options.width","100%")},s.get(this.schema,"options.css",{}))},onChangeData(e){s.set(this.model,s.get(this.schema,"model",!1),e)}}},Ir={class:"code-wrapper"},Tr={class:"label"};function Rr(e,t,l,o,i,r){const a=C("codemirror");return n(),m("div",Ir,[u("div",Tr,f(e.schema.label),1),i.isReady?(n(),b(a,{key:0,ref:"input",value:e.value,"onUpdate:value":t[0]||(t[0]=d=>e.value=d),style:Qe(r.getStyle()),options:i.cmOption,onInput:r.onChangeData},null,8,["value","style","options","onInput"])):v("",!0)])}const Er=T(Cr,[["render",Rr]]),Dr={mixins:[P],props:["locale"],data(){return{acceptedModes:["hexa","rgba","hsla","hex","rgb"],color:"",options:{outputModel:"hexa",hideInputs:!1,hideCanvas:!1,hideSliders:!1}}},watch:{color(){this.onChangeData(this.color)},"schema.model":function(){this.color=this.getColor()}},created(){const e=s.extend(this.options,this.schema);s.indexOf(this.acceptedModes,e.outputModel)===-1&&(console.warn(`Invalid color mode detected: '${e.outputModel}', will default to hexa`),e.outputModel="hexa"),this.options=e},mounted(){this.color=this.getColor()},methods:{getColor(){return s.get(this.model,`${this.schema.model}`,"#000000FF")}}},$r={class:"wrapper-color"};function Mr(e,t,l,o,i,r){const a=C("field-label");return n(),m("div",$r,[p(a,{schema:e.schema},null,8,["schema"]),i.options.model?(n(),b(kt,{ref:"input",key:e.schema.model+"custom",modelValue:i.color,"onUpdate:modelValue":t[0]||(t[0]=d=>i.color=d),variant:"outlined",elevation:"1","dot-size":i.options.dotSize,"hide-canvas":i.options.hideCanvas,"hide-sliders":i.options.hideSliders,"hide-inputs":i.options.hideInputs,model:i.options.outputModel,class:S({disabled:e.disabled})},null,8,["modelValue","dot-size","hide-canvas","hide-sliders","hide-inputs","model","class"])):v("",!0)])}const Fr=T(Dr,[["render",Mr]]),Ar={mixins:[P],data(){return{editor:null,originalValue:null}},watch:{"schema.model":function(){const e=s.extend(this.originalValue,s.get(this.model,this.schema.model));this.editor.setValue(e),s.set(this.model,this.schema.model,e)}},mounted(){const e=s.get(this.$refs,"input",!1);this.schema.jsonEditorOptions.title=" ";const t={schema:this.schema.jsonEditorOptions,theme:"cms",iconlib:"foundation3"};this.disabled&&(t.disable_array_delete=!0),ke.JSONEditor.defaults.themes.cms=class extends ke.JSONEditor.AbstractTheme{getRangeInput(o,i,r){return super.getRangeInput(o,i,r)}getGridContainer(){const o=document.createElement("div");return o.className="json-editor-grid-container",o}getGridRow(){const o=document.createElement("div");return o.className="json-editor-grid-row",o}getFormInputLabel(o){const i=super.getFormInputLabel(o);return i.style.display="inline-block",i.style.fontWeight="bold",i.className="json-editor-input-label",i}setGridColumnSize(o,i){o.className=`span${i}`}getSelectInput(o){return super.getSelectInput(o)}getFormInputField(o){return super.getFormInputField(o)}afterInputReady(o){if(!o.controlgroup&&(o.controlgroup=this.closest(o,".control-group"),o.controls=this.closest(o,".controls"),this.closest(o,".compact")&&(o.controlgroup.className=o.controlgroup.className.replace(/control-group/g,"").replace(/[ ]{2,}/g," "),o.controls.className=o.controlgroup.className.replace(/controls/g,"").replace(/[ ]{2,}/g," "),o.style.marginBottom=0),this.queuedInputErrorText)){const i=this.queuedInputErrorText;delete this.queuedInputErrorText,this.addInputError(o,i)}}getIndentedPanel(){return document.createElement("div")}getModal(){const o=document.createElement("div");return o.style.backgroundColor="white",o.style.border="1px solid black",o.style.boxShadow="3px 3px black",o.style.position="absolute",o.style.zIndex="10",o.style.display="none",o.style.width="auto",o}getInfoButton(o){const i=document.createElement("span");i.className="icon-info-sign pull-right",i.style.padding=".25rem",i.style.position="relative",i.style.display="inline-block";const r=document.createElement("span");return r.style["font-family"]="sans-serif",r.style.visibility="hidden",r.style["background-color"]="rgba(50, 50, 50, .75)",r.style.margin="0 .25rem",r.style.color="#FAFAFA",r.style.padding=".5rem 1rem",r.style["border-radius"]=".25rem",r.style.width="25rem",r.style.transform="translateX(-27rem) translateY(-.5rem)",r.style.position="absolute",r.innerText=o,i.onmouseover=function(){r.style.visibility="visible"},i.onmouseleave=function(){r.style.visibility="hidden"},i.appendChild(r),i}getFormInputDescription(o){const i=document.createElement("p");return i.className="help-inline",i.textContent=o,i}getFormControl(o,i,r,a){const d=document.createElement("div");d.className="control-group";const c=document.createElement("div");return c.className="controls",o&&i.getAttribute("type")==="checkbox"?(d.appendChild(c),o.className+=" checkbox",o.appendChild(i),c.appendChild(o),a&&c.appendChild(a),c.style.height="30px"):(o&&(o.className+=" control-label",d.appendChild(o)),a&&c.appendChild(a),c.appendChild(i),d.appendChild(c)),r&&c.appendChild(r),d}getHeaderButtonHolder(){const o=this.getButtonHolder();return o.className+=" btn-groups",o}getButtonHolder(){const o=document.createElement("div");return o.className="btn-group",o}getButton(o,i,r){const a=super.getButton(o,i,r);return a.className+=" btn btn-default",a}getTable(){const o=document.createElement("table");return o.className="table table-bordered",o}getTableCell(){return document.createElement("td")}addInputError(o,i){if(!o.controlgroup){this.queuedInputErrorText=i;return}!o.controlgroup||!o.controls||(o.controlgroup.className+=" error",o.errmsg?o.errmsg.style.display="":(o.errmsg=document.createElement("p"),o.errmsg.className="help-block errormsg",o.controls.appendChild(o.errmsg)),o.errmsg.textContent=i)}removeInputError(o){o.controlgroup||delete this.queuedInputErrorText,o.errmsg&&(o.errmsg.style.display="none",o.controlgroup.className=o.controlgroup.className.replace(/\s?error/g,""))}getTabHolder(o){const i=typeof o>"u"?"":o,r=document.createElement("div");return r.className="tabbable tabs-left",r.innerHTML=`<ul class='nav nav-tabs'  id='${i}'></ul><div class='tab-content well well-small' id='${i}'></div>`,r}getTopTabHolder(o){const i=typeof o>"u"?"":o,r=document.createElement("div");return r.className="tabbable tabs-over",r.innerHTML=`<ul class='nav nav-tabs' id='${i}'></ul><div class='tab-content well well-small'  id='${i}'></div>`,r}getTab(o,i){const r=document.createElement("li");r.className="nav-item";const a=document.createElement("a");return a.setAttribute("href",`#${i}`),a.appendChild(o),r.appendChild(a),r}getTopTab(o,i){const r=document.createElement("li");r.className="nav-item";const a=document.createElement("a");return a.setAttribute("href",`#${i}`),a.appendChild(o),r.appendChild(a),r}getTabContentHolder(o){return o.children[1]}getTopTabContentHolder(o){return o.children[1]}getTabContent(){const o=document.createElement("div");return o.className="tab-pane",o}getTopTabContent(){const o=document.createElement("div");return o.className="tab-pane",o}markTabActive(o){o.tab.className=o.tab.className.replace(/\s?active/g,""),o.tab.className+=" active",o.container.className=o.container.className.replace(/\s?active/g,""),o.container.className+=" active"}markTabInactive(o){o.tab.className=o.tab.className.replace(/\s?active/g,""),o.container.className=o.container.className.replace(/\s?active/g,"")}addTab(o,i){o.children[0].appendChild(i)}addTopTab(o,i){o.children[0].appendChild(i)}getProgressBar(){const o=document.createElement("div");o.className="progress";const i=document.createElement("div");return i.className="bar",i.style.width="0%",o.appendChild(i),o}updateProgressBar(o,i){o&&(o.firstChild.style.width=`${i}%`)}updateProgressBarUnknown(o){o&&(o.className="progress progress-striped active",o.firstChild.style.width="100%")}},this.editor=new ke.JSONEditor(e,t),this.disabled&&this.editor.disable(),this.editor.on("ready",()=>{this.originalValue=this.editor.getValue();const l=s.extend(this.originalValue,s.get(this.model,this.schema.model));this.editor.setValue(l),s.set(this.model,this.schema.model,l)}),this.editor.on("change",()=>{const l=this.editor.getValue();s.set(this.model,this.schema.model,l)})},methods:{}},Vr=["disabled"];function Or(e,t,l,o,i,r){return n(),m("div",{ref:"input",class:"json-editor",disabled:e.disabled},null,8,Vr)}const Ur=T(Ar,[["render",Or]]),Nr={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}}};function Pr(e,t,l,o,i,r){return n(),b(R,{class:S(["menu-item",{"is-active":l.isActive?l.isActive():null}]),icon:"",elevation:"0",title:l.title,onClick:E(l.action,["stop","prevent"])},{default:h(()=>[p(L,null,{default:h(()=>[y(f(l.icon),1)]),_:1})]),_:1},8,["class","title","onClick"])}const Br=T(Nr,[["render",Pr],["__scopeId","data-v-772981e0"]]),xr={components:{TiptapMenuItem:Br},props:{editor:{type:Object,required:!0},buttons:{type:Array,default:()=>[]}},data(){return{menuBarButtons:!1,defaultButtons:[{icon:"mdi-format-bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"mdi-format-italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"mdi-format-strikethrough",title:"Strike through",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"mdi-format-paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"mdi-format-list-bulleted",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"mdi-format-list-numbered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"mdi-format-superscript",title:"Superscript",action:()=>this.editor.chain().focus().toggleSuperscript().run()},{icon:"mdi-format-header-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"mdi-format-header-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"mdi-format-header-3",title:"Heading 3",action:()=>this.editor.chain().focus().toggleHeading({level:3}).run(),isActive:()=>this.editor.isActive("heading",{level:3})},{icon:"mdi-format-underline",title:"Underline",action:()=>this.editor.chain().focus().toggleUnderline().run(),isActive:()=>this.editor.isActive("underline")},{icon:"mdi-link",title:"Link",action:()=>this.setLink(),isActive:()=>this.editor.isActive("link")},{icon:"mdi-format-quote-open",title:"Quote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"mdi-xml",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mdi-format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{icon:"mdi-minus",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{icon:"mdi-arrow-u-left-top",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"mdi-arrow-u-right-top",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}},mounted(){this.menuBarButtons=this.buttons.length>0?this.buttons:this.defaultButtons},methods:{setLink(){const e=this.editor.getAttributes("link").href,t=window.prompt("URL",e);if(t!==null){if(t===""){this.editor.chain().focus().extendMarkRange("link").unsetLink().run();return}this.editor.chain().focus().extendMarkRange("link").setLink({href:t}).run()}}}},Hr={key:0,class:"toolbar"};function qr(e,t,l,o,i,r){const a=C("tiptap-menu-item");return i.menuBarButtons?(n(),m("div",Hr,[(n(!0),m(I,null,D(i.menuBarButtons,(d,c)=>(n(),b(a,V({key:c},d),null,16))),128))])):v("",!0)}const zr=T(xr,[["render",qr],["__scopeId","data-v-a055f95d"]]),jr={components:{EditorContent:Ft,TiptapMenuBar:zr},mixins:[P],data(){return{loaded:!1,key:null,editor:null}},watch:{model(){this.updateObj()}},mounted(){this.editor=new At({content:this.value,extensions:[Vt.configure({history:!0,code:!0,blockquote:!0}),Ot,Ut,Nt],onUpdate:()=>{const e=this.editor.getHTML();this.$emit("change",e),this.value=e}}),this.loaded=!0,this.updateObj()},created(){},methods:{getColorForToolbar(){return this.$vuetify.theme.dark?"black":"white"},onInit(){setTimeout(()=>{const e=s.get(this.$refs.wysiwygWrapper,"children[1].children[0].children[0].children[0].children[0].children[0].children",[]);s.each(e,t=>{t.tabIndex=-1,s.each(t.children,l=>{l.tabIndex=-1,s.each(l.children,o=>{o.tabIndex=-1})})})},10)},updateObj(){if(!s.get(this.schema,"model",!1))return!1;this.loaded=!0}}},Gr={ref:"wysiwygWrapper",class:"wysiwyg-wrapper"},Kr={class:"border-wrapper"};function Yr(e,t,l,o,i,r){const a=C("field-label"),d=C("tiptap-menu-bar"),c=C("editor-content");return n(),m("div",Gr,[p(a,{schema:e.schema},null,8,["schema"]),u("div",Kr,[i.editor?(n(),b(B,{key:0,class:"editor",rounded:"",elevation:"0"},{default:h(()=>[p(d,{class:"editor__header",editor:i.editor},null,8,["editor"]),p(c,{class:"editor-content",editor:i.editor},null,8,["editor"])]),_:1})):v("",!0)])],512)}const Wr=T(jr,[["render",Yr]]),Se={data(){return{key:se(),dragging:!1,dragOptions:{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{onStartDrag(){this.dragging=!0},viewFile(e=!1){var t=e||this.attachment();const l=s.get(t,"_filename","").split("."),o=l.length>1?`.${s.last(l)}`:"";window.open(window.origin+t.url+o,"_blank").focus()},getKey(e){return`${e._filename}-${Math.random()}`}}},Xr=["string","text","password","email","url","number","double","integer","checkbox","date","time","datetime","pillbox","json","code","wysiwyg","object","color","image","file"],Qr={mixins:[Se],props:["schema","vfg","model","disabled","paragraphLevel","theme"],data(){return{items:s.cloneDeep(s.get(this.model,this.schema.model,[])),types:[],selectedType:!1,localModel:{},key:se(),menuProps:{contentProps:{density:"compact"},attach:".v-application"}}},watch:{"schema.model":function(){this.items=s.cloneDeep(s.get(this.model,this.schema.model,[]))}},created(){this.updateLocalData()},mounted(){const e=s.get(this,"schema.types",Xr);this.types=s.map(e,t=>(s.isString(t)&&(t={input:t,parentKey:this.schema.model}),t.label||(t.label=s.includes(["select","multiselect"],t.input)?`${t.input}(${t.source})`:t.input),t)),this.selectedType=s.first(this.types)},methods:{onError(e){console.error("ParagraphView - error",e)},updateLocalData(){this.localModel=s.cloneDeep(this.model)},validate(){return s.each(this.$refs.vfg,e=>{if(!e.validate())throw this.errors=e.errors,new Error("group validation error")}),!0},debouncedValidate(){s.each(this.$refs.vfg,e=>{e.debouncedValidate()})},clearValidationErrors(){s.each(this.$refs.vfg,e=>{e.clearValidationErrors()})},getSchema(e){let t=[];const{resource:l,locale:o,userLocale:i,disabled:r}=this.schema;if(e.input==="group")t=s.map(e.schema,g=>s.extend({},g,{field:`value.${g.field}`,localised:this.schema.localised,label:g.label||g.field}));else{const g=s.extend({},e,{field:"value",localised:this.schema.localised});t.push(g)}s.each(t,g=>{s.includes(["image","file"],g.input)&&(g.input=s.camelCase(`paragraph ${g.input}`))});let a=s.isString(e.source)?s.get(x.getSchema(e.source),"extraSources",{}):{};const d=fe.getSchemaFields(t,l,o,i,r,a,this.schema.rootView||this);return{fields:fe.getNestedGroups(l,d,0,null,"value.")}},getAttachment(e,t){const l=s.find(this.model._attachments,{_fields:{fileItemId:e}});return t?s.get(l,t):l},onChangeType(e){const t=s.find(this.types,{label:e});s.isUndefined(t)||(this.selectedType=t)},onClickAddNewItem(){if(this.selectedType){const e=s.cloneDeep(this.selectedType);this.items.push(e),s.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.items,this.schema.model)}},findIds(e){const t=[];return s.each(e,(l,o)=>{if(o==="id")return t.push(l);(s.isPlainObject(l)||s.isArray(l))&&t.push(...this.findIds(l))}),t},onClickRemoveItem(e){let t=s.get(this.model,"_attachments",[]);s.includes(["image","file","group"],e.input)&&s.each(this.findIds(e),l=>{t=s.reject(t,{_fields:{fileItemId:l}})}),this.items=s.difference(this.items,[e]),s.set(this.localModel,this.schema.model,this.items),s.set(this.model,"_attachments",t),this.items=s.clone(this.items),this.key=se(),this.$emit("input",this.items,this.schema.model)},onChange(){s.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.items,this.schema.model)},onEndDrag(){this.dragging=!1,s.set(this.localModel,this.schema.model,this.items),this.key=se(),this.$emit("input",this.items,this.schema.model)},onModelUpdated(e,t,l){s.includes(t,".")&&s.set(this.items,`[${l}].${t}`,e),s.set(this.localModel,this.schema.model,this.items),this.$emit("input",this.items,this.schema.model)}}},Zr={class:"paragraph-view"},Jr={class:"paragraph-title"},eo={class:"add-btn-wrapper"},to={class:"item-main-wrapper"},so={class:"item-main"},io={class:"paragraph-footer"},lo={class:"add-btn-wrapper"};function ro(e,t,l,o,i,r){const a=C("custom-form"),d=C("draggable"),c=C("field-label");return n(),m("div",Zr,[l.schema?(n(),b(d,V({key:`${l.schema.model}-${i.key}`,list:i.items,class:{disabled:l.disabled},draggable:".item"},e.dragOptions,{handle:".handle",group:`${l.schema.model}-${i.key}`,"ghost-class":"ghost",onEnd:r.onEndDrag,onStart:t[0]||(t[0]=g=>e.dragging=!0)}),{default:h(()=>[(n(!0),m(I,null,D(i.items,(g,_)=>(n(),b(B,{key:`paragraph-item-${_}`,theme:l.theme,elevation:"0",class:S(`item nested-level-${l.paragraphLevel}`)},{default:h(()=>[p(Ye,{class:"handle paragraph-header"},{default:h(()=>[u("div",Jr,f(g.label),1),u("div",eo,[p(R,{class:"remove-item",disabled:l.disabled||l.schema.disabled,variant:"text",icon:"",rounded:"",size:"small",onClick:$=>r.onClickRemoveItem(g)},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-trash-can-outline")]),_:1})]),_:2},1032,["disabled","onClick"])])]),_:2},1024),u("div",to,[u("div",so,[p(a,{schema:r.getSchema(g),model:g,"paragraph-index":_,"paragraph-level":l.paragraphLevel+1,onError:r.onError,onInput:r.onModelUpdated},null,8,["schema","model","paragraph-index","paragraph-level","onError","onInput"])])])]),_:2},1032,["theme","class"]))),128))]),_:1},16,["list","class","group","onEnd"])):v("",!0),u("div",io,[p(Xe,{ref:"input",ripple:!1,"menu-props":i.menuProps,theme:l.theme,transition:"none","model-value":i.selectedType,items:i.types,"item-title":"label","item-value":"label","hide-details":"",rounded:"",density:"compact","persistent-placeholder":"",variant:"solo-filled",flat:"",disabled:l.disabled||l.schema.disabled,"menu-icon":"mdi-chevron-down","onUpdate:modelValue":r.onChangeType},{prepend:h(()=>[p(c,{schema:l.schema},null,8,["schema"])]),label:h(()=>[]),_:1},8,["menu-props","theme","model-value","items","disabled","onUpdate:modelValue"]),u("div",lo,[p(R,{elevation:"0",class:"add-new-item",rounded:"",disabled:l.disabled||l.schema.disabled,onClick:r.onClickAddNewItem},{default:h(()=>[u("span",null,f(e.$filters.translate("TL_ADD")),1)]),_:1},8,["disabled","onClick"])])])])}const oo=T(Qr,[["render",ro],["__scopeId","data-v-10e953ef"]]),Oe={data(){return{dragover:!1,attachments:[],localModel:!1}},mounted(){this.localModel=s.cloneDeep(this.model),this.attachments=this.getAttachments()},methods:{onEndDrag({newIndex:e,oldIndex:t}){this.dragging=!1;const l=s.map(this.getAttachments(),(i,r)=>(i.order!==r+1&&(i.order=r+1,i.orderUpdated=!0),i));let o=s.map(this.localModel._attachments,i=>{if(!this.isSameAttachment(i))return i;const r=s.get(s.find(l,{orderUpdated:!0,_filename:i._filename,_size:i._size,url:i.url}),"order",0);return r!==0&&r!==s.get(i,"order",-1)&&(i.order=r,i.orderUpdated=!0),i});o=s.orderBy(o,["order"],["asc"]),this.attachments=s.filter(o,i=>this.isSameAttachment(i)),this.isForParagraph?this.value=this.items:this.$emit("input",o,this.schema.model)},getImageSrc(e=!1){const t=e||this.attachment();return t.data?t.data:this.getPreviewUrl(t)},isImage(e=!1){const t=e||this.attachment();return t&&/image/g.test(t._contentType||t.file&&t.file.type)},getPreviewUrl(e=!1){const t=e||this.attachment();return t._contentType.indexOf("svg")!==-1?t.url:`${t.url}?resize=autox100`},isSameAttachment(e){const{key:t,locale:l}=this.getKeyLocale();return e._name===t&&(e._fields&&e._fields.locale)===l},attachment(){return s.find(this.localModel._attachments,e=>this.isSameAttachment(e))},getAttachments(){return s.get(this.attachments,"length",0)!==0?this.attachments:s.filter(this.localModel._attachments,e=>this.isSameAttachment(e))},imageSize(e=!1){const t=e||this.attachment();return this.bytesToSize(s.get(t,"_size",s.get(t,"file.size",!1)))},bytesToSize(e){if(e===0)return"0 Byte";const t=["Bytes","KB","MB","GB","TB"],l=parseInt(Math.floor(Math.log(e)/Math.log(1024))),o=Math.round(e/Math.pow(1024,l),2);return s.isNaN(o)?"Unknown":`${o} ${t[l]}`},isForMultipleImages(){if(this.schema.width&&this.schema.height)return!1;const e=this.getMaxCount();return e===-1?!0:e>1},isFieldDisabled(){const e=this.getMaxCount();return e===-1?!1:this.getAttachments().length>=e?!0:this.disabled||s.get(this.schema,"disabled",!1)},getFieldType(){return s.toUpper(s.get(this.schema,"type","ImageView")==="ImageView"?"image":"file")},getRules(){const e=[];return this.schema.required&&e.push(t=>!!t||s.get(this.getAttachments(),"length",0)!==0||k.get(`TL_${this.getFieldType()}_IS_MANDATORY`)),this.isForMultipleImages()&&e.push(t=>{const l=this.getMaxCount();return l===-1||s.get(this.getAttachments(),"length",0)+s.get(t,"length",0)<=l+1?!0:k.get(`TL_TOO_MANY_${this.getFieldType()}S`)}),s.get(this.schema,"options.limit",!1)&&e.push(t=>!t||!t.some(l=>l.size>this.schema.limit)||k.get(`TL_${this.getFieldType()}_IS_TOO_BIG`)),e},getPlaceholder(){return k.get(`TL_CLICK_OR_DRAG_AND_DROP_TO_ADD_${this.getFieldType()}${this.isForMultipleImages()?"S":""}`)},getMaxCount(){return s.get(this.schema,"options.maxCount",-1)},getFileSizeLimit(e){const t=e/1024;return t>1e3?`${t/1e3} MB`:`${t} KB`},removeImage(e){this.localModel._attachments=s.filter(this.localModel._attachments,l=>l!==e),this.attachments=s.filter(this.localModel._attachments,l=>this.isSameAttachment(l)),this.$forceUpdate(),this.$emit("input",this.localModel._attachments,this.schema.model);const t=this.schema.label;this.schema.label=null,this.schema.label=t},onDrop(e){this.dragover=!1;const t=this.getMaxCount();if(t!==-1&&t<=1&&e.dataTransfer.files.length>1)return console.error("Only one file can be uploaded at a time..");this.onUploadChanged(e.dataTransfer.files)},async onUploadChanged(e){if(s.get(await this.$refs.input.validate(),"length",0)!==0||(e=s.isNull(e)?[]:e,s.get(e,"target.files",!1)&&(e=s.values(e.target.files)),s.isArray(e)||(e=[e]),!e.length))return;let t=this.getMaxCount();s.get(this.schema,"width",!1)&&s.get(this.schema,"height",!1)&&(t=1);const l=this.getAttachments().length+e.length;t>1&&l>t?(console.info(`Reached max number of files for ${this.schema.model}`,l,t),e=s.take(e,e.length-(l-t))):t===1&&l>1&&!this.isForParagraph&&(this.localModel._attachments=s.filter(this.localModel._attachments,i=>!this.isSameAttachment(i)));const o=await this.readAllFiles(e);this.isForParagraph?this.value=this.items:(this.attachments=s.filter(o,i=>this.isSameAttachment(i)),this.$forceUpdate(),this.$emit("input",this.localModel._attachments,this.schema.model))},addAttachment(e,t){const{key:l,locale:o}=this.getKeyLocale(),i={_filename:s.get(e,"[0].name",e.name),_name:l,_fields:{locale:o},field:this.schema.model,localised:this.schema.localised,file:s.get(e,"[0]",e),data:t.target.result};if(this.isForParagraph){const r=se();this.items.push({id:r}),this.items=s.clone(this.items),i._fields.fileItemId=r,this.schema.rootView.model._attachments.push(i)}else this.localModel._attachments.push(i)},async readAllFiles(e){let t=s.get(e,"length",1);return new Promise((l,o)=>{s.each(e,(i,r)=>{const a=new FileReader,d=this;a.onload=c=>{d.addAttachment(i,c),d.$forceUpdate(),t--,t===0&&(this.isForMultipleImages()&&s.each(d.localModel._attachments,(g,_)=>{g.order=_+1,g.orderUpdated=!0}),l(this.isForParagraph?d.items:d.localModel._attachments))};try{const c=s.get(i,"[0]",i);c instanceof Blob&&a.readAsDataURL(c)}catch(c){console.error("Error while reading file:",c)}})})}}},ao={components:{Cropper:at},mixins:[P,Oe,Se],data(){return{firstCropUpdate:!0,stencilProps:{class:"cropper-stencil",previewClass:"cropper-stencil__preview",draggingClass:"cropper-stencil--dragging",handlersClasses:{default:"cropper-handler",eastNorth:"cropper-handler--east-north",westNorth:"cropper-handler--west-north",eastSouth:"cropper-handler--east-south",westSouth:"cropper-handler--west-south"}}}},methods:{getDefaultCropPosition({imageSize:e,visibleArea:t,coordinates:l}){const o=this.attachment();if(s.get(o,"cropOptions",!1))return{left:o.cropOptions.left,top:o.cropOptions.top};console.warn("no crop options");const i=t||e;return{left:(t?t.left:0)+i.width/2-l.width/2,top:(t?t.top:0)+i.height/2-l.height/2}},getDefaultCropSize(){return{width:s.get(this.schema,"options.width",500),height:s.get(this.schema,"options.height",500)}},onCropperChange(e){const t=this.attachment();s.each(this.localModel._attachments,o=>{o._id===t._id&&(o.cropOptions=e.coordinates,this.firstCropUpdate?this.firstCropUpdate=!1:o.cropOptions.updated=!0)});const l=s.filter(this.localModel._attachments,o=>s.get(o,"_fields.locale",!1)&&s.get(o,"_name",!1)&&`${o._fields.locale}.${o._name}`===this.schema.model?!0:s.get(o,"_name",!1)===this.schema.model);this.$emit("input",l,this.schema.model)},imageUrl(){const e=this.attachment();return e&&(e.url||e.data)}}},no={enctype:"multipart/form-data"},co={key:0,class:"preview-multiple"},uo={class:"row-handle"},ho={key:0,class:"image-wrapper"},mo={key:0,class:"preview-single-attachment"},po={class:"image-wrapper"},go={key:1,class:"parent-parent"},fo={class:"cropper-parent"},yo={key:0,class:"help-block"},vo={key:0},_o={key:1},bo={key:1,class:"help-block"},So={key:2,class:"help-block"},wo={key:3,class:"help-block"};function ko(e,t,l,o,i,r){const a=C("field-label"),d=C("draggable"),c=C("cropper");return n(),m("div",{class:S(["image-view",{"full-width":!(e.schema.width&&e.schema.height)}])},[u("form",no,[p(a,{schema:e.schema},null,8,["schema"]),e.schema.disabled?(n(),b(B,{key:0,theme:e.theme,class:S(["file-input-card",{"drag-and-drop":e.dragover}]),elevation:"0",onDrop:t[0]||(t[0]=E(g=>e.onDrop(g),["prevent"])),onDragover:t[1]||(t[1]=E(g=>e.dragover=!0,["prevent"])),onDragenter:t[2]||(t[2]=E(g=>e.dragover=!0,["prevent"])),onDragleave:t[3]||(t[3]=E(g=>e.dragover=!1,["prevent"]))},{default:h(()=>[p(le,{ref:"input",rules:e.getRules(),"hide-details":"auto","prepend-icon":"",flat:"","single-line":"",placeholder:e.getPlaceholder(),clearable:!1,label:e.getPlaceholder(),density:"compact",variant:e.getVariant(),rounded:"","persistent-placeholder":"",multiple:e.isForMultipleImages(),accept:e.schema.accept,disabled:!0,onChange:e.onUploadChanged},{selection:h(()=>[]),_:1},8,["rules","placeholder","label","variant","multiple","accept","onChange"])]),_:1},8,["theme","class"])):(n(),b(B,{key:1,theme:e.theme,class:S(["file-input-card",{"drag-and-drop":e.dragover}]),elevation:"0",onDrop:t[4]||(t[4]=E(g=>e.onDrop(g),["prevent"])),onDragover:t[5]||(t[5]=E(g=>e.dragover=!0,["prevent"])),onDragenter:t[6]||(t[6]=E(g=>e.dragover=!0,["prevent"])),onDragleave:t[7]||(t[7]=E(g=>e.dragover=!1,["prevent"]))},{default:h(()=>[p(le,{ref:"input",theme:e.theme,variant:"solo-filled",rules:e.getRules(),"hide-details":"auto","prepend-icon":"",flat:"","single-line":"",placeholder:e.getPlaceholder(),clearable:!1,label:e.getPlaceholder(),density:"compact",rounded:"","persistent-placeholder":"",multiple:e.isForMultipleImages(),accept:e.schema.accept,disabled:e.isForMultipleImages()&&e.isFieldDisabled(),onChange:e.onUploadChanged},{selection:h(()=>[]),_:1},8,["theme","rules","placeholder","label","multiple","accept","disabled","onChange"])]),_:1},8,["theme","class"]))]),e.isForMultipleImages()?(n(),m("div",co,[(n(),b(d,V({key:`${e.schema.model}-${e.key}`,list:e.getAttachments(),group:`${e.schema.model}-${e.key}`,"item-key":e.getKey,draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},e.dragOptions,{class:[{disabled:e.disabled},"preview-multiple"],onEnd:e.onEndDrag,onStart:e.onStartDrag}),{default:h(()=>[(n(!0),m(I,null,D(e.getAttachments(),(g,_)=>(n(),b(B,{key:e.getKey(g),theme:e.theme,elevation:"0",class:S(["preview-attachment",{odd:_%2!==0}])},{default:h(()=>[p(Q,{theme:e.theme,location:"right",eager:""},{activator:h(({props:$})=>[p(X,V({variant:"outlined",class:"filename",closable:"","close-icon":"mdi-close-circle-outline"},$,{"onClick:close":F=>e.removeImage(g)}),{default:h(()=>[y("#"+f(_+1)+" - "+f(e.$filters.truncate(g._filename,10))+" ("+f(e.imageSize(g))+")",1)]),_:2},1040,["onClick:close"])]),default:h(()=>[u("span",null,f(g._filename),1)]),_:2},1032,["theme"]),u("div",uo,[e.isImage(g)?(n(),m("div",ho,[p(re,{cover:"",src:e.getImageSrc(g)},null,8,["src"])])):g._id?(n(),b(R,{key:1,theme:e.theme,size:"small",rounded:"",elevation:"0",onClick:$=>e.viewFile(g)},{default:h(()=>[y(f(e.$filters.translate("TL_VIEW")),1)]),_:2},1032,["theme","onClick"])):v("",!0)])]),_:2},1032,["theme","class"]))),128))]),_:1},16,["list","group","item-key","class","onEnd","onStart"]))])):e.attachment()&&e.isImage()?(n(),m(I,{key:1},[e.schema.width&&e.schema.height?(n(),m("div",go,[u("div",fo,[p(c,{ref:"cropper",src:r.imageUrl(),transitions:!0,"image-restriction":"fit-area","image-class":"cropper__image","default-boundaries":"fill",class:"cropper","default-size":e.schema.options.width&&e.schema.options.height?r.getDefaultCropSize():!1,"default-position":r.getDefaultCropPosition,"min-width":e.schema.options.width,"max-width":e.schema.options.width,"min-height":e.schema.options.height,"max-height":e.schema.options.height,"move-image":!!e.schema.options.moveImage,"resize-image":!!e.schema.options.resizeImage,"stencil-props":i.stencilProps,onChange:r.onCropperChange},null,8,["src","default-size","default-position","min-width","max-width","min-height","max-height","move-image","resize-image","stencil-props","onChange"])]),p(R,{elevation:"2",class:"delete",icon:"",disabled:r.imageUrl().length===0,onClick:t[9]||(t[9]=g=>e.removeImage(e.attachment()))},{default:h(()=>[p(L,null,{default:h(()=>[y("mdi-trash-can-outline")]),_:1})]),_:1},8,["disabled"])])):(n(),m("div",mo,[p(Q,{theme:e.theme,location:"right",eager:""},{activator:h(({props:g})=>[p(X,V({class:"filename",closable:""},g,{"onClick:close":t[8]||(t[8]=_=>e.removeImage(e.attachment()))}),{default:h(()=>[y(f(e.$filters.truncate(e.attachment()._filename))+" ("+f(e.imageSize(e.attachment()))+")",1)]),_:2},1040)]),default:h(()=>[u("span",null,f(e.attachment()._filename),1)]),_:1},8,["theme"]),u("div",po,[p(re,{class:"preview",cover:"",src:e.getImageSrc()},null,8,["src"])])]))],64)):v("",!0),e.model._local&&!e.disabled?(n(),m(I,{key:2},[e.isForMultipleImages()?(n(),m("div",yo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),e.getMaxCount()!==-1?(n(),m("span",vo,f(e.$filters.translate("TL_MAX_NUMBER_OF_IMAGES",{num:e.getMaxCount()})),1)):(n(),m("span",_o,f(e.$filters.translate("TL_UNLIMITED_NUMBER_OF_IMAGES")),1))])):v("",!0),e.schema.width&&e.schema.height?(n(),m("div",bo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES_THE_FOLLOWING_SIZE"))+":"+f(e.schema.width)+"x"+f(e.schema.height),1)])):v("",!0),e.schema.limit?(n(),m("div",So,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES_A_FILE_SIZE"))+": "+f(e.getFileSizeLimit(e.schema.limit)),1)])):v("",!0),e.schema.accept?(n(),m("div",wo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES"))+": "+f(e.schema.accept),1)])):v("",!0)],64)):v("",!0)],2)}const Lo=T(ao,[["render",ko]]),Co={mixins:[P,Oe,Se]},Io={class:"attachment-view"},To={key:0,enctype:"multipart/form-data"},Ro={key:1,class:"preview-multiple"},Eo={class:"row-handle"},Do={key:0,class:"image-wrapper"},$o={key:2,class:"preview-single-attachment"},Mo={key:0,class:"image-wrapper"},Fo={key:0,class:"help-block"},Ao={key:0},Vo={key:1},Oo={key:1,class:"help-block"},Uo={key:2,class:"help-block"},No={key:3,class:"help-block"};function Po(e,t,l,o,i,r){const a=C("field-label"),d=C("draggable");return n(),m("div",Io,[e.disabled?v("",!0):(n(),m("form",To,[p(a,{schema:e.schema},null,8,["schema"]),p(B,{theme:e.theme,class:S(["file-input-card",{"drag-and-drop":e.dragover}]),elevation:"0",onDrop:t[0]||(t[0]=E(c=>e.onDrop(c),["prevent"])),onDragover:t[1]||(t[1]=E(c=>e.dragover=!0,["prevent"])),onDragenter:t[2]||(t[2]=E(c=>e.dragover=!0,["prevent"])),onDragleave:t[3]||(t[3]=E(c=>e.dragover=!1,["prevent"]))},{default:h(()=>[p(le,{ref:"input",theme:e.theme,flat:"",rules:e.getRules(),"prepend-icon":"",label:e.getPlaceholder(),placeholder:e.getPlaceholder(),clearable:!1,"hide-details":"auto",density:"compact",variant:e.getVariant(),rounded:"","persistent-placeholder":"","single-line":"",multiple:e.isForMultipleImages(),accept:e.schema.accept,disabled:e.isForMultipleImages()&&e.isFieldDisabled(),onChange:e.onUploadChanged},{selection:h(()=>[]),_:1},8,["theme","rules","label","placeholder","variant","multiple","accept","disabled","onChange"])]),_:1},8,["theme","class"])])),e.isForMultipleImages()?(n(),m("div",Ro,[(n(),b(d,V({key:`${e.schema.model}-${e.key}`,list:e.getAttachments(),group:`${e.schema.model}-${e.key}`,"item-key":e.getKey,draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},e.dragOptions,{class:[{disabled:e.disabled},"preview-multiple"],onEnd:e.onEndDrag,onStart:e.onStartDrag}),{default:h(()=>[(n(!0),m(I,null,D(e.getAttachments(),(c,g)=>(n(),b(B,{key:e.getKey(c),theme:e.theme,elevation:"0",class:S(["preview-attachment",{odd:g%2!==0}])},{default:h(()=>[p(Q,{location:"right",eager:""},{activator:h(({props:_})=>[p(X,V({variant:"outlined",class:"filename",closable:"","close-icon":"mdi-close-circle-outline"},_,{"onClick:close":$=>e.removeImage(c)}),{default:h(()=>[y("#"+f(g+1)+" - "+f(e.$filters.truncate(c._filename,10))+" ("+f(e.imageSize(c))+")",1)]),_:2},1040,["onClick:close"])]),default:h(()=>[u("span",null,f(c._filename),1)]),_:2},1024),u("div",Eo,[e.isImage(c)?(n(),m("div",Do,[p(re,{cover:"",src:e.getImageSrc(c)},null,8,["src"])])):c._id?(n(),b(R,{key:1,size:"small",rounded:"",elevation:"0",onClick:_=>e.viewFile(c)},{default:h(()=>[y(f(e.$filters.translate("TL_VIEW")),1)]),_:2},1032,["onClick"])):v("",!0)])]),_:2},1032,["theme","class"]))),128))]),_:1},16,["list","group","item-key","class","onEnd","onStart"]))])):e.attachment()?(n(),m("div",$o,[p(Q,{location:"right",eager:""},{activator:h(({props:c})=>[p(X,V({class:"filename",closable:""},c,{"onClick:close":t[4]||(t[4]=g=>e.removeImage(e.attachment()))}),{default:h(()=>[y(f(e.$filters.truncate(e.attachment()._filename,10))+" ("+f(e.imageSize(e.attachment()))+")",1)]),_:2},1040)]),default:h(()=>[u("span",null,f(e.attachment()._filename),1)]),_:1}),e.isImage()?(n(),m("div",Mo,[p(re,{cover:"",src:e.getImageSrc(e.a)},null,8,["src"])])):(n(),b(R,{key:1,size:"small",rounded:"",elevation:"0",onClick:t[5]||(t[5]=c=>e.viewFile())},{default:h(()=>[y(f(e.$filters.translate("TL_VIEW")),1)]),_:1}))])):v("",!0),e.model._local&&!e.disabled?(n(),m(I,{key:3},[e.isForMultipleImages()?(n(),m("div",Fo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),e.getMaxCount()!==-1?(n(),m("span",Ao,f(e.$filters.translate("TL_MAX_NUMBER_OF_FILES",{num:e.getMaxCount()})),1)):(n(),m("span",Vo,f(e.$filters.translate("TL_UNLIMITED_NUMBER_OF_FILES")),1))])):v("",!0),e.schema.width&&e.schema.height?(n(),m("div",Oo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES_THE_FOLLOWING_SIZE"))+":"+f(e.schema.width)+"x"+f(e.schema.height),1)])):v("",!0),e.schema.limit?(n(),m("div",Uo,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES_A_FILE_SIZE"))+": "+f(e.getFileSizeLimit(e.schema.limit)),1)])):v("",!0),e.schema.accept?(n(),m("div",No,[p(L,{size:"small"},{default:h(()=>[y("mdi-information")]),_:1}),u("span",null,f(e.$filters.translate("TL_THIS_FIELD_REQUIRES"))+": "+f(e.schema.accept),1)])):v("",!0)],64)):v("",!0)])}const Bo=T(Co,[["render",Po],["__scopeId","data-v-218be696"]]),xo={mixins:[P,Oe,Se],data(){return{isForParagraph:!0,items:s.get(this.model,this.schema.model,[]),attachments:[]}},watch:{"schema.model":function(){this.items=s.get(this.model,this.schema.model,[]),this.attachments=this.formatItems()}},mounted(){this.attachments=this.formatItems()},methods:{formatItems(){return s.map(this.items,e=>this.getAttachment(e))},getAttachment(e,t){const l=s.find(this.schema.rootView.model._attachments,{_fields:{fileItemId:e.id}});return t?s.get(l,t):l},onClickRemoveFileItem(e){let t=this.schema.rootView.model._attachments=this.schema.rootView.model._attachments||[];t=s.reject(t,{_fields:{fileItemId:e.id}}),this.items=s.difference(this.items,[e]),s.set(this.schema.rootView.model,"_attachments",t),s.set(this.model,this.schema.model,this.items),this.$emit("input",this.model,this.schema.model)}}},Ho={class:"paragraph-attachment-view"},qo={class:"row-handle"},zo={key:0,class:"image-wrapper"};function jo(e,t,l,o,i,r){const a=C("draggable");return n(),m("div",Ho,[p(B,{elevation:"0",class:S({"drag-and-drop":e.dragover}),onDrop:t[0]||(t[0]=E(d=>e.onDrop(d),["prevent"])),onDragover:t[1]||(t[1]=E(d=>e.dragover=!0,["prevent"])),onDragenter:t[2]||(t[2]=E(d=>e.dragover=!0,["prevent"])),onDragleave:t[3]||(t[3]=E(d=>e.dragover=!1,["prevent"]))},{default:h(()=>[p(le,{ref:"input",rules:e.getRules(),"prepend-icon":"",flat:"","single-line":"",accept:e.model.input==="image"?"image/*":"*",clearable:!1,placeholder:e.getPlaceholder(),label:e.getPlaceholder(),density:"compact",variant:e.getVariant(),rounded:"","persistent-placeholder":"",multiple:e.isForMultipleImages(),disabled:e.isForMultipleImages()&&e.isFieldDisabled(),onChange:e.onUploadChanged},{selection:h(()=>[]),_:1},8,["rules","accept","placeholder","label","variant","multiple","disabled","onChange"])]),_:1},8,["class"]),e.schema?(n(),b(a,V({key:`${e.schema.model}-${e.key}`,list:i.items,group:`${e.schema.model}-${e.key}`,"item-key":e.getKey,draggable:".preview-attachment",handle:".row-handle","ghost-class":"ghost"},e.dragOptions,{class:[{disabled:e.disabled},"preview-multiple"],onEnd:e.onEndDrag,onStart:e.onStartDrag}),{default:h(()=>[(n(!0),m(I,null,D(i.items,(d,c)=>(n(),b(B,{key:e.getKey(d),elevation:"0",class:S(["preview-attachment",{odd:c%2!==0}])},{default:h(()=>[u("div",qo,[p(Q,{location:"right",eager:""},{activator:h(({props:g})=>[p(X,V({class:"filename",closable:""},g,{"onClick:close":_=>r.onClickRemoveFileItem(d)}),{default:h(()=>[y("#"+f(c+1)+" - "+f(e.$filters.truncate(e.$filters.translate(r.getAttachment(d,"_filename"))))+" ("+f(e.imageSize(r.getAttachment(d)))+")",1)]),_:2},1040,["onClick:close"])]),default:h(()=>[u("span",null,f(r.getAttachment(d,"_filename")),1)]),_:2},1024),e.isImage(r.getAttachment(d))?(n(),m("div",zo,[p(re,{cover:"",src:e.getImageSrc(r.getAttachment(d))},null,8,["src"])])):r.getAttachment(d,"url")?(n(),b(R,{key:1,size:"small",rounded:"",elevation:"0",onClick:g=>e.viewFile(r.getAttachment(d))},{default:h(()=>[y(f(e.$filters.translate("TL_VIEW")),1)]),_:2},1032,["onClick"])):v("",!0)])]),_:2},1032,["class"]))),128))]),_:1},16,["list","group","item-key","class","onEnd","onStart"])):v("",!0)])}const Go=T(xo,[["render",jo],["__scopeId","data-v-662e19b2"]]),Ko={props:["format","name","width","value"],data(){return{hideCal:!0,activePort:null,timeStamp:null,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Su","Mo","Tu","We","Th","Fr","Sa"],monthIndex:0,hourIndex:0,minuteIndex:0,year:2017,portsHolder:[],minute:0,hour:1,day:1,minuteSelectorVisible:!1,hourSelectorVisible:!1,period:"AM"}},computed:{ports:{get(){let e=[];if(this.portsHolder.length===0)for(let t=0;t<42;t++)e.push("");else e=this.portsHolder;return e},set(e){this.portsHolder=e}},month(){return this.months[this.monthIndex]},dateTime(){return`${this.timeStamp.getFullYear()}-${this.timeStamp.getMonth()+1}-${this.timeStamp.getUTCDay()}`},minutes(){const e=[];for(let t=0;t<60;t++)t<10?e.push(`0${t}`):e.push(`${t}`);return e},hours(){const e=[];for(let t=1;t<=12;t++)t<10?e.push(`0${t}`):e.push(`${t}`);return e},dateFormat(){return this.format||"YYYY-MM-DD hh:mm:ss a"},hideTime(){return this.dateFormat.indexOf("hh:mm:ss")===-1},hideDate(){return this.dateFormat==="hh:mm:ss a"}},created(){let e=new Date;this.value&&(e=new Date(this.value),this.timeStamp=e),this.year=e.getFullYear(),this.monthIndex=e.getMonth(),this.day=e.getDate(),this.period=e.getHours()>=12?"PM":"AM",this.hour=e.getHours(),this.hour===0?this.hour+=12:this.hour>12&&(this.hour-=12),this.minute=e.getMinutes()||0,this.updateCalendar(),document.addEventListener("keydown",this.keyIsDown),document.addEventListener("click",this.documentClicked),this.setDate()},unmounted(){document.removeEventListener("keydown",this.keyIsDown),document.removeEventListener("click",this.documentClicked)},methods:{padZero(e){return s.padStart(e,2,"0")},display(){return this.timeStamp?K(this.timeStamp).format(this.dateFormat):""},leftMonth(){const e=this.months.indexOf(this.month);e===0?this.monthIndex=11:this.monthIndex=e-1,this.updateCalendar()},rightMonth(){const e=this.months.indexOf(this.month);e===11?this.monthIndex=0:this.monthIndex=e+1,this.updateCalendar()},rightYear(){this.year++,this.updateCalendar()},leftYear(){this.year--,this.updateCalendar()},updateCalendar(){const e=this,l=new Date(e.year,e.monthIndex,1,0,0,0).getDay(),o=new Date(e.year,e.monthIndex+1,0).getDate(),i=[];let r=35;(l===6||l===5&&o===31)&&(r=42);let a=!1;for(let d=0;d<r;d++){const c=d-l,g=c<0||c>=o?"":c+1;i.push(g),this.timeStamp&&g===e.day&&this.timeStamp.getMonth()===e.monthIndex&&this.timeStamp.getFullYear()===e.year&&(e.activePort=d,a=!0)}a||(e.activePort=-1),this.ports=i},setDay(e,t){t!==""&&(this.activePort=e,this.day=t,this.timeStamp=new Date(this.year,this.monthIndex,this.day),this.setDate(!0))},setMinute(e,t){this.minuteIndex=e,this.minute=e,t&&(this.minuteSelectorVisible=!1)},setHour(e,t){this.hourIndex=e,this.hour=e+1,t&&(this.hourSelectorVisible=!1)},showHourSelector(){this.hourSelectorVisible=!0,this.minuteSelectorVisible=!1},showMinuteSelector(){this.minuteSelectorVisible=!0,this.hourSelectorVisible=!1},keyIsDown(e){const t=e.which||e.keycode;t===38?this.minuteSelectorVisible&&this.minuteIndex>0?(this.setMinute(this.minuteIndex-1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex>0&&(this.setHour(this.hourIndex-1,!1),this.scrollTopHour()):t===40?this.minuteSelectorVisible&&this.minuteIndex<this.minutes.length-1?(this.setMinute(this.minuteIndex+1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex<this.hours.length-1&&(this.setHour(this.hourIndex+1,!1),this.scrollTopHour()):t===13&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),(this.minuteSelectorVisible||this.hourSelectorVisible)&&(e.preventDefault(),this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1)},scrollTopMinute(){const e=this.$refs.minuteScroller.scrollHeight,t=this.$refs.minuteScrollerWrapper.clientHeight,l=e*(this.minuteIndex/(this.minutes.length-1))-t/2;this.$refs.minuteScroller.scrollTop=l},scrollTopHour(){const e=this.$refs.hourScroller.scrollHeight,t=this.$refs.hourScrollerWrapper.clientHeight,l=e*(this.hourIndex/(this.hours.length-1))-t/2;this.$refs.hourScroller.scrollTop=l},changePeriod(){this.period=this.period==="AM"?"PM":"AM"},calendarClicked(e){e.target.id!=="j-hour"&&e.target.id!=="j-minute"&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},documentClicked(e){e.target.id!=="tj-datetime-input"&&(this.hideCal=!0)},toggleCal(){this.hideCal=!this.hideCal},clearDate(){this.timeStamp="",this.$emit("input",""),this.hideCal=!0},setDate(e){let t=this.hour;this.hour===12&&this.period==="AM"&&(t=t-12),this.hour!==12&&this.period==="PM"&&(t=t+12);const l=new Date(this.year||1970,this.monthIndex||0,this.day||1,t,this.minute,0);e&&(this.timeStamp=l,this.$emit("input",l.getTime()),this.hideCal=!0)}}},Yo=["value","name"],Wo={class:"year-month-wrapper"},Xo={class:"month-setter"},Qo={class:"year"},Zo={class:"month-setter"},Jo={class:"month"},ea={class:"headers"},ta=["onClick"],sa={class:"hour-selector"},ia={ref:"hourScroller"},la=["onClick"],ra=u("div",{class:"time-separator"},[u("span",null,":")],-1),oa={class:"minute-selector"},aa={ref:"minuteScroller"},na=["onClick"],ca=u("div",{class:"time-separator"},[u("span",null,":")],-1),da={class:"minute-selector"};function ua(e,t,l,o,i,r){return n(),m("div",{style:Qe({width:l.width}),class:"datetime-picker",onClick:t[11]||(t[11]=a=>r.calendarClicked(a))},[u("div",null,[u("input",{id:"tj-datetime-input",ref:"input",readonly:"",type:"text",value:r.display(),name:l.name,autocomplete:"off",onClick:t[0]||(t[0]=(...a)=>r.toggleCal&&r.toggleCal(...a))},null,8,Yo),u("div",{class:S(["calendar-div",{noDisplay:i.hideCal}])},[u("div",{class:S({noDisplay:r.hideDate})},[u("div",Wo,[u("div",Xo,[u("span",{type:"button",class:"nav-l",onClick:t[1]||(t[1]=(...a)=>r.leftYear&&r.leftYear(...a))},[p(L,null,{default:h(()=>[y("mdi-chevron-left")]),_:1})]),u("span",Qo,f(i.year),1),u("span",{type:"button",class:"nav-r",onClick:t[2]||(t[2]=(...a)=>r.rightYear&&r.rightYear(...a))},[p(L,null,{default:h(()=>[y("mdi-chevron-right")]),_:1})])]),u("div",Zo,[u("span",{type:"button",class:"nav-l",onClick:t[3]||(t[3]=(...a)=>r.leftMonth&&r.leftMonth(...a))},[p(L,null,{default:h(()=>[y("mdi-chevron-left")]),_:1})]),u("span",Jo,f(e.$filters.translate("TL_"+r.month.toUpperCase())),1),u("span",{type:"button",class:"nav-r",onClick:t[4]||(t[4]=(...a)=>r.rightMonth&&r.rightMonth(...a)),onMousedown:t[5]||(t[5]=E(()=>{},["stop","prevent"]))},[p(L,null,{default:h(()=>[y("mdi-chevron-right")]),_:1})],32)])]),u("div",ea,[(n(!0),m(I,null,D(i.days,(a,d)=>(n(),m("span",{key:d,class:"days"},f(e.$filters.translate("TL_"+a.toUpperCase())),1))),128))]),u("div",null,[(n(!0),m(I,null,D(r.ports,(a,d)=>(n(),m("span",{key:d,class:S(["port",{activePort:d===i.activePort}]),onClick:c=>r.setDay(d,a)},f(a),11,ta))),128))])],2),u("div",{class:S(["time-picker",{noDisplay:r.hideTime}])},[u("div",sa,[u("div",{id:"j-hour",onClick:t[6]||(t[6]=(...a)=>r.showHourSelector&&r.showHourSelector(...a))},f(r.padZero(i.hour)),1),u("div",{ref:"hourScrollerWrapper",class:S(["scroll-hider",{showSelector:i.hourSelectorVisible}])},[u("ul",ia,[(n(!0),m(I,null,D(r.hours,(a,d)=>(n(),m("li",{key:d,class:S({active:d==i.hourIndex}),onClick:c=>r.setHour(d,!0)},f(a),11,la))),128))],512)],2)]),ra,u("div",oa,[u("div",{id:"j-minute",onClick:t[7]||(t[7]=(...a)=>r.showMinuteSelector&&r.showMinuteSelector(...a))},f(r.padZero(i.minute)),1),u("div",{ref:"minuteScrollerWrapper",class:S(["scroll-hider",{showSelector:i.minuteSelectorVisible}])},[u("ul",aa,[(n(!0),m(I,null,D(r.minutes,(a,d)=>(n(),m("li",{key:d,class:S({active:d==i.minuteIndex}),onClick:c=>r.setMinute(d,!0)},f(a),11,na))),128))],512)],2)]),ca,u("div",da,[u("div",{onClick:t[8]||(t[8]=(...a)=>r.changePeriod&&r.changePeriod(...a))},f(e.$filters.translate("TL_"+i.period.toUpperCase())),1)])],2),u("span",{type:"button",class:"okButton",onClick:t[9]||(t[9]=a=>r.setDate(!0))},f(e.$filters.translate("TL_OK")),1),u("span",{type:"button",class:"okButton",onClick:t[10]||(t[10]=a=>r.clearDate())},f(e.$filters.translate("TL_CLEAR")),1)],2)])],4)}const ha=T(Ko,[["render",ua]]),ma={components:{datetime:ha},mixins:[P],props:["options","customDatetimePickerOptions"],data(){return{}},created(){this.schema.format=this.schema.format||"DD/MM/YYYY h:i:s"},methods:{onChangeData(e){s.set(this.model,this.schema.model,e),this.$emit("model-updated",e,this.schema.model);const t=this.schema.label;this.schema.label=null,this.schema.label=t},get:s.get}};function pa(e,t,l,o,i,r){const a=C("datetime");return n(),m("div",null,[p(a,{ref:"input",format:e.schema.format,value:r.get(e.model,e.schema.model),onInput:r.onChangeData},null,8,["format","value","onInput"])])}const ga=T(ma,[["render",pa]]),fa={mixins:[P],data(){return{objectValue:this.value,menuProps:{contentProps:{density:"compact"},attach:".v-application"}}},computed:{selectOptions(){return this.schema.selectOptions||{}},options(){let e=this.schema.values;return s.isFunction(e)?e.apply(this,[this.model,this.schema]):e}},methods:{getValue(e){const t=s.get(e,"raw",e);return s.get(t,"_id",s.get(t,"value",t))},customLabel(e){const t=s.get(e,"raw",e);return s.get(this.schema,"localised",!1)?s.get(t,"_id",!1)?s.get(t,s.first(s.without(s.keys(t),"_id")),t):s.get(this.schema,`options.labels.${t}.${this.schema.locale}`,!1)?s.get(this.schema,`options.labels.${t}.${this.schema.locale}`,t):s.get(t,"text",t):this.schema.selectOptions.customLabel(t)},getSelectOpt(e){return s.get(this.selectOptions,e,!1)},allOptionsSelected(){return s.get(this.options,"length",0)===s.get(this.objectValue||this.value,"length",0)},onChangeSelectAll(e){if(this.allOptionsSelected())this.objectValue=[];else{let l=s.compact(s.map(this.options,"value"));s.get(l,"length",0)===0&&(l=this.options),this.objectValue=l}this.value=this.objectValue,this.$emit("input",this.value,this.schema.model)},getLabel(){return this.disabled?"":s.isString(this.selectOptions.label)?this.selectOptions.label:this.schema.label},updateSelected(e){this.objectValue=e;const t=s.get(this.schema,"selectOptions.key",!1);t&&(e=s.isString(e)?e:s.get(e,t,e)),this.$emit("input",e,this.schema.model)},addTag(e,t){const l=this.selectOptions.onNewTag;typeof l=="function"&&l(e,t,this.options,this.objectValue)},onSearchChange(e,t){const l=this.selectOptions.onSearch;typeof l=="function"&&l(e,t,this.options)}}},ya={class:"multiselect-wrapper"};function va(e,t,l,o,i,r){const a=C("field-label");return n(),m("div",ya,[p(Xe,{id:r.selectOptions.id,ref:"input",theme:e.theme,chips:r.getSelectOpt("chips"),"menu-props":i.menuProps,"model-value":i.objectValue||e.value,items:r.options,"closable-chips":r.getSelectOpt("deletableChips")||r.getSelectOpt("multiple"),"hide-selected":r.getSelectOpt("hideSelected"),disabled:e.disabled||e.schema.disabled,placeholder:e.schema.placeholder,multiple:r.getSelectOpt("multiple"),ripple:!1,flat:e.get("flat"),"item-title":r.customLabel,"item-value":r.getValue,"menu-icon":"mdi-chevron-down",clearable:r.getSelectOpt("clearable"),variant:e.getVariant(),density:e.get("density"),rounded:"","hide-details":"","onUpdate:modelValue":r.updateSelected,onSearchChange:r.onSearchChange,onTag:r.addTag},{prepend:h(()=>[p(a,{schema:e.schema,label:r.getLabel()},null,8,["schema","label"]),e.schema.listBox?(n(),b(R,{key:0,variant:"tonal",size:"small",rounded:"",elevation:"0",onClick:r.onChangeSelectAll},{default:h(()=>[y(f(e.$filters.translate(r.allOptionsSelected()?"TL_DESELECT_ALL":"TL_SELECT_ALL")),1)]),_:1},8,["onClick"])):v("",!0)]),label:h(()=>[]),append:h(()=>[]),item:h(({props:d,item:c})=>[p(de,V({density:"compact"},d,{title:r.customLabel(c)}),null,16,["title"])]),_:1},8,["id","theme","chips","menu-props","model-value","items","closable-chips","hide-selected","disabled","placeholder","multiple","flat","item-title","item-value","clearable","variant","density","onUpdate:modelValue","onSearchChange","onTag"])])}const _a=T(fa,[["render",va]]),ba={mixins:[P],methods:{getType(){return s.get(this.schema,"inputFieldType","text")},validateField(e){return this.schema.required&&(s.isNull(e)||s.isUndefined(e)||e==="")?!1:this.schema.validator&&s.isFunction(this.schema.validator)?!!this.schema.validator(e,this.schema.model,this.model):!0}}};function Sa(e,t,l,o,i,r){const a=C("field-label");return n(),b(ye,{ref:"input",theme:e.theme,class:S([e.schema.labelClasses]),type:r.getType(),"model-value":e.value,"max-length":e.schema.max,"min-length":e.schema.min,autocomplete:"off","validate-on-submit":"",rules:[r.validateField],variant:e.getVariant(),flat:e.get("flat"),rounded:e.get("rounded"),density:e.get("density"),disabled:e.disabled,readonly:e.get("readonly"),"persistent-placeholder":"","hide-details":"","onUpdate:modelValue":e.onChangeData},{prepend:h(()=>[p(a,{schema:e.schema},null,8,["schema"])]),label:h(()=>[]),_:1},8,["theme","class","type","model-value","max-length","min-length","rules","variant","flat","rounded","density","disabled","readonly","onUpdate:modelValue"])}const wa=T(ba,[["render",Sa]]),ka={mixins:[P],methods:{getType(){return s.get(this.schema,"inputFieldType","text")}}},La={class:"custom-textarea"};function Ca(e,t,l,o,i,r){const a=C("field-label");return n(),m("div",La,[p(Lt,{ref:"input","multi-line":"",class:S([e.schema.labelClasses]),type:r.getType(),"model-value":e.value,"max-length":e.schema.max,"min-length":e.schema.min,density:e.get("density"),flat:e.get("flat"),disabled:!!e.schema.disabled,readonly:!!e.schema.readonly,"hide-details":"",variant:e.getVariant(),rounded:"get('rounded')","onUpdate:modelValue":e.onChangeData},{prepend:h(()=>[p(a,{schema:e.schema},null,8,["schema"])]),_:1},8,["class","type","model-value","max-length","min-length","density","flat","disabled","readonly","variant","onUpdate:modelValue"])])}const Ia=T(ka,[["render",Ca]]),Ta={mixins:[P],methods:{getValue(){const e=s.get(this.model,this.schema.model,!1);return s.isNull(e)?!1:e},onChange(){this.disabled||(this.value=!this.getValue(),this.$emit("input",this.value,this.schema.model))}}},Ra=e=>(ue("data-v-f128a681"),e=e(),he(),e),Ea=Ra(()=>u("div",{class:"drag"},null,-1)),Da={class:"labels"},$a={class:"label inactive"},Ma={class:"label active"};function Fa(e,t,l,o,i,r){const a=C("field-label");return n(),m("div",{class:S(["custom-checkbox",{disabled:e.schema.disabled}])},[p(a,{schema:e.schema},null,8,["schema"]),u("div",{ref:"input",class:S(["switch",{active:r.getValue()}]),onClick:t[0]||(t[0]=(...d)=>r.onChange&&r.onChange(...d))},[Ea,u("div",Da,[u("span",$a,f(e.$filters.translate("TL_NO")),1),u("span",Ma,f(e.$filters.translate("TL_YES")),1)])],2)],2)}const Aa=T(Ta,[["render",Fa],["__scopeId","data-v-f128a681"]]),Va={mixins:[P],methods:{getType(){return s.get(this.schema,"inputFieldType","text")},validateField(e){return this.schema.required&&(s.isNull(e)||s.isUndefined(e)||e==="")?!1:this.schema.validator&&s.isFunction(this.schema.validator)?!!this.schema.validator(e,this.schema.model,this.model):!0}}};function Oa(e,t,l,o,i,r){const a=C("field-label");return n(),b(Ct,{ref:"input",theme:e.theme,class:S([e.schema.labelClasses]),type:r.getType(),"model-value":e.value,"input-value":e.value,"max-length":e.schema.max,"min-length":e.schema.min,autocomplete:"off","validate-on-submit":"",rules:[r.validateField],"persistent-placeholder":"","hide-details":"",chips:"",multiple:"",variant:e.getVariant(),flat:e.get("flat"),rounded:e.get("rounded"),density:e.get("density"),disabled:e.disabled,readonly:e.get("readonly"),clearable:"","onUpdate:modelValue":e.onChangeData},{prepend:h(()=>[p(a,{schema:e.schema},null,8,["schema"])]),label:h(()=>[]),_:1},8,["theme","class","type","model-value","input-value","max-length","min-length","rules","variant","flat","rounded","density","disabled","readonly","onUpdate:modelValue"])}const Ua=T(Va,[["render",Oa]]),Na={mixins:[P],props:["groupOptions","paragraphLevel"],data(){return{errors:null}},methods:{onError(e){console.error("Group - onError:",e)},async validate(){const e=s.get(await this.$refs.input.validate(),"length",0)===0;if(!e)throw this.errors=this.$refs.input.errors,new Error("group validation error");return e},debouncedValidate(){return this.$refs.input.debouncedValidate()},clearValidationErrors(){return this.$refs.input.clearValidationErrors()},onModelUpdated(e,t){this.$emit("input",e,t)}}},Pa={class:"header"},Ba={class:"group-content"};function xa(e,t,l,o,i,r){const a=C("field-label"),d=C("custom-form");return n(),m("div",{class:S(`group nested-level-${l.paragraphLevel}`)},[u("div",Pa,[p(a,{schema:e.schema},null,8,["schema"])]),u("div",Ba,[p(d,{ref:"input",model:e.model,"onUpdate:model":t[0]||(t[0]=c=>e.model=c),schema:e.schema.groupOptions,"paragraph-level":l.paragraphLevel+1,onError:r.onError,onInput:r.onModelUpdated},null,8,["model","schema","paragraph-level","onError","onInput"])])],2)}const Ha=T(Na,[["render",xa],["__scopeId","data-v-8b34f79b"]]),qa={install(e,t){this.params=t,e.config.globalProperties.$loading=Ve}};function za(e,t,l){return k.get(e,t,l)}function ja(e,t){return s.isString(t)?(s.includes(t,"n")&&console.warn("Truncate - should truncate the text by number of items"),s.truncate(e,{length:s.toNumber(t)})):s.truncate(e,{length:t})}const Ga=nt({history:ct(),routes:[{path:"/",component:Me}]}),ce=$t({render:()=>{const e=document.querySelector("#app");return e?Pe(e.getAttribute("type")==="login"?Ji:Me):Pe(Me)}});window.nodeCms=ce;ce.config.globalProperties.$filters={translate:za,truncate:ja};ce.use(Ga).use(Pt).component("CustomForm",al).component("FieldLabel",br).component("AttachmentView",Bo).component("ImageView",Lo).component("CustomInput",wa).component("CustomTextarea",Ia).component("CustomCheckbox",Aa).component("ParagraphAttachmentView",Go).component("ParagraphView",oo).component("CustomTreeView",Lr).component("CustomCode",Er).component("ColorPicker",Fr).component("JsonEditor",Ur).component("WysiwygField",Wr).component("CustomDatetimePicker",ga).component("Group",Ha).component("CustomInputTag",Ua).component("CustomMultiSelect",_a).component("PluginPage",ul).component("Syslog",Ll).component("CmsImport",zl).component("SyncResource",dr).component("Draggable",dt).use(ut).use(qa).use(ht).use(mt,{prevent:["input","textarea"]});function Ie(e,t,l="System",o=["admins","imagination"]){window.plugins=window.plugins||[],window.plugins.push({title:e,displayname:t,component:e,group:l,allowed:o,type:"plugin"})}window.addEventListener("load",async function(){s.each(window.plugins,l=>{l.type="plugin"}),window.TranslateService=k;const t=(await N.get(`${window.location.pathname}config`)).data;Ie("Syslog","Syslog"),t.import&&Ie("CmsImport","Cms Import"),t.sync&&!t.sync.disablePlugin&&Ie("SyncResource","Sync Resource"),window.disableJwtLogin=s.get(t,"disableJwtLogin",!1),window.noLogin=window.disableJwtLogin&&s.get(t,"disableAuthentication",!1),ce.mount("#app"),window.nodeCms=ce});window.Vue=rt;
