import{c as Ye,a as ze,d as We,_ as s,E as we,b as x,e as A,f as D,o as h,g as f,h as a,F as C,r as V,n as w,t as g,i as _,j as Xe,k as Y,l as Qe,m as L,w as m,p,V as O,q as X,s as R,u as y,v as Ae,x as ee,y as me,z as ne,A as ae,B as Te,C as Le,D as q,G as Ze,H as Re,I as ce,J as de,K as ue,L as Q,M as Ve,N as T,O as Je,P as Ie,Q as et,R as _e,S as Fe,T as tt,U as Ue,W as B,X as st,Y as it,Z as lt,$ as rt,a0 as te,a1 as Ne,a2 as ot,a3 as nt,a4 as at,a5 as ye,a6 as ct,a7 as $e,a8 as dt,a9 as ut,aa as ht,ab as mt,ac as b,ad as ft,ae as pt,af as gt,ag as _t,ah as yt,ai as vt,aj as bt,ak as Ee}from"./vendor-69432236.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function l(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=l(i);fetch(i.href,r)}})();const St=Ye({components:ze,directives:We,theme:{themes:{light:{primary:"#00095B","node-cms-black":"#00142E","node-cms-blue":"#00095B","node-cms-grabber":"#1700F4","node-cms-twilight":"#00142E","node-cms-grey":"#AFAFAF","node-cms-light-grey":"#DBDBDB","node-cms-light-white-grey":"#EDEDED","node-cms-off-white":"#F6F6F6","node-cms-red":"#C90000"},dark:{primary:"#00142E","node-cms-black":"#00142E","node-cms-blue":"00142E","node-cms-grabber":"00142E","node-cms-twilight":"00142E","node-cms-grey":"00142E","node-cms-light-grey":"00142E","node-cms-light-white-grey":"00142E","node-cms-off-white":"00142E","node-cms-red":"00142E"}}},icons:{iconfont:"mdi"}});class wt{constructor(){this.isShow=!1,this.list=[]}start(t){this.isShow=!0,this.list=s.union(this.list,[t])}stop(t){this.list=s.difference(this.list,[t]),s.isEmpty(this.list)&&(this.isShow=!1)}}const Ce=new wt;class Lt{constructor(){this.events=new we}send(t,l="success"){this.events.emit("notification",{message:t,type:l})}sendOmnibarDisplayStatus(t){this.events.emit("omnibar-display-status",t)}}const Z=new Lt;class Rt{constructor(){this.user=null,this.logoutCallbackList=[]}init(){console.info("LoginService - init"),setInterval(async()=>{this.checkStatus()},1e3*15)}async getStatus(){try{const{data:t}=await x.get(`${window.location.pathname}login`);return this.user=t,t}catch{return null}}async checkStatus(){let t;const l=s.cloneDeep(this.user);try{t=await this.getStatus()}catch{}s.isEmpty(t)&&!s.isEmpty(l)&&(console.info("will logout"),await this.logout())}async changeTheme(t){try{const l=s.get(this.user,"theme","dark")==="dark"?"light":"dark";return await x.get(`${window.location.pathname}changeTheme/${l}`),console.warn("Successfully changed the theme for user"),s.set(this.user,"theme",l),l}catch(l){console.error("Failed to change theme: ",l)}}async logout(){this.user=null;try{await x.get(`${window.location.pathname}logout`),window.location.reload()}catch(t){console.error("Failed to logout: ",t)}s.each(this.logoutCallbackList,t=>{t()})}onLogout(t){this.logoutCallbackList.push(t)}checkPermission(t){return s.includes(this.user.group.modules,t)}}const j=new Rt;class Ct{constructor(){this.config={}}async init(){try{const{data:t}=await A.get(`${window.location.pathname}config`);this.config=t}catch(t){console.error("Error during init of ConfigService:",t)}}}const J=new Ct;let kt=class{constructor(){this.dict={},this.locale="enUS"}async init(){const{data:t}=await A.get(`${window.location.pathname}i18n/config.json`);this.config=s.get(t,"config.language",{defaultLocale:"enUS",locales:["enUS"]}),this.locale=s.get(this.config,"defaultLocale","enUS");for(const l of this.config.locales)try{const{data:o}=await A.get(`${window.location.pathname}i18n/${l}.json`);this.dict[l]=o}catch(o){console.warn(`TranslateService wasn't able to pull ${l}: `,o)}}setLocale(t){this.locale=t}get(t,l,o){if(s.isString(t)){const i=this.dict[l||this.locale]&&this.dict[l||this.locale][t];return i?s.template(i)(o):t}return s.isEmpty(t)?"":t[l||this.locale]||""}};const S=new kt;class Tt{constructor(){this.cacheMap={}}async cache(t){const{data:l}=await A.get(`${window.location.pathname}../api/${t}`);return s.get(l,"userLoggedOut",!1)?(console.info("Received userLoggedOut from server, will redirect to login page"),window.location.reload(),[]):(this.cacheMap[t]=l,this.get(t))}get(t){const l=this.cacheMap[t];return s.isUndefined(l)&&console.info(`resource (${t}) is not cached`),l}setSchemas(t){this.schemas=t}getSchema(t){return s.find(this.schemas,{title:t})}}const $=new Tt,K={data(){return{}},mounted(){},methods:{notify(e,t="success"){s.get(console,t,console.info)(e),Z.send(e,t)},sendOmnibarDisplayStatus(e){Z.sendOmnibarDisplayStatus(e)}}},It={},Et={class:"showbox active"},xt=a("div",{class:"loader"},[a("svg",{class:"circular",viewBox:"25 25 50 50"},[a("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none","stroke-width":"2","stroke-miterlimit":"10"})])],-1),Dt=[xt];function Mt(e,t){return h(),f("div",Et,Dt)}const Pe=D(It,[["render",Mt]]),Ot={props:{localeList:{type:Array,default:()=>[]}},data(){return{TranslateService:S}},methods:{select(e){S.setLocale(e)}}},At={key:0,class:"locale-list"},Vt=["onClick"];function Ft(e,t,l,o,i,r){return l.localeList&&l.localeList.length>1?(h(),f("div",At,[(h(!0),f(C,null,V(l.localeList,(n,c)=>(h(),f("div",{key:c,class:w(["locale",{active:i.TranslateService.locale==n}]),onClick:d=>r.select(n)},g("TL_"+n.toUpperCase()|e.translate),11,Vt))),128))])):_("",!0)}const Ut=D(Ot,[["render",Ft]]);class Nt{constructor(){Xe(this),this.events=new we,this.connection=null,this.clientID=0,this.isConnecting=!1,this.isConnected=!1,this.connecting=!1,this.serverUrl=!1}async init(t){this.serverUrl=`ws://${window.location.hostname}:${s.get(t,"webserver.port",9090)}`,this.connect()}connect(){clearTimeout(this.connecting),!this.isConnecting&&(this.isConnecting=!0,this.isConnected=!1,this.events.emit("connected",!1),setTimeout(()=>{this.client=new WebSocket(this.serverUrl,"json"),console.info(`Created websocket client for ${this.serverUrl}`),this.client.onopen=this.onOpen,this.client.onclose=this.onClose,this.client.onmessage=this.onMessage},150))}onClose(t){console.info("Websocket - onClose",t),this.isConnecting=!1,this.isConnected=!1,this.events.emit("connected",!1),clearTimeout(this.heatbeat),clearTimeout(this.connecting),this.connecting=setTimeout(async()=>{await this.connect()},500)}onOpen(t){this.onHeartbeat(),this.isConnecting=!1,this.isConnected=!0,this.events.emit("connected",!0)}onMessage(t){const l=JSON.parse(t.data),o=s.get(l,"action","??");if(o==="ping")return this.pong();this.events.emit(o,s.get(l,"data",{}))}pong(){this.send({action:"pong",bearer:"9-0123456789"}),this.onHeartbeat()}send(t){try{this.client&&this.client.send(JSON.stringify(t))}catch(l){console.error("WebSocket::send: Error:",l)}}onHeartbeat(){clearTimeout(this.heatbeat),this.heatbeat=setTimeout(()=>{this.client.close()},3e4+5e3)}}const W=new Nt;Y.extend(Qe);const $t={props:{config:{type:[Object,Boolean],default:!1},settingsData:{type:[Object,Boolean],default:!1}},data(){return{TranslateService:S,destroyed:!1,type:null,timer:null,system:{cpu:{count:0,usage:0,model:"Unknown"},memory:{totalMemMb:0,usedMemMb:0,freeMemMb:0,freeMemPercentage:0},network:"not supported",drive:"not supported",uptime:0}}},computed:{showLogoutButton(){return!s.get(window,"disableJwtLogin",!1)}},async mounted(){W.events.on("getSystemInfo",e=>{this.system=e,this.$forceUpdate()}),await W.init(this.config),this.getSystemData()},unmounted(){this.destroyed=!0,clearTimeout(this.timer)},methods:{isActiveLink(e){const t=new URL(window.location),l=new URL(e);return t.host===l.host},getTheme(){return s.get(j,"user.theme","light")==="dark"},async onChangeTheme(){const e=s.get(j,"user.theme","light")==="light"?"dark":"light";this.$vuetify.theme.dark=await j.changeTheme(e)==="dark"},async logout(){await j.logout()},async getSystemData(){try{W.send({action:"getSystemInfo"})}catch(e){console.error(e)}this.destroyed||(this.timer=setTimeout(this.getSystemData,this.error?1e4:5e3))},select(e){this.$emit("selectItem",e)},timeAgo(e){return Y().subtract(parseInt(e,10),"second").fromNow()},convertBytes(e){const t=["MB","GB","TB"];if(e===0)return"0 MB";if(Math.log(e)<=0)return`${e.toFixed(1)} MB`;const l=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return l<=0?e+" "+t[l]:(e/Math.pow(1024,l)).toFixed(1)+" "+t[l]}}},le=e=>(ne("data-v-ec236a69"),e=e(),ae(),e),Pt={class:"system-info"},Bt={class:"links-wrapper"},qt={class:"node-cms-title"},Ht=["href"],Gt={class:"system-info-wrapper"},jt={class:"node-cms-title flex"},Kt={class:"stats cpu"},Yt=le(()=>a("div",{class:"node-cms-title"},[a("small",null,[a("b",null,"CPU Usage")])],-1)),zt={class:"text"},Wt={class:"stats ram"},Xt=le(()=>a("div",{class:"node-cms-title"},[a("small",null,[a("b",null,"Memory Usage")])],-1)),Qt={class:"text"},Zt={key:0,class:"stats drive"},Jt=le(()=>a("div",{class:"node-cms-title"},[a("small",null,[a("b",null,"Disk Usage")])],-1)),es={class:"text"},ts={class:"stats two-by-two"},ss={key:0,class:"stats network"},is=le(()=>a("div",{class:"node-cms-title"},[a("small",null,[a("b",null,"Network Usage")])],-1)),ls={class:"text"},rs={class:"stats uptime"},os={class:"node-cms-title"},ns=le(()=>a("small",null,[a("b",null,"Uptime:")],-1)),as={class:"text"};function cs(e,t,l,o,i,r){return h(),f("div",Pt,[l.settingsData&&l.settingsData.linksGroups&&l.settingsData.linksGroups.length>0?(h(),L(ee,{key:0,"content-class":"links-menu","offset-y":"","close-on-content-click":!1,"nudge-bottom":"5px",transition:"slide-y-transition"},{activator:m(({props:n})=>[p(O,X({icon:""},n),{default:m(()=>[p(R,null,{default:m(()=>[y("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:m(()=>[a("div",Bt,[(h(!0),f(C,null,V(l.settingsData.linksGroups,(n,c)=>(h(),f("div",{key:c,class:"group"},[a("div",qt,g(n.value.title),1),(h(!0),f(C,null,V(n.value.links,(d,u)=>(h(),f("a",{key:u,class:w(["link",{active:r.isActiveLink(d.value.url)}]),href:d.value.url},g(d.value.name),11,Ht))),128)),c<l.settingsData.linksGroups.length-1?(h(),L(Ae,{key:0})):_("",!0)]))),128))])]),_:1})):_("",!0),p(ee,{"content-class":"system-info-menu","offset-y":"","close-on-content-click":!1,"nudge-bottom":"5px",transition:"slide-y-transition"},{activator:m(({props:n})=>[p(O,X({icon:""},n),{default:m(()=>[p(R,null,{default:m(()=>[y("mdi-cog-outline")]),_:1})]),_:2},1040)]),default:m(()=>[a("div",Gt,[a("div",jt,[a("span",null,g(e.$filters.translate("TL_SYSTEM")),1),a("div",{class:"theme-switch",onClick:t[0]||(t[0]=n=>r.onChangeTheme())},[p(R,{class:w({selected:!r.getTheme()})},{default:m(()=>[y("mdi-weather-sunny")]),_:1},8,["class"]),p(R,{class:w({selected:r.getTheme()})},{default:m(()=>[y("mdi-weather-night")]),_:1},8,["class"])])]),a("div",Kt,[Yt,p(me,{rounded:"","model-value":i.system.cpu.usage},null,8,["model-value"]),a("small",zt,g(i.system.cpu.count)+" cores ("+g(i.system.cpu.model)+")",1)]),a("div",Wt,[Xt,p(me,{rounded:"","model-value":100-i.system.memory.freeMemPercentage},null,8,["model-value"]),a("small",Qt,g(r.convertBytes(i.system.memory.usedMemMb))+" / "+g(r.convertBytes(i.system.memory.totalMemMb)),1)]),i.system.drive!="not supported"?(h(),f("div",Zt,[Jt,p(me,{rounded:"","model-value":100-i.system.drive.usedPercentage},null,8,["model-value"]),a("small",es,g(r.convertBytes(i.system.drive.usedGb*1024))+" / "+g(r.convertBytes(i.system.drive.totalGb*1024)),1)])):_("",!0),a("div",ts,[i.system.network!="not supported"?(h(),f("div",ss,[is,a("small",ls,[y(g(r.convertBytes(i.system.network.total.outputMb))+" ",1),p(R,null,{default:m(()=>[y("mdi-arrow-up")]),_:1}),y(" / "+g(r.convertBytes(i.system.network.total.inputMb))+" ",1),p(R,null,{default:m(()=>[y("mdi-arrow-down")]),_:1})])])):_("",!0),a("div",rs,[a("div",os,[ns,y(),a("small",as,g(r.timeAgo(i.system.uptime)),1)])])])])]),_:1}),r.showLogoutButton?(h(),L(O,{key:1,icon:"",onClick:t[1]||(t[1]=n=>r.logout())},{default:m(()=>[p(R,null,{default:m(()=>[y("mdi-logout")]),_:1})]),_:1})):_("",!0)])}const ds=D($t,[["render",cs],["__scopeId","data-v-ec236a69"]]);class us{constructor(){this.events=new we}select(t){this.events.emit("select",t)}}const ve=new us;const hs={mixins:[K],props:{selectResourceCallback:{type:Function,default:()=>{}},groupedList:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},data(){return{showOmnibar:!1,search:null,scrolledToBottom:!1,resourcesList:[],results:[],highlightedItem:0,searchModes:["all","resource","field"],searchMode:"all",shortcutsWhenClosed:{open:["ctrl","p"]},shortcuts:{esc:["esc"],open:["ctrl","p"],"arrow-up":["arrowup"],"arrow-down":["arrowdown"],enter:["enter"],all:["shift","a"],resource:["shift","r"],field:["shift","f"]},searchOptions:{keys:["displayname"],scoreFn:e=>e[0]?e[0].score+(this.isResultInCurrentResource(e)?1e7:0):-1e7}}},watch:{search(){this.highlightedItem=0,this.results=[];const e=Te.go(this.search,this.getDataForSearch(),this.searchOptions);this.results=s.compact(s.map(e,(t,l)=>s.isNull(s.get(t,"[0]",null))?!1:(t.obj.html=Te.highlight(t[0]),t.obj.score=t.score,t.obj)))}},mounted(){this.resourcesList=s.map(s.flatten(s.map(this.groupedList,"list")),e=>(e.type="resource",e.displayname=s.get(e,"displayname.enUS",s.get(e,"displayname",e.title)),e)),this.fieldsList=s.flatten(s.map(this.resourcesList,e=>s.map(e.schema,t=>(t.resource=e,t.displayname=`${e.displayname}.${s.get(t,"label.enUS",s.get(t,"label",t.field))}`,t.type="field",t))))},methods:{onScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:l}}){this.scrolledToBottom=e+t>=l-50},isResultInCurrentResource(e){return s.startsWith(s.get(e[0],"target",""),s.get(this.selectedItem,"displayname",""))},getDataForSearch(){return this.searchMode==="all"?s.concat(this.resourcesList,this.fieldsList):this.searchMode==="resource"?this.resourcesList:this.fieldsList},getIconForResult(e){return this.getIcon(this.searchMode==="all"?e.type:this.searchMode)},getIcon(e){return`mdi-${e==="resource"?"package":"cursor-text"}`},isCharHighlighted(e,t){return s.includes(s.values(e._indexes),t)},showHideOmnibar(e){this.showOmnibar=e,this.setSearchMode("all"),e&&this.$nextTick(()=>{s.get(this.$refs,"['search']",!1).focus()}),this.sendOmnibarDisplayStatus(e)},selectResult(e=-1){const t=s.get(this.results,`[${e===-1?this.highlightedItem:e}]`,!1);if(!t)return;const l=s.includes(["resource","plugin"],t.type)?t:t.resource;l!==this.selectedItem?(console.info(`Switching to resource ${l.title}`),this.selectResourceCallback(l)):t.type==="field"&&ve.events.emit("select",s.omit(t,"resource")),this.showHideOmnibar(!1)},setSearchMode(e){this.searchMode=e,this.search=""},scrollToResult(e){const t=document.getElementById(`result-${this.highlightedItem}`);t&&t.scrollIntoView()},async interactiveSearch(e){const t=s.get(e,"srcKey",!1);if(t){if(!this.showOmnibar){t==="open"&&this.showHideOmnibar(!0);return}t==="esc"||t==="open"?this.showHideOmnibar(!1):t==="arrow-up"?(this.highlightedItem-1>=0?this.highlightedItem-=1:this.highlightedItem=0,this.scrollToResult()):t==="arrow-down"?(this.highlightedItem+1<=this.results.length-1?this.highlightedItem+=1:this.highlightedItem=this.results.length-1,this.scrollToResult()):t==="enter"?this.selectResult():s.includes(this.searchModes,t)&&this.setSearchMode(t)}}}},ms=["innerHTML"];function fs(e,t,l,o,i,r){const n=Le("shortkey");return q((h(),f("div",{id:"omnibar",onShortkey:t[3]||(t[3]=(...c)=>r.interactiveSearch&&r.interactiveSearch(...c))},[a("div",{id:"omnibar-backdrop",class:w({displayed:i.showOmnibar}),onClick:t[0]||(t[0]=c=>r.showHideOmnibar(!1))},null,2),q(p(Q,{elevation:"24"},{default:m(()=>[p(Ze,{class:"search"},{default:m(()=>[p(Re,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=c=>i.search=c),class:"search-bar",flat:"",variant:"filled",rounded:"","hide-details":"","prepend-inner-icon":"mdi-magnify",density:"compact",placeholder:e.$filters.translate("TL_INSERT_KEYWORDS"),type:"text",autocomplete:"off",name:"search",prefix:i.searchMode==="all"?"":`${i.searchMode}:`},null,8,["modelValue","placeholder","prefix"])]),_:1}),i.results&&i.results.length>0?(h(),f(C,{key:0},[p(Ae),a("div",{ref:"scrollWrapper",class:w(["scroll-wrapper",{"scrolled-to-bottom":i.scrolledToBottom||i.results.length<20}]),onScroll:t[2]||(t[2]=(...c)=>r.onScroll&&r.onScroll(...c))},[p(ce,{density:"compact"},{default:m(()=>[(h(!0),f(C,null,V(i.results,(c,d)=>(h(),L(de,{id:"result-"+d,key:d,class:w(["list",{highlighted:i.highlightedItem===d}]),ripple:!1,onClick:u=>r.selectResult(d)},{default:m(()=>[p(ue,null,{default:m(()=>[p(R,{size:"small"},{default:m(()=>[y(g(r.getIconForResult(c)),1)]),_:2},1024),a("span",{innerHTML:c.html},null,8,ms)]),_:2},1024)]),_:2},1032,["id","class","onClick"]))),128))]),_:1})],34)],64)):_("",!0)]),_:1},512),[[Ve,i.showOmnibar]])],32)),[[n,i.showOmnibar?i.shortcuts:i.shortcutsWhenClosed]])}const ps=D(hs,[["render",fs]]);const gs={components:{Omnibar:ps},props:{selectResourceCallback:{type:Function,default:()=>{}},groupedList:{type:Array,default:()=>[]},selectedItem:{type:Object,default:()=>{}}},async mounted(){await this.$nextTick(),s.isEmpty(this.selectedItem)&&this.selectResourceCallback(s.first(s.get(s.first(this.groupedList),"list",[])))},methods:{getResourceTitle(e){return e.displayname?S.get(e.displayname):e.title},groupSelected(e){if(!this.selectedItem)return!1;const t=s.get(this.selectedItem,"group.enUS",s.get(this.selectedItem,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t}}},_s={key:0,class:"resources-content"},ys={class:"resource-list"};function vs(e,t,l,o,i,r){const n=T("omnibar");return l.groupedList?(h(),f("div",_s,[p(n,{"select-resource-callback":l.selectResourceCallback,"grouped-list":l.groupedList,"selected-item":l.selectedItem},null,8,["select-resource-callback","grouped-list","selected-item"]),a("div",ys,[(h(!0),f(C,null,V(l.groupedList,(c,d)=>(h(),f("div",{key:`resource-group-${d}`,class:"resource"},[p(ee,{auto:"","open-on-hover":"","offset-y":"","close-on-content-click":!1,"content-class":"resources-menu"},{activator:m(({props:u})=>[a("div",X({class:"menu-btn-wrapper"},u),[p(O,{variant:r.groupSelected(c)?"text":"outlined",rounded:"",size:"small",class:w({selected:r.groupSelected(c)})},{default:m(()=>[y(g(e.$filters.translate(c.name)),1)]),_:2},1032,["variant","class"])],16)]),default:m(()=>[p(ce,{rounded:""},{default:m(()=>[(h(!0),f(C,null,V(c.list,u=>(h(),L(de,{key:u.name,density:"compact",class:w({selected:l.selectedItem===u}),onClick:v=>l.selectResourceCallback(u)},{default:m(()=>[p(ue,null,{default:m(()=>[y(g(r.getResourceTitle(u)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024)]))),128))])])):_("",!0)}const bs=D(gs,[["render",vs],["__scopeId","data-v-07f57689"]]),Ss=""+new URL("logo-3832edb8.svg",import.meta.url).href;const ws={components:{SystemInfo:ds,ResourceList:bs},props:{toolbarTitle:{type:[String,Boolean],default:!1},groupedList:{type:Array,default:()=>[]},config:{type:[Object,Boolean],default:!1},localeClass:{type:Object,default:()=>{}},selectResourceCallback:{type:Function,default:()=>{}},selectedItem:{type:Object,default:()=>{}}},data(){return{settingsData:!1}},mounted(){this.getSettingsData()},methods:{getDefaultLogo(){return Ss},getLogo(){const e=s.find(s.get(this.settingsData,"_attachments",[]),{_name:"logo"});return s.isUndefined(e)?!1:s.get(e,"url","")},hasLogoOrTitle(){return this.getLogo()||s.get(this.settingsData,"title",!1)},async getSettingsData(){try{this.settingsData=s.first(await $.cache("_settings"))}catch(e){console.error(e)}},getSelectedItemName(){return s.get(this.selectedItem,"displayname",!1)?S.get(this.selectedItem.displayname):s.get(this.selectedItem,"name",!1)}}},Ls={class:"nav-bar-wrapper"},Rs=["src"],Cs=["src"];function ks(e,t,l,o,i,r){const n=T("resource-list"),c=T("system-info");return h(),f("div",Ls,[p(et,{class:w(["nav-bar",l.localeClass]),height:"58"},{default:m(()=>[p(Je,null,{default:m(()=>[i.settingsData&&r.hasLogoOrTitle()?(h(),f(C,{key:0},[r.getLogo()?(h(),f("img",{key:0,src:r.getLogo(),class:"logo"},null,8,Rs)):i.settingsData.title&&i.settingsData.title.length>0?(h(),f(C,{key:1},[y(g(i.settingsData.title),1)],64)):_("",!0)],64)):(h(),f("img",{key:1,src:r.getDefaultLogo(),class:"logo"},null,8,Cs))]),_:1}),p(Ie),p(n,{"select-resource-callback":l.selectResourceCallback,"grouped-list":l.groupedList,"selected-item":l.selectedItem},null,8,["select-resource-callback","grouped-list","selected-item"]),p(Ie),l.config?(h(),L(c,{key:0,config:l.config,"settings-data":i.settingsData},null,8,["config","settings-data"])):_("",!0)]),_:1},8,["class"])])}const Ts=D(ws,[["render",ks]]),Be={methods:{getName(e){return this.getValue(e,s.first(this.resource.schema),this.resource.displayItem)},getValue(e,t,l){let o="";if(t){if(t.input==="file"){const i=s(e).get("_attachments",[]).find(r=>r._name===t.field);o=i&&i._filename}else if(t.input==="select"){let i=s.get(e,t.field);s.isString(i)&&(i=s.find($.get(t.source),{_id:i}),i&&s.each(t.options&&t.options.extraSources,(r,n)=>{const c=s.get(i,n);s.isString(c)&&s.set(i,n,s.find($.get(r),{_id:c}))})),t.options&&t.options.customLabel?o=_e.render(t.options.customLabel,i||{}):o=s.get(i,s.chain(i).keys().first().value(),"")}o===""&&(this.resource.locales&&(t.localised||s.isUndefined(t.localised))?o=s.get(e,`${this.locale}.${t.field}`):o=s.get(e,t.field))}if(l){const i=s.clone(e);s.each(this.getExtraRessources(),(r,n)=>{const c=$.get(r);if(c){const d=s.find(c,{_id:s.get(i,n)});d&&s.set(i,n,d)}}),o=_e.render(l,i)}return o},getExtraRessources(){return s.extend(s.get(this.resource,"extraSources",{}),s.get(this.resource,"schema[0].options.extraSources"))}}},Is={mixins:[K,Be],props:{list:{type:[Array,Boolean],default:()=>[]},resource:{type:[Object,Boolean],default:()=>{}},groupedList:{type:[Array,Boolean],default:()=>[]},resourceGroup:{type:[Object,Boolean],default:()=>{}},selectedItem:{type:Object,default:()=>{}},selectResourceCallback:{type:Function,default:()=>{}},updateRecordList:{type:Function,default:()=>{}},locale:{type:String,default:"enUS"},multiselect:{type:Boolean,default:!1},multiselectItems:{type:[Array,Boolean],default:()=>[]}},data(){return{lastSelectedItem:!1,menuOpened:!1,search:null,TranslateService:S,omnibarDisplayed:!1,sift:{isQuery:!1,isValid:!1},query:{},localMultiselectItems:[]}},computed:{selectedResourceGroup(){return s.find(this.groupedList,e=>this.groupSelected(e))},maxCount(){return s.get(this.resource,"maxCount",0)},listCount(){return s.get(this.list,"length",0)},filteredList(){let e=this.getSearchableFields();return e.length===0&&(e=[s.first(this.resource.schema)]),s.forEach(this.list,t=>t._searchable={id:!1,keyFields:!1,query:!1}),this.sift.isQuery?s.forEach(this.list.filter(Fe(this.query)),t=>t._searchable.query=!0):s.filter(this.list,t=>{if(s.isEmpty(this.search))return!0;const l=[];s.forEach(e,n=>{l.push(this.getValue(t,n,this.resource.displayItem))});let o=0,i=0;for(const n in this.query){const c=this.query[n];o=o+1;let d=s.get(t,n);s.isUndefined(d)===!1&&(s.isArray(d)?s.includes(d,c)&&(i=i+1):d===c&&(i=i+1))}let r=!1;return o>0&&o===i?(r=!0,t._searchable.query=!0):this.doesMatch(this.search,l)?(r=!0,t._searchable.keyFields=!0):new RegExp(this.search,"i").test(t._id)&&(r=!0,t._searchable.id=!0),r})}},watch:{selectedResourceGroup(){this.search=""},search(){this.query=this.flatten(tt.parse(this.search)),this.sift.isQuery=!1;try{this.search.search("sift:")===0&&(this.sift.isQuery=!0,this.query=Ue.parse(this.search.substr(5)),this.sift.isValid=!0)}catch{this.sift.isValid=!1,this.query={}}},multiselectItems(){this.localMultiselectItems=s.cloneDeep(this.multiselectItems)}},mounted(){Z.events.on("omnibar-display-status",this.onGetOmnibarDisplayStatus)},methods:{onGetOmnibarDisplayStatus(e){this.omnibarDisplayed=e},getShortcuts(){return this.omnibarDisplayed?{}:{esc:["esc"],open:["ctrl","/"]}},getSelectedRecordIds(){return s.map(this.localMultiselectItems,"_id")},allRecordsSelected(){const e=this.getSelectedRecordIds();return s.get(s.filter(this.filteredList,t=>!s.includes(e,t._id)),"length",0)===0},onClickSelectAll(){const e=this.getSelectedRecordIds();s.each(this.filteredList,t=>{s.includes(e,t._id)||this.localMultiselectItems.push(t)}),this.$emit("changeMultiselectItems",this.localMultiselectItems)},onClickDeselectAll(){this.$emit("changeMultiselectItems",[])},toggleViewMode(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!this.multiselect)},isCreatingNewRecord(){return this.selectedItem&&!s.get(this.selectedItem,"_id",!1)},copyIdToClipboard(e){navigator.clipboard.writeText(e)},hasEditableRecords(){return s.get(s.filter(this.filteredList,e=>s.get(e,"_local",!1)),"length",0)!==0},isItemSelected(e){return this.multiselect?s.includes(s.map(this.localMultiselectItems,"_id"),e._id):e===this.selectedItem||s.includes(s.map(this.localMultiselectItems,"_id"),e._id)},getTypePrefix(e){let t="TL_ERROR_ON_RECORD_";return e==="create"?t+="CREATION":e==="update"?t+="UPDATE":e==="delete"&&(t+="DELETE"),t?S.get(t):"Error"},manageError(e,t,l){let o=this.getTypePrefix(t),i=o;if(s.get(e,"response.data.code",500)===400){const r=s.get(e,"response.data");s.get(r,"message",!1)?i=`${o}: ${r.message}`:i=`${o}: ${S.get("TL_UNKNOWN_ERROR")}`}console.error(i,l),this.notify(i,"error")},groupSelected(e){if(!this.resource)return!1;const t=s.get(this.resource,"group.enUS",s.get(this.resource,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t},getResourceTitle(e){return e?e.displayname?S.get(e.displayname):e.title:""},selectAll(){this.localMultiselectItems.length===this.filteredList.length?this.localMultiselectItems=[]:this.localMultiselectItems=this.filteredList,this.$emit("changeMultiselectItems",this.localMultiselectItems)},dive(e,t,l){for(let o in t)if(o in t){let i=o,r=t[o];e.length>0&&(i=e+"."+o),typeof r=="object"?this.dive(i,r,l):l[i]=r}},flatten(e){let t={};return this.dive("",e,t),t},async interactiveSearch(e){const t=s.get(e,"srcKey",!1),l=s.get(this.$refs,"['search']",!1);if(!(!t||!l))return t==="esc"?l.blur():l.focus()},select(e,t=!1){if(!e._local)return this.$emit("selectItem",e);if(this.lastSelectedItem=e._id,!t)this.localMultiselectItems=[e],this.$emit("selectItem",e);else{if(this.selectedItem&&this.selectedItem._id===e._id)return;this.isItemSelected(e)?this.localMultiselectItems=s.filter(this.localMultiselectItems,l=>l._id!==e._id):this.localMultiselectItems.push(e)}this.$emit("changeMultiselectItems",this.localMultiselectItems)},checkIndex(e){return e+1<=this.filteredList.length?e+1:-1},selectTo(e,t=!1){if(!this.multiselect)return;if(t||e._id===this.lastSelectedItem)return s.isUndefined(s.find(this.localMultiselectItems,{_id:e._id}))?this.localMultiselectItems.push(e):this.localMultiselectItems=s.filter(this.localMultiselectItems,d=>d._id!==e._id),this.$emit("changeMultiselectItems",this.localMultiselectItems);this.lastSelectedItem||(this.lastSelectedItem=e._id);const l=s.isUndefined(s.find(this.localMultiselectItems,{_id:e._id}))?"check":"uncheck",o=s.findIndex(this.filteredList,d=>d._id===e._id),i=s.findIndex(this.filteredList,d=>d._id===this.lastSelectedItem),r=o<=i?o:i,n=this.checkIndex(o<=i?i:o),c=s.slice(this.filteredList,r,n);if(l==="check")s.each(c,d=>{s.isUndefined(s.find(this.localMultiselectItems,{_id:d._id}))&&this.localMultiselectItems.push(d)});else{const d=s.map(c,"_id");this.localMultiselectItems=s.filter(this.localMultiselectItems,u=>!s.includes(d,u._id))}this.lastSelectedItem=e._id,this.$emit("changeMultiselectItems",this.localMultiselectItems)},onClickNew(){this.localMultiselectItems=[],this.$emit("changeMultiselectItems",this.localMultiselectItems),this.$emit("selectMultiselect",!1),this.$emit("selectItem",{_local:!0})},getSearchableFields(){return s.filter(this.resource.schema,e=>e.searchable===!0)},doesMatch(e,t){return s.find(t,l=>!!new RegExp(this.search,"i").test(l))}}},Es={key:0,class:"record-list"},xs={class:"record-list-top-bar"},Ds={class:"resource-title"},Ms={key:0,class:"records-top-bar"},Os={key:0,class:"multiselect-buttons"},As=["onClick"],Vs={class:"item-info"},Fs=["onClick"],Us={class:"infos-wrapper"},Ns={key:0,class:"main"},$s={class:"meta"},Ps={class:"ts"},Bs=["onClick"];function qs(e,t,l,o,i,r){const n=T("timeago"),c=T("RecycleScroller"),d=Le("shortkey");return r.maxCount!=1?(h(),f("div",Es,[a("div",xs,[r.selectedResourceGroup&&l.groupedList?(h(),L(ee,{key:0,modelValue:i.menuOpened,"onUpdate:modelValue":t[0]||(t[0]=u=>i.menuOpened=u),auto:"","content-class":"resources-menu sidebar","offset-y":"","close-on-content-click":!0},{activator:m(({props:u})=>[a("div",X({class:["resource-selector",{opened:i.menuOpened}]},u),[a("div",Ds,g(r.getResourceTitle(l.resource)),1),p(R,{size:"large"},{default:m(()=>[y("mdi-chevron-down")]),_:1})],16)]),default:m(()=>[p(ce,{rounded:""},{default:m(()=>[(h(!0),f(C,null,V(r.selectedResourceGroup.list,u=>(h(),L(de,{key:u.name,density:"compact",class:w({selected:u===l.resource}),onClick:v=>u!==l.resource?l.selectResourceCallback(u):""},{default:m(()=>[p(ue,null,{default:m(()=>[y(g(r.getResourceTitle(u)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),q((h(),f("div",{class:w(["search",{"is-query":i.sift.isQuery,"is-valid":i.sift.isQuery&&i.sift.isValid==!0,"is-invalid":i.sift.isQuery&&i.sift.isValid==!1}]),onShortkey:t[2]||(t[2]=(...u)=>r.interactiveSearch&&r.interactiveSearch(...u))},[p(Re,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=u=>i.search=u),"prepend-inner-icon":"mdi-magnify",class:"search-bar",flat:"",variant:"filled",rounded:"","hide-details":"",density:"compact",placeholder:e.$filters.translate("TL_SEARCH"),type:"text",name:"search"},null,8,["modelValue","placeholder"]),r.maxCount<=0||r.listCount<r.maxCount?(h(),L(O,{key:0,elevation:"0",icon:"",class:w(["new-record",{active:r.isCreatingNewRecord()}]),onClick:r.onClickNew},{default:m(()=>[l.selectedItem&&!l.multiselect?(h(),L(R,{key:0},{default:m(()=>[y("mdi-note-edit-outline")]),_:1})):(h(),L(R,{key:1},{default:m(()=>[y("mdi-note-plus-outline")]),_:1}))]),_:1},8,["class","onClick"])):_("",!0)],34)),[[d,r.getShortcuts()]])]),r.hasEditableRecords()?(h(),f("div",Ms,[a("div",{class:"toggle-view-mode",onClick:t[3]||(t[3]=u=>r.toggleViewMode())},[p(R,{size:"small",class:w({selected:!l.multiselect})},{default:m(()=>[y("mdi-note-edit-outline")]),_:1},8,["class"]),p(R,{size:"small",class:w({selected:l.multiselect})},{default:m(()=>[y("mdi-format-list-checks")]),_:1},8,["class"])]),l.multiselect?(h(),f("div",Os,[a("span",{class:w({disabled:r.allRecordsSelected()}),onClick:t[4]||(t[4]=(...u)=>r.onClickSelectAll&&r.onClickSelectAll(...u))},g(e.$filters.translate("TL_SELECT_ALL")),3),a("span",{class:w({disabled:l.multiselectItems.length===0}),onClick:t[5]||(t[5]=(...u)=>r.onClickDeselectAll&&r.onClickDeselectAll(...u))},g(e.$filters.translate("TL_DESELECT_ALL")),3)])):_("",!0)])):_("",!0),q((h(),f("div",{class:"records",onShortkey:t[6]||(t[6]=u=>r.selectAll())},[p(c,{class:"list",items:r.filteredList||[],"item-size":58,"key-field":"_id"},{default:m(({item:u})=>[a("div",{class:w(["item",{selected:r.isItemSelected(u),frozen:!u._local}]),onClick:[B(v=>r.select(u),["exact"]),B(v=>r.selectTo(u),["shift"]),B(v=>r.selectTo(u,!0),["ctrl"])]},[a("div",Vs,[l.multiselect?(h(),f("div",{key:0,class:w(["checkbox",{"blink-background":r.isItemSelected(u)}]),onClick:B(v=>r.select(u,!0),["exact"])},[u._local?(h(),L(R,{key:0,class:w({displayed:r.isItemSelected(u)}),size:"small"},{default:m(()=>[y("mdi-check-bold")]),_:2},1032,["class"])):_("",!0)],10,Fs)):_("",!0),a("div",Us,[u?(h(),f("div",Ns,[p(st,{location:"right"},{activator:m(({props:v})=>[a("span",it(lt(v)),g(e.$filters.truncate(e.getName(u),15)),17)]),default:m(()=>[a("span",null,g(e.getName(u)),1)]),_:2},1024)])):_("",!0),a("div",$s,[a("div",Ps,[u._updatedBy?(h(),f(C,{key:0},[y(g(u._updatedBy)+" - ",1)],64)):(h(),f(C,{key:1},[y(g(e.$filters.translate("TL_UPDATED")),1)],64)),y(),a("span",{class:"time-ago",onClick:v=>r.copyIdToClipboard(u._id)},[p(n,{datetime:u._updatedAt},null,8,["datetime"])],8,Bs)])])])])],10,As)]),_:1},8,["items"])],32)),[[d,l.multiselect?["ctrl","a"]:!1]])])):_("",!0)}const Hs=D(Is,[["render",qs]]);let se;window.TranslateService?se=window.TranslateService:se=S;const be=e=>{const t={},l=s.get(e,"model","").split(".");return s.get(e,"localised",!1)&&(t.locale=l.shift()),t.key=l.join("."),t},Gs=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),re={url:e=>{try{return!!new URL(e)}catch{return!1}},number:e=>s.isNumber(e),integer:e=>s.isNumber(e)&&s.isInteger(e),double:e=>s.isNumber(e)&&(s.isInteger(e)||e===+e&&e!==(e|0)),text:e=>s.isString(e),array:e=>s.isArray(e),email:e=>Gs(e)},G={fieldIsRequired:se.get("TL_FIELD_IS_REQUIRED"),invalidFormat:se.get("TL_INVALID_FORMAT")},fe=(e,t,l,o)=>{if(s.get(e,"required",!1)&&!s.isNumber(t))return G.fieldIsRequired;const i=s.get(re,o,!1);return i?i(Number(t||0),e,l,G):(console.error(`checkNumber - No validator found for type '${o}'`),!1)},P={array:e=>s.isArray(e),email:e=>new RegExp("/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/").test(e),text:(e,t,l)=>{if(s.get(t,"required",!1)&&(!s.isString(e)||s.isEmpty(e)))return G.fieldIsRequired;const o=s.head(s.get(t,"model","").split("."));if(s.get(t,"regex.value",!1)===!1&&s.get(t,`regex['${o}'].value`,!1)===!1)return!0;let i=!1,r=!1;if(t.localised&&o&&(i=s.get(t,`regex['${o}'].value`,!1),r=s.get(t,`regex['${o}'].description`,!1)),i===!1&&(i=s.get(t,"regex.value",!1),r=s.get(t,"regex.description",!1)),r===!1&&(r=i),i&&s.isString(i)){const n=i.match(/\/(.*?)\/([gimy])?$/);if(!new RegExp(n[1],n[2]||"").test(e))return`${G.invalidFormat} (${se.get(r)})`}return!0},number:(e,t,l)=>fe(t,e,l,"number"),double:(e,t,l)=>fe(t,e,l,"double"),integer:(e,t,l)=>(s.isUndefined(e)&&(e=""),e.toString().indexOf(".")!==-1?!1:fe(t,e,l,"integer")),image:(e,t,l)=>{const{key:o,locale:i}=be(t),r=s.find(s.get(l,"_attachments",[]),n=>!(n._name!==o||i&&n._fields.locale!==i));return s.get(t,"required",!1)&&!r?G.fieldIsRequired:!0},file:(e,t,l)=>{const{key:o,locale:i}=be(t),r=s.find(s.get(l,"_attachments",[]),n=>!(n._name!==o||i&&n._fields.locale!==i));return s.get(t,"required",!1)&&!r?G.fieldIsRequired:!0},select:(e,t,l)=>s.get(t,"required",!1)&&s.isEmpty(e)?G.fieldIsRequired:!0,pillbox:(e,t,l)=>s.get(t,"required",!1)&&(!s.isArray(e)||s.isEmpty(e))?G.fieldIsRequired:!0};let qe={string:{type:"input",overrideType:"CustomInput",validator:P.text},text:{type:"textarea",overrideType:"CustomTextarea",rows:5,validator:P.text},password:{type:"input",inputFieldType:"password",overrideType:"CustomInput"},email:{type:"input",overrideType:"CustomInput",inputFieldType:"email",validator:re.email},url:{type:"input",overrideType:"CustomInput",validator:re.url},number:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:P.number},double:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:P.double},integer:{type:"input",overrideType:"CustomInput",inputFieldType:"number",validator:P.integer},checkbox:{type:"switch",overrideType:"CustomCheckbox"},date:{type:"CustomDatetimePicker",format:"YYYY-MM-DD",customDatetimePickerOptions:{format:"YYYY-MM-DD"}},time:{type:"CustomDatetimePicker",format:"hh:mm:ss a",customDatetimePickerOptions:{format:"hh:mm:ss a"}},datetime:{type:"CustomDatetimePicker",format:"YYYY-MM-DD hh:mm:ss a",customDatetimePickerOptions:{format:"YYYY-MM-DD hh:mm:ss a"}},pillbox:{type:"CustomInputTag",selectOptions:{multiple:!0,searchable:!0,onNewTag(e,t,l,o){l.push(e),o.push(e)}},values:[],validator:P.pillbox},select:{type:"CustomMultiSelect",selectOptions:{multiple:!1,trackBy:"_id",customLabel:(e,t)=>s.get(t,e,e),searchable:!0},validator:P.select},multiselect:{type:"CustomMultiSelect",selectOptions:{multiple:!0,listBox:!0,trackBy:"_id",customLabel:(e,t)=>s.get(t,e,e),searchable:!0},validator:re.array},json:{type:"TreeView",overrideType:"CustomTreeView",treeViewOptions:{maxDepth:4,rootObjectKey:"root",modifiable:!1}},code:{type:"Code",overrideType:"CustomCode",options:{}},wysiwyg:{type:"Wysiwyg",overrideType:"WysiwygField"},image:{type:"ImageView",validator:P.image},file:{type:"AttachmentView",validator:P.file},paragraph:{type:"ParagraphView"},group:{type:"group",overrideType:"Group"},object:{type:"JsonEditor"},color:{type:"ColorPicker",colorPickerOptions:{}},paragraphImage:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",fileType:"image",validator:P.image},paragraphFile:{type:"paragraphAttachmentView",overrideType:"ParagraphAttachmentView",validator:P.file}};s.each(qe,e=>{e.dense=!0,e.rounded=!0,e.filled=!0});class js{constructor(){this.typeMapper=qe}getKeyLocale(t){return be(t)}}const xe=new js;let N;window.TranslateService?N=window.TranslateService:N=S;class Ks{constructor(){this.typeMapper=xe.typeMapper}getSchemaFields(t,l,o,i,r,n,c){let d=s.map(t,u=>{const v=l.locales&&(u.localised||s.isUndefined(u.localised)),E=u.label&&N.get(u.label);let I=s.extend({},this.typeMapper[u.input],{label:`${E||u.field}${v?` (${N.get(`TL_${o.toUpperCase()}`)})`:""}`,model:v?`${o}.${u.field}`:u.field,originalModel:u.field,placeholder:`${E||u.field}${v?` (${N.get(`TL_${o.toUpperCase()}`)})`:""}`,disabled:r||s.get(u,"options.disabled",!1),readonly:s.get(u,"options.readonly",!1),required:!!u.required,options:u.options,resource:l,locale:o,userLocale:i,rootView:c});if(I=s.merge({},u.options,I),u.input==="file"&&s.get(I,"maxCount",!1)===!1)I.maxCount=1/0;else if(u.input==="select"&&s.get(I,"labels",!1))I.selectOptions.label=s.map(I.labels,(F,H)=>({value:H,text:s.get(F,`${o}`,F)}));else if(u.input==="multiselect"&&s.get(I,"labels",!1)&&!s.isObject(s.first(u.source))){const F=[];s.forEach(u.source,H=>{F.push({text:s.get(I,`labels.${H}`,H),value:H})}),u.source=F}return(u.input==="select"||u.input==="pillbox")&&(I.selectOptions.selectLabel=N.get("TL_MULTISELECT_SELECT_LABEL"),I.selectOptions.selectGroupLabel=N.get("TL_MULTISELECT_SELECT_GROUP_LABEL"),I.selectOptions.selectedLabel=N.get("TL_MULTISELECT_SELECTED_LABEL"),I.selectOptions.deselectLabel=N.get("TL_MULTISELECT_DESELECT_LABEL"),I.selectOptions.deselectGroupLabel=N.get("TL_MULTISELECT_DESELECT_GROUP_LABEL"),I.selectOptions.tagPlaceholder=N.get("TL_MULTISELECT_TAG_PLACEHOLDER")),u.input==="pillbox"&&(I.selectOptions.min=u.min,I.selectOptions.max=u.max),I});for(const u in t){const v=t[u];s.isArray(v.source)?d[u].values=v.source:s.isString(v.source)&&this.updateFieldSchema(d,v,u,o,n),d[u].localised=l.locales&&(v.localised||s.isUndefined(v.localised))}return d}updateFieldSchema(t,l,o,i,r){const n=$.get(l.source);r=s.extend({},r,s.get(l,"options.extraSources")),s.each(r,(v,E)=>{const I=$.get(v);s.each(n,F=>{const H=s.get(F,E);s.isString(H)&&s.set(F,E,s.find(I,{_id:H}))})});const c=$.getSchema(l.source),d=c&&s.first(c.schema);let u="_id";d&&(u=d.field,c.locales&&i&&(d.localised||s.isUndefined(d.localised))&&(u=`${i}.${u}`)),t[o].values=n||[],t[o].type==="CustomMultiSelect"&&(t[o].selectOptions=t[o].selectOptions||{},t[o].selectOptions=s.clone(t[o].selectOptions),t[o].selectOptions.key="_id",t[o].selectOptions.customLabel=v=>{const E=s.isString(v)?s.find(n,{_id:v}):v;return t[o].customLabel?_e.render(t[o].customLabel,E):s.get(E,u)})}getKeyLocale(t){return xe.getKeyLocale(t)}getNestedGroups(t,l,o,i,r){let n=s.groupBy(l,c=>{let d=c.originalModel;return r&&(d=d.replace(r,"")),d=d.split("."),d[o]});return n=s.map(n,(c,d)=>{if(s.uniqBy(c,"originalModel").length===1){const E=s.first(c);return c.length>1&&console.warn(`duplicated field '${E.model}' detected in resource '${t.displayname||t.title}'`),E}let u=`${i}.${d}`;s.isUndefined(i)&&(u=d);let v=s.get(t,`groups.${u}.label`,d);return v=N.get(v),s.extend({},this.typeMapper.group,{label:v,key:d,path:i,groupOptions:{fields:this.getNestedGroups(t,c,o+1,i,r)}})}),n}}const De=new Ks,Me=window.TranslateService||S,ke={mixins:[K],methods:{async uploadAttachments(e,t){this.$loading.start("uploadAttachments");try{for(const l of t){const o=new FormData;o.append(l._name,l.file),l._fields.locale&&o.append("locale",l._fields.locale),l._filename&&o.append("_filename",l._filename),l._fields.fileItemId&&o.append("fileItemId",l._fields.fileItemId),s.get(l,"cropOptions",!1)&&(console.warn("detected cropOptions, will add it to the request"),o.append("cropOptions",JSON.stringify(l.cropOptions))),s.get(l,"orderUpdated",!1)&&s.get(l,"order",!1)&&o.append("order",l.order),await A.post(`../api/${this.resource.title}/${e}/attachments`,o)}}catch(l){console.error("Error happen during uploadAttachments:",l)}this.$loading.stop("uploadAttachments")},async updateAttachments(e,t){this.$loading.start("updateAttachments");try{for(const[l,o]of t.entries()){const i=s.omit(s.get(o,"cropOptions",{}),["updated"]),r=s.get(o,"order",l+1);await A.put(`../api/${this.resource.title}/${e}/attachments/${o._id}`,{cropOptions:i,order:r})}}catch(l){console.error("Error happen during updateAttachments:",l)}this.$loading.stop("updateAttachments")},async removeAttachments(e,t){this.$loading.start("remove-attachments");try{for(const l of t)await A.delete(`../api/${this.resource.title}/${e}/attachments/${l._id}`)}catch(l){console.error("Error happen during removeAttachments:",l)}this.$loading.stop("remove-attachments")},getTypePrexix(e){let t="TL_ERROR_ON_RECORD_";return e==="create"?t+="CREATION":e==="update"?t+="UPDATE":e==="delete"&&(t+="DELETE"),t?Me.get(t):"Error"},manageError(e,t,l){let o=this.getTypePrexix(t),i=o;if(s.get(e,"response.data.code",500)===400){const r=s.get(e,"response.data");s.get(r,"message",!1)?i=`${o}: ${r.message}`:i=`${o}: ${Me.get("TL_UNKNOWN_ERROR")}`}console.error(i,l),this.notify(i,"error")},formatSchemaLayout(e){if(!s.get(e,"layout.lines",!1))return e;const t=[];return s.each(e.layout.lines,l=>{l.slots=l.slots||s.get(l,"fields.length",1),s.each(l.fields,o=>{o.schema=s.find(e.fields,{model:o.model}),s.isUndefined(o.schema)&&(o.schema=s.find(e.fields,{originalModel:o.model})),s.isUndefined(o.schema)?console.error(`Couldn't find schema for field ${o.model}`):t.push(o.model)})}),s.each(e.fields,l=>{!s.includes(t,l.model)&&!s.includes(t,l.originalModel)&&e.layout.lines.push({fields:[{model:l.model,schema:l}]})}),e},async updateSchema(){try{const e=!(this.record&&this.record._local);this.$loading.start("loading-schema");const t=De.getSchemaFields(this.resource.schema,this.resource,this.locale||this.userLocale,this.userLocale,e,this.resource.extraSources),l=De.getNestedGroups(this.resource,t,0);this.schema=this.formatSchemaLayout({fields:l,layout:s.cloneDeep(this.resource.layout)}),this.$loading.stop("loading-schema"),this.originalFieldList=t}catch(e){console.error("AbstractEditorView - updateSchema - Error happen during updateSchema:",e)}}}},Ys={mixins:[ke,K],props:{resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}},locale:{type:String,default:()=>"enUS"},userLocale:{type:String,default:()=>"enUS"}},data(){return{scrolledToBottom:!1,randomId:Math.random(),formValid:!1,fileInputTypes:["file","img","image","imageView","attachmentView"],cachedMap:{},editingRecord:{},originalFieldList:[],schema:{fields:[]},isReady:!1,formElem:!1,formOptions:{validateAfterLoad:!0,validateAfterChanged:!0}}},watch:{async locale(){await this.updateSchema(),this.editingRecord=s.clone(this.editingRecord),this.checkDirty()},async record(){await this.updateSchema(),this.cloneEditingRecord()},async userLocale(){await this.updateSchema(),this.editingRecord=s.clone(this.editingRecord),this.checkDirty()}},async mounted(){await this.updateSchema(),this.cloneEditingRecord(),this.isReady=!0,ve.events.on("select",this.onFieldSelected),this.$nextTick(()=>{this.formElem=document.getElementById(this.randomId)})},beforeUnmount(){ve.events.off("select",this.onFieldSelected)},methods:{onScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:l}}){this.scrolledToBottom=e+t>=l-50},toggleLocale(){this.selectLocale(s.find(this.resource.locales,e=>e!==this.locale))},getLocaleTranslation(e){return S.get("TL_"+e.toUpperCase())},getFieldRealOffset(e){return s.get(e,"$el.offsetTop",e.offsetTop)-50},onFieldSelected(e){this.schema.fields=s.map(this.schema.fields,t=>{const l=`${t.localised?`${S.locale}.`:""}${e.field}`;if(t.model===l){const o=document.getElementById(`${l}-${this.randomId}`),i=this.getFieldRealOffset(o);this.formElem.scrollTo({top:i})}return t})},back(){this.$emit("back")},onError(e){console.log(999,"error",e)},selectLocale(e){this.$emit("update:locale",e)},cloneEditingRecord(){const e={};s.each(this.resource.schema,t=>{if(s.includes(this.fileInputTypes,t.input))return;if(this.resource.locales&&(t.localised||s.isUndefined(t.localised)))s.each(this.resource.locales,o=>{const i=`${o}.${t.field}`;let r=s.get(this.record,i);t.input==="pillbox"?r=r||[]:t.input==="json"&&(r=r||{}),s.isPlainObject(r)&&(r=s.cloneDeep(r)),s.set(e,i,r)});else{const o=t.field;let i=s.get(this.record,o);t.input==="pillbox"&&(i=i||[]),t.input==="json"&&(i=i||{}),s.isPlainObject(i)&&(i=s.cloneDeep(i)),s.set(e,o,i)}}),this.editingRecord=s.clone(e),this.editingRecord._id=this.record._id;try{this.editingRecord._attachments=s.cloneDeep(this.record._attachments||[])}catch(t){console.error("Error during cloneEditingRecord:",t),this.editingRecord._attachments=[]}this.removeDirtyFlags()},async deleteRecord(){if(window.confirm(S.get("TL_ARE_YOU_SURE_TO_DELETE"),S.get("TL_YES"),S.get("TL_NO")))if(s.isUndefined(this.editingRecord._id))this.editingRecord={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await A.delete(`../api/${this.resource.title}/${this.editingRecord._id}`),this.notify(S.get("TL_RECORD_DELETED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",null)}catch(e){console.error("Error happen during deleteRecord:",e),this.manageError(e,"delete",this.editingRecord)}this.$loading.stop("delete-record")}},checkFormValid(){let e=!1;try{e=this.$refs.vfg.validate()}catch(l){console.error("Not valid: ",l),e=!1}const t=s.find(this.$refs.vfg.inputs,l=>!l.valid);if(s.isUndefined(t)||(e=!1,t.focus()),this.formValid=e,!this.formValid){const l=this.editingRecord._id?S.get("TL_ERROR_CREATING_RECORD_ID",null,{id:this.editingRecord._id}):S.get("TL_ERROR_CREATING_RECORD");this.notify(l,"error")}},fieldValueOrDefault(e,t){return e.input==="pillbox"?t||[]:e.input==="json"?t||{}:t},updateLocalisedField(e,t){s.each(this.resource.locales,l=>{if(!this.formValid)return this.handleFormNotValid();const o=`${l}.${t.field}`,i=this.fieldValueOrDefault(t,s.get(this.editingRecord,o));if(l!==this.locale&&t.required&&(s.isUndefined(i)||t.input==="string"&&i.length===0)){this.selectLocale(l),this.formValid=!1,this.$forceUpdate(),this.$nextTick(()=>{this.checkFormValid()}),console.warn("required field empty",t,this.formValid);return}s.isEqual(i,s.get(this.record,o))||s.set(e,o,i)})},handleFormNotValid(){console.info("form not valid")},async createUpdateClicked(){if(this.checkFormValid(),!this.formValid)return this.handleFormNotValid();const e={};s.each(this.resource.schema,l=>{if(!this.formValid||s.includes(this.fileInputTypes,l.input))return;if(this.resource.locales&&(l.localised||s.isUndefined(l.localised)))this.updateLocalisedField(e,l);else{const i=l.field,r=this.fieldValueOrDefault(l,s.get(this.editingRecord,i));s.isEqual(r,s.get(this.record,i))||s.set(e,i,r)}});const t=s.filter(this.editingRecord._attachments,l=>!l._id);if(s.isEmpty(t)||console.warn("NEW ATTACHMENTS = ",t),!this.formValid)return this.handleFormNotValid();if(s.isUndefined(this.editingRecord._id))return this.createRecord(e,t);this.updateRecord(e,t)},async createRecord(e,t){this.$loading.start("create-record");try{const{data:l}=await A.post(`../api/${this.resource.title}`,e);await this.uploadAttachments(l._id,t),this.notify(S.get("TL_RECORD_CREATED",null,{id:l._id})),this.$emit("updateRecordList",l)}catch(l){console.error("Error happen during createRecord:",l),this.manageError(l,"create")}this.$loading.stop("create-record")},async updateRecord(e,t){this.$loading.start("update-record");try{let l=this.editingRecord;console.info("Will send",e),s.isEmpty(e)||(l=(await A.put(`../api/${this.resource.title}/${this.editingRecord._id}`,e)).data),await this.uploadAttachments(l._id,t);const o=s.map(t,"_id"),i=s.filter(this.editingRecord._attachments,n=>n._id&&!s.includes(o,n._id)&&(s.get(n,"cropOptions.updated",!1)||s.get(n,"orderUpdated",!1)));s.isEmpty(i)||(console.warn("UPDATED ATTACHMENTS = ",s.map(i,n=>`${n.orderUpdated}-${n.order}-${n._filename}`)),await this.updateAttachments(l._id,i));const r=s.filter(this.record._attachments,n=>!s.find(this.editingRecord._attachments,{_id:n._id}));s.isEmpty(r)||(console.warn("REMOVED ATTACHMENTS = ",s.map(r,n=>`${n.order}-${n._filename}`)),await this.removeAttachments(l._id,r)),this.notify(S.get("TL_RECORD_UPDATED",null,{id:this.editingRecord._id})),this.$emit("updateRecordList",l)}catch(l){console.error("Error happen during updateRecord:",l),this.manageError(l,"update",this.editingRecord)}this.$loading.stop("update-record")},getAttachmentModel(e){const t=[];return s.get(e,"_fields.locale",!1)&&t.push(e._fields.locale),t.push(e._name),s.join(t,".")},updateFields(e,t){if(!this.isAttachmentField(t))return s.set(this.editingRecord,t,e);s.set(this.editingRecord,"_attachments",e),console.info(`Will update attachment ${t}`,e)},onModelUpdated(e,t){this.updateFields(e,t),this.checkDirty()},isAttachmentField(e){const t=s.get(s.find(s.get(this.schema,"fields",[]),{model:e}),"originalModel",!1),l=s.get(s.find(this.resource.schema,{field:t}),"input",!1);return s.includes(this.fileInputTypes,l)},checkDirty(){s.each(this.originalFieldList,e=>{let t=!0;if(s.includes(["AttachmentView","ImageView"],e.type)){const{key:l,locale:o}=this.getKeyLocale(e),i=s.filter(this.record._attachments,n=>n._name===l&&(n._fields&&n._fields.locale)===o),r=s.filter(this.editingRecord._attachments,n=>n._name===l&&(n._fields&&n._fields.locale)===o);t=s.isEqual(i,r)}else t=s.isEqual(s.get(this.record,e.model),s.get(this.editingRecord,e.model));e.labelClasses=t?"":"dirty"})},removeDirtyFlags(){s.each(this.originalFieldList,e=>{delete e.labelClasses})},getKeyLocale(e){const t={},l=e.model.split(".");return e.localised&&(t.locale=l.shift()),t.key=l.join("."),t}}},zs={class:"top-bar"},Ws={class:"buttons"};function Xs(e,t,l,o,i,r){const n=T("top-bar-locale-list"),c=T("custom-form");return l.record?(h(),L(Q,{key:0,elevation:"0",class:w(["record-editor",{frozen:!l.record._local}])},{default:m(()=>[a("div",zs,[p(n,{locales:l.resource.locales,locale:l.locale,"select-locale":r.selectLocale,back:r.back},null,8,["locales","locale","select-locale","back"]),a("div",Ws,[i.editingRecord._id?(h(),L(O,{key:0,elevation:"0",class:"delete",icon:"",rounded:"",onClick:r.deleteRecord},{default:m(()=>[p(R,null,{default:m(()=>[y("mdi-trash-can-outline")]),_:1})]),_:1},8,["onClick"])):_("",!0),p(O,{elevation:"0",class:"update",rounded:"",onClick:r.createUpdateClicked},{default:m(()=>[y(g((i.editingRecord._id?"TL_UPDATE":"TL_CREATE")|e.translate),1)]),_:1},8,["onClick"])])]),a("div",{class:w(["scroll-wrapper",{"scrolled-to-bottom":i.scrolledToBottom}]),onScroll:t[1]||(t[1]=(...d)=>r.onScroll&&r.onScroll(...d))},[p(rt,{id:i.randomId,ref:"vfg",modelValue:i.formValid,"onUpdate:modelValue":t[0]||(t[0]=d=>i.formValid=d),class:"record-editor-form","lazy-validation":""},{default:m(()=>[i.isReady?(h(),L(c,{key:0,schema:i.schema,"form-id":i.randomId,"form-options":i.formOptions,model:i.editingRecord,"paragraph-level":1,onError:r.onError,onInput:r.onModelUpdated},null,8,["schema","form-id","form-options","model","onError","onInput"])):_("",!0)]),_:1},8,["id","modelValue"])],34)]),_:1},8,["class"])):_("",!0)}const He=D(Ys,[["render",Xs]]),Qs={props:["resource","schema","items","locale","options","selectedRecords"],data(){return{localSelectedRecords:[],columns:[],sourceData:[],tableData:[],rowStyleOption:{stripe:!0},filteredColumns:[],sortOption:{multipleSort:!0,sortAlways:!0,sortChange:e=>{this.tableData=s.sortBy(this.tableData,s.keys(e),s.values(e))}},clipboardOption:{copy:!0,paste:!1,cut:!1,delete:!1,beforeCopy:({data:e,selectionRangeIndexes:t,selectionRangeKeys:l})=>(navigator.clipboard.writeText(this.getDataToCopy(t)),!1)},columnWidthResizeOption:{enable:!0,minWidth:50}}},computed:{orderedItem(){return this.items},schemaFields(){let e=this.schema.fields,t=[];s.forEach(e,o=>{s.get(o,"options.breakdown",!1)&&s.forEach(this.resource.locales,(i,r)=>{if(o.model===`${i}.${o.originalModel}`)o.localised=!1,o.options.localeIndex=r+1;else{let n=s.cloneDeep(o);n.localised=!1;const c=o.originalModel&&S.get(o.originalModel);n.label=`${c} (${S.get(`TL_${i.toUpperCase()}`)})`,n.model=`${i}.${o.originalModel}`,s.set(n,"options.localeIndex",r+1),t.push(n)}}),o.disabled=!0}),e=e.concat(t);let l=s.filter(e,o=>s.isNumber(s.get(o,"options.index",!1)));return s.isEmpty(l)?this.schema.fields:s.sortBy(l,o=>`${o.options.index}${s.get(o,"options.localeIndex",0)}`)}},watch:{items(){this.resetRecordsFiltering()}},mounted(){this.resetRecordsFiltering(),this.createTableColumns()},methods:{getDataToCopy(e){let t=e.startColIndex,l=e.endColIndex;const o=this.columns.slice(t,l+1).map(n=>n.field),i=this.tableData.slice(e.startRowIndex,e.endRowIndex+1).map(n=>s.map(o,c=>s.get(n,c,"")));let r="";return s.each(i,(n,c)=>{c!==0&&(r+=`
`),r+=n.join("	")}),r},deleteSelectedRecords(){this.$emit("remove-records",s.filter(this.sourceData,e=>s.includes(this.selectedRecords,e._id)))},resetRecordsFiltering(){this.sourceData=this.orderedItem,this.tableData=this.sourceData.slice(0)},createTableColumns(){const e=[{field:"__RECORD_SELECTION__",key:"__RECORD_SELECTION__",fixed:"left",align:"center",disableResizing:!0,width:20,renderBodyCell:({row:t,column:l,rowIndex:o},i)=>i("TableRecordSelection",{props:{row:t,selected:this.isRecordSelected(t),onChange:this.onSelectRecord}})}];s.each(this.schemaFields,(t,l)=>{const o=this.getFieldType(t),i="Table"+o,r={field:t.model,key:"a"+l,title:t.label,ellipsis:{showTitle:!0,lineClamp:s.get(t,"options.lineClamp",1)},renderBodyCell:({row:n,column:c,rowIndex:d},u)=>s.includes(["CustomInput","CustomMultiSelect"],o)?s.get(n,c.field,""):i in Vue.options.components?u(i,{props:{row:n,column:c,rowIndex:d,field:t}}):(console.error(`${i} isn't defined as a custom field type, will not render it`),s.get(n,c.field,""))};s.get(t,"options.filter",!1)&&(r.filter={filterList:s.uniqBy(s.map(this.sourceData,(n,c)=>({value:c,label:t.type==="switch"?S.get("TL_"+s.toUpper(s.get(n,t.model,!1))):s.get(n,t.model),realValue:s.get(n,t.model),selected:!1})),"label"),isMultiple:s.get(t,"options.filter",!1)==="multiple",filterConfirm:n=>{const c=n.filter(d=>d.selected).map(d=>d.realValue);this.searchBy(c,t.model),s.includes(this.filteredColumns,r.field)||this.filteredColumns.push(r.field)},filterReset:n=>{this.searchBy([],t.model),this.filteredColumns=s.filter(this.filteredColumns,r.field)},filterIcon:()=>s.includes(this.filteredColumns,r.field)?p(T("v-icon"),null,{default:()=>[y("mdi-filter")]}):p(T("v-icon"),null,{default:()=>[y("mdi-filter-outline")]}),maxHeight:200}),s.each(["sortBy","align"],n=>{const c=s.get(t,`options.${n}`,!1);c!==!1&&s.set(r,n,c)}),e.push(r)}),e.push({field:"__ACTIONS__",key:"__ACTIONS__",title:S.get("TL_ACTIONS"),fixed:"right",disableResizing:!0,width:75,renderBodyCell:({row:t,column:l,rowIndex:o},i)=>i("TableRowActions",{props:{row:t,column:l,rowIndex:o,remove:r=>this.$emit("remove",r),edit:r=>this.$emit("edit",r)}})}),this.columns=e},isRecordSelected(e){return s.includes(this.localSelectedRecords,s.get(e,"_id",!1))},onSelectRecord(e,t){t?this.localSelectedRecords.push(e):this.localSelectedRecords=s.filter(this.localSelectedRecords,l=>l!==e),this.$emit("update:selectedRecords",this.localSelectedRecords)},searchBy(e,t){this.tableData=this.sourceData.filter(l=>e.length===0||e.includes(s.get(l,t)))},editRow(e){console.warn("editRow",e)},getFieldType(e){return s.get(e,"overrideType",s.get(e,"type",!1))}}};const Zs={ref:"excel-container",class:"vue-table-generator vue-form-generator table"};function Js(e,t,l,o,i,r){const n=T("ve-table");return h(),f("div",Zs,[p(n,{ref:"tableRef","scroll-width":"0","sort-option":i.sortOption,"virtual-scroll-option":{enable:!0},"column-width-resize-option":i.columnWidthResizeOption,columns:i.columns,"table-data":i.tableData,"fixed-header":!0,"border-around":!0,"border-x":!0,"border-y":!0,"clipboard-option":i.clipboardOption,"row-style-option":i.rowStyleOption,"max-height":"100%","row-key-field-name":"_id"},null,8,["sort-option","column-width-resize-option","columns","table-data","clipboard-option","row-style-option"]),q(a("div",{class:"empty-data"},g("TL_NO_DATA_FOUND"|e.translate),513),[[Ve,i.tableData.length===0]])],512)}const ei=D(Qs,[["render",Js],["__scopeId","data-v-0d37d050"]]),ti={components:{VueTableGenerator:ei,RecordEditor:He},mixins:[ke,K],props:{groupedList:{type:Array,default:()=>[]},recordList:{type:Array,default:()=>[]},locale:{type:String,default:"enUS"},selectedResourceCallback:{type:Function,default:()=>{}},resource:{type:Object,default:()=>{}},record:{type:Object,default:()=>{}}},data(){return{page:1,menuOpened:!1,isReady:!1,omnibarDisplayed:!1,search:null,cachedMap:{},selectedRecords:[],schema:{fields:[]},TranslateService:S,localLocale:!1,localRecord:{},clonedRecordList:null}},computed:{selectedResourceGroup(){return s.find(this.groupedList,e=>this.groupSelected(e))},options(){return{paging:s.get(this.resource,"options.paging",10),displayId:s.get(this.resource,"options.displayId",!0),displayUpdatedAt:s.get(this.resource,"options.displayUpdatedAt",!0)}},pageCount(){return Math.ceil(this.listCount/this.options.paging)},maxCount(){return s.get(this.resource,"maxCount",0)},listCount(){return s.get(this.clonedRecordList,"length",0)},filteredList(){let e=this.getSearchableFields();return e.length===0&&(e=[s.first(this.resource.schema)]),s.filter(this.clonedRecordList,(t,l)=>{if(s.isEmpty(this.search))return l>=this.options.paging*(this.page-1)&&l<this.options.paging*this.page;const o=[];return s.forEach(e,i=>{o.push(this.getValue(t,i))}),this.doesMatch(this.search,o)||new RegExp(this.search,"i").test(t._id)})}},watch:{async locale(){this.isReady=!1,this.localLocale=this.locale,this.$emit("update:locale",this.localLocale),await this.updateSchema(),this.isReady=!0},async record(){this.localRecord=s.cloneDeep(this.record)},async recordList(){this.clonedRecordList=s.cloneDeep(this.recordList),this.isReady=!1,await this.updateSchema(),this.isReady=!0,this.$forceUpdate()},async userLocale(){this.isReady=!1,await this.updateSchema(),this.isReady=!0}},mounted(){Z.events.on("omnibar-display-status",this.onGetOmnibarDisplayStatus)},methods:{onGetOmnibarDisplayStatus(e){this.omnibarDisplayed=e},getShortcuts(){return this.omnibarDisplayed?{}:{esc:["esc"],open:["ctrl","/"]}},async interactiveSearch(e){const t=s.get(e,"srcKey",!1),l=s.get(this.$refs,"['search']",!1);if(!(!t||!l))return t==="esc"?l.blur():l.focus()},getResourceTitle(e){return e?e.displayname?S.get(e.displayname):e.title:""},groupSelected(e){if(!this.resource)return!1;const t=s.get(this.resource,"group.enUS",s.get(this.resource,"group",!1)),l=s.get(e,"name.enUS",e.name);return l==="TL_OTHERS"&&!t?!0:l===t},onPaginationClick(){console.warn("onPaginationClick ---",arguments)},updateRecordList(e){this.$emit("updateRecordList",e)},selectRecord(e){this.localLocale=this.locale,this.$emit("update:record",e)},editRecord(e){this.selectRecord(e)},askConfirmation(e=!1){return window.confirm(S.get(`TL_ARE_YOU_SURE_TO_DELETE${e?"_SELECTED_RECORDS":""}`),S.get("TL_YES"),S.get("TL_NO"))},async removeRecords(){this.askConfirmation(!0)&&await Promise.all(s.map(this.selectedRecords,e=>this.removeRecord({_id:e},!0)))},async removeRecord(e,t=!1){if(!(!t&&!this.askConfirmation())){if(s.isUndefined(e._id))e={},this.$emit("update:record",null);else{this.$loading.start("delete-record");try{await A.delete(`../api/${this.resource.title}/${e._id}`),this.notify(S.get("TL_RECORD_DELETED",null,{id:e._id})),this.$emit("updateRecordList",null)}catch(l){console.error("Error happen during deleteRecord:",l),this.manageError(l,"delete",this.editingRecord)}this.$loading.stop("delete-record")}this.clonedRecordList=s.filter(this.clonedRecordList,l=>e!==l)}},doesMatch(e,t){let l=!1;return s.forEach(t,o=>{if(l=new RegExp(this.search,"i").test(o),l)return!1}),l},async updateRecord(e){const t={};let l=s.find(this.recordList,{_id:e._id});s.each(this.resource.schema,r=>{if(r.input==="file"||r.input==="image")return;if(this.resource.locales&&(r.localised||s.isUndefined(r.localised)))s.each(this.resource.locales,c=>{const d=`${c}.${r.field}`;let u=s.get(e,d);r.input==="pillbox"?u=u||[]:r.input==="json"&&(u=u||{}),!s.isEqual(u,s.get(l,d))&&s.set(t,d,u)});else{const c=r.field;let d=s.get(e,c);if(r.input==="pillbox"?d=d||[]:r.input==="json"&&(d=d||{}),s.isEqual(d,s.get(l,c)))return;s.set(t,c,d)}});const o=s.filter(e._attachments,r=>!r._id),i=s.filter(l&&l._attachments,r=>!s.find(e._attachments,{_id:r._id}));if(s.isUndefined(e._id)){this.$loading.start("create-record");try{const r=await A.post(`../api/${this.resource.title}`,t);await this.uploadAttachments(r.data._id,o),this.notify(S.get("TL_RECORD_CREATED",null,{id:r.data._id})),this.$emit("updateRecordList",r.data)}catch(r){console.error("Error happend during updateRecord/create:",r),this.manageError(r,"create")}this.$loading.stop("create-record")}else{this.$loading.start("update-record");try{let r;s.isEmpty(t)?r={data:e}:r=await A.put(`../api/${this.resource.title}/${e._id}`,t),await this.uploadAttachments(r.data._id,o),await this.removeAttachments(r.data._id,i),(!s.isEmpty(t)||!s.isEmpty(o)||!s.isEmpty(i))&&this.notify(S.get("TL_RECORD_UPDATED",null,{id:e._id})),this.$emit("updateRecordList",r.data)}catch(r){console.error("Error happend during updateRecord/create:",r),this.manageError(r,"update",e)}this.$loading.stop("update-record")}},async updateRecords(){try{const e=[];this.$loading.start("update-records");let t=s.filter(this.recordList,l=>!s.find(this.clonedRecordList,{_id:l._id}));for(const l of t)e.push(async()=>{this.$loading.start("delete-record"),await A.delete(`../api/${this.resource.title}/${l._id}`),this.notify(S.get("TL_RECORD_DELETED",null,{id:l._id})),this.$emit("updateRecordList",null),this.$loading.stop("delete-record")});for(const l of s.reverse(this.clonedRecordList))e.push(async()=>await this.updateRecord(l));await te(e,{concurrency:10})}catch(e){console.error("Error happens during updateRecords:",e)}this.$loading.stop("update-records")},createRecord(){let e={_local:!0};s.each(this.schema.fields,t=>{s.set(e,t.model,void 0)}),this.clonedRecordList.push(e),this.selectRecord(e)},getSearchableFields(){return s.filter(this.resource.schema,e=>e.searchable===!0)},selectLocale(e){this.$emit("update:locale",e)},getValue(e,t){let l="";if(t)if(t.input==="file"){const o=s(e).get("_attachments",[]).find(i=>i._name===t.field);l=o&&o._filename}else this.resource.locales&&(t.localised||s.isUndefined(t.localised))?l=s.get(e,`${this.locale}.${t.field}`):l=s.get(e,t.field);return l},back(){this.$emit("unsetRecord")}}},si={class:"record-table-wrapper"},ii={class:"resource-title"},li={key:0,class:"top-bar"},ri={class:"buttons"};function oi(e,t,l,o,i,r){const n=T("top-bar-locale-list"),c=T("vue-table-generator"),d=T("record-editor"),u=Le("shortkey");return h(),f("div",si,[r.selectedResourceGroup&&l.groupedList?(h(),L(ee,{key:0,modelValue:i.menuOpened,"onUpdate:modelValue":t[0]||(t[0]=v=>i.menuOpened=v),auto:"","content-class":"resources-menu full-width","offset-y":"","close-on-content-click":!0},{activator:m(({props:v})=>[a("div",X({class:"resource-selector"},v,{class:{opened:i.menuOpened}}),[a("div",ii,g(r.getResourceTitle(l.resource)),1),p(R,{large:""},{default:m(()=>[y("mdi-chevron-down")]),_:1})],16)]),default:m(()=>[p(ce,{rounded:""},{default:m(()=>[(h(!0),f(C,null,V(r.selectedResourceGroup.list,v=>(h(),L(de,{key:v.name,dense:"",class:w({selected:v===l.resource}),onClick:E=>v!==l.resource?e.selectResourceCallback(v):""},{default:m(()=>[p(ue,null,{default:m(()=>[y(g(r.getResourceTitle(v)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),p(Q,{class:w(["record-table",{"has-back-button":l.record}]),elevation:"0"},{default:m(()=>[l.record?_("",!0):(h(),f("div",li,[p(n,{locales:l.resource.locales,locale:l.locale,"select-locale":r.selectLocale,back:r.back},null,8,["locales","locale","select-locale","back"]),q((h(),f("div",{class:"search",onShortkey:t[2]||(t[2]=(...v)=>r.interactiveSearch&&r.interactiveSearch(...v))},[p(Re,{ref:"search",modelValue:i.search,"onUpdate:modelValue":t[1]||(t[1]=v=>i.search=v),"prepend-inner-icon":"mdi-magnify",class:"search-bar",flat:"",filled:"",rounded:"","hide-details":"",dense:"",placeholder:"TL_SEARCH"|e.translate,type:"text",name:"search"},null,8,["modelValue","placeholder"])],32)),[[u,r.getShortcuts()]]),a("div",ri,[i.selectedRecords.length>0?(h(),L(O,{key:0,elevation:"0",rounded:"",class:"delete-selected-records",onClick:r.removeRecords},{default:m(()=>[y(g("TL_DELETE_SELECTED_RECORDS"|e.translate),1)]),_:1},8,["onClick"])):_("",!0),r.maxCount<=0||r.listCount<r.maxCount?(h(),L(O,{key:1,elevation:"0",rounded:"",class:"new",onClick:r.createRecord},{default:m(()=>[y(g("TL_ADD_NEW_RECORD"|e.translate),1)]),_:1},8,["onClick"])):_("",!0)])])),l.record?_("",!0):(h(),f(C,{key:1},[i.isReady?(h(),L(c,{key:0,options:r.options,"selected-records":i.selectedRecords,resource:l.resource,schema:i.schema,items:r.filteredList,locale:i.localLocale,onRemove:r.removeRecord,onEdit:r.editRecord},null,8,["options","selected-records","resource","schema","items","locale","onRemove","onEdit"])):_("",!0)],64)),l.record?(h(),L(d,{key:l.record._id,record:i.localRecord,resource:l.resource,locale:i.localLocale,"user-locale":i.TranslateService.locale,onUpdateRecordList:r.updateRecordList,onBack:r.back},null,8,["record","resource","locale","user-locale","onUpdateRecordList","onBack"])):_("",!0)]),_:1},8,["class"])])}const ni=D(ti,[["render",oi]]);const ai={components:{NavBar:Ts,RecordList:Hs,RecordEditor:He,Loading:Pe,LocaleList:Ut,RecordTable:ni},mixins:[K],data(){return{config:!1,locale:"enUS",resourceList:[],selectedResource:null,localeList:[],recordList:[],notification:{},toolbarTitle:!1,selectedResourceGroup:null,selectedRecord:null,selectedPlugin:null,LoadingService:Ce,TranslateService:S,user:null,multiselect:!1,multiselectItems:[]}},computed:{groupedList(){const e={name:"TL_OTHERS"},t={name:"TL_PLUGINS"};let l=[e,t],o=s.union(this.resourceList,s.map(this.pluginList,i=>s.extend(i,{type:"plugin"})));return s.each(o,i=>{s.isEmpty(i.group)||s.isString(i.group)||s.find(l,n=>{if(s.isEqual(n.name,i.group))return n})||l.push({name:i.group})}),s.each(o,i=>{s.isEmpty(i.group)||s.isString(i.group)&&(s.find(l,n=>{if(n===i.group||n.name===i.group||s.includes(s.values(n.name),i.group))return n})||l.push({name:i.group}))}),s.each(o,i=>{const r=s.find(l,n=>{if(s.isEqual(n.name,i.group)||n===i.group||n.name===i.group||s.includes(s.values(n.name),i.group))return n});if(r){r.list=r.list||[],r.list.push(i);return}i.type==="plugin"?(t.list=t.list||[],t.list.push(i)):(e.list=e.list||[],e.list.push(i))}),l=s.orderBy(l,i=>i.name==="CMS"?String.fromCharCode(0):i===e?String.fromCharCode(255):`${S.get(i.name,"enUS")}`.toLowerCase(),"asc"),s.filter(l,i=>i.list&&i.list.length!==0)},pluginList(){return s.filter(window.plugins,t=>s.isUndefined(t.allowed)?!0:s.isEmpty(this.user)?!1:s.includes(t.allowed,this.user.group))}},watch:{$route:function(){if(this.$route.query.id!=null){const e=s.union(this.pluginList,this.resourceList);e.length>0&&this.selectResource(s.find(e,{title:this.$route.query.id}))}}},unmounted(){Z.events.off("notification",this.onGetNotification)},mounted(){this.$loading.start("init"),j.onLogout(()=>{console.info("User logged out"),window.location.reload()}),Z.events.on("notification",this.onGetNotification),this.$nextTick(async()=>{if(await J.init(),this.config=J.config,await S.init(),this.setToolbarTitle(),s.get(window,"noLogin",!1))this.user={};else{j.init();try{this.user=await j.getStatus();const t=s.get(this.user,"theme","light")==="dark";this.$vuetify.theme.dark=t,this.$forceUpdate()}catch(t){const l=s.get(t,"response.data.message",t.message);throw this.notify(l,"error"),t}}try{const t=await A.get(`${window.location.pathname}resources`);this.$loading.stop("init");const l=s.sortBy(t.data,o=>o.title);if(this.resourceList=s.filter(l,o=>s.isUndefined(o.allowed)?!0:s.includes(o.allowed,this.user.group)),$.setSchemas(this.resourceList),this.localeList=S.config.locales,this.$route.query.id!=null){const o=s.find(s.union(this.pluginList,this.resourceList),{title:this.$route.query.id});this.selectResource(o)}}catch(t){console.error("Error while getting resources: ",t)}})},methods:{setToolbarTitle(){this.toolbarTitle=s.get(J.config,`toolbarTitle.${S.locale}`,s.get(J.config,"toolbarTitle",!1))},onGetNotification(e){this.notification=e},getNotificationClass(){return`notification-${this.notification.type}`},getThemeClass(){const e={};return s.set(e,`theme--${s.get(this.user,"theme","light")}`,!0),e},async selectResourceGroup(e){this.selectedResourceGroup=e},async selectResource(e){if(!s.isUndefined(e))try{if(s.get(this.$router,"history.current.query.id",!1)!==e.title&&this.$router.push({query:{id:e.title}}).catch(l=>console.error("Router throw an error:",l)),e.type==="plugin"){this.selectedResource=null,this.selectedPlugin=e;return}if(this.onCancelMultiselectPage(),this.selectedResource=e,this.selectedPlugin=null,this.recordList=null,this.selectedRecord=null,!this.selectedResource)return;this.locale=s.first(this.selectedResource.locales),this.$loading.start("selectResource"),await this.cacheRelatedResources(e);const t=$.get(e.title);if(this.recordList=s.sortBy(t,l=>-l._updatedAt),s.get(e,"maxCount",0)===1){const l=s.get(this.recordList,"[0]",!1);l?this.selectRecord(l):this.selectRecord({_local:!0})}this.$loading.stop("selectResource")}catch(t){console.error("Error happen during selectResource:",t)}},async cacheRelatedResources(e){let t=s.union([e.title],s.values(e.extraSources));const l=o=>{s.isArray(o)?s.each(o,i=>{l(i)}):s.each(o,(i,r)=>{switch(r){case"input":{const n=s.get(o,"options.extraSources");switch(t.push(...s.values(n)),i){case"select":case"multiselect":const c=s.get(o,"source");if(s.isString(c)){t.push(c);const d=$.getSchema(c);t.push(...s.values(d.extraSources))}break;case"paragraph":s.each(s.get(o,"options.types"),d=>{l(d);const u=s.get(d,"schema");l(u)})}break}case"extraSources":t.push(...s.values(i))}})};l(e.schema),t=s.uniq(t),await te(s.map(t,o=>async()=>await $.cache(o)),{concurrency:10})},selectRecord(e){this.selectedRecord=e},onSelectMultiselect(e){this.multiselect=e,e&&this.unsetSelectedRecord()},onChangeMultiselectItems(e){this.multiselectItems=s.clone(e)},async updateRecordList(e){try{this.$loading.start("updateRecordList");const t=await $.cache(this.selectedResource.title);this.$loading.stop("updateRecordList"),this.recordList=s.sortBy(t,l=>-l._updatedAt),this.selectRecord(s.find(this.recordList,{_id:s.get(e,"_id")}))}catch(t){console.error("Error happen during updateRecordList:",t)}},unsetSelectedRecord(){this.selectedRecord=null},onCancelMultiselectPage(){this.multiselect=!1,this.multiselectItems=[]}}},ci={key:0,class:"cms-layout"},di={class:"resources"},ui={class:"records"};function hi(e,t,l,o,i,r){const n=T("nav-bar"),c=T("locale-list"),d=T("record-list"),u=T("record-editor"),v=T("record-table"),E=T("plugin-page"),I=T("loading");return h(),L(Ne,null,{default:m(()=>[p(at,{theme:e.$vuetify&&e.$vuetify.theme&&!e.$vuetify.theme.isDark?"light":"dark"},{default:m(()=>[p(ot,null,{default:m(()=>[i.notification.type?(h(),L(nt,{key:0,modelValue:i.notification,"onUpdate:modelValue":t[1]||(t[1]=F=>i.notification=F),"multi-line":"",location:"centered",class:w(["notification elevation-10",r.getNotificationClass()]),timeout:i.notification.type==="error"?-1:1e3},{action:m(({props:F})=>[p(O,X({rounded:"",icon:""},F,{onClick:t[0]||(t[0]=H=>i.notification={})}),{default:m(()=>[p(R,null,{default:m(()=>[y("mdi-close-circle-outline")]),_:1})]),_:2},1040)]),default:m(()=>[a("p",null,g(i.notification.message),1)]),_:1},8,["modelValue","timeout","class"])):_("",!0)]),_:1}),i.user?(h(),f("div",ci,[a("div",{class:w(["cms-inner-layout",r.getThemeClass()])},[i.resourceList.length>0?(h(),L(n,{key:0,config:i.config,"toolbar-title":i.toolbarTitle,"locale-class":{locale:i.localeList&&i.localeList.length>1},"select-resource-group-callback":r.selectResourceGroup,"select-resource-callback":r.selectResource,"grouped-list":r.groupedList,"selected-resource-group":i.selectedResourceGroup,"selected-item":i.selectedResource||i.selectedPlugin},null,8,["config","toolbar-title","locale-class","select-resource-group-callback","select-resource-callback","grouped-list","selected-resource-group","selected-item"])):_("",!0),a("div",di,[i.localeList?(h(),L(c,{key:0,"locale-list":i.localeList},null,8,["locale-list"])):_("",!0)]),a("div",ui,[i.selectedResource&&(!i.selectedResource.view||i.selectedResource.view=="list")?(h(),f(C,{key:0},[i.selectedResource?(h(),L(d,{key:0,list:i.recordList,locale:i.locale,"selected-item":i.selectedRecord,"grouped-list":r.groupedList,"resource-group":i.selectedResourceGroup,resource:i.selectedResource,"select-resource-callback":r.selectResource,multiselect:i.multiselect,"multiselect-items":i.multiselectItems,onSelectItem:r.selectRecord,onChangeMultiselectItems:r.onChangeMultiselectItems,onSelectMultiselect:r.onSelectMultiselect,onUpdateRecordList:r.updateRecordList},null,8,["list","locale","selected-item","grouped-list","resource-group","resource","select-resource-callback","multiselect","multiselect-items","onSelectItem","onChangeMultiselectItems","onSelectMultiselect","onUpdateRecordList"])):_("",!0),i.selectedRecord&&!i.multiselect?(h(),L(u,{key:i.selectedRecord._id,record:i.selectedRecord,resource:i.selectedResource,locale:i.locale,"user-locale":i.TranslateService.locale,onUpdateRecordList:r.updateRecordList},null,8,["record","resource","locale","user-locale","onUpdateRecordList"])):_("",!0)],64)):_("",!0),i.selectedResource&&i.selectedResource.view=="table"?(h(),L(v,{key:1,"grouped-list":r.groupedList,"resource-group":i.selectedResourceGroup,"select-resource-callback":r.selectResource,"record-list":i.recordList,resource:i.selectedResource,record:i.selectedRecord,locale:i.locale,"user-locale":i.TranslateService.locale,onUnsetRecord:r.unsetSelectedRecord,onUpdateRecordList:r.updateRecordList},null,8,["grouped-list","resource-group","select-resource-callback","record-list","resource","record","locale","user-locale","onUnsetRecord","onUpdateRecordList"])):_("",!0),i.selectedPlugin?(h(),L(E,{key:2,plugin:i.selectedPlugin},null,8,["plugin"])):_("",!0)]),i.LoadingService.isShow?(h(),L(I,{key:1})):_("",!0)],2)])):_("",!0)]),_:1},8,["theme"])]),_:1})}const Se=D(ai,[["render",hi]]);const mi={components:{Loading:Pe},mixins:[K],data(){return{username:null,password:null,activeField:!1,loginFailed:!1,loggingIn:!1,showLoginForm:!1,loaded:!1,LoadingService:Ce,TranslateService:S}},async mounted(){console.warn("Login page mounted"),this.$loading.start("init");try{s.get(window,"noLogin",!1)||j.init(),await J.init(),await S.init(),this.loaded=!0}catch(e){console.error("Error happen during mounted:",e)}this.loaded=!0,this.$nextTick(()=>{setTimeout(()=>{this.showLoginForm=!0},100)}),this.$loading.stop("init")},methods:{async login(){if(!this.loggingIn){if(!this.username)return this.$refs.username.focus();if(!this.password)return this.$refs.password.focus();this.$loading.start("login"),this.loggingIn=!0;try{await A.post(`${window.location.pathname}login`,{username:this.username,password:this.password}),this.$loading.stop("login"),window.location.reload()}catch(e){console.error("Error happen during login:",e),this.loginFailed=!0,this.$loading.stop("login")}this.loggingIn=!1}}}},fi={class:"login-canvas"},pi={class:"node-cms-title"},gi=["placeholder"],_i=["placeholder"],yi={key:0,class:"error-message"},vi=["disabled"];function bi(e,t,l,o,i,r){const n=T("loading");return h(),L(Ne,null,{default:m(()=>[i.loaded?(h(),f("div",{key:0,class:w(["cms-layout",{displayed:i.showLoginForm}])},[a("div",fi,[a("form",{onSubmit:t[2]||(t[2]=B((...c)=>r.login&&r.login(...c),["prevent"]))},[a("div",pi,g(e.$filters.translate("TL_LOGIN")),1),q(a("input",{ref:"username","onUpdate:modelValue":t[0]||(t[0]=c=>i.username=c),autofocus:"",type:"test",name:"nodeCmsUsername",autocomplete:"on",placeholder:e.$filters.translate("TL_USERNAME")},null,8,gi),[[ye,i.username]]),q(a("input",{ref:"password","onUpdate:modelValue":t[1]||(t[1]=c=>i.password=c),type:"password",name:"nodeCmsPassword",autocomplete:"on",placeholder:e.$filters.translate("TL_PASSWORD")},null,8,_i),[[ye,i.password]]),i.loginFailed?(h(),f("span",yi,g(e.$filters.translate("TL_LOGIN_FAIL")),1)):_("",!0),a("div",{class:w(["login-btn-wrapper",{disabled:!i.username||!i.password||i.loggingIn}])},[a("button",{disabled:i.loggingIn},g(e.$filters.translate("TL_CONFIRM")),9,vi)],2)],32)])],2)):_("",!0),i.LoadingService.isShow?(h(),L(n,{key:1})):_("",!0)]),_:1})}const Si=D(mi,[["render",bi],["__scopeId","data-v-61042664"]]);const wi={mixins:[Be,ke,K],props:{resource:{type:Object,default:()=>{}},locale:{type:String,default:"enUS"},multiselectItems:{type:Array,default:()=>[]},recordList:{type:Array,default:()=>[]}},data(){return{scrolledToBottom:!1,size:s.size,isEmpty:s.isEmpty}},methods:{onScroll({target:{scrollTop:e,clientHeight:t,scrollHeight:l}}){this.scrolledToBottom=e+t>=l-50},deselectItem(e){this.$emit("changeMultiselectItems",s.filter(this.multiselectItems,t=>t._id!==e._id))},onClickCancel(){this.$emit("cancel")},async onClickDelete(){if(window.confirm(S.get("TL_ARE_YOU_SURE_TO_DELETE_RECORDS",null,{num:s.size(this.multiselectItems)}),S.get("TL_YES"),S.get("TL_NO"))){this.$loading.start("onDeleteMultiselectedItems");try{await te(s.map(this.multiselectItems,e=>async()=>{try{await x.delete(`../api/${this.resource.title}/${e._id}`),this.notify(S.get("TL_RECORD_DELETED",null,{id:e._id}))}catch(t){console.error(t),this.manageError(t,"delete",e)}}),{concurrency:1})}catch(e){console.error(e)}this.multiselect=!1,this.$loading.stop("onDeleteMultiselectedItems"),this.$emit("updateRecordList",null),this.$emit("cancel")}}}},Li={class:"top-bar"},Ri={class:"buttons"},Ci={class:"selected-records-list"};function ki(e,t,l,o,i,r){return h(),L(Q,{elevation:"0",class:"multiselect-page"},{default:m(()=>[a("div",Li,[a("h3",null,g("TL_NUMBER_OF_SELECTED_RECORDS"|e.translate(null,{num:i.size(l.multiselectItems)})),1),a("div",Ri,[p(O,{elevation:"0",class:"delete",rounded:"",disabled:i.isEmpty(l.multiselectItems),onClick:r.onClickDelete},{default:m(()=>[y(g("TL_DELETE"|e.translate),1)]),_:1},8,["disabled","onClick"])])]),a("div",{class:w(["scroll-wrapper",{"scrolled-to-bottom":i.scrolledToBottom}]),onScroll:t[0]||(t[0]=(...n)=>r.onScroll&&r.onScroll(...n))},[a("div",Ci,[(h(!0),f(C,null,V(l.multiselectItems,n=>(h(),f("div",{key:n._id,class:"selected-record"},[p($e,{outlined:"",c:"",small:"",ripple:!1},{default:m(()=>[p(ct,{left:""},{default:m(()=>[p(R,{small:"",onClick:c=>r.deselectItem(n)},{default:m(()=>[y("mdi-close-circle-outline")]),_:2},1032,["onClick"])]),_:2},1024),y(" "+g(e.getName(n)|e.truncate(15))+" ("+g(n._id)+") ",1)]),_:2},1024)]))),128))])],34)]),_:1})}const Ti=D(wi,[["render",ki],["__scopeId","data-v-acaf5f75"]]);const Ii={props:["plugin"]},Ei={class:"plugin-page"};function xi(e,t,l,o,i,r){return h(),f("div",Ei,[(h(),L(dt(l.plugin.component)))])}const Di=D(Ii,[["render",xi],["__scopeId","data-v-284fcf40"]]);const Mi={data(){return{timer:null,isLoading:!0,sysLog:[],error:!1,scrollBottom:!0,data:"",stickyId:-1,count:0,destroyed:!1,autoscroll:!0,lastId:-1,tempId:0,logLines:[],filterOutLines:[],searchKey:null,warningQty:0,errorQty:0,ignoreNextScrollEvent:!1,fakeData:[],config:null}},async mounted(){const{data:e}=await x.get(`${window.location.pathname}../api/_syslog/config`);this.config=e,this.config.wss&&W.events.on("syslog",t=>{s.isEmpty(t)||(this.error=!1,this.logLines.push(...t),this.lastId=s.last(this.logLines).id,this.updateSysLog()),this.autoscroll&&(this.ignoreNextScrollEvent=!0,this.$refs.scroller.scrollToBottom())}),this.$nextTick(()=>{this.refreshLog(),this.$refs.scroller&&this.$refs.scroller.$el.addEventListener("scroll",this.detectScroll)})},async unmounted(){this.destroyed=!0,this.$refs.scroller&&this.$refs.scroller.$el.removeEventListener("scroll",this.detectScroll),clearTimeout(this.timer)},methods:{filterLevel(e){this.searchKey=`sift:{level: {$gte: ${e}}}`,this.updateSysLog()},detectScroll(e){const t=s.get(e,"srcElement.scrollHeight",0),l=s.get(e,"srcElement.scrollTop",0),o=s.get(e,"srcElement.clientHeight",0);if(this.ignoreNextScrollEvent){this.ignoreNextScrollEvent=!1;return}this.$nextTick(()=>{this.autoscroll===!1&&l+o>=t&&(this.stickyId=-1),this.autoscroll=l+o>=t})},getLogViewerHeight(){return s.get(this.$refs["log-viewer"],"offsetHeight",100)},onInputSearch(){this.updateSysLog()},onClickRefresh(){this.error=!1,this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog(),this.lastId=-1},onClickClearSearch(){this.searchKey=null,this.updateSysLog()},onClickAutoscroll(){this.autoscroll=!this.autoscroll},onClickClear(){this.searchKey=null,this.logLines=[],this.sysLog=[],this.updateSysLog()},calculateLineNumberSpacing(e){return s.padStart(e,8,"0")+" |"},jumpTo(e){if(!(!this.searchKey&&this.stickyId!==e)){if(this.stickyId===e){this.stickyId=-1,this.autoscroll=!0;return}this.ignoreNextScrollEvent=!0,this.autoscroll=!1,this.onClickClearSearch(),this.$nextTick(()=>{document.querySelector(`[data-line-id='${e}'][data-is-active='true']`)||this.$refs.scroller.scrollToItem(s.findIndex(this.logLines,l=>l.id===e)-14),this.stickyId=e})}},async refreshLog(){try{if(this.config.wss)W.client&&(W.send({action:"syslog",id:this.lastId}),this.isLoading=!1,this.error=!1);else{const e=await x.get(`${window.location.pathname}../api/_syslog`,{params:{id:this.lastId}});this.isLoading=!1,this.error=!1,s.isEmpty(e.data)||(this.error=!1,this.logLines.push(...e.data),this.lastId=s.last(this.logLines).id,this.updateSysLog()),this.autoscroll&&(this.ignoreNextScrollEvent=!0,this.$refs.scroller.scrollToBottom())}}catch(e){console.error(e),this.error=!0}this.destroyed||(this.timer=setTimeout(this.refreshLog,this.error?2e3:200))},updateSysLog(){let e=s.uniqBy(this.logLines,"id");const t=s.groupBy(this.logLines,"level");if(this.warningQty=s.get(t,"[1].length",0),this.errorQty=s.get(t,"[2].length",0),!s.isEmpty(this.searchKey))if(this.searchKey.search("sift:")===0)try{const l=Ue.parse(this.searchKey.substr(5));e=e.filter(Fe(l))}catch{}else e=s.filter(e,l=>s.includes(s.toLower(l.line),s.toLower(this.searchKey)));this.sysLog=e,this.filterOutLines=s.get(this.logLines,"length",0)-s.get(this.sysLog,"length",0)}}},Oi={class:"syslog"},Ai={class:"buttons"},Vi=["placeholder"],Fi={key:1,class:"item filter-out"},Ui={class:"item logs-raised-flags"},Ni={key:0,class:"bg-error"},$i={ref:"log-viewer",class:"log-viewer-wrapper"},Pi=["data-line-id","data-is-active"],Bi=["onClick"],qi=["innerHTML"];function Hi(e,t,l,o,i,r){const n=T("DynamicScrollerItem"),c=T("DynamicScroller");return h(),f("div",Oi,[a("div",Ai,[a("button",{class:w(["item autoscroll",{active:i.autoscroll}]),onClick:t[0]||(t[0]=(...d)=>r.onClickAutoscroll&&r.onClickAutoscroll(...d))},[i.autoscroll?(h(),L(R,{key:0},{default:m(()=>[y("mdi-lock-outline")]),_:1})):(h(),L(R,{key:1},{default:m(()=>[y("mdi-unlock")]),_:1}))],2),a("button",{class:"item clear",onClick:t[1]||(t[1]=(...d)=>r.onClickClear&&r.onClickClear(...d))},[p(R,null,{default:m(()=>[y("mdi-trash-can-outline")]),_:1})]),a("button",{class:"item refresh",onClick:t[2]||(t[2]=(...d)=>r.onClickRefresh&&r.onClickRefresh(...d))},[p(R,null,{default:m(()=>[y("mdi-refresh")]),_:1})]),q(a("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>i.searchKey=d),class:w([{"is-sift":i.searchKey&&i.searchKey.search("sift:")===0},"item search"]),placeholder:"TL_SEARCH"|e.translate,onInput:t[4]||(t[4]=(...d)=>r.onInputSearch&&r.onInputSearch(...d))},null,42,Vi),[[ye,i.searchKey]]),i.searchKey&&i.searchKey.length>0?(h(),f("button",{key:0,class:"item clear-search",onClick:t[5]||(t[5]=(...d)=>r.onClickClearSearch&&r.onClickClearSearch(...d))},[p(R,null,{default:m(()=>[y("mdi-close")]),_:1})])):_("",!0),i.filterOutLines>0?(h(),f("div",Fi,[p(R,null,{default:m(()=>[y("mdi-target")]),_:1}),y(g(i.filterOutLines)+" lines are filter out",1)])):_("",!0),a("div",Ui,[i.warningQty>=0?(h(),f("span",{key:0,class:"flag-item flag-warning",onClick:t[6]||(t[6]=d=>r.filterLevel(1))},[p(R,null,{default:m(()=>[y("mdi-flag-outline")]),_:1}),y(" "+g(i.warningQty),1)])):_("",!0),i.errorQty>=0?(h(),f("span",{key:1,class:"flag-item flag-error",onClick:t[7]||(t[7]=d=>r.filterLevel(2))},[p(R,null,{default:m(()=>[y("mdi-alert-box-outline")]),_:1}),y(" "+g(i.errorQty),1)])):_("",!0)])]),i.error?(h(),f("div",Ni,g("TL_ERROR_RETRIEVE_SYSLOG"|e.translate),1)):_("",!0),a("div",$i,[p(c,{ref:"scroller",items:i.sysLog,"min-item-size":14,class:"scroller"},{default:m(({item:d,index:u,active:v})=>[p(n,{item:d,active:v,"size-dependencies":[r.calculateLineNumberSpacing(d.id),d.line],"data-index":u},{default:m(()=>[a("div",{class:"line-wrapper","data-line-id":d.id,"data-is-active":v},[a("div",{class:w(["line-number",{stickId:i.stickyId===d.id,search:i.searchKey}]),onClick:E=>r.jumpTo(d.id)},g(d.id),11,Bi),a("div",{class:"line-content",innerHTML:d.html},null,8,qi)],8,Pi)]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])],512)])}const Gi=D(Mi,[["render",Hi],["__scopeId","data-v-049fdc3c"]]);const ji={data(){return{config:null,status:null,error:null,type:0,loading:!1,uploadedXlsx:null,dragover:!1}},async mounted(){const e=await x("./config");this.config=e.data.import},methods:{getRules(){return[e=>!e||e.type==="text/xlsx"||e.type==="text/xls"||e.type==="text/csv"||"Only XLSX/XLS/CSV files allowed"]},clickOnFileInput(){this.$refs.xlsxFile.$refs.input.click()},onDrop(e){if(this.dragover=!1,e.dataTransfer.files.length>1)return console.error("Only one file can be uploaded at a time..");this.onChangeXlsxFile(e,e.dataTransfer.files)},async onChangeXlsxFile(e,t=!1){this.uploadedXlsx=null;const l=s.first(t||s.get(e,"target.files",e))||e;l&&(this.uploadedXlsx=l)},openFile(){window.open(`https://docs.google.com/spreadsheets/d/${this.config.gsheetId}/edit`,"_blank").focus()},async checkStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("cms-import"),this.type=0,this.$nextTick(async()=>{try{const e=await x("../import/status");this.status=e.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("cms-import"),this.loading=!1})},async execute(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("cms-import"),this.$nextTick(async()=>{try{const e=await x("../import/execute");this.status=e.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("cms-import"),this.loading=!1})},async checkXlsxStatus(){this.loading=!0,this.status=null,this.error=null,this.$loading.start("xlsx-import"),this.type=0,this.$nextTick(async()=>{try{const e=new FormData;e.append("xlsx",this.uploadedXlsx);const t=await x.post("../import/statusXlsx",e);this.status=t.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("xlsx-import"),this.loading=!1})},async executeXlsx(){this.loading=!0,this.status=null,this.error=null,this.type=1,this.$loading.start("xlsx-import"),this.$nextTick(async()=>{try{const e=new FormData;e.append("xlsx",this.uploadedXlsx);const t=await x.post("../import/executeXlsx",e);this.status=t.data}catch(e){this.status=null,this.error=s.get(e,"message",e)}this.$loading.stop("xlsx-import"),this.loading=!1})}}},z=e=>(ne("data-v-72596d4d"),e=e(),ae(),e),Ki={class:"plugin-wrapper"},Yi=z(()=>a("div",{class:"plugin-title"},[a("h5",null,"Cms Import")],-1)),zi={class:"main-container"},Wi={class:"config-resources"},Xi=z(()=>a("h5",null,"Resources",-1)),Qi=z(()=>a("div",{class:"divider dashed"},null,-1)),Zi=z(()=>a("h5",null,"Actions",-1)),Ji={class:"other-actions"},el=z(()=>a("div",{class:"divider dashed"},null,-1)),tl=z(()=>a("h5",null,"Upload Xlsx",-1)),sl=z(()=>a("div",{class:"subtext"},"Import Excel",-1)),il={class:"other-actions margin-top"},ll={key:0},rl={key:0},ol={key:1},nl=["innerHTML"],al=["innerHTML"];function cl(e,t,l,o,i,r){return h(),f("div",Ki,[Yi,p(Q,{elevation:"0",class:"cms-import"},{default:m(()=>[a("div",zi,[a("div",Wi,[Xi,i.config&&i.config.resources?(h(),L(ut,{key:0,column:""},{default:m(()=>[(h(!0),f(C,null,V(i.config.resources,(n,c)=>(h(),L($e,{key:c,small:"",ripple:!1},{default:m(()=>[y(g(n),1)]),_:2},1024))),128))]),_:1})):_("",!0)]),Qi,Zi,a("div",null,[p(O,{rounded:"",dense:"",onClick:t[0]||(t[0]=n=>r.openFile())},{default:m(()=>[y("Edit Google Sheet")]),_:1}),a("div",Ji,[p(O,{rounded:"",dense:"",disabled:i.loading,onClick:t[1]||(t[1]=n=>r.checkStatus())},{default:m(()=>[y("Check Difference")]),_:1},8,["disabled"]),p(O,{rounded:"",dense:"",disabled:i.loading,onClick:t[2]||(t[2]=n=>r.execute())},{default:m(()=>[y("Import from Remote")]),_:1},8,["disabled"])])]),el,tl,sl,p(Q,{class:w(["file-input-card",{"drag-and-drop":i.dragover,bold:i.uploadedXlsx&&i.uploadedXlsx.name}]),elevation:"0",onDrop:t[3]||(t[3]=B(n=>r.onDrop(n),["prevent"])),onDragover:t[4]||(t[4]=B(n=>i.dragover=!0,["prevent"])),onClick:t[5]||(t[5]=n=>r.clickOnFileInput()),onDragenter:t[6]||(t[6]=B(n=>i.dragover=!0,["prevent"])),onDragleave:t[7]||(t[7]=B(n=>i.dragover=!1,["prevent"]))},{default:m(()=>[i.uploadedXlsx?(h(),f(C,{key:1},[y(g(i.uploadedXlsx.name),1)],64)):(h(),f(C,{key:0},[y("Click or drag & drop to import an .xlsx file")],64)),p(ht,{ref:"xlsxFile",accept:".xlsx, .xls, .csv",rules:r.getRules(),class:"hidden-field",flat:"",dense:"","hide-details":"",type:"file",onChange:r.onChangeXlsxFile},null,8,["rules","onChange"])]),_:1},8,["class"]),a("div",il,[p(O,{rounded:"",dense:"",disabled:i.loading||!i.uploadedXlsx,onClick:t[8]||(t[8]=n=>r.checkXlsxStatus())},{default:m(()=>[y("Check Difference")]),_:1},8,["disabled"]),p(O,{rounded:"",dense:"",disabled:i.loading||!i.uploadedXlsx,onClick:t[9]||(t[9]=n=>r.executeXlsx())},{default:m(()=>[y("Import from Remote")]),_:1},8,["disabled"])]),i.status||i.error?(h(),f("div",ll,[i.type==0?(h(),f("h6",rl,"Difference:")):(h(),f("h6",ol,"Status:")),a("pre",{innerHTML:i.status},null,8,nl),a("pre",{innerHTML:i.error},null,8,al)])):_("",!0)])]),_:1})])}const dl=D(ji,[["render",cl],["__scopeId","data-v-72596d4d"]]);const ul={data(){return{statusInterval:null,error:null,config:null,selectedResource:null,recordData:{},reportData:{},syncStatus:{},uniqueKeyMap:{},environments:["local","remote"],syncingEnvironment:null,isEmpty:s.isEmpty,get:s.get,includes:s.includes}},unmounted(){this.statusInterval&&clearInterval(this.statusInterval)},async mounted(){let e;e=await x.get(`${window.location.pathname}resources`),s.each(e.data,t=>{let l=s.find(t.schema,{unique:!0});l&&(this.uniqueKeyMap[t.title]=l.field)}),e=await x.get(`${window.location.pathname}/config`),this.config=e.data,this.selectedResource&&this.update(),this.statusInterval=setInterval(async()=>{if(this.selectedResource){try{await te(s.map(["local","remote"],l=>async()=>{try{const o=await x.get(`${window.location.pathname}/sync/${l}/${this.selectedResource}/status`);this.syncStatus[l]=o.data,this.syncStatus=s.clone(this.syncStatus)}catch(o){console.error(o)}}))}catch{}const t=s.find(this.syncStatus,{status:"syncing"});!t&&this.syncingEnvironment&&(this.$loading.stop("deploy-resource"),t&&t.status==="error"&&(this.error=t.error),this.syncingEnvironment=!1,this.update())}},5*1e3)},methods:{onChangeResource(){this.update()},async update(){this.$loading.start("loading-resource");try{const e=this.uniqueKeyMap[this.selectedResource];this.recordData={},this.reportData={},await te(s.map(this.environments,n=>async()=>{try{let c;c=await x.get(`${window.location.pathname}sync/${n}/${this.selectedResource}`),s.set(this.recordData,n,c.data),c=await x.get(`${window.location.pathname}sync/${n}/${this.selectedResource}/status`),s.set(this.syncStatus,n,c.data),this.syncStatus=s.clone(this.syncStatus)}catch(c){console.error(c)}}),{concurrency:1}),this.recordData=s.clone(this.recordData);const t=this.recordData.local,l=this.recordData.remote,o=s.map(t,n=>n[e]),i=s.map(l,n=>n[e]);let r=s.intersection(o,i);r=s.filter(r,n=>{let c=s.find(t,u=>u[e]===n),d=s.find(l,u=>u[e]===n);return c._attachments=s.map(c._attachments,u=>s.omit(u,["url"])),d._attachments=s.map(d._attachments,u=>s.omit(u,["url"])),!s.isEqual(c,d)}),s.isEmpty(r)||s.each(r,n=>{console.log(n,"local",s.find(t,{[e]:n}),"remote",s.find(l,{[e]:n}))}),this.reportData={create:s.difference(o,i).length,remove:s.difference(i,o).length,update:r.length}}catch(e){console.error(e)}this.$loading.stop("loading-resource")},async onClickDeploy(e,t){this.error=null,this.$loading.start("deploy-resource"),this.syncingEnvironment=!0;try{await x.post(`../sync/${this.selectedResource}/from/${e}/to/${t}`),s.set(this.syncStatus,`${t}.status`,"syncing"),this.syncStatus=s.clone(this.syncStatus)}catch(l){console.error(l),this.syncingEnvironment=!1,this.$loading.stop("deploy-resource")}}}},he=e=>(ne("data-v-5bc476c0"),e=e(),ae(),e),hl={class:"sync-resources main"},ml=he(()=>a("h1",null,"Sync Resources",-1)),fl={key:0},pl=["value"],gl={key:0,class:"num-records"},_l=he(()=>a("span",null,"number of records",-1)),yl={class:"num-records-wrapper"},vl=["num"],bl={key:1,class:"num-records"},Sl=he(()=>a("span",null,"records difference",-1)),wl={class:"num-records-wrapper"},Ll=["set"],Rl=he(()=>a("span",null,"local / remote",-1)),Cl={key:0},kl={key:1},Tl={key:1,class:"na-field"},Il={key:1,class:"bg-error"};function El(e,t,l,o,i,r){return h(),f("div",hl,[ml,i.config?(h(),f("div",fl,[q(a("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>i.selectedResource=n),onChange:t[1]||(t[1]=(...n)=>r.onChangeResource&&r.onChangeResource(...n))},[(h(!0),f(C,null,V(i.config.sync.resources,n=>(h(),f("option",{key:n,value:n},g(n),9,pl))),128))],544),[[mt,i.selectedResource]]),i.isEmpty(i.recordData)?_("",!0):(h(),f("div",gl,[_l,a("div",yl,[(h(!0),f(C,null,V(i.environments,n=>(h(),f("div",{key:n,class:"num-record",num:i.environments.length},[a("span",null,g(n),1),a("span",null,g(i.get(i.recordData,`${n}.length`,"N/A")),1)],8,vl))),128))])])),i.isEmpty(i.reportData)?_("",!0):(h(),f("div",bl,[Sl,a("div",wl,[a("div",{class:"num-record",num:"1",set:e.enabled=i.get(i.recordData,"local.length")!==void 0&&i.get(i.recordData,"remote.length")!==void 0},[e.enabled?(h(),f(C,{key:0},[i.get(i.syncStatus,"local.status")!=="syncing"&&i.get(i.syncStatus,"remote.status")!=="syncing"?(h(),f(C,{key:0},[Rl,a("span",null,"create: "+g(i.reportData.create),1),a("span",null,"update: "+g(i.reportData.update),1),a("span",null,"remove: "+g(i.reportData.remove),1),i.includes(i.get(i.syncStatus,"remote.allows"),"write")?(h(),f("span",Cl,[a("button",{onClick:t[2]||(t[2]=n=>r.onClickDeploy("local","remote"))},"push to remote")])):_("",!0),i.includes(i.get(i.syncStatus,"local.allows"),"write")?(h(),f("span",kl,[a("button",{onClick:t[3]||(t[3]=n=>r.onClickDeploy("remote","local"))},"pull from remote")])):_("",!0)],64)):_("",!0),i.get(i.syncStatus,"local.status")==="syncing"?(h(),f(C,{key:1},[a("span",null,"resource: "+g(i.get(i.syncStatus,"local.resource")),1),a("span",null,"created: "+g(i.get(i.syncStatus,"local.created"))+" / "+g(i.get(i.syncStatus,"local.createTotal")),1),a("span",null,"updated: "+g(i.get(i.syncStatus,"local.updated"))+" / "+g(i.get(i.syncStatus,"local.updateTotal")),1),a("span",null,"removed: "+g(i.get(i.syncStatus,"local.removed"))+" / "+g(i.get(i.syncStatus,"local.removeTotal")),1)],64)):_("",!0),i.get(i.syncStatus,"remote.status")==="syncing"?(h(),f(C,{key:2},[a("span",null,"resource: "+g(i.get(i.syncStatus,"remote.resource")),1),a("span",null,"created: "+g(i.get(i.syncStatus,"remote.created"))+" / "+g(i.get(i.syncStatus,"remote.createTotal")),1),a("span",null,"updated: "+g(i.get(i.syncStatus,"remote.updated"))+" / "+g(i.get(i.syncStatus,"remote.updateTotal")),1),a("span",null,"removed: "+g(i.get(i.syncStatus,"remote.removed"))+" / "+g(i.get(i.syncStatus,"remote.removeTotal")),1)],64)):_("",!0)],64)):_("",!0),e.enabled?_("",!0):(h(),f("span",Tl," N/A "))],8,Ll)])]))])):_("",!0),i.error?(h(),f("div",Il," Error: "+g(i.error),1)):_("",!0)])}const xl=D(ul,[["render",El],["__scopeId","data-v-5bc476c0"]]);let M={fieldIsRequired:"This field is required!",invalidFormat:"Invalid format!",numberTooSmall:"The number is too small! Minimum: {0}",numberTooBig:"The number is too big! Maximum: {0}",invalidNumber:"Invalid number",invalidInteger:"The value is not an integer",textTooSmall:"The length of text is too small! Current: {0}, Minimum: {1}",textTooBig:"The length of text is too big! Current: {0}, Maximum: {1}",thisNotText:"This is not a text!",thisNotArray:"This is not an array!",selectMinItems:"Select minimum {0} items!",selectMaxItems:"Select maximum {0} items!",invalidDate:"Invalid date!",dateIsEarly:"The date is too early! Current: {0}, Minimum: {1}",dateIsLate:"The date is too late! Current: {0}, Maximum: {1}",invalidEmail:"Invalid e-mail address!",invalidURL:"Invalid URL!",invalidCard:"Invalid card format!",invalidCardNumber:"Invalid card number!",invalidTextContainNumber:"Invalid text! Cannot contains numbers or special characters",invalidTextContainSpec:"Invalid text! Cannot contains special characters"};function U(e,t,l=M){return!b.isNil(e)&&e!==""?null:t?[k(l.fieldIsRequired)]:[]}function k(e){if(e!=null&&arguments.length>1)for(let t=1;t<arguments.length;t++)e=e.replace("{"+(t-1)+"}",arguments[t]);return e}const ie={resources:M,required(e,t,l,o=M){return U(e,t.required,o)},number(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;let r=[];return b.isFinite(e)?(!b.isNil(t.min)&&e<t.min&&r.push(k(o.numberTooSmall,t.min)),!b.isNil(t.max)&&e>t.max&&r.push(k(o.numberTooBig,t.max))):r.push(k(o.invalidNumber)),r},integer(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;let r=ie.number(e,t,l,o);return b.isInteger(e)||r.push(k(o.invalidInteger)),r},double(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!b.isNumber(e)||isNaN(e))return[k(o.invalidNumber)]},string(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;let r=[];return b.isString(e)?(!b.isNil(t.min)&&e.length<t.min&&r.push(k(o.textTooSmall,e.length,t.min)),!b.isNil(t.max)&&e.length>t.max&&r.push(k(o.textTooBig,e.length,t.max))):r.push(k(o.thisNotText)),r},array(e,t,l,o=M){if(t.required){if(!b.isArray(e))return[k(o.thisNotArray)];if(e.length===0)return[k(o.fieldIsRequired)]}if(!b.isNil(e)){if(!b.isNil(t.min)&&e.length<t.min)return[k(o.selectMinItems,t.min)];if(!b.isNil(t.max)&&e.length>t.max)return[k(o.selectMaxItems,t.max)]}},date(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;let r=new Date(e);if(isNaN(r.getDate()))return[k(o.invalidDate)];let n=[];if(!b.isNil(t.min)){let c=new Date(t.min);r.valueOf()<c.valueOf()&&n.push(k(o.dateIsEarly,Y.format(r),Y.format(c)))}if(!b.isNil(t.max)){let c=new Date(t.max);r.valueOf()>c.valueOf()&&n.push(k(o.dateIsLate,Y.format(r),Y.format(c)))}return n},regexp(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!b.isNil(t.pattern)&&!new RegExp(t.pattern).test(e))return[k(o.invalidFormat)]},email(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))return[k(o.invalidEmail)]},url(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g.test(e))return[k(o.invalidURL)]},creditCard(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;const r=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,n=e.replace(/[^0-9]+/g,"");if(!r.test(n))return[k(o.invalidCard)];let c=0,d,u,v;for(let E=n.length-1;E>=0;E--)d=n.substring(E,E+1),u=parseInt(d,10),v?(u*=2,u>=10?c+=u%10+1:c+=u):c+=u,v=!v;if(!(c%10===0&&n))return[k(o.invalidCardNumber)]},alpha(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!/^[a-zA-Z]*$/.test(e))return[k(o.invalidTextContainNumber)]},alphaNumeric(e,t,l,o=M){let i=U(e,t.required,o);if(i!=null)return i;if(!/^[a-zA-Z0-9]*$/.test(e))return[k(o.invalidTextContainSpec)]}};Object.keys(ie).forEach(e=>{const t=ie[e];b.isFunction(t)&&(t.locale=l=>(o,i,r)=>t(o,i,r,b.defaults(l,M)))});const Dl=(e,t="")=>typeof e.id<"u"?t+e.id:t+(e.inputName||e.label||e.model||"").toString().trim().toLowerCase().replace(/ |_/g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").replace(/([^a-zA-Z0-9-]+)/g,"");function Oe(e){return b.isString(e)?ie[e]!=null?ie[e]:(console.warn(`'${e}' is not a validator function!`),null):e}function pe(e,t,l){let o=b.get(l.context,"schema.attributes",{}),i=t.value||"input";b.isString(i)&&(o=b.get(o,i)||o),b.forEach(o,(r,n)=>{e.setAttribute(n,r)})}const Ge={props:["model","schema","formOptions","disabled","focused"],data(){return{errors:[],debouncedValidateFunc:null,debouncedFormatFunc:null}},directives:{attributes:{bind:pe,updated:pe,componentUpdated:pe}},watch:{focused(){if(this.focused===-1)return;let e=b.get(this.$refs,"input",!1);if(!e)return console.error("no input ref for ",this.schema);b.isFunction(e.focus)&&this.focused&&e.focus()}},computed:{value:{cache:!1,get(){return b.isFunction(b.get(this.schema,"get"))?this.schema.get(this.model):b.get(this.model,this.schema.model)},set(e){let t=this.value;b.isFunction(e)?e(e,t):this.updateModelValue(e,t)}}},methods:{getOpt(e,t){return b.get(this.schema,`options.${e}`,t)},validate(e){this.clearValidationErrors();let t=b.get(this.formOptions,"validateAsync",!1),l=[];if(this.schema.validator&&this.schema.readonly!==!0&&this.disabled!==!0){let i=[];b.isArray(this.schema.validator)?b.forEach(this.schema.validator,r=>{i.push(Oe(r).bind(this))}):i.push(Oe(this.schema.validator).bind(this)),b.forEach(i,r=>{if(t)l.push(r(this.value,this.schema,this.model));else{let n=r(this.value,this.schema,this.model);n&&b.isFunction(n.then)?n.then(c=>{c&&(this.errors=this.errors.concat(c));let d=this.errors.length===0;this.$emit("validated",d,this.errors,this)}):n&&(l=l.concat(n))}})}let o=i=>{let r=[];b.forEach(b.uniq(i),c=>{b.isArray(c)&&c.length>0?r=r.concat(c):b.isString(c)&&r.push(c)}),b.isFunction(this.schema.onValidated)&&this.schema.onValidated.call(this,this.model,r,this.schema);let n=r.length===0;return e||this.$emit("validated",n,r,this),this.errors=r,r};return t?Promise.all(l).then(o):o(l)},debouncedValidate(){b.isFunction(this.debouncedValidateFunc)||(this.debouncedValidateFunc=b.debounce(this.validate.bind(this),b.get(this.schema,"validateDebounceTime",b.get(this.formOptions,"validateDebounceTime",500)))),this.debouncedValidateFunc()},updateModelValue(e,t){let l=!1;b.isFunction(this.schema.set)?(this.schema.set(this.model,e),l=!0):this.schema.model&&(this.setModelValueByPath(this.schema.model,e),l=!0),l&&(b.isFunction(this.schema.onChanged)&&this.schema.onChanged.call(this,this.model,e,t,this.schema),b.get(this.formOptions,"validateAfterChanged",!1)===!0&&(b.get(this.schema,"validateDebounceTime",b.get(this.formOptions,"validateDebounceTime",0))>0?this.debouncedValidate():this.validate()),this.$emit("input",e,this.schema.model))},clearValidationErrors(){this.errors.splice(0)},setModelValueByPath(e,t){let l=e.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");let o=this.model;const i=l.split(".");let r=0;const n=i.length;for(;r<n;){let c=i[r];if(r<n-1)o[c]!==void 0||this.$root.$set(o,c,{}),o=o[c];else{this.$root.$set(o,c,t);return}++r}},getKeyLocale(){const e={},t=this.schema.model.split(".");return this.schema.localised&&(e.locale=t.shift()),e.key=t.join("."),e},getFieldID(e,t=!1){const l=b.get(this.formOptions,"fieldIdPrefix","");return Dl(e,l)+(t?"-"+b.uniqueId():"")},getFieldClasses(){return b.get(this.schema,"fieldClasses",[])}}};s.get;const Ml={props:["format","name","width","value"],data(){return{hideCal:!0,activePort:null,timeStamp:null,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Su","Mo","Tu","We","Th","Fr","Sa"],monthIndex:0,hourIndex:0,minuteIndex:0,year:2017,portsHolder:[],minute:0,hour:1,day:1,minuteSelectorVisible:!1,hourSelectorVisible:!1,period:"AM"}},computed:{ports:{get(){let e=[];if(this.portsHolder.length===0)for(let t=0;t<42;t++)e.push("");else e=this.portsHolder;return e},set(e){this.portsHolder=e}},month(){return this.months[this.monthIndex]},dateTime(){return`${this.timeStamp.getFullYear()}-${this.timeStamp.getMonth()+1}-${this.timeStamp.getUTCDay()}`},minutes(){const e=[];for(let t=0;t<60;t++)t<10?e.push(`0${t}`):e.push(`${t}`);return e},hours(){const e=[];for(let t=1;t<=12;t++)t<10?e.push(`0${t}`):e.push(`${t}`);return e},dateFormat(){return this.format||"YYYY-MM-DD hh:mm:ss a"},hideTime(){return this.dateFormat.indexOf("hh:mm:ss")===-1},hideDate(){return this.dateFormat==="hh:mm:ss a"}},created(){let e=new Date;this.value&&(e=new Date(this.value),this.timeStamp=e),this.year=e.getFullYear(),this.monthIndex=e.getMonth(),this.day=e.getDate(),this.period=e.getHours()>=12?"PM":"AM",this.hour=e.getHours(),this.hour===0?this.hour+=12:this.hour>12&&(this.hour-=12),this.minute=e.getMinutes()||0,this.updateCalendar(),document.addEventListener("keydown",this.keyIsDown),document.addEventListener("click",this.documentClicked),this.setDate()},unmounted(){document.removeEventListener("keydown",this.keyIsDown),document.removeEventListener("click",this.documentClicked)},methods:{padZero(e){return s.padStart(e,2,"0")},display(){return this.timeStamp?Y(this.timeStamp).format(this.dateFormat):""},leftMonth(){const e=this.months.indexOf(this.month);e===0?this.monthIndex=11:this.monthIndex=e-1,this.updateCalendar()},rightMonth(){const e=this.months.indexOf(this.month);e===11?this.monthIndex=0:this.monthIndex=e+1,this.updateCalendar()},rightYear(){this.year++,this.updateCalendar()},leftYear(){this.year--,this.updateCalendar()},updateCalendar(){const e=this,l=new Date(e.year,e.monthIndex,1,0,0,0).getDay(),o=new Date(e.year,e.monthIndex+1,0).getDate(),i=[];let r=35;(l===6||l===5&&o===31)&&(r=42);let n=!1;for(let c=0;c<r;c++){const d=c-l,u=d<0||d>=o?"":d+1;i.push(u),this.timeStamp&&u===e.day&&this.timeStamp.getMonth()===e.monthIndex&&this.timeStamp.getFullYear()===e.year&&(e.activePort=c,n=!0)}n||(e.activePort=-1),this.ports=i},setDay(e,t){t!==""&&(this.activePort=e,this.day=t,this.timeStamp=new Date(this.year,this.monthIndex,this.day),this.setDate(!0))},setMinute(e,t){this.minuteIndex=e,this.minute=e,t&&(this.minuteSelectorVisible=!1)},setHour(e,t){this.hourIndex=e,this.hour=e+1,t&&(this.hourSelectorVisible=!1)},showHourSelector(){this.hourSelectorVisible=!0,this.minuteSelectorVisible=!1},showMinuteSelector(){this.minuteSelectorVisible=!0,this.hourSelectorVisible=!1},keyIsDown(e){const t=e.which||e.keycode;t===38?this.minuteSelectorVisible&&this.minuteIndex>0?(this.setMinute(this.minuteIndex-1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex>0&&(this.setHour(this.hourIndex-1,!1),this.scrollTopHour()):t===40?this.minuteSelectorVisible&&this.minuteIndex<this.minutes.length-1?(this.setMinute(this.minuteIndex+1,!1),this.scrollTopMinute()):this.hourSelectorVisible&&this.hourIndex<this.hours.length-1&&(this.setHour(this.hourIndex+1,!1),this.scrollTopHour()):t===13&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),(this.minuteSelectorVisible||this.hourSelectorVisible)&&(e.preventDefault(),this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1)},scrollTopMinute(){const e=this.$refs.minuteScroller.scrollHeight,t=this.$refs.minuteScrollerWrapper.clientHeight,l=e*(this.minuteIndex/(this.minutes.length-1))-t/2;this.$refs.minuteScroller.scrollTop=l},scrollTopHour(){const e=this.$refs.hourScroller.scrollHeight,t=this.$refs.hourScrollerWrapper.clientHeight,l=e*(this.hourIndex/(this.hours.length-1))-t/2;this.$refs.hourScroller.scrollTop=l},changePeriod(){this.period=this.period==="AM"?"PM":"AM"},calendarClicked(e){e.target.id!=="j-hour"&&e.target.id!=="j-minute"&&(this.minuteSelectorVisible=!1,this.hourSelectorVisible=!1),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},documentClicked(e){e.target.id!=="tj-datetime-input"&&(this.hideCal=!0)},toggleCal(){this.hideCal=!this.hideCal},clearDate(){this.timeStamp="",this.$emit("input",""),this.hideCal=!0},setDate(e){let t=this.hour;this.hour===12&&this.period==="AM"&&(t=t-12),this.hour!==12&&this.period==="PM"&&(t=t+12);const l=new Date(this.year||1970,this.monthIndex||0,this.day||1,t,this.minute,0);e&&(this.timeStamp=l,this.$emit("input",l.getTime()),this.hideCal=!0)}}},je=e=>(ne("data-v-c6aa99c4"),e=e(),ae(),e),Ol=["value","name"],Al={class:"year-month-wrapper"},Vl={class:"month-setter"},Fl={class:"year"},Ul={class:"month-setter"},Nl={class:"month"},$l={class:"headers"},Pl=["onClick"],Bl={class:"hour-selector"},ql={ref:"hourScroller"},Hl=["onClick"],Gl=je(()=>a("div",{class:"time-separator"},[a("span",null,":")],-1)),jl={class:"minute-selector"},Kl={ref:"minuteScroller"},Yl=["onClick"],zl=je(()=>a("div",{class:"time-separator"},[a("span",null,":")],-1)),Wl={class:"minute-selector"};function Xl(e,t,l,o,i,r){return h(),f("div",{style:ft({width:l.width}),class:"datetime-picker",onClick:t[11]||(t[11]=n=>r.calendarClicked(n))},[a("div",null,[a("input",{id:"tj-datetime-input",ref:"input",readonly:"",type:"text",value:r.display(),name:l.name,autocomplete:"off",onClick:t[0]||(t[0]=(...n)=>r.toggleCal&&r.toggleCal(...n))},null,8,Ol),a("div",{class:w(["calender-div",{noDisplay:i.hideCal}])},[a("div",{class:w({noDisplay:r.hideDate})},[a("div",Al,[a("div",Vl,[a("span",{type:"button",class:"nav-l",onClick:t[1]||(t[1]=(...n)=>r.leftYear&&r.leftYear(...n))},[p(R,null,{default:m(()=>[y("mdi-chevron-left")]),_:1})]),a("span",Fl,g(i.year),1),a("span",{type:"button",class:"nav-r",onClick:t[2]||(t[2]=(...n)=>r.rightYear&&r.rightYear(...n))},[p(R,null,{default:m(()=>[y("mdi-chevron-right")]),_:1})])]),a("div",Ul,[a("span",{type:"button",class:"nav-l",onClick:t[3]||(t[3]=(...n)=>r.leftMonth&&r.leftMonth(...n))},[p(R,null,{default:m(()=>[y("mdi-chevron-left")]),_:1})]),a("span",Nl,g("TL_"+r.month.toUpperCase()|e.translate),1),a("span",{type:"button",class:"nav-r",onClick:t[4]||(t[4]=(...n)=>r.rightMonth&&r.rightMonth(...n)),onMousedown:t[5]||(t[5]=B(()=>{},["stop","prevent"]))},[p(R,null,{default:m(()=>[y("mdi-chevron-right")]),_:1})],32)])]),a("div",$l,[(h(!0),f(C,null,V(i.days,(n,c)=>(h(),f("span",{key:c,class:"days"},g("TL_"+n.toUpperCase()|e.translate),1))),128))]),a("div",null,[(h(!0),f(C,null,V(r.ports,(n,c)=>(h(),f("span",{key:c,class:w(["port",{activePort:c===i.activePort}]),onClick:d=>r.setDay(c,n)},g(n),11,Pl))),128))])],2),a("div",{class:w(["time-picker",{noDisplay:r.hideTime}])},[a("div",Bl,[a("div",{id:"j-hour",onClick:t[6]||(t[6]=(...n)=>r.showHourSelector&&r.showHourSelector(...n))},g(r.padZero(i.hour)),1),a("div",{ref:"hourScrollerWrapper",class:w(["scroll-hider",{showSelector:i.hourSelectorVisible}])},[a("ul",ql,[(h(!0),f(C,null,V(r.hours,(n,c)=>(h(),f("li",{key:c,class:w({active:c==i.hourIndex}),onClick:d=>r.setHour(c,!0)},g(n),11,Hl))),128))],512)],2)]),Gl,a("div",jl,[a("div",{id:"j-minute",onClick:t[7]||(t[7]=(...n)=>r.showMinuteSelector&&r.showMinuteSelector(...n))},g(r.padZero(i.minute)),1),a("div",{ref:"minuteScrollerWrapper",class:w(["scroll-hider",{showSelector:i.minuteSelectorVisible}])},[a("ul",Kl,[(h(!0),f(C,null,V(r.minutes,(n,c)=>(h(),f("li",{key:c,class:w({active:c==i.minuteIndex}),onClick:d=>r.setMinute(c,!0)},g(n),11,Yl))),128))],512)],2)]),zl,a("div",Wl,[a("div",{onClick:t[8]||(t[8]=(...n)=>r.changePeriod&&r.changePeriod(...n))},g("TL_"+i.period.toUpperCase()|e.translate),1)])],2),a("span",{type:"button",class:"okButton",onClick:t[9]||(t[9]=n=>r.setDate(!0))},g("TL_OK"|e.translate),1),a("span",{type:"button",class:"okButton",onClick:t[10]||(t[10]=n=>r.clearDate())},g("TL_CLEAR"|e.translate),1)],2)])],4)}const Ql=D(Ml,[["render",Xl],["__scopeId","data-v-c6aa99c4"]]);s.get;const Zl={install(e,t){this.params=t,e.config.globalProperties.$loading=Ce}};function Jl(e,t,l){return S.get(e,t,l)}function er(e,t){return s.isString(t)?(s.includes(t,"n")&&console.warn("Truncate - should truncate the text by number of items"),s.truncate(e,{length:s.toNumber(t)})):s.truncate(e,{length:t})}const tr=pt({history:gt(),routes:[{path:"/",component:Se}]}),oe=_t({render:()=>{const e=document.querySelector("#app");return e?Ee(e.getAttribute("type")==="login"?Si:Se):Ee(Se)}});oe.config.globalProperties.$filters={translate:Jl,truncate:er};oe.use(tr).use(St).component("PluginPage",Di).component("MultiselectPage",Ti).component("Syslog",Gi).component("CmsImport",dl).component("SyncResource",xl).use(Zl).use(yt).use(vt).use(bt,{name:"timeago"});function ge(e,t,l="System",o=["admins","imagination"]){window.plugins=window.plugins||[],window.plugins.push({title:e,displayname:t,component:e,group:l,allowed:o,type:"plugin"})}let Ke=document.createElement("script");Ke.setAttribute("src","./plugins/scripts/bundle.js");document.head.appendChild(Ke);window.addEventListener("load",async function(){s.each(window.plugins,l=>{l.type="plugin"}),window.TranslateService=S;const t=(await x.get(`${window.location.pathname}config`)).data;ge("Syslog","Syslog"),t.import&&ge("CmsImport","Cms Import"),t.sync&&!t.sync.disablePlugin&&ge("SyncResource","Sync Resource"),window.disableJwtLogin=s.get(t,"disableJwtLogin",!1),window.noLogin=window.disableJwtLogin&&s.get(t,"disableAuthentication",!1),window.nodeCms=oe,oe.mount("#app")});
